---
aliases: ["Полифилы JavaScript", "Шимы", "Совместимость браузеров"]
tags: [programming, javascript, html, frontend, compatibility, polyfills]
---

# Полифилы

## Общее описание

**Полифилы** (от англ. "polyfill") — это фрагменты кода, которые обеспечивают современные возможности JavaScript в более старых браузерах, которые изначально не поддерживают эти возможности. Полифилы "заполняют пробел" между возможностями современного JavaScript и тем, что поддерживает целевой браузер.

## Отличие полифилов от транспиляции

- **Транспиляция** (например, с помощью Babel) преобразует современный синтаксис в старый (например, стрелочные функции в обычные функции)
- **Полифилы** обеспечивают отсутствующие API и методы (например, `Array.prototype.includes`, `Promise`, `fetch`)

## Основные полифилы

### ES-связанные полифилы

- `Promise` — для работы с асинхронными операциями
- `fetch` — для выполнения HTTP-запросов
- `Array.prototype.includes` — для проверки наличия элемента в массиве
- `Object.assign` — для объединения объектов
- `Array.from` — для создания массивов из итерируемых объектов
- `Array.prototype.find` — для поиска элементов в массиве
- `String.prototype.startsWith/endsWith` — для проверки начала/конца строки

### DOM-связанные полифилы

- `CustomEvent` — для создания пользовательских событий
- `Element.prototype.classList` — для работы с классами элементов
- `Element.prototype.closest` — для поиска ближайшего родительского элемента
- `Element.prototype.matches` — для проверки соответствия селектору

## Популярные библиотеки полифилов

### core-js

`core-js` — это универсальный полифил для современных возможностей JavaScript:

```bash
npm install core-js
```

Пример использования:

```javascript
// Импорт всех полифилов
import 'core-js';

// Или импорт конкретных полифилов
import 'core-js/features/array/includes';
import 'core-js/features/promise';
import 'core-js/features/object/assign';
```

### regenerator-runtime

Необходим для поддержки `async/await` в старых браузерах:

```bash
npm install regenerator-runtime
```

```javascript
import 'regenerator-runtime/runtime';
```

### babel-polyfills

Ранее использовался для полифилов с Babel, но теперь рекомендуется использовать `core-js` напрямую:

```javascript
// Вместо импорта babel-polyfill
import 'core-js/stable';
import 'regenerator-runtime/runtime';
```

## Настройка полифилов

### Использование с Babel

Для автоматического добавления необходимых полифилов через Babel:

```json
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "targets": {
          "browsers": ["> 1%", "last 2 versions", "not dead"]
        },
        "useBuiltIns": "usage",
        "corejs": {
          "version": 3,
          "proposals": true
        }
      }
    ]
  ]
}
```

С опцией `"useBuiltIns": "usage"` Babel автоматически добавит только те полифилы, которые действительно используются в коде.

### Ручное подключение

Для точечного подключения полифилов:

```html
<!-- Подключение полифилов до основного скрипта -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,Array.prototype.includes,fetch"></script>
<script src="app.js"></script>
```

## Примеры полифилов

### Полифил для `Array.prototype.includes`

```javascript
if (!Array.prototype.includes) {
  Array.prototype.includes = function(searchElement, fromIndex) {
    'use strict';
    var O = Object(this);
    var len = parseInt(O.length) || 0;
    if (len === 0) {
      return false;
    }
    var n = fromIndex || 0;
    var k;
    if (n >= 0) {
      k = n;
    } else {
      k = len + n;
      if (k < 0) {k = 0;}
    }
    var currentElement;
    while (k < len) {
      currentElement = O[k];
      if (searchElement === currentElement ||
         (searchElement !== searchElement && currentElement !== currentElement)) {
        return true;
      }
      k++;
    }
    return false;
  };
}
```

### Полифил для `Promise`

```javascript
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global.Promise = factory());
}(this, (function () {
  'use strict';
  
  // Реализация Promise
  function Promise(fn) {
    // Реализация Promise...
  }
  
  // Добавление методов...
  
  return Promise;
})));
```

## Совместимость с браузерами в российских реалиях

В России в 2025 году при выборе полифилов нужно учитывать:

- Поддержка IE11 в государственных и корпоративных системах
- Использование Яндекс.Браузера и других альтернативных браузеров
- Медленное обновление браузеров в некоторых регионах

Для настройки под российские реалии:

```json
{
  "browserslist": [
    "> 1%",
    "last 2 versions", 
    "not dead",
    "ie >= 11",
    "yandex >= 1"
  ]
}
```

## Управление размером бандла

### Выборочные полифилы

Вместо подключения всех полифилов, подключайте только необходимые:

```javascript
// Хорошо: точечное подключение
import 'core-js/features/array/includes';
import 'core-js/features/promise';

// Неэффективно: подключение всех полифилов
import 'core-js';
```

### Использование Polyfill.io

Сервис, который предоставляет только необходимые полифилы для конкретного браузера:

```html
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,Array.prototype.includes,fetch"></script>
```

## Современные альтернативы

### Условная загрузка полифилов

```javascript
// Проверка поддержки возможностей и условная загрузка полифилов
if (!window.Promise) {
  import('./polyfills/promise.js');
}

if (!Array.prototype.includes) {
  import('./polyfills/array-includes.js');
}
```

### Нативные возможности браузеров

С развитием браузеров необходимость в полифиллах снижается:

- Все современные браузеры поддерживают ES6+
- Улучшается поддержка модулей
- Улучшается поддержка Web APIs

## Интеграция с HTML

### Через CDN

```html
<!DOCTYPE html>
<html>
<head>
  <title>Проект с полифилами</title>
</head>
<body>
  <div id="app"></div>
  
  <!-- Подключение полифилов -->
  <script src="https://cdn.jsdelivr.net/npm/core-js-bundle@3/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13/runtime.min.js"></script>
  
  <!-- Основной скрипт -->
  <script src="app.js"></script>
</body>
</html>
```

### Через сборку

При использовании Webpack или других сборщиков:

```javascript
// entry.js - точка входа
import 'core-js/stable';
import 'regenerator-runtime/runtime';

// Основной код приложения
import App from './app';
```

## Лучшие практики

1. **Используйте `core-js` с опцией `useBuiltIns: 'usage'`** для автоматического подключения необходимых полифилов
2. **Регулярно обновляйте список целевых браузеров** в соответствии с аудиторией проекта
3. **Минимизируйте количество полифилов** для уменьшения размера бандла
4. **Тестируйте в целевых браузерах** для проверки корректной работы полифилов
5. **Используйте ленивую загрузку** для нечасто используемых возможностей
6. **Отслеживайте поддержку возможностей** на caniuse.com

## Проблемы и решения

### Проблемы с производительностью

- Полифилы увеличивают размер бандла
- Решение: точечное подключение, использование Polyfill.io

### Проблемы с совместимостью

- Некоторые полифилы могут конфликтовать друг с другом
- Решение: тщательное тестирование, использование проверенных библиотек

### Проблемы с поддержкой

- Некоторые возможности сложно или невозможно полифилить
- Решение: альтернативные реализации, ограничение функционала для старых браузеров

## Будущее полифилов

С развитием веб-стандартов и браузеров:

- Уменьшается необходимость в большинстве полифилов
- Появляются новые возможности, требующие новых полифилов
- Развиваются инструменты для автоматического определения необходимых полифилов
- Появляются возможности для отправки разных версий кода для разных браузеров

## См. также

- [[Babel]] - инструмент транспиляции JavaScript
- [[TypeScript]] - язык с транспиляцией и типизацией
- [[Преобразование-кода]] - общие концепции транспиляции
- [[HTML]] - основы веб-разработки
- [[ES6]] - современные возможности JavaScript