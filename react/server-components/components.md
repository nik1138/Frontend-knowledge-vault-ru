---
aliases: ["React Server Components", "Серверные компоненты React"]
tags: 
  - #react
  - #server-components
  - #nextjs
  - #ssr
  - #performance
---

# React Server Components (RSC) - Полное руководство

React Server Components (RSC) — это новая парадигма в разработке React-приложений, позволяющая выполнять рендеринг компонентов на сервере и передавать их на клиент в виде специального формата, а не в виде HTML. Это позволяет оптимизировать производительность, уменьшить размер бандла и улучшить UX.

## Что такое серверные компоненты

Серверные компоненты — это компоненты React, которые рендерятся исключительно на сервере. Они не включаются в клиентский бандл, что уменьшает его размер. Эти компоненты могут напрямую взаимодействовать с базой данных, файловой системой или другими серверными ресурсами без необходимости создания API-эндпоинтов.

```jsx
// ServerComponent.jsx
import { db } from '@/lib/database';

export async function ServerComponent() {
  const data = await db.posts.findMany();
  
  return (
    <div>
      {data.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  );
}
```

## Различия между клиентскими и серверными компонентами

| Характеристика | Серверный компонент | Клиентский компонент |
|----------------|---------------------|----------------------|
| Рендеринг | На сервере | В браузере |
| Размер бандла | Не включается | Включается |
| Доступ к серверным ресурсам | Да | Нет |
| Интерактивность | Требует клиентские компоненты | Полностью интерактивен |
| Состояние | Не может использовать useState | Может использовать useState |
| События | Не может обрабатывать события | Может обрабатывать события |

## Когда использовать серверные компоненты

- Для рендеринга статического контента
- При работе с данными, требующими доступа к серверу
- Для снижения размера клиентского бандла
- При отображении больших списков или таблиц
- Для компонентов, не требующих интерактивности

## Получение данных в серверных компонентах

Серверные компоненты позволяют получать данные напрямую из базы данных или внешних API без промежуточного API-слоя:

```jsx
// DataFetchingComponent.jsx
import { fetchPosts } from '@/services/posts';

export async function DataFetchingComponent() {
  const posts = await fetchPosts();
  
  return (
    <ul>
      {posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

## Безопасность с серверными компонентами

- Конфиденциальная логика остается на сервере
- Клиент не получает доступ к внутренним API или базе данных
- Уязвимости в клиентском коде не затрагивают серверную логику
- Не передавайте чувствительные данные в пропсах клиентских компонентов

## Преимущества производительности

- Меньший размер клиентского бандла
- Быстрее первоначальная загрузка
- Уменьшение количества HTTP-запросов
- Эффективное кэширование на сервере
- Улучшенная производительность на слабых устройствах

## Потоковая передача и прогрессивный рендеринг

RSC поддерживает потоковую передачу контента, что позволяет показывать части UI по мере их готовности:

```jsx
// StreamingExample.jsx
import { Suspense } from 'react';

function StreamingExample() {
  return (
    <div>
      <h1>Статический контент</h1>
      <Suspense fallback={<div>Загрузка...</div>}>
        <ServerComponent />
      </Suspense>
    </div>
  );
}
```

## Сравнение с традиционным SSR

| Аспект | Традиционный SSR | Server Components |
|--------|------------------|-------------------|
| Размер бандла | Полный бандл | Только клиентские части |
| Состояние приложения | На клиенте | На сервере |
| Интерактивность | Немедленная | После гидратации |
| Получение данных | Через API | Прямой доступ |

## Миграция на Server Components

1. Идентифицируйте компоненты с минимальной интерактивностью
2. Перенесите получение данных в серверные компоненты
3. Используйте `use client` для компонентов с интерактивностью
4. Обновите структуру файлов

## Ограничения и ограничения

- Нет доступа к DOM
- Нет доступа к браузерным API
- Нельзя использовать хуки состояния
- Ограниченная поддержка библиотек сторонних разработчиков
- Не поддерживают события браузера

## Структура файлов с Server Components

```
app/
├── layout.js (клиентский)
├── page.js (серверный)
├── components/
│   ├── ClientComponent.jsx (use client)
│   └── ServerComponent.jsx (серверный по умолчанию)
└── api/
    └── ...
```

## Границы ошибок в смешанных средах

```jsx
// ErrorBoundary.jsx
'use client';

import { Component } from 'react';

export class ErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  render() {
    if (this.state.hasError) {
      return <h1>Произошла ошибка</h1>;
    }

    return this.props.children;
  }
}
```

## Стратегии кэширования

- Кэширование на уровне компонентов
- Использование HTTP-кэширования
- Кэширование данных на сервере
- Кэширование с инвалидацией

## Особенности деплоя

- Требуется серверная среда выполнения
- Поддержка Node.js или Edge Runtime
- Необходима поддержка RSC в хостинге
- Рассмотрите использование Next.js 13+ с App Router

## Связь с Next.js App Router

Server Components тесно интегрированы с Next.js App Router:
- Файлы `page.js` по умолчанию являются серверными компонентами
- Поддержка вложенных маршрутов
- Автоматическая оптимизация загрузки

## Отладка Server Components

- Используйте `console.log` на сервере
- Отладка клиентских компонентов как обычно
- Инспекция сетевых запросов
- Инструменты разработчика React

## Тестирование Server Components

- Юнит-тестирование логики получения данных
- Интеграционные тесты с серверной логикой
- Тестирование взаимодействия с базой данных

## Связь с другими файлами React

- [[react/components/functional-components]] - Функциональные компоненты
- [[react/hooks/use-client]] - Директива "use client"
- [[nextjs/app-router]] - Next.js App Router
- [[react/performance/optimization]] - Оптимизация производительности
- [[react/data-fetching]] - Получение данных в React

## Заключение

React Server Components представляют собой мощный инструмент для оптимизации производительности и упрощения архитектуры React-приложений. Правильное использование этой технологии позволяет создавать более быстрые и эффективные веб-приложения.

Для успешного внедрения RSC необходимо понимать различия между серверными и клиентскими компонентами, а также учитывать ограничения и особенности новой парадигмы.