# React Internationalization (i18n)

## Введение в i18n и l10n

**i18n (internationalization)** - это процесс подготовки приложения для поддержки различных языков и культур. Слово "internationalization" содержит 18 букв между "i" и "n", отсюда и сокращение.

**l10n (localization)** - это процесс адаптации уже интернационализированного приложения для конкретной локали (языка, страны, культуры). Слово "localization" содержит 10 букв между "l" и "n".

В контексте React i18n позволяет создавать приложения, которые могут отображаться на разных языках и учитывать культурные особенности пользователей.

## Библиотеки для i18n в React

### React Intl

React Intl - это библиотека от FormatJS, которая предоставляет компоненты и API для интернационализации React-приложений.

```jsx
import { FormattedMessage } from 'react-intl';

function MyComponent() {
  return (
    <FormattedMessage
      id="welcome"
      defaultMessage="Welcome, {name}!"
      values={{ name: 'John' }}
    />
  );
}
```

### i18next

i18next - это мощная библиотека для интернационализации с плагинами для React.

```jsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();
  return <div>{t('welcome', { name: 'John' })}</div>;
}
```

## Управление переводами

### Форматы файлов переводов

Наиболее популярные форматы:
- **JSON** - простой и понятный формат
- **YAML** - более читаемый, особенно для больших файлов
- **PO/MO** - стандарт GNU для переводов

Пример JSON файла:
```json
{
  "welcome": "Welcome",
  "greeting": "Hello, {name}!",
  "items_count": "You have {count, plural, one {# item} other {# items}}"
}
```

### Структура файлов переводов

Рекомендуется организовывать переводы по модулям:
```
locales/
├── en/
│   ├── common.json
│   ├── home.json
│   └── profile.json
└── ru/
    ├── common.json
    ├── home.json
    └── profile.json
```

## Форматирование дат, чисел и валют

### React Intl

```jsx
import { FormattedDate, FormattedNumber, FormattedPlural } from 'react-intl';

function Formatters() {
  const date = new Date();
  const count = 5;
  
  return (
    <div>
      <FormattedDate value={date} year="numeric" month="long" day="2-digit" />
      <FormattedNumber value={1000} style="currency" currency="USD" />
      <FormattedPlural value={count} one="item" other="items" />
    </div>
  );
}
```

### i18next

Для форматирования в i18next часто используются дополнительные плагины или стандартные встроенные API:
```jsx
const formatDate = (date) => {
  return new Intl.DateTimeFormat(i18n.language).format(date);
};
```

## Плюрализация

Обработка множественных форм слов различается в разных языках:

### React Intl
```jsx
<FormattedMessage
  id="items.count"
  defaultMessage="{count, plural, 
    one {# item} 
    few {# items} 
    many {# items} 
    other {# items}
  }"
  values={{ count: itemCount }}
/>
```

### i18next
```jsx
// В файле переводов
{
  "items_count": "{{count}} item",
  "items_count_plural": "{{count}} items"
}

// В компоненте
{t('items_count', { count: 5 })}
```

## Поддержка RTL (языки с направлением справа налево)

Для поддержки RTL в React-приложениях:

1. Установка атрибута `dir` в HTML:
```jsx
document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
```

2. Использование CSS для RTL:
```css
[dir="rtl"] .container {
  text-align: right;
  direction: rtl;
}
```

3. Библиотеки для автоматического преобразования:
- `rtl-css-js`
- `react-with-direction`

## Определение и переключение языка

### React Intl
```jsx
import { IntlProvider } from 'react-intl';

function App({ locale, messages }) {
  return (
    <IntlProvider locale={locale} messages={messages}>
      <MyApp />
    </IntlProvider>
  );
}
```

### i18next
```jsx
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

i18n.use(initReactI18next).init({
  lng: localStorage.getItem('language') || 'en',
  resources: {
    en: { translation: enTranslation },
    ru: { translation: ruTranslation }
  }
});
```

## Динамические импорты для переводов

Для уменьшения размера бандла можно использовать динамические импорты:

```jsx
const loadLocaleData = async (locale) => {
  const { default: messages } = await import(`../locales/${locale}.json`);
  return messages;
};

const handleLanguageChange = async (newLocale) => {
  const messages = await loadLocaleData(newLocale);
  i18n.changeLanguage(newLocale, () => {
    // Обновление сообщений
  });
};
```

## Производительность и i18n

- Используйте ленивую загрузку переводов
- Кэшируйте отформатированные значения
- Оптимизируйте рендеринг компонентов с переводами
- Используйте memoization для сложных форматирований

## Тестирование интернационализированных компонентов

```jsx
import { render } from '@testing-library/react';
import { IntlProvider } from 'react-intl';

const renderWithIntl = (component, locale = 'en', messages = {}) => {
  return render(
    <IntlProvider locale={locale} messages={messages}>
      {component}
    </IntlProvider>
  );
};

test('renders translated text', () => {
  const { getByText } = renderWithIntl(<MyComponent />);
  expect(getByText(/translated text/)).toBeInTheDocument();
});
```

## Поддержка файлов переводов

- Используйте системы управления переводами (TMS)
- Регулярно обновляйте переводы
- Используйте CI/CD для проверки полноты переводов
- Автоматизируйте процесс извлечения строк

## Культурные особенности

- Порядок отображения дат (DD/MM/YYYY vs MM/DD/YYYY)
- Форматы телефонных номеров
- Локальные праздники и традиции
- Визуальные ассоциации (цвета, символы)

## SEO с многоязычными сайтами

- Используйте теги `<link rel="alternate" hreflang="..." />`
- Управление URL для разных языков
- Локализованные метатеги
- Карта сайта для каждого языка

## Связи с другими файлами

- [[react/react-basics]] - основы React, необходимые для понимания i18n
- [[react/hooks]] - использование хуков для управления локализацией
- [[react/context]] - передача локали через контекст
- [[architecture/component-architecture]] - архитектура компонентов с i18n
- [[css/css-basics]] - стили для поддержки RTL

## Теги

#react #i18n #internationalization #localization #javascript #web-development #translation