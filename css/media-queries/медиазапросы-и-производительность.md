---
aliases: ["Производительность медиазапросов", "Оптимизация медиазапросов", "CSS Performance", "Media Queries Performance"]
tags: ["css", "media-queries", "performance", "optimization", "rendering"]
---

# Медиазапросы и производительность

Правильное использование медиазапросов может значительно повлиять на производительность веб-страницы. Понимание того, как медиазапросы влияют на рендеринг, позволяет создавать более эффективные адаптивные решения.

## Влияние медиазапросов на производительность

Медиазапросы могут влиять на производительность несколькими способами:

1. **Перерасчет стилей (Style Recalculation)**: При изменении размеров окна браузера или контейнера, медиазапросы могут вызывать перерасчет стилей для элементов.

2. **Перерисовка (Repaint)**: Изменения, вызванные медиазапросами, могут привести к перерисовке элементов на странице.

3. **Перестройка макета (Layout Thrashing)**: Частые изменения, вызванные медиазапросами, могут вызвать перестройку макета.

## Оптимизация медиазапросов

### 1. Минимизация количества медиазапросов

Старайтесь объединять стили для одинаковых брейкпоинтов:

```css
/* Плохо: много отдельных медиазапросов */
@media (min-width: 768px) {
  .header { display: flex; }
}

@media (min-width: 768px) {
  .nav { flex-direction: row; }
}

@media (min-width: 768px) {
  .sidebar { width: 25%; }
}

/* Хорошо: объединенные медиазапросы */
@media (min-width: 768px) {
  .header { display: flex; }
  .nav { flex-direction: row; }
  .sidebar { width: 25%; }
}
```

### 2. Использование контейнерных медиазапросов для изоляции изменений

Контейнерные медиазапросы позволяют изолировать изменения стилей в пределах компонента:

```css
.card-container {
  container-type: inline-size;
}

@container (min-width: 300px) {
  .card {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
}

/* Изменения внутри card не влияют на остальную страницу */
```

### 3. Оптимизация сложных медиазапросов

Избегайте сложных комбинаций медиазапросов, которые могут замедлить обработку:

```css
/* Избегайте сложных комбинаций */
@media (min-width: 768px) and (max-width: 1200px) and (orientation: landscape) and (prefers-reduced-motion: no-preference) {
  /* Сложные стили */
}

/* Лучше разбить на несколько простых запросов */
@media (min-width: 768px) and (max-width: 1200px) {
  /* Стили для размера экрана */
}

@media (orientation: landscape) {
  /* Стили для ориентации */
}

@media (prefers-reduced-motion: no-preference) {
  /* Стили для анимаций */
}
```

## Производительность при изменении размеров окна

### Дебаунсинг изменений размеров

При использовании JavaScript для обработки изменения размеров окна, применяйте дебаунсинг:

```javascript
// Плохо: каждый resize вызывает функцию
window.addEventListener('resize', handleResize);

// Хорошо: с дебаунсингом
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    handleResize();
  }, 250);
});
```

### Использование ResizeObserver

Для отслеживания изменений размеров элементов используйте ResizeObserver вместо resize события:

```javascript
const resizeObserver = new ResizeObserver(entries => {
  for (let entry of entries) {
    // Обработка изменения размера элемента
    if (entry.contentRect.width > 500) {
      entry.target.classList.add('large');
    } else {
      entry.target.classList.remove('large');
    }
  }
});

resizeObserver.observe(document.querySelector('.container'));
```

## Оптимизация изображений

### Responsive Images

Используйте адаптивные изображения для улучшения производительности:

```html
<!-- Использование srcset для разных плотностей пикселей -->
<img src="image-1x.jpg" 
     srcset="image-1x.jpg 1x, image-2x.jpg 2x, image-3x.jpg 3x"
     alt="Описание изображения">

<!-- Использование sizes для разных размеров экрана -->
<img src="image-small.jpg"
     srcset="image-small.jpg 300w, image-medium.jpg 600w, image-large.jpg 1200w"
     sizes="(max-width: 400px) 100vw, (max-width: 800px) 50vw, 25vw"
     alt="Описание изображения">
```

```css
/* Оптимизация загрузки фоновых изображений */
.hero-section {
  background-image: url('hero-mobile.jpg');
  background-size: cover;
}

@media (min-width: 768px) {
  .hero-section {
    background-image: url('hero-tablet.jpg');
  }
}

@media (min-width: 1024px) {
  .hero-section {
    background-image: url('hero-desktop.jpg');
  }
}
```

## Использование CSS Container Queries для производительности

Контейнерные запросы могут улучшить производительность, позволяя компонентам адаптироваться независимо:

```css
/* Компонент карточки */
.product-card {
  container-type: inline-size;
  display: flex;
  flex-direction: column;
}

/* Стили применяются только при изменении размера контейнера */
@container (min-width: 200px) {
  .product-image {
    width: 100%;
  }
}

@container (min-width: 300px) {
  .product-card {
    flex-direction: row;
  }
  
  .product-info {
    padding-left: 1rem;
  }
}
```

## Профилирование производительности

### Использование инструментов браузера

1. **Chrome DevTools Performance Panel**: Для анализа времени перерасчета стилей
2. **Firefox Performance Tool**: Для измерения времени рендеринга
3. **CSS Triggers**: Для понимания, какие свойства вызывают перерисовку или перестройку макета

### Измерение производительности медиазапросов

```css
/* Используйте CSS-переменные для динамических изменений */
.element {
  --size: 100px;
  width: var(--size);
  height: var(--size);
  transition: --size 0.3s ease;
}

/* Изменение через JavaScript более эффективно, чем изменение классов */
@media (min-width: 768px) {
  .element {
    --size: 200px;
  }
}
```

## Лучшие практики

1. **Используйте минимально необходимое количество медиазапросов**
2. **Предпочитайте контейнерные запросы глобальным, когда это возможно**
3. **Оптимизируйте изображения для разных размеров экрана**
4. **Избегайте частых изменений, вызывающих перерасчет стилей**
5. **Тестируйте производительность на слабых устройствах**
6. **Используйте hardware-accelerated CSS-свойства при анимациях**

> [!tip] Совет
> Используйте CSS Container Queries вместо window resize events для компонентов, чтобы избежать ненужных перерасчетов стилей на уровне всей страницы.

> [!warning] Важно
> Частые изменения, вызванные медиазапросами, могут привести к "layout thrashing" и значительному снижению производительности, особенно на мобильных устройствах.

[[Современные медиазапросы: основанные на контейнере, плотности пикселей, предпочтениях пользователя]]
[[Адаптивный дизайн: стратегии и брейкпоинты]]
[[CSS-медиазапросы]]