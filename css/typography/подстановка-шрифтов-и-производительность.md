---
aliases: ["Подстановка шрифтов CSS", "Производительность шрифтов", "CSS font-display", "Загрузка шрифтов"]
tags: ["css", "typography", "fonts", "performance", "font-display", "loading", "fallback"]
---

# Подстановка шрифтов и производительность

## Введение

Подстановка шрифтов и оптимизация их загрузки являются критически важными аспектами веб-производительности. Правильная стратегия загрузки шрифтов может значительно улучшить время отображения контента и воспринимаемую производительность веб-сайта.

## Проблемы загрузки шрифтов

### FOIT и FOUT

При загрузке пользовательских шрифтов возникают две основные проблемы:

- **FOIT** (Flash of Invisible Text) - текст остается невидимым до полной загрузки шрифта
- **FOUT** (Flash of Unstyled Text) - кратковременное отображение резервного шрифта перед переключением на пользовательский шрифт

```css
/* Проблематичная загрузка без оптимизации */
@font-face {
  font-family: 'ProblematicFont';
  src: url('problematic-font.woff2') format('woff2');
  /* Без font-display - по умолчанию browser определяет поведение */
}

.problematic-text {
  font-family: 'ProblematicFont', Arial, sans-serif;
}
```

## Свойство font-display

Свойство `font-display` позволяет контролировать, как шрифт отображается во время загрузки.

### Значения font-display

#### font-display: auto

```css
/* Автоматическое поведение (обычно FOIT) */
@font-face {
  font-family: 'AutoFont';
  src: url('auto-font.woff2') format('woff2');
  font-display: auto; /* Браузер определяет поведение */
}
```

#### font-display: block

```css
/* Короткий период блокировки, затем swap */
@font-face {
  font-family: 'BlockFont';
  src: url('block-font.woff2') format('woff2');
  font-display: block;
  /* 0-3 секунды блокировки, затем swap */
}
```

#### font-display: swap

```css
/* Немедленный swap резервного шрифта на пользовательский */
@font-face {
  font-family: 'SwapFont';
  src: url('swap-font.woff2') format('woff2');
  font-display: swap;
  /* Немедленно отображает резервный шрифт, меняет на пользовательский когда тот загрузится */
}

.swap-text {
  font-family: 'SwapFont', Arial, sans-serif;
  /* Текст сразу виден в Arial, затем меняется на SwapFont */
}
```

#### font-display: fallback

```css
/* Очень короткий период блокировки, быстрый swap */
@font-face {
  font-family: 'FallbackFont';
  src: url('fallback-font.woff2') format('woff2');
  font-display: fallback;
  /* 100ms блокировки, 3 секунды swap */
}
```

#### font-display: optional

```css
/* Очень короткий период блокировки, swap только если шрифт загружается быстро */
@font-face {
  font-family: 'OptionalFont';
  src: url('optional-font.woff2') format('woff2');
  font-display: optional;
  /* 100ms блокировки, затем шрифт опционален */
}
```

## Оптимизация загрузки шрифтов

### Подключение шрифтов с приоритетом

```css
/* Подключение критических шрифтов */
@font-face {
  font-family: 'CriticalFont';
  src: url('critical-font.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'CriticalFont';
  src: url('critical-font-bold.woff2') format('woff2');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

/* Подключение некритических шрифтов с более агрессивной стратегией */
@font-face {
  font-family: 'DecorativeFont';
  src: url('decorative-font.woff2') format('woff2');
  font-display: optional;
}
```

### Использование preload для критических шрифтов

```html
<!-- В HTML HEAD -->
<link rel="preload" href="critical-font.woff2" as="font" type="font/woff2" crossorigin>
```

```css
/* В CSS */
@font-face {
  font-family: 'PreloadedFont';
  src: url('critical-font.woff2') format('woff2');
  font-display: swap;
}
```

### Оптимизация форматов шрифтов

```css
/* Подключение шрифтов в порядке предпочтения */
@font-face {
  font-family: 'OptimizedFont';
  src: 
    url('optimized-font.woff2') format('woff2'), /* Наиболее сжатый формат */
    url('optimized-font.woff') format('woff'),   /* Широкая поддержка */
    url('optimized-font.ttf') format('truetype'); /* Резервный вариант */
  font-display: swap;
}
```

## Стратегии подстановки

### Подстановка по весу и начертанию

```css
/* Подстановка шрифтов по весу */
@font-face {
  font-family: 'WeightedFont';
  src: url('weighted-font-regular.woff2') format('woff2');
  font-weight: 300 500;
  font-display: swap;
}

@font-face {
  font-family: 'WeightedFont';
  src: url('weighted-font-medium.woff2') format('woff2');
  font-weight: 600 700;
  font-display: swap;
}

.weighted-text {
  font-family: 'WeightedFont', Arial, sans-serif;
  font-weight: 400; /* Использует первый доступный шрифт в диапазоне */
}
```

### Подстановка по стилю

```css
/* Подстановка по стилю */
@font-face {
  font-family: 'StyledFont';
  src: url('styled-font-normal.woff2') format('woff2');
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'StyledFont';
  src: url('styled-font-italic.woff2') format('woff2');
  font-style: italic;
  font-display: swap;
}

.styled-text {
  font-family: 'StyledFont', Arial, sans-serif;
  font-style: italic;
}
```

## Современные подходы к подстановке

### Использование CSS-переменных для стратегии загрузки

```css
:root {
  --font-display-strategy: swap;
  --critical-font-loaded: false;
}

/* Условная загрузка в зависимости от состояния */
@font-face {
  font-family: 'ConditionalFont';
  src: url('conditional-font.woff2') format('woff2');
  font-display: var(--font-display-strategy, swap);
}
```

### Подстановка с учетом соединения

```css
/* Подстановка в зависимости от качества соединения (через JavaScript) */
.font-quality-fast {
  font-family: 'HighQualityFont', Arial, sans-serif;
}

.font-quality-slow {
  font-family: 'LightFont', Arial, sans-serif;
}
```

## Оптимизация для производительности

### Минимизация количества файлов шрифтов

```css
/* Использование одного файла для нескольких начертаний (переменные шрифты) */
@font-face {
  font-family: 'VariableFont';
  src: url('variable-font.woff2') format('woff2-variations');
  font-weight: 100 900;
  font-stretch: 75% 125%;
  font-display: swap;
}

/* Вместо нескольких файлов для каждого начертания */
.variable-text {
  font-family: 'VariableFont';
  font-weight: 450; /* Промежуточное значение */
}
```

### Оптимизация размера шрифтов

```css
/* Использование подмножества символов */
@font-face {
  font-family: 'SubsetFont';
  src: url('latin-subset.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  font-display: swap;
}

@font-face {
  font-family: 'CyrillicSubset';
  src: url('cyrillic-subset.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
  font-display: swap;
}
```

### Отложенная загрузка некритических шрифтов

```css
/* Критические шрифты загружаются сразу */
@font-face {
  font-family: 'Critical';
  src: url('critical.woff2') format('woff2');
  font-display: swap;
}

/* Некритические шрифты загружаются позже */
.non-critical-fonts {
  /* Загрузка через JavaScript после загрузки страницы */
}
```

## Практические примеры стратегий

### Стратегия для основного текста

```css
/* Стратегия для основного текста - быстрая доступность */
@font-face {
  font-family: 'BodyFont';
  src: 
    url('body-font-latin.woff2') format('woff2'),
    url('body-font.woff2') format('woff2');
  font-weight: 300 700;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  font-display: swap;
}

@font-face {
  font-family: 'BodyFont';
  src: url('body-font-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
  font-display: swap;
}

.body-text {
  font-family: 'BodyFont', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}
```

### Стратегия для заголовков

```css
/* Стратегия для заголовков - баланс между визуальным эффектом и производительностью */
@font-face {
  font-family: 'HeadingFont';
  src: url('heading-font.woff2') format('woff2');
  font-weight: 700;
  font-display: fallback; /* Быстрая загрузка или отказ */
}

.heading-text {
  font-family: 'HeadingFont', Arial, sans-serif;
}
```

### Стратегия для декоративных элементов

```css
/* Стратегия для декоративных элементов - опциональная загрузка */
@font-face {
  font-family: 'DisplayFont';
  src: url('display-font.woff2') format('woff2');
  font-display: optional; /* Загружается только если быстро доступен */
}

.display-text {
  font-family: 'DisplayFont', Georgia, serif;
}
```

## Измерение и мониторинг производительности

### CSS-индикаторы загрузки шрифтов

```css
/* Использование CSS-переменных для отслеживания состояния шрифта */
.font-loading {
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.font-loaded {
  opacity: 1;
}

/* Индикаторы могут управляться JavaScript */
```

### Использование Font Loading API

```css
/* Подготовка CSS для работы с Font Loading API */
@font-face {
  font-family: 'APILoadedFont';
  src: url('api-font.woff2') format('woff2');
  font-display: swap;
}

.api-font-text {
  font-family: 'APILoadedFont', Arial, sans-serif;
  /* Стили могут изменяться после загрузки шрифта */
}
```

## Совместимость и резервные значения

```css
/* Полная стратегия с резервными значениями */
@font-face {
  font-family: 'CompleteFontStrategy';
  src: url('font.woff2') format('woff2');
  font-display: swap;
}

.complete-typography {
  /* Полная цепочка резервных шрифтов */
  font-family: 
    'CompleteFontStrategy',
    /* Системные шрифты */
    -apple-system, 
    BlinkMacSystemFont, 
    /* Альтернативные веб-шрифты */
    'Segoe UI', 
    /* Стандартные веб-шрифты */
    Roboto, 
    /* Резервные системные шрифты */
    Oxygen, 
    Ubuntu, 
    Cantarell, 
    /* Финальный резерв */
    sans-serif;
}
```

## Лучшие практики

### 1. Приоритезация критических шрифтов

```css
/* Загрузка критических шрифтов первой */
@font-face {
  font-family: 'CriticalFont';
  src: url('critical.woff2') format('woff2');
  font-display: swap;
  /* Другие свойства */
}
```

### 2. Использование подмножеств символов

```css
/* Загрузка только необходимых символов */
@font-face {
  font-family: 'LatinFont';
  src: url('latin-only.woff2') format('woff2');
  unicode-range: U+0000-00FF; /* Только латиница */
  font-display: swap;
}
```

### 3. Оптимизация для разных языков

```css
/* Разные шрифты для разных языков */
@font-face {
  font-family: 'MultiLangFont';
  src: url('latin-font.woff2') format('woff2');
  unicode-range: U+0000-00FF;
  font-display: swap;
}

@font-face {
  font-family: 'MultiLangFont';
  src: url('cyrillic-font.woff2') format('woff2');
  unicode-range: U+0400-045F;
  font-display: swap;
}
```

## Заключение

Подстановка шрифтов и оптимизация их загрузки являются ключевыми аспектами веб-производительности. Правильное использование свойства `font-display`, оптимизация форматов шрифтов, использование подмножеств символов и стратегическое подключение шрифтов позволяют достичь баланса между визуальной привлекательностью и производительностью.

Важно тестировать стратегии загрузки шрифтов на разных устройствах и при различных условиях соединения. Также необходимо учитывать доступность и обеспечивать резервные значения для пользователей с особыми потребностями.

## См. также

- [[современная-типографика-в-css]]
- [[адаптивная-типографика]]
- [[CSS-производительность]]
- [[CSS-шрифты]]
- [[цветовые-пространства-и-форматы]]
- [[цветовые-функции-и-их-применение]]
- [[работа-с-цветовыми-темами-и-контрастностью]]
- [[обзор-css-функций]]
- [[продвинутые-функции-css]]
- [[практическое-применение-функций-в-адаптивном-дизайне]]
- [[2d-и-3d-трансформации]]
- [[перспектива-и-3d-пространство-в-css]]
- [[трансформации-и-производительность]]
- [[css-фильтры-применение-и-оптимизация]]
- [[css-формы-и-обтекание]]
- [[комбинирование-фильтров-и-создание-визуальных-эффектов]]