---
aliases: [Target Platforms, Platform Compatibility, Target Environments]
tags: [typescript, compatibility, platforms, environments]
---

# Целевые платформы

## Обзор

Целевые платформы - это среды выполнения, в которых будет работать ваш TypeScript код после транспиляции. Правильное определение целевых платформ критически важно для обеспечения совместимости и оптимальной производительности вашего приложения.

## Типы целевых платформ

### Веб-браузеры

Наиболее распространенная платформа для TypeScript приложений:

- **Chrome** - высокая поддержка современных возможностей
- **Firefox** - хорошая поддержка современных возможностей
- **Safari** - может отставать в поддержке новых возможностей
- **Edge** - теперь на основе Chromium
- **Internet Explorer** - ограниченная поддержка, особенно IE11

### Node.js

Серверная платформа для JavaScript:

- Поддержка различных версий Node.js
- Различные возможности в зависимости от версии
- Нужно учитывать LTS версии

### Мобильные платформы

- **WebView** в мобильных приложениях
- **React Native**
- **Cordova/Ionic**

### Десктопные приложения

- **Electron** - для десктопных приложений
- **Tauri** - альтернатива Electron

## Определение целевой платформы

### Использование Browserslist

Файл `.browserslistrc`:
```
# Основные браузеры
> 1%
last 2 versions
not dead

# IE11 при необходимости
ie 11
```

### В tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["ES2017", "DOM"],
    "module": "ES2020",
    "moduleResolution": "node"
  }
}
```

## Настройка для разных платформ

### Для современных браузеров

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM"],
    "module": "ES2020",
    "useDefineForClassFields": true,
    "downlevelIteration": false
  }
}
```

### Для широкой совместимости (включая IE11)

```json
{
  "compilerOptions": {
    "target": "ES5",
    "lib": ["ES2015", "DOM"],
    "module": "ES2015",
    "downlevelIteration": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

### Для Node.js

```json
{
  "compilerOptions": {
    "target": "ES2018",
    "lib": ["ES2018"],
    "module": "commonjs",
    "moduleResolution": "node",
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true
  }
}
```

## Платформо-специфичные API

При работе с разными платформами учитывайте доступные API:

### Веб API

```typescript
// Доступно только в браузерах
if (typeof window !== 'undefined') {
  const storage = window.localStorage;
  const location = window.location;
}
```

### Node.js API

```typescript
// Доступно только в Node.js
if (typeof process !== 'undefined') {
  const fs = require('fs');
  const path = require('path');
}
```

### Условное выполнение

```typescript
// Проверка среды выполнения
declare const process: {
  env: {
    NODE_ENV: string;
  };
} | undefined;

if (typeof process !== 'undefined' && process.env.NODE_ENV === 'development') {
  console.log('Development mode');
}
```

## Тестирование на целевых платформах

### Автоматизированное тестирование

```typescript
// Конфигурация для тестирования в разных браузерах
// karma.conf.js
module.exports = function(config) {
  config.set({
    browsers: ['Chrome', 'Firefox', 'Safari', 'IE'],
    // ...
  });
};
```

### Проверка возможностей

```typescript
// Проверка поддержки возможностей
function supportsES2015() {
  try {
    new Function('(a = 0) => a');
    return true;
  } catch (err) {
    return false;
  }
}

if (supportsES2015()) {
  // Использование ES2015 возможностей
} else {
  // Резервная реализация
}
```

## Производительность и оптимизация

### Для мобильных платформ

- Минимизируйте размер бандла
- Учитывайте ограничения производительности
- Оптимизируйте изображения и ресурсы

### Для серверных приложений

- Используйте более современные возможности
- Учитывайте доступную память и вычислительные ресурсы
- Оптимизируйте загрузку модулей

## Современные подходы

### Progressive Web Apps (PWA)

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["ES2017", "DOM", "WebWorker"],
    "module": "ES2020"
  }
}
```

### Изоморфные приложения

```typescript
// Код, который работает как на клиенте, так и на сервере
export function formatDate(date: Date): string {
  if (typeof Intl !== 'undefined') {
    return new Intl.DateTimeFormat().format(date);
  } else {
    // Резервная реализация
    return date.toString();
  }
}
```

## Инструменты для определения целевой платформы

### Can I Use

Проверяйте поддержку возможностей на [caniuse.com](https://caniuse.com)

### StatCounter Global Stats

Анализируйте использование браузеров вашей аудиторией

### Google Analytics

Определите, какие браузеры используют ваши пользователи

## Практические рекомендации

### 1. Определите свою аудиторию

```markdown
- Какие браузеры используют ваши пользователи?
- Какие версии Node.js вы поддерживаете?
- Требуется ли поддержка мобильных платформ?
```

### 2. Используйте feature detection

```typescript
// Вместо определения браузера по версии
if ('serviceWorker' in navigator) {
  // Использование Service Worker
  navigator.serviceWorker.register('/sw.js');
}
```

### 3. Тестируйте в реальных условиях

- Используйте инструменты для тестирования в разных браузерах
- Проверяйте производительность на слабых устройствах
- Тестируйте в разных сетевых условиях

### 4. Постепенное улучшение

```typescript
// Начните с базовой функциональности
function loadContent() {
  if (window.fetch) {
    // Современный подход
    return fetch('/api/content').then(r => r.json());
  } else {
    // Резервный подход
    const xhr = new XMLHttpRequest();
    xhr.open('GET', '/api/content');
    // ...
  }
}
```

## Связанные темы

- [[Версии-ECMAScript]]
- [[Совместимость-с-браузерами]]
- [[Polyfills]]
- [[Транспиляция]]