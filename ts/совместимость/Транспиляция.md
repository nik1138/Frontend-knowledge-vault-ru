---
aliases: [Transpilation, Transpile, TypeScript Transpilation]
tags: [typescript, javascript, transpilation, compilation]
---

# Транспиляция

## Обзор

Транспиляция - это процесс преобразования кода из одной версии языка в другую, обычно из более новой версии в более старую, для обеспечения совместимости. В контексте TypeScript, транспиляция преобразует TypeScript код в JavaScript код, который может выполняться в различных средах.

## Как работает транспиляция TypeScript

TypeScript компилятор (tsc) выполняет несколько шагов:

1. **Парсинг** - преобразование исходного кода в дерево синтаксического разбора
2. **Анализ типов** - проверка типов и выявление ошибок
3. **Транспиляция** - преобразование TypeScript синтаксиса в JavaScript
4. **Генерация кода** - создание результирующего JavaScript файла

## Настройка транспиляции в tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ES2020",
    "lib": ["ES2020", "DOM"],
    "downlevelIteration": true,
    "removeComments": false,
    "sourceMap": true
  }
}
```

### Основные параметры транспиляции

- `target` - определяет версию ECMAScript, в которую будет транспилирован код
- `module` - определяет систему модулей
- `lib` - указывает, какие библиотеки типов использовать
- `downlevelIteration` - включает поддержку итерации в старых версиях JavaScript
- `sourceMap` - генерирует source maps для отладки

## Примеры транспиляции

### Классы

TypeScript:
```typescript
class Animal {
  name: string;
  
  constructor(name: string) {
    this.name = name;
  }
  
  move(distance: number = 0) {
    console.log(`${this.name} moved ${distance}m.`);
  }
}

class Dog extends Animal {
  constructor(name: string) {
    super(name);
  }
  
  bark() {
    console.log('Woof! Woof!');
  }
}
```

С `target: "ES5"`:
```javascript
var Animal = /** @class */ (function () {
  function Animal(name) {
    this.name = name;
  }
  Animal.prototype.move = function (distance) {
    if (distance === void 0) { distance = 0; }
    console.log(this.name + " moved " + distance + "m.");
  };
  return Animal;
}());

var Dog = /** @class */ (function (_super) {
  __extends(Dog, _super);
  function Dog(name) {
    return _super.call(this, name) || this;
  }
  Dog.prototype.bark = function () {
    console.log('Woof! Woof!');
  };
  return Dog;
}(Animal));
```

### Async/Await

TypeScript:
```typescript
async function fetchData(): Promise<string> {
  const response = await fetch('/api/data');
  const data = await response.json();
  return data.message;
}
```

С `target: "ES5"` (с `downlevelIteration: true`):
```javascript
function fetchData() {
  return __awaiter(this, void 0, void 0, function () {
    var response, data;
    return __generator(this, function (_a) {
      switch (_a.label) {
        case 0: return [4, fetch('/api/data')];
        case 1:
          response = _a.sent();
          return [4, response.json()];
        case 2:
          data = _a.sent();
          return [2, data.message];
      }
    });
  });
}
```

### Деструктуризация

TypeScript:
```typescript
const user = { name: 'John', age: 30, city: 'New York' };
const { name, age } = user;
const numbers = [1, 2, 3];
const [first, ...rest] = numbers;
```

С `target: "ES5"`:
```javascript
var user = { name: 'John', age: 30, city: 'New York' };
var name = user.name, age = user.age;
var numbers = [1, 2, 3];
var first = numbers[0];
var rest = numbers.slice(1);
```

## Современные возможности и транспиляция

### Decorators

TypeScript поддерживает декораторы, но они требуют специальных настроек:

```typescript
function logged(target: Function) {
  console.log(target.name);
}

@logged
class MyClass {}
```

Для транспиляции декораторов:
```json
{
  "compilerOptions": {
    "target": "ES5",
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}
```

### Nullish Coalescing и Optional Chaining

TypeScript:
```typescript
const user = {
  name: 'John',
  address: {
    street: '123 Main St'
  }
};

// Optional chaining
const street = user?.address?.street;

// Nullish coalescing
const displayName = user.name ?? 'Anonymous';
```

С `target: "ES2020"`:
```javascript
const street = user?.address?.street;
const displayName = user.name ?? 'Anonymous';
```

С `target: "ES2019"` и более ранними:
```javascript
const street = user === null || user === void 0 ? void 0 : user.address === null || user.address === void 0 ? void 0 : user.address.street;
const displayName = user.name !== null && user.name !== void 0 ? user.name : 'Anonymous';
```

## Конфигурация транспиляции

### Платформо-специфические настройки

Для веб-браузеров:
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["ES2017", "DOM"],
    "module": "ES2020",
    "moduleResolution": "node"
  }
}
```

Для Node.js:
```json
{
  "compilerOptions": {
    "target": "ES2018",
    "lib": ["ES2018"],
    "module": "commonjs",
    "moduleResolution": "node"
  }
}
```

### Оптимизация транспиляции

Для минимизации размера бандла:

1. Используйте целевую версию, соответствующую вашим браузерам
2. Включайте только необходимые библиотеки в `lib`
3. Используйте tree-shaking для удаления неиспользуемого кода

## Транспиляция с Babel

TypeScript может использовать Babel для дополнительной транспиляции:

```json
{
  "presets": [
    ["@babel/preset-env", {
      "targets": {
        "browsers": ["last 2 versions"]
      }
    }],
    "@babel/preset-typescript"
  ]
}
```

## Проверка транспилированного кода

Для проверки результата транспиляции:

1. Проверьте сгенерированные файлы
2. Убедитесь, что код работает в целевых средах
3. Проверьте размер бандла
4. Убедитесь, что source maps корректны

## Ошибки транспиляции

Частые проблемы:

1. **Несовместимость с целевой версией** - используйте `target` правильно
2. **Проблемы с модулями** - проверьте `module` и `moduleResolution`
3. **Отсутствие полифилов** - добавьте необходимые полифилы для новых возможностей

## Связанные темы

- [[Версии-ECMAScript]]
- [[Совместимость-с-браузерами]]
- [[Polyfills]]
- [[Целевые-платформы]]