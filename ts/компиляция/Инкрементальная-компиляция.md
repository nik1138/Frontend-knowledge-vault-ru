---
aliases: ["Incremental Compilation", "Инкрементальная сборка", "Увеличительная компиляция"]
tags: ["#typescript", "#compilation", "#performance", "#build-optimization", "#incremental-build"]
---

# Инкрементальная компиляция

Инкрементальная компиляция - это механизм TypeScript, который позволяет ускорить процесс компиляции за счет анализа изменений в файлах и перекомпиляции только тех файлов, которые действительно изменились или могут быть затронуты изменениями. Это особенно полезно в больших проектах, где полная перекомпиляция может занимать значительное время.

## Принцип работы

При включении инкрементальной компиляции TypeScript создает и сохраняет информацию о предыдущей компиляции в специальных файлах. При последующих запусках компилятор анализирует:

- Какие файлы были изменены
- Какие файлы зависят от измененных файлов
- Какие файлы требуют перекомпиляции

## Включение инкрементальной компиляции

### В tsconfig.json

```json
{
  "compilerOptions": {
    "incremental": true
  }
}
```

### Через флаг командной строки

```bash
tsc --incremental
```

## Файлы инкрементальной компиляции

Когда включена инкрементальная компиляция, TypeScript создает специальный файл под названием `tsbuildinfo`, который содержит информацию о предыдущей компиляции. Этот файл обычно размещается в:

- Корне проекта
- В каталоге, указанном в опции `outFile`
- В каталоге, указанном в опции `tsBuildInfoFile`

### Настройка расположения tsbuildinfo

```json
{
  "compilerOptions": {
    "incremental": true,
    "tsBuildInfoFile": "./build/tsconfig.tsbuildinfo"
  }
}
```

## Практические примеры

### Пример конфигурации с инкрементальной компиляцией

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "incremental": true,
    "tsBuildInfoFile": "./build/.tsbuildinfo",
    "sourceMap": true,
    "declaration": true
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
```

### Использование в npm scripts

```json
{
  "scripts": {
    "build": "tsc",
    "build:incremental": "tsc --incremental",
    "watch": "tsc --watch --incremental"
  }
}
```

## Производительность и преимущества

### Время компиляции

Инкрементальная компиляция может значительно сократить время компиляции:

- При первом запуске производится полная компиляция
- При последующих запусках компилируются только измененные файлы и их зависимости
- В больших проектах это может сократить время компиляции с минут до нескольких секунд

### Повторяемость

Инкрементальная компиляция обеспечивает согласованность результатов между запусками, так как TypeScript отслеживает зависимости и состояние файлов.

## Composite проекты

Инкрементальная компиляция особенно полезна при работе с composite проектами (проектами с несколькими tsconfig.json файлами), где она может эффективно управлять зависимостями между подпроектами.

### Пример composite проекта

```json
// tsconfig.json (корневой)
{
  "references": [
    { "path": "./packages/core" },
    { "path": "./packages/utils" },
    { "path": "./packages/api" }
  ],
  "files": []
}
```

```json
// packages/core/tsconfig.json
{
  "compilerOptions": {
    "composite": true,
    "incremental": true,
    "outDir": "../../dist/core",
    "rootDir": "."
  },
  "include": [
    "**/*.ts"
  ]
}
```

## Мониторинг и отладка

### Очистка кэша инкрементальной компиляции

Иногда может потребоваться очистить информацию инкрементальной компиляции:

```bash
# Удалите файлы tsbuildinfo
rm -f **/*.tsbuildinfo
# или
find . -name "*.tsbuildinfo" -delete
```

### Принудительная полная перекомпиляция

Для принудительной полной перекомпиляции без использования кэша:

```bash
tsc --incremental false
# или
tsc --noBuild
```

## Ограничения и особенности

### Зависимости

Инкрементальная компиляция учитывает зависимости между файлами, но в некоторых случаях может потребоваться полная перекомпиляция при изменении:

- Настроек компилятора
- Зависимостей в package.json
- Глобальных деклараций

### Системные особенности

Работа инкрементальной компиляции может зависеть от:

- Файловой системы
- Времени модификации файлов
- Прав доступа к файлам

### CI/CD среды

В системах непрерывной интеграции может быть полезно отключать инкрементальную компиляцию для обеспечения полной и надежной сборки:

```yaml
# GitHub Actions пример
- name: Build
  run: tsc --incremental false
```

## Лучшие практики

### 1. Использование с системой контроля версий

Файлы `tsbuildinfo` обычно исключаются из системы контроля версий, так как они зависят от локальной среды разработки:

```gitignore
# Исключить файлы инкрементальной компиляции
*.tsbuildinfo
```

### 2. Совместимость с другими инструментами

При использовании инкрементальной компиляции убедитесь в совместимости с другими инструментами сборки:

- Webpack
- Rollup
- Vite
- Parcel

### 3. Мониторинг производительности

Регулярно мониторьте производительность компиляции:

```bash
# С измерением времени
time tsc --incremental
```

## Сравнение с обычной компиляцией

| Характеристика | Обычная компиляция | Инкрементальная компиляция |
|----------------|---------------------|------------------------------|
| Время первого запуска | Полное время | Полное время |
| Время последующих запусков | Полное время | Минимальное (только изменения) |
| Используемая память | Стандартно | Немного больше (для кэша) |
| Размер вывода | Стандартно | Стандартно |
| Сложность настройки | Минимальная | Немного выше |

## См. также

- [[tsconfig-json]]
- [[Компилятор]]
- [[Флаги-компиляции]]
- [[Множественные-конфигурации]]
- [[Сборка и оптимизация]]