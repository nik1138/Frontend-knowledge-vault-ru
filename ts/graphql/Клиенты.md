---
aliases: ["GraphQL Clients", "Клиенты GraphQL", "GraphQL Client Libraries"]
tags: [programming, graphql, typescript, clients, frontend]
---

# Клиенты GraphQL

## Обзор

Клиенты GraphQL - это библиотеки, которые позволяют приложениям взаимодействовать с GraphQL API. Они обеспечивают удобный интерфейс для выполнения запросов, мутаций и подписок, а также могут включать кэширование, оптимистические обновления и другие полезные функции.

## Популярные клиенты GraphQL

### Apollo Client

Apollo Client - один из самых популярных GraphQL клиентов, предлагает широкий набор возможностей:

```typescript
import { ApolloClient, InMemoryCache, gql, useQuery } from '@apollo/client';

const client = new ApolloClient({
  uri: 'http://localhost:4000/graphql',
  cache: new InMemoryCache()
});

// Запрос с использованием хука
const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
    }
  }
`;

function UserProfile({ userId }: { userId: string }) {
  const { loading, error, data } = useQuery(GET_USER, {
    variables: { id: userId }
  });

  if (loading) return <p>Загрузка...</p>;
  if (error) return <p>Ошибка: {error.message}</p>;

  return (
    <div>
      <h2>{data.user.name}</h2>
      <p>{data.user.email}</p>
    </div>
  );
}
```

### URQL

URQL - легковесная альтернатива с простым API:

```typescript
import { createClient, gql, useQuery } from 'urql';

const client = createClient({
  url: 'http://localhost:4000/graphql',
});

const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
    }
  }
`;

function UserProfile({ userId }: { userId: string }) {
  const [result] = useQuery({
    query: GET_USER,
    variables: { id: userId },
  });

  const { data, error, fetching } = result;

  if (fetching) return <p>Загрузка...</p>;
  if (error) return <p>Ошибка: {error.message}</p>;

  return (
    <div>
      <h2>{data.user.name}</h2>
      <p>{data.user.email}</p>
    </div>
  );
}
```

### Relay

Relay - мощный фреймворк от Facebook с акцентом на производительность:

```typescript
import { graphql, useQuery } from 'react-relay';

const userQuery = graphql`
  query UserQuery($id: ID!) {
    user(id: $id) {
      id
      name
      email
    }
  }
`;

function UserProfile({ userId }: { userId: string }) {
  const [query, refetch] = useQuery<UserQueryType>(userQuery, {
    id: userId
  });

  if (query.error) return <p>Ошибка: {query.error.message}</p>;
  if (query.data === undefined) return <p>Загрузка...</p>;

  return (
    <div>
      <h2>{query.data.user.name}</h2>
      <p>{query.data.user.email}</p>
    </div>
  );
}
```

## Настройка клиента с типизацией

### Использование сгенерированных типов

При использовании [[Codegen]] можно получить типизированные операции:

```typescript
import { GetUsersQuery, GetUsersQueryVariables } from './generated/graphql';

const GET_USERS = gql`
  query GetUsers {
    users {
      id
      name
      email
    }
  }
`;

function UsersList() {
  const { loading, error, data } = useQuery<GetUsersQuery, GetUsersQueryVariables>(GET_USERS);

  if (loading) return <p>Загрузка...</p>;
  if (error) return <p>Ошибка: {error.message}</p>;

  return (
    <ul>
      {data?.users.map(user => (
        <li key={user.id}>
          {user.name} ({user.email})
        </li>
      ))}
    </ul>
  );
}
```

## Кэширование данных

### Apollo Client кэш

Apollo Client предоставляет мощную систему кэширования:

```typescript
import { InMemoryCache } from '@apollo/client';

const cache = new InMemoryCache({
  typePolicies: {
    User: {
      // Определение ключа для идентификации объектов
      keyFields: ['id'],
      fields: {
        // Кастомная логика для поля
        email: {
          read(email) {
            return email || 'Email не указан';
          }
        }
      }
    }
  }
});
```

### Кэширование запросов

```typescript
// Кэширование с настройками
const { data } = useQuery(GET_USER, {
  variables: { id: userId },
  // Не использовать кэш
  fetchPolicy: 'network-only',
  // Использовать кэш, но обновить в фоне
  nextFetchPolicy: 'cache-and-network'
});
```

## Мутации

### Выполнение мутаций

```typescript
import { gql, useMutation } from '@apollo/client';

const UPDATE_USER = gql`
  mutation UpdateUser($id: ID!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      id
      name
      email
    }
  }
`;

function UpdateUserForm({ userId }: { userId: string }) {
  const [updateUser, { loading, error }] = useMutation(UPDATE_USER);

  const handleSubmit = async (formData: any) => {
    try {
      await updateUser({
        variables: {
          id: userId,
          input: {
            name: formData.name,
            email: formData.email
          }
        }
      });
    } catch (err) {
      console.error('Ошибка обновления:', err);
    }
  };

  return (
    <form onSubmit={(e) => {
      e.preventDefault();
      handleSubmit(/* данные формы */);
    }}>
      {/* форма обновления пользователя */}
    </form>
  );
}
```

### Оптимистические обновления

```typescript
const [updateUser] = useMutation(UPDATE_USER, {
  optimisticResponse: {
    __typename: 'Mutation',
    updateUser: {
      __typename: 'User',
      id: userId,
      name: optimisticName,
      email: optimisticEmail
    }
  },
  update(cache, { data }) {
    // Обновление кэша после успешной мутации
    cache.modify({
      id: cache.identify({ __typename: 'User', id: userId }),
      fields: {
        name() {
          return data?.updateUser.name;
        },
        email() {
          return data?.updateUser.email;
        }
      }
    });
  }
});
```

## Подписки

### GraphQL подписки

```typescript
import { gql, useSubscription } from '@apollo/client';

const USER_UPDATED = gql`
  subscription UserUpdated($userId: ID!) {
    userUpdated(userId: $userId) {
      id
      name
      email
    }
  }
`;

function UserSubscription({ userId }: { userId: string }) {
  const { data, loading, error } = useSubscription(USER_UPDATED, {
    variables: { userId }
  });

  if (loading) return <p>Подписка активна...</p>;
  if (error) return <p>Ошибка подписки: {error.message}</p>;

  if (data) {
    return <p>Пользователь обновлен: {data.userUpdated.name}</p>;
  }

  return null;
}
```

## Интеграция с различными фреймворками

### React

Большинство клиентов GraphQL имеют React-хуки:

```typescript
// Apollo Client
import { useQuery, useMutation, useSubscription } from '@apollo/client';

// URQL
import { useQuery, useMutation } from 'urql';

// Relay
import { useQuery, useMutation } from 'react-relay';
```

### Vue.js

```typescript
// Использование GraphQL с Vue
import { useQuery, useMutation } from '@vue/apollo-composable';

const { result, loading, error } = useQuery(GET_USER, { id: userId });
```

### Angular

```typescript
// Использование с Angular
import { Apollo } from 'apollo-angular';

class UserService {
  constructor(private apollo: Apollo) {}

  getUser(id: string) {
    return this.apollo.query<GetUserQuery>({
      query: GET_USER,
      variables: { id }
    });
  }
}
```

## Обработка ошибок

### Обработка ошибок в запросах

```typescript
import { useQuery } from '@apollo/client';

const { loading, error, data } = useQuery(GET_USER, {
  variables: { id: userId },
  onError: (error) => {
    console.error('Ошибка GraphQL:', error);
    // Обработка ошибки
  }
});

// Обработка ошибок на уровне клиента
const client = new ApolloClient({
  uri: 'http://localhost:4000/graphql',
  cache: new InMemoryCache(),
  onError: ({ graphQLErrors, networkError }) => {
    if (graphQLErrors) {
      graphQLErrors.forEach(({ message, locations, path }) => {
        console.error(
          `GraphQL ошибка: Message: ${message}, Location: ${locations}, Path: ${path}`
        );
      });
    }
    
    if (networkError) {
      console.error(`Сетевая ошибка: ${networkError}`);
    }
  }
});
```

## Практические рекомендации

- Выбирайте клиент в зависимости от потребностей проекта
- Используйте сгенерированные типы для обеспечения безопасности
- Настройте кэширование для улучшения производительности
- Реализуйте корректную обработку ошибок
- Используйте оптимистические обновления для улучшения UX
- Покрывайте клиентский код тестами

## Связанные темы

- [[Типизация-GraphQL]] - типизация GraphQL
- [[Codegen]] - генерация кода
- [[Resolvers]] - реализация резолверов
- [[Схемы]] - определение схем