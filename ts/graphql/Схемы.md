---
aliases: ["GraphQL Schema", "Схемы GraphQL", "GraphQL Types Definition"]
tags: [programming, graphql, typescript, schema, definition]
---

# Схемы GraphQL

## Обзор

Схема GraphQL - это фундаментальный элемент API, который определяет все доступные типы данных, операции (запросы, мутации, подписки) и связи между ними. Она служит контрактом между клиентом и сервером.

## Определение схемы

GraphQL схема определяется с использованием GraphQL Schema Definition Language (SDL):

```graphql
type User {
  id: ID!
  name: String!
  email: String!
  posts: [Post!]!
  createdAt: String
}

type Post {
  id: ID!
  title: String!
  content: String
  author: User!
  published: Boolean!
}

type Query {
  user(id: ID!): User
  users: [User!]!
  post(id: ID!): Post
  posts: [Post!]!
}

type Mutation {
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User!
  deletePost(id: ID!): Boolean!
}

input CreateUserInput {
  name: String!
  email: String!
}

input UpdateUserInput {
  name: String
  email: String
}
```

## Основные типы

### Примитивные типы

GraphQL предоставляет несколько встроенных скалярных типов:

- `String` - строка UTF-8
- `Int` - 32-битное целое число
- `Float` - число с плавающей точкой
- `Boolean` - логическое значение
- `ID` - уникальный идентификатор

### Объектные типы

Объектные типы определяют структуру данных:

```graphql
type User {
  id: ID!
  name: String!
  email: String!
  age: Int
  isActive: Boolean
}
```

### Enum типы

Enum типы ограничивают значение до фиксированного набора значений:

```graphql
enum Role {
  ADMIN
  USER
  MODERATOR
}

type User {
  id: ID!
  name: String!
  role: Role!
}
```

### Interface типы

Interface определяет набор полей, которые должны быть реализованы в объектном типе:

```graphql
interface Node {
  id: ID!
}

type User implements Node {
  id: ID!
  name: String!
}

type Post implements Node {
  id: ID!
  title: String!
}
```

### Union типы

Union позволяет полю возвращать один из нескольких типов:

```graphql
union SearchResult = User | Post | Comment

type Query {
  search(term: String!): [SearchResult!]!
}
```

## Направленности полей (Field Directives)

Директивы позволяют изменять поведение полей:

```graphql
type User {
  id: ID!
  name: String!
  email: String! @deprecated(reason: "Используйте contactEmail вместо этого поля")
  age: Int @deprecated
}
```

## Валидация схемы

Схема должна проходить валидацию:

- Все типы должны быть определены
- Поля должны иметь допустимые типы
- Аргументы мутаций должны быть Input типами
- Циклические зависимости должны быть корректно обработаны

## Интеграция с TypeScript

Для типизации схемы с использованием TypeScript можно использовать генерацию типов через [[Codegen]]:

```typescript
// Пример сгенерированного типа из схемы
interface User {
  id: string;
  name: string;
  email: string;
  posts: Post[];
}
```

## Расширение схемы

Схему можно расширять с помощью `extend`:

```graphql
extend type User {
  phone: String
}

extend type Query {
  me: User
}
```

## Инструменты для работы со схемами

### GraphQL SDL

GraphQL Schema Definition Language используется для описания схемы в текстовом формате:

```graphql
# Комментарии в SDL
type User {
  """
  Уникальный идентификатор пользователя
  """
  id: ID!
  
  """
  Имя пользователя
  """
  name: String!
}
```

### Инструменты валидации

- `graphql` - основная библиотека для работы со схемами
- `@graphql-tools/schema` - утилиты для создания и объединения схем
- `graphql-schema-linter` - линтер для схем

## Практические рекомендации

- Документируйте поля и типы с помощью комментариев
- Используйте понятные имена для типов и полей
- Разделяйте схему на модули для больших приложений
- Регулярно проверяйте схему на валидность
- Используйте версионирование при изменении схемы
- Обеспечьте совместимость при изменениях схемы

## Построение схемы в TypeScript

Существует несколько способов определения схемы в TypeScript:

### С использованием SDL

```typescript
import { gql } from 'apollo-server-express';

const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
  }

  type Query {
    user(id: ID!): User
  }
`;
```

### Программное определение

```typescript
import { 
  GraphQLSchema, 
  GraphQLObjectType, 
  GraphQLString, 
  GraphQLNonNull,
  GraphQLID 
} from 'graphql';

const userType = new GraphQLObjectType({
  name: 'User',
  fields: {
    id: { type: GraphQLNonNull(GraphQLID) },
    name: { type: GraphQLNonNull(GraphQLString) },
    email: { type: GraphQLNonNull(GraphQLString) }
  }
});

const schema = new GraphQLSchema({
  query: new GraphQLObjectType({
    name: 'Query',
    fields: {
      user: {
        type: userType,
        args: {
          id: { type: GraphQLNonNull(GraphQLID) }
        }
      }
    }
  })
});
```

## Связанные темы

- [[Resolvers]] - реализация резолверов
- [[Типизация-GraphQL]] - типизация GraphQL
- [[Codegen]] - генерация кода
- [[Клиенты]] - работа с клиентами GraphQL