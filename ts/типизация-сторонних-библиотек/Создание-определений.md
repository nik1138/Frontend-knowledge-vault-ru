---
aliases: [Создание определений типов, Пользовательские определения]
tags: [typescript, typing, external-libraries, definitions]
---

# Создание определений

Создание определений типов для сторонних библиотек — важный навык для разработчиков TypeScript. Иногда библиотека не имеет определений в [[DefinitelyTyped]] или требует настройки под конкретные нужды проекта.

## Когда создавать определения

Создание собственных определений типов может быть необходимо в следующих случаях:

- Библиотека отсутствует в репозитории [[DefinitelyTyped]]
- Требуется модификация существующих определений
- Работа с проприетарной или внутренней библиотекой
- Использование экспериментальной версии библиотеки
- Необходимость добавления типов для плагинов или расширений

## Структура файла определений

Файлы определений имеют расширение `.d.ts` и содержат только информацию о типах:

```typescript
// my-library.d.ts
declare module 'my-library' {
  export interface Config {
    apiKey: string;
    timeout?: number;
  }

  export function initialize(config: Config): void;
  export function doSomething(data: string): Promise<boolean>;
}
```

## Объявление глобальных переменных

Для библиотек, которые добавляют глобальные переменные:

```typescript
// globals.d.ts
declare const MY_APP_VERSION: string;
declare const API_BASE_URL: string;

interface Window {
  myLibrary: any;
}
```

## Расширение существующих определений

Можно расширять существующие определения типов:

```typescript
// types/extended-jquery.d.ts
import * as $ from 'jquery';

declare global {
  interface JQuery {
    customPlugin(options: any): JQuery;
  }
}

export {};
```

## Шаблоны для быстрого старта

### Простая библиотека с функциями

```typescript
// simple-lib.d.ts
declare module 'simple-lib' {
  export function doWork(input: string): string;
  export const VERSION: string;
  export namespace utils {
    export function helper(): void;
  }
}
```

### Класс-ориентированная библиотека

```typescript
// class-lib.d.ts
declare module 'class-lib' {
  export class MyClass {
    constructor(options?: Options);
    method(param: string): number;
    static utility(): void;
  }

  export interface Options {
    settingA?: boolean;
    settingB?: string;
  }
}
```

### Библиотека с модулями

```typescript
// modular-lib.d.ts
declare module 'modular-lib/core' {
  export function init(): void;
}

declare module 'modular-lib/utils' {
  export function format(value: any): string;
}
```

## Лучшие практики

### 1. Использование строгой типизации

```typescript
// Хорошо
export function processData(data: { id: number; name: string }): ProcessedData {
  // реализация
}

// Плохо
export function processData(data: any): any {
  // реализация
}
```

### 2. Поддержка нескольких версий

```typescript
// Проверка версии для поддержки нескольких API
declare module 'my-lib' {
  // Для версии 2.x
  export function newFeature(): void;
  
  // Для версии 1.x (если требуется поддержка)
  export function legacyFeature?(): void;
}
```

### 3. Документирование определений

```typescript
/**
 * Инициализирует библиотеку с указанными параметрами
 * @param config Конфигурация для инициализации
 * @returns Объект библиотеки
 */
export function init(config: Config): LibraryInstance;
```

## Тестирование определений

Для проверки корректности определений типов рекомендуется создать тестовые файлы:

```typescript
// tests/definitions.test.ts
import { doSomething, Config } from 'my-library';

// Проверка типов
const config: Config = { apiKey: 'test-key' }; // Должно работать
const result = doSomething('test'); // Должен возвращать Promise<boolean>

// Проверка ошибок типов
// const wrongConfig: Config = { wrongProperty: 'value' }; // Должна быть ошибка
```

## Публикация собственных определений

Если определения могут быть полезны другим разработчикам, их можно:

1. Опубликовать в [[DefinitelyTyped]] (рекомендуется)
2. Создать отдельный npm-пакет с префиксом `@types/`
3. Хранить локально в проекте

## Связанные темы

- [[DefinitelyTyped]]
- [@types]
- [[Ambient-модули]]
- [[Глобальные-переменные]]