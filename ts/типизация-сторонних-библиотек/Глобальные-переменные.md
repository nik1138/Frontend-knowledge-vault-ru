---
aliases: [Глобальные переменные, Глобальные объявления]
tags: [typescript, typing, external-libraries, globals, ambient]
---

# Глобальные переменные

Глобальные переменные в TypeScript — это переменные, доступные в глобальной области видимости, которые могут быть объявлены для сторонних библиотек или фреймворков, добавляющих значения в глобальное пространство имен. Правильное объявление глобальных переменных позволяет использовать их с проверкой типов.

## Обзор

Многие JavaScript-библиотеки и фреймворки добавляют переменные в глобальное пространство имен (например, `window` в браузере или `global` в Node.js). TypeScript позволяет объявлять типы для этих глобальных переменных, обеспечивая безопасность типов при их использовании.

## Объявление глобальных переменных

### Базовое объявление

```typescript
// Объявление глобальной переменной
declare const API_URL: string;
declare const APP_VERSION: string;

// Объявление глобальной функции
declare function myGlobalFunction(param: string): void;

// Объявление глобального объекта
declare const MyGlobalObject: {
  propertyA: string;
  methodB(): number;
};
```

## Использование declare global

Для расширения глобального пространства имен используется конструкция `declare global`:

```typescript
declare global {
  // Добавление переменной в глобальное пространство
  var myGlobalVar: string;
  
  // Расширение интерфейса Window для браузерных приложений
  interface Window {
    myLibrary?: any;
    $: any;
    jQuery: any;
  }
  
  // Расширение глобального объекта Node.js
  interface NodeJS {
    interface Global {
      myGlobalValue: string;
    }
  }
}

// Обязательно экспортировать пустой объект для корректной работы глобальных объявлений
export {};
```

## Примеры объявления глобальных переменных

### 1. Переменные среды

```typescript
// types/env.d.ts
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      NODE_ENV: 'development' | 'production' | 'test';
      API_KEY: string;
      DATABASE_URL: string;
    }
  }
}

export {};
```

### 2. Библиотека, добавляющая глобальные переменные

```typescript
// types/third-party-lib.d.ts
declare global {
  // Глобальная переменная, добавляемая библиотекой
  const ThirdPartyLib: {
    version: string;
    config: {
      apiUrl: string;
      timeout: number;
    };
    init(): void;
    doSomething(data: string): void;
  };

  // Расширение window для браузерной библиотеки
  interface Window {
    ThirdPartyLib?: typeof ThirdPartyLib;
  }
}

export {};
```

### 3. Модульные глобальные переменные

```typescript
// types/module-globals.d.ts
declare const __webpack_require__: (id: string) => any;
declare const __webpack_public_path__: string;

// Переменные для тестирования
declare const __TEST__: boolean;
declare const __DEV__: boolean;
```

## Расширение встроенных глобальных объектов

### Расширение интерфейса Array

```typescript
// types/array-extensions.d.ts
declare global {
  interface Array<T> {
    customMethod(): T[];
  }
}

export {};
```

### Расширение интерфейса String

```typescript
// types/string-extensions.d.ts
declare global {
  interface String {
    capitalize(): string;
    reverse(): string;
  }
}

export {};
```

## Практические примеры

### 1. Объявление переменных для браузерного окружения

```typescript
// types/browser.d.ts
declare global {
  interface Window {
    // Переменные, добавляемые аналитическими скриптами
    gtag?: (...args: any[]) => void;
    analytics?: {
      track(event: string, properties?: any): void;
      identify(userId: string, traits?: any): void;
    };
    
    // Переменные для отладки
    DEBUG_MODE?: boolean;
    APP_CONFIG?: {
      apiUrl: string;
      version: string;
    };
  }
}

export {};
```

### 2. Объявление переменных для Node.js

```typescript
// types/node.d.ts
declare global {
  // Глобальные переменные среды выполнения
  var IS_DEV: boolean;
  var IS_PROD: boolean;
  
  // Дополнительные глобальные функции
  function logError(error: Error): void;
}

export {};
```

## Лучшие практики

### 1. Организация файлов объявлений

Создайте отдельные файлы для разных типов глобальных объявлений:

```
types/
├── globals.d.ts          // Общие глобальные переменные
├── browser.d.ts          // Глобальные переменные для браузера
├── node.d.ts             // Глобальные переменные для Node.js
└── env.d.ts              // Переменные среды
```

### 2. Документирование глобальных переменных

```typescript
/**
 * Базовый URL для API
 * Устанавливается в зависимости от среды выполнения
 */
declare const API_BASE_URL: string;
```

### 3. Использование строгой типизации

```typescript
// Хорошо - строго типизированная глобальная переменная
declare const APP_CONFIG: {
  name: string;
  version: string;
  apiUrl: string;
};

// Плохо - использование any
declare const APP_CONFIG: any;
```

## Частые ошибки

### 1. Забытый экспорт

```typescript
// НЕПРАВИЛЬНО - TypeScript может не распознать глобальные объявления
declare global {
  const MY_GLOBAL: string;
}
// Забыли export {};

// ПРАВИЛЬНО
declare global {
  const MY_GLOBAL: string;
}
export {};
```

### 2. Неправильное размещение объявлений

```typescript
// НЕПРАВИЛЬНО - объявления вне declare global блока
const MY_GLOBAL: string; // Это создаст переменную, а не объявление

// ПРАВИЛЬНО
declare global {
  const MY_GLOBAL: string;
}
export {};
```

## Тестирование глобальных объявлений

Создайте тестовый файл для проверки корректности объявлений:

```typescript
// tests/globals.test.ts
// Использование глобальных переменных с проверкой типов
console.log(API_URL); // Должно работать с правильным типом
myGlobalFunction('test'); // Должна быть проверка типов параметров

// Проверка расширения window
if (window.myLibrary) {
  window.myLibrary.doSomething(); // Должна быть проверка типов
}
```

## Связанные темы

- [[DefinitelyTyped]]
- [@types]
- [[Создание-определений]]
- [[Ambient-модули]]