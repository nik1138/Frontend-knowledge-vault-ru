---
aliases: [Постепенная миграция, Частичная миграция]
tags: [typescript, migration, javascript]
---

# Постепенная миграция с JavaScript на TypeScript

Постепенная миграция позволяет внедрять TypeScript в существующий JavaScript-проект без полной остановки разработки. Этот подход особенно полезен для больших кодовых баз, где полная миграция может занять месяцы или даже годы.

## Принципы постепенной миграции

Постепенная миграция основана на нескольких ключевых принципах:

- **Совместимость**: TypeScript полностью совместим с JavaScript, что позволяет использовать оба языка в одном проекте
- **Гибкость**: можно мигрировать файл за файлом, модуль за модулем
- **Безопасность**: по мере добавления типизации код становится более надежным
- **Контроль**: возможность контролировать скорость и объем изменений

## Подготовка проекта

Перед началом миграции необходимо настроить TypeScript в проекте:

```bash
npm install --save-dev typescript @types/node
```

Создайте файл `tsconfig.json` в корне проекта:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "strict": false,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "allowJs": true,
    "checkJs": false,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "outDir": "./dist"
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
```

Ключевые параметры:
- `allowJs: true` - позволяет TypeScript работать с JavaScript файлами
- `checkJs: false` - отключает проверку типов в JS файлах по умолчанию
- `declaration: true` - генерирует .d.ts файлы для JS файлов

## Стратегии миграции

### 1. Миграция по файлам

Начните с миграции отдельных файлов, особенно тех, которые:
- Менее критичны для бизнес-логики
- Имеют хорошее покрытие тестами
- Редко изменяются

### 2. Миграция по слоям

Мигрируйте по архитектурным слоям:
- Утилиты и хелперы
- Модели данных
- Сервисы
- Компоненты интерфейса

### 3. Миграция по функциональности

Фокусируйтесь на конкретных функциональных блоках:
- Аутентификация
- Работа с API
- Валидация данных

## Практические шаги

### Шаг 1: Настройка TypeScript

Создайте `tsconfig.json` с опцией `allowJs: true` и `checkJs: false`.

### Шаг 2: Добавление JSDoc

Прежде чем конвертировать файлы в `.ts`, улучшите документацию с помощью JSDoc. Это облегчит процесс типизации:

```javascript
/**
 * @param {string} name - Имя пользователя
 * @param {number} age - Возраст пользователя
 * @returns {object} Объект пользователя
 */
function createUser(name, age) {
  return { name, age, id: Math.random() };
}
```

Подробнее о [[JSDoc-типизация]].

### Шаг 3: Постепенная проверка типов

Включите `checkJs: true` в `tsconfig.json` и начните исправлять ошибки типизации. Используйте `// @ts-ignore` временно для игнорирования сложных участков кода.

### Шаг 4: Конвертация файлов

Когда файл будет полностью типизирован, измените его расширение с `.js` на `.ts` и убедитесь, что все зависимости также корректно обрабатываются.

## Преимущества постепенной миграции

- **Непрерывная разработка**: проект остается рабочим на протяжении всей миграции
- **Минимизация рисков**: ошибки могут быть обнаружены и исправлены постепенно
- **Обучение команды**: разработчики постепенно осваивают TypeScript
- **Улучшение качества кода**: типизация помогает находить ошибки на этапе компиляции

## Возможные проблемы

- **Сложность с типами внешних библиотек**: может потребоваться установка `@types` пакетов
- **Конфликты типов**: при интеграции JS и TS кода могут возникать несоответствия
- **Зависимости**: необходимо следить за тем, чтобы мигрируемые модули не имели непереведенных зависимостей

## Лучшие практики

- Начинайте с небольших, изолированных модулей
- Обязательно покрывайте код тестами перед миграцией
- Используйте [[Лучшие-практики]] для обеспечения согласованности
- Регулярно обновляйте типы зависимостей

## Заключение

Постепенная миграция - это наиболее безопасный и эффективный способ внедрения TypeScript в существующий проект. Она позволяет сохранить непрерывность разработки и постепенно улучшать качество кода за счет статической типизации.

Следующий шаг - [[JSDoc-типизация]].