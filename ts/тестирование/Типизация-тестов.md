---
aliases: ["Типизация тестов", "Type Testing"]
tags: [typescript, testing, типизация]
---

# Типизация тестов в TypeScript

## Обзор

Типизация тестов в TypeScript - это важная практика, которая позволяет проверять корректность типов в коде во время написания тестов. Это помогает выявлять ошибки типизации на ранних этапах разработки и обеспечивает большую надежность приложений.

## Зачем нужна типизация тестов?

Типизация тестов важна по нескольким причинам:

1. **Обнаружение ошибок типизации** - Позволяет выявлять несоответствия типов до запуска тестов
2. **Улучшение читаемости** - Четко определяет ожидаемые типы данных в тестах
3. **Поддержка рефакторинга** - При изменении типов в коде тесты также нужно будет обновить
4. **Документирование API** - Тесты с типами служат дополнительной документацией

## Основные концепции

### Строгая типизация в тестах

В TypeScript тесты могут использовать строгую типизацию, чтобы гарантировать, что данные, передаваемые в тестируемую функцию, соответствуют ожидаемому типу:

```typescript
// Тестируемая функция
function calculateTotal(items: { price: number; quantity: number }[]): number {
  return items.reduce((total, item) => total + item.price * item.quantity, 0);
}

// Тест с типизацией
describe('calculateTotal', () => {
  it('должна корректно вычислять общую сумму', () => {
    const items: { price: number; quantity: number }[] = [
      { price: 10, quantity: 2 },
      { price: 5, quantity: 3 }
    ];
    
    const result: number = calculateTotal(items);
    expect(result).toBe(35);
  });
});
```

### Использование дженериков в тестах

Дженерики позволяют писать универсальные тесты, которые работают с разными типами:

```typescript
function identity<T>(arg: T): T {
  return arg;
}

// Тест для дженерик-функции
describe('identity', () => {
  it('должна возвращать тот же тип, что и получила', () => {
    const numberValue: number = identity<number>(42);
    const stringValue: string = identity<string>('hello');
    
    expect(numberValue).toBe(42);
    expect(stringValue).toBe('hello');
  });
});
```

## Практические примеры

### Тестирование интерфейсов

```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

function createUser(userData: Partial<User>): User {
  return {
    id: userData.id || 0,
    name: userData.name || 'Default Name',
    email: userData.email || 'default@example.com'
  };
}

describe('createUser', () => {
  it('должна создавать пользователя с правильными типами', () => {
    const userData: Partial<User> = {
      name: 'John Doe',
      email: 'john@example.com'
    };
    
    const user: User = createUser(userData);
    
    expect(typeof user.id).toBe('number');
    expect(typeof user.name).toBe('string');
    expect(typeof user.email).toBe('string');
  });
});
```

### Тестирование типов возвращаемых значений

```typescript
type ApiResponse<T> = {
  data: T;
  status: number;
  message: string;
};

async function fetchUserData(id: number): Promise<ApiResponse<User>> {
  // Симуляция API-запроса
  return {
    data: { id, name: 'Test User', email: 'test@example.com' },
    status: 200,
    message: 'Success'
  };
}

describe('fetchUserData', () => {
  it('должна возвращать корректный тип ответа', async () => {
    const response: ApiResponse<User> = await fetchUserData(1);
    
    expect(response.status).toBe(200);
    expect(typeof response.data.id).toBe('number');
    expect(typeof response.data.name).toBe('string');
    expect(typeof response.data.email).toBe('string');
  });
});
```

## Инструменты для типизации тестов

### tsd - библиотека для тестирования типов

```typescript
// test/type-test.ts
import { expectError, expectType } from 'tsd';

interface User {
  id: number;
  name: string;
}

const user: User = { id: 1, name: 'John' };

// Эти тесты проверяются на уровне типов
expectType<User>(user);
expectType<number>(user.id);
expectType<string>(user.name);
expectError<string>(user.id); // Ошибка: number не может быть string
```

## Лучшие практики

1. **Явно указывайте типы в тестах** - Это делает тесты более понятными и помогает при рефакторинге
2. **Используйте типы для проверки ожидаемого поведения** - Это помогает документировать API
3. **Проверяйте типы возвращаемых значений** - Убедитесь, что функции возвращают ожидаемые типы
4. **Используйте дженерики для универсальных тестов** - Это позволяет повторно использовать тесты для разных типов

## Связанные темы

- [[Mock-типы]] - Типы, используемые для создания mock-объектов
- [[Тестирование-типов]] - Проверка корректности определений типов
- [[Инструменты-для-тестирования]] - Инструменты, используемые для тестирования TypeScript кода
- [[Практики-тестирования]] - Общие практики тестирования в TypeScript

## Вывод

Типизация тестов в TypeScript значительно повышает качество кода и уменьшает количество ошибок. Правильное использование типов в тестах помогает лучше документировать API и облегчает поддержку кода в долгосрочной перспективе.