---
aliases: ["Инструменты для тестирования", "Testing Tools"]
tags: [typescript, testing, tools, jest, vitest, cypress]
---

# Инструменты для тестирования TypeScript

## Обзор

Тестирование TypeScript-приложений требует специфических инструментов, которые могут корректно обрабатывать типизированный код. В этой статье рассматриваются основные инструменты, используемые для тестирования TypeScript-приложений, их особенности и лучшие практики использования.

## Основные инструменты

### Jest

Jest - один из самых популярных фреймворков для тестирования JavaScript и TypeScript. Он предоставляет все необходимые инструменты для написания и выполнения тестов.

#### Установка и настройка

```bash
npm install --save-dev jest @types/jest ts-jest
```

Файл конфигурации `jest.config.js`:

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src'],
  testMatch: ['**/__tests__/**/*.+(ts|tsx|js)', '**/?(*.)+(spec|test).+(ts|tsx|js)'],
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],
};
```

#### Пример использования с типами

```typescript
// calculator.ts
export function add(a: number, b: number): number {
  return a + b;
}

export function multiply(a: number, b: number): number {
  return a * b;
}

// calculator.test.ts
import { add, multiply } from './calculator';

describe('Calculator', () => {
  test('addition should work correctly', () => {
    const result: number = add(2, 3);
    expect(result).toBe(5);
  });

  test('multiplication should work correctly', () => {
    const result: number = multiply(2, 3);
    expect(result).toBe(6);
  });
});
```

#### Особенности работы с TypeScript

- Используйте `ts-jest` для транспиляции TypeScript кода
- Можете использовать типизированные mock-объекты
- Поддержка асинхронных тестов с `async/await`

### Vitest

Vitest - современный тестовый фреймворк, созданный командой Vite. Он быстрее и легковеснее, чем Jest.

#### Установка и настройка

```bash
npm install --save-dev vitest @vitest/ui @types/node
```

Файл конфигурации `vite.config.ts`:

```typescript
import { defineConfig } from 'vite';

export default defineConfig({
  test: {
    globals: true,
    environment: 'node',
    include: ['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
  },
});
```

#### Пример использования

```typescript
// utils.ts
export function capitalize(str: string): string {
  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}

// utils.test.ts
import { describe, it, expect } from 'vitest';
import { capitalize } from './utils';

describe('capitalize', () => {
  it('should capitalize the first letter', () => {
    const result: string = capitalize('hello');
    expect(result).toBe('Hello');
  });

  it('should handle empty string', () => {
    const result: string = capitalize('');
    expect(result).toBe('');
  });
});
```

### Cypress

Cypress - фреймворк для end-to-end тестирования, который также поддерживает TypeScript.

#### Установка и настройка

```bash
npm install --save-dev cypress
npx cypress open
```

Файл конфигурации `cypress.config.ts`:

```typescript
import { defineConfig } from 'cypress';

export default defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      // implement node event listeners here
    },
    baseUrl: 'http://localhost:3000',
  },
});
```

#### Пример теста

```typescript
// cypress/e2e/example.cy.ts
describe('My First Test', () => {
  it('Visits the initial project page', () => {
    cy.visit('/');
    cy.contains('Welcome').should('be.visible');
  });
});
```

## Инструменты для тестирования типов

### tsd

tsd - библиотека для тестирования типов TypeScript.

#### Установка и использование

```bash
npm install --save-dev tsd
```

#### Пример использования

```typescript
// test/type-test.ts
import { expectType, expectError } from 'tsd';

interface User {
  id: number;
  name: string;
}

const user: User = { id: 1, name: 'John' };

// Эти тесты проверяются на уровне типов
expectType<User>(user);
expectType<number>(user.id);
expectType<string>(user.name);

// Эти тесты должны вызвать ошибки типизации
expectError<string>(user.id); // Ошибка: number не может быть string
```

### Conditional Types in Tests

Использование условных типов для проверки типов:

```typescript
// helpers.ts
type IsString<T> = T extends string ? true : false;

// type-tests.ts
import { IsString } from './helpers';

type Test1 = IsString<string>; // true
type Test2 = IsString<number>; // false
type Test3 = IsString<'hello'>; // true

// Вспомогательный тип для проверки
type AssertEquals<T, Expected> = T extends Expected ? (Expected extends T ? true : false) : false;

type VerifyTest1 = AssertEquals<Test1, true>;
type VerifyTest2 = AssertEquals<Test2, false>;
type VerifyTest3 = AssertEquals<Test3, true>;
```

## Mock-инструменты

### Типизированные mock-объекты с Jest

```typescript
// user-service.ts
export interface User {
  id: number;
  name: string;
  email: string;
}

export interface UserService {
  getUser(id: number): Promise<User>;
  createUser(userData: Omit<User, 'id'>): Promise<User>;
}

export class UserServiceImpl implements UserService {
  async getUser(id: number): Promise<User> {
    // реализация
    return { id, name: 'Test User', email: 'test@example.com' };
  }

  async createUser(userData: Omit<User, 'id'>): Promise<User> {
    // реализация
    return { id: 999, ...userData };
  }
}

// user-service.test.ts
import { UserService } from './user-service';

describe('UserService', () => {
  let mockUserService: jest.Mocked<UserService>;

  beforeEach(() => {
    mockUserService = {
      getUser: jest.fn(),
      createUser: jest.fn()
    };
  });

  it('should create user correctly', async () => {
    const userData = { name: 'John Doe', email: 'john@example.com' };
    const expectedUser = { id: 999, name: 'John Doe', email: 'john@example.com' };
    
    mockUserService.createUser.mockResolvedValue(expectedUser);

    const result: User = await mockUserService.createUser(userData);

    expect(mockUserService.createUser).toHaveBeenCalledWith(userData);
    expect(result).toEqual(expectedUser);
  });
});
```

## Инструменты для анализа покрытия кода

### Istanbul/nyc

Инструмент для анализа покрытия кода тестами.

#### Установка

```bash
npm install --save-dev nyc
```

#### Использование с Jest

```json
{
  "scripts": {
    "test:coverage": "nyc jest"
  }
}
```

## Интеграция с IDE

### Поддержка TypeScript в редакторах

Большинство современных редакторов (VSCode, WebStorm, и др.) предоставляют отличную поддержку TypeScript-тестов:

- Подсветка синтаксиса
- Автодополнение
- Проверка типов в реальном времени
- Интеграция с тестовыми фреймворками

### VSCode конфигурация

Файл `.vscode/settings.json`:

```json
{
  "typescript.preferences.includePackageJsonAutoImports": "auto",
  "jest.autoRun": "off",
  "typescript.updateImportsOnFileMove.enabled": "always",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

## Лучшие практики

1. **Используйте строгую типизацию в тестах** - Это помогает избежать ошибок и делает тесты более понятными
2. **Создавайте типизированные mock-объекты** - Это обеспечивает совместимость с оригинальными интерфейсами
3. **Разделяйте unit и integration тесты** - Используйте разные подходы для разных типов тестов
4. **Используйте подходящий инструмент для задачи** - Jest для unit-тестов, Cypress для e2e тестов
5. **Регулярно проверяйте покрытие кода** - Это помогает выявить непротестированные участки кода

## Связанные темы

- [[Типизация-тестов]] - Типизация в контексте тестирования
- [[Mock-типы]] - Типы, используемые для создания mock-объектов
- [[Тестирование-типов]] - Проверка корректности определений типов
- [[Практики-тестирования]] - Общие практики тестирования в TypeScript

## Вывод

Выбор правильных инструментов для тестирования TypeScript-приложений критически важен для обеспечения качества кода. Каждый инструмент имеет свои особенности и области применения. Понимание этих различий позволяет создавать эффективные и надежные тестовые покрытия.