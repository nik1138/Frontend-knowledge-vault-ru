---
aliases: ["Зависимости", "Управление зависимостями"]
tags: ["#typescript", "#зависимости", "#архитектура"]
---

# Управление зависимостями

## Обзор

Управление зависимостями в TypeScript-проектах - это критический аспект разработки, особенно при работе с несколькими проектами или монорепозиториями. Эффективное управление зависимостями помогает избежать конфликтов версий, упрощает обновления и обеспечивает стабильность приложений.

## Типы зависимостей

### 1. Production Dependencies

Зависимости, необходимые для работы приложения в продакшене:

```json
{
  "dependencies": {
    "express": "^4.18.0",
    "lodash": "^4.17.21",
    "axios": "^1.3.0"
  }
}
```

### 2. Development Dependencies

Зависимости, используемые только во время разработки:

```json
{
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^18.0.0",
    "ts-node": "^10.9.0",
    "jest": "^29.0.0"
  }
}
```

### 3. Peer Dependencies

Зависимости, которые должны быть предоставлены внешними зависимостями:

```json
{
  "peerDependencies": {
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  }
}
```

## Инструменты управления зависимостями

### 1. npm

Самый распространенный менеджер пакетов для Node.js:

```bash
# Установка зависимостей
npm install package-name

# Установка зависимостей разработки
npm install --save-dev package-name

# Обновление зависимостей
npm update

# Аудит безопасности
npm audit
```

### 2. Yarn

Альтернативный менеджер пакетов с улучшенной производительностью:

```bash
# Установка зависимостей
yarn add package-name

# Установка зависимостей разработки
yarn add --dev package-name

# Установка всех зависимостей
yarn install
```

### 3. pnpm

Менеджер пакетов с эффективным использованием дискового пространства:

```bash
# Установка зависимостей
pnpm add package-name

# Установка зависимостей разработки
pnpm add --save-dev package-name
```

## Управление зависимостями в монорепозиториях

### 1. Yarn Workspaces

Позволяет управлять несколькими пакетами в одном репозитории:

```json
// package.json (корневой)
{
  "private": true,
  "workspaces": [
    "packages/*"
  ]
}
```

### 2. Lerna

Инструмент для управления JavaScript/TypeScript проектами в монорепозиториях:

```json
// lerna.json
{
  "packages": [
    "packages/*"
  ],
  "version": "independent"
}
```

```bash
# Установка зависимостей во всех пакетах
lerna bootstrap

# Запуск команды во всех пакетах
lerna exec -- npm run build
```

### 3. Nx

Платформа для монорепозиториев с расширенными возможностями:

```json
// nx.json
{
  "affected": {
    "defaultBase": "main"
  },
  "targetDefaults": {
    "build": {
      "dependsOn": ["^build"]
    }
  }
}
```

## Практические рекомендации

### 1. Используйте точные версии для критических зависимостей

```json
{
  "dependencies": {
    "critical-lib": "1.2.3"
  }
}
```

### 2. Регулярно обновляйте зависимости

```bash
# Проверка устаревших пакетов
npm outdated

# Интерактивное обновление
npx npm-check -u
```

### 3. Используйте lock-файлы

Lock-файлы (package-lock.json, yarn.lock, pnpm-lock.yaml) обеспечивают воспроизводимость сборки:

```bash
# Убедитесь, что lock-файл включен в репозиторий
git add package-lock.json
```

### 4. Избегайте дублирования зависимостей

При работе с монорепозиториями используйте хуки для проверки дублирования:

```bash
# Проверка дублирования с помощью npm
npm ls --depth=0
```

## Управление версиями зависимостей

### 1. Семантическое версионирование

Используйте семантическое версионирование (SemVer):

- MAJOR.MAJOR.MINOR
- ^ (caret) для совместимости с основной версией
- ~ (tilde) для совместимости с минорной версией

### 2. Использование диапазонов версий

```json
{
  "dependencies": {
    "lodash": "^4.17.0",  // Любая версия >= 4.17.0 и < 5.0.0
    "express": "~4.18.0", // Любая версия >= 4.18.0 и < 4.19.0
    "react": "18.2.x"     // Любая версия 18.2.*
  }
}
```

## Проверка безопасности зависимостей

### 1. Использование npm audit

```bash
# Проверка уязвимостей
npm audit

# Автоматическое исправление
npm audit fix
```

### 2. Использование сторонних инструментов

```bash
# Использование Snyk
npx snyk test

# Использование OWASP Dependency Check
npx @dependency-check/cli check --project "My Project" --scan "."
```

## Практические примеры

### Пример структуры зависимостей в монорепозитории

```
monorepo/
├── package.json
├── lerna.json
├── packages/
│   ├── core/
│   │   ├── package.json
│   │   └── tsconfig.json
│   ├── shared/
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── app/
│       ├── package.json
│       └── tsconfig.json
```

### Пример общей зависимости в корневом package.json

```json
{
  "private": true,
  "workspaces": [
    "packages/*"
  ],
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^18.0.0",
    "ts-node": "^10.9.0",
    "jest": "^29.0.0"
  },
  "dependencies": {
    "axios": "^1.3.0"
  }
}
```

### Пример конкретного package.json в подпроекте

```json
{
  "name": "@myorg/core",
  "version": "1.0.0",
  "private": true,
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsc",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "axios": "^1.3.0",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "@types/lodash": "^4.14.194"
  }
}
```

## Связанные концепции

- [[Монорепозитории]]
- [[Множественные-проекты]]
- [[Ссылки-на-проекты]]
- [[Композиция-проектов]]

## Заключение

Эффективное управление зависимостями - ключ к стабильности и безопасности TypeScript-проектов. При работе с несколькими проектами или монорепозиториями особенно важно правильно организовать зависимости, использовать подходящие инструменты и следовать лучшим практикам для обеспечения надежности и производительности приложений.