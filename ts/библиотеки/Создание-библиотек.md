---
aliases: ["Создание библиотек", "Разработка библиотек", "TypeScript библиотеки"]
tags: [typescript, libraries, development]
---

# Создание-библиотек

## Обзор

Создание библиотек на TypeScript - это процесс разработки переиспользуемого кода, который может быть интегрирован в другие проекты. TypeScript предоставляет мощные возможности типизации, которые делают библиотеки более надежными и удобными в использовании.

## Подготовка проекта

Для создания TypeScript библиотеки необходимо настроить правильную структуру проекта:

```bash
mkdir my-ts-library
cd my-ts-library
npm init -y
npm install --save-dev typescript @types/node
```

### Структура проекта

```
my-ts-library/
├── src/
│   ├── index.ts
│   ├── core/
│   │   └── types.ts
│   └── utils/
│       └── helpers.ts
├── dist/
├── package.json
├── tsconfig.json
└── README.md
```

## Настройка tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "CommonJS",
    "lib": ["ES2020"],
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "allowSyntheticDefaultImports": true
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts"
  ]
}
```

## Основные принципы создания библиотек

### 1. Чистые API

Создавайте понятные и последовательные интерфейсы:

```typescript
// Хорошо: понятное API
export interface User {
  id: number;
  name: string;
  email: string;
}

export function createUser(userData: Partial<User>): User {
  return {
    id: Date.now(),
    name: '',
    email: '',
    ...userData
  };
}

// Плохо: запутанное API
export function makeUser(a: any, b?: string) {
  // ...
}
```

### 2. Экспорт только необходимого

Экспортируйте только то, что нужно пользователям вашей библиотеки:

```typescript
// src/index.ts
export { createUser, updateUser, deleteUser } from './core/user';
export type { User } from './core/user';
export { ValidationError } from './utils/errors';
// Не экспортируйте внутренние вспомогательные функции
```

### 3. Обработка ошибок

Реализуйте надежную обработку ошибок:

```typescript
export class LibraryError extends Error {
  constructor(message: string, public code: string) {
    super(message);
    this.name = 'LibraryError';
  }
}

export function validateInput(input: unknown): void {
  if (!input) {
    throw new LibraryError('Input is required', 'INVALID_INPUT');
  }
  
  if (typeof input !== 'object') {
    throw new LibraryError('Input must be an object', 'INVALID_TYPE');
  }
}
```

## Типы и интерфейсы

### Общие шаблоны типов

```typescript
// Использование дженериков для гибкости
export interface Repository<T> {
  findById(id: number): Promise<T | null>;
  findAll(): Promise<T[]>;
  create(item: Omit<T, 'id'>): Promise<T>;
  update(id: number, item: Partial<T>): Promise<T | null>;
  delete(id: number): Promise<boolean>;
}

// Типы для конфигурации
export interface Config {
  timeout?: number;
  retries?: number;
  baseUrl?: string;
}

export const defaultConfig: Required<Config> = {
  timeout: 5000,
  retries: 3,
  baseUrl: 'https://api.example.com'
};
```

## Тестирование библиотеки

Для надежной библиотеки важно писать тесты:

```bash
npm install --save-dev jest @types/jest ts-jest
```

```typescript
// src/__tests__/user.test.ts
import { createUser } from '../core/user';

describe('createUser', () => {
  it('should create a user with default values', () => {
    const user = createUser();
    expect(user.id).toBeDefined();
    expect(user.name).toBe('');
    expect(user.email).toBe('');
  });

  it('should create a user with provided data', () => {
    const user = createUser({ name: 'John', email: 'john@example.com' });
    expect(user.name).toBe('John');
    expect(user.email).toBe('john@example.com');
  });
});
```

## Сборка и публикация

### Скрипты сборки

```json
{
  "scripts": {
    "build": "tsc",
    "dev": "tsc --watch",
    "test": "jest",
    "clean": "rm -rf dist"
  }
}
```

## Лучшие практики

1. **Документация**: Пишите JSDoc для всех публичных API
2. **Семантическое версионирование**: Следуйте семверу
3. **Проверка типов**: Убедитесь, что библиотека корректно работает с различными версиями TypeScript
4. **Поддержка ES6 модулей**: Обеспечьте поддержку как CommonJS, так и ES6 модулей

## Связанные темы

- [[Публикация-на-npm]]
- [[Типизация-библиотек]]
- [[Совместимость-библиотек]]
- [[Документация-библиотек]]
- [[TypeScript]]