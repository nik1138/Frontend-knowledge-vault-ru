---
aliases: ["–°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤", "–ê–ª–µ—Ä—Ç–∏–Ω–≥ TypeScript", "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö"]
tags: [typescript, monitoring, alerting, notifications, best-practices]
---

# –ê–ª–µ—Ä—Ç–∏–Ω–≥ –≤ TypeScript-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö

## –û–±–∑–æ—Ä

–ê–ª–µ—Ä—Ç–∏–Ω–≥ - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è —É–≤–µ–¥–æ–º–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

### 1. –î–µ—Ç–µ–∫—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º

–î–µ—Ç–µ–∫—Ç–æ—Ä—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π:

```typescript
interface AlertCondition {
  evaluate(value: number): boolean;
}

class ThresholdCondition implements AlertCondition {
  constructor(
    private threshold: number,
    private operator: 'gt' | 'lt' | 'gte' | 'lte' = 'gt'
  ) {}
  
  evaluate(value: number): boolean {
    switch (this.operator) {
      case 'gt': return value > this.threshold;
      case 'lt': return value < this.threshold;
      case 'gte': return value >= this.threshold;
      case 'lte': return value <= this.threshold;
      default: return false;
    }
  }
}

class ConsecutiveCondition implements AlertCondition {
  private consecutiveCount: number = 0;
  
  constructor(
    private condition: AlertCondition,
    private threshold: number
  ) {}
  
  evaluate(value: number): boolean {
    if (this.condition.evaluate(value)) {
      this.consecutiveCount++;
      return this.consecutiveCount >= this.threshold;
    } else {
      this.consecutiveCount = 0;
      return false;
    }
  }
}
```

### 2. –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–ª–µ—Ä—Ç–æ–≤

–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–ª–µ—Ä—Ç–æ–≤ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∞–ª–µ—Ä—Ç–æ–≤:

```typescript
interface Alert {
  id: string;
  name: string;
  description: string;
  severity: 'critical' | 'warning' | 'info';
  value: number;
  timestamp: Date;
  labels: Record<string, string>;
  status: 'firing' | 'resolved' | 'pending';
  silenceUntil?: Date;
}

class AlertManager {
  private alerts: Map<string, Alert> = new Map();
  private handlers: AlertHandler[] = [];
  
  addHandler(handler: AlertHandler) {
    this.handlers.push(handler);
  }
  
  async evaluateAlert(
    name: string,
    description: string,
    value: number,
    condition: AlertCondition,
    labels: Record<string, string> = {},
    severity: 'critical' | 'warning' | 'info' = 'warning'
  ): Promise<void> {
    const isFiring = condition.evaluate(value);
    const alertId = `${name}-${JSON.stringify(labels)}`;
    
    if (isFiring) {
      if (!this.alerts.has(alertId)) {
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∞–ª–µ—Ä—Ç
        const alert: Alert = {
          id: alertId,
          name,
          description,
          value,
          severity,
          timestamp: new Date(),
          labels,
          status: 'firing'
        };
        
        this.alerts.set(alertId, alert);
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –∞–ª–µ—Ä—Ç–µ
        await this.notifyAlert(alert);
      } else {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–ª–µ—Ä—Ç
        const existingAlert = this.alerts.get(alertId)!;
        existingAlert.value = value;
        existingAlert.timestamp = new Date();
      }
    } else if (this.alerts.has(alertId)) {
      // –ê–ª–µ—Ä—Ç –±–æ–ª—å—à–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
      const alert = this.alerts.get(alertId)!;
      alert.status = 'resolved';
      alert.timestamp = new Date();
      
      await this.notifyAlert(alert);
      this.alerts.delete(alertId);
    }
  }
  
  private async notifyAlert(alert: Alert) {
    for (const handler of this.handlers) {
      try {
        await handler.handle(alert);
      } catch (error) {
        console.error(`Error in alert handler:`, error);
      }
    }
  }
  
  getAlerts(): Alert[] {
    return Array.from(this.alerts.values());
  }
  
  silenceAlert(alertId: string, duration: number) {
    const alert = this.alerts.get(alertId);
    if (alert) {
      alert.silenceUntil = new Date(Date.now() + duration);
    }
  }
}
```

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∞–ª–µ—Ä—Ç—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:

```typescript
interface AlertHandler {
  handle(alert: Alert): Promise<void>;
}

class ConsoleAlertHandler implements AlertHandler {
  async handle(alert: Alert) {
    console.log(`[${alert.severity.toUpperCase()}] ${alert.name}: ${alert.description}`);
    console.log(`Value: ${alert.value}, Labels:`, alert.labels);
  }
}

class SlackAlertHandler implements AlertHandler {
  constructor(private webhookUrl: string) {}
  
  async handle(alert: Alert) {
    const message = {
      text: `üö® *${alert.severity.toUpperCase()}* ${alert.name}`,
      attachments: [{
        color: alert.severity === 'critical' ? 'danger' : 'warning',
        fields: [
          { title: 'Description', value: alert.description, short: false },
          { title: 'Value', value: alert.value.toString(), short: true },
          { title: 'Labels', value: JSON.stringify(alert.labels), short: false }
        ]
      }]
    };
    
    try {
      await fetch(this.webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(message)
      });
    } catch (error) {
      console.error('Failed to send Slack notification:', error);
    }
  }
}

class EmailAlertHandler implements AlertHandler {
  constructor(
    private smtpConfig: {
      host: string;
      port: number;
      user: string;
      password: string;
    }
  ) {}
  
  async handle(alert: Alert) {
    // –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
    console.log(`Email notification for alert: ${alert.name}`);
  }
}
```

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

```typescript
import client from 'prom-client';

// –°–æ–∑–¥–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
const httpRequestDuration = new client.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status_code'],
  buckets: [0.1, 0.3, 0.5, 0.7, 1, 3, 5, 7, 10]
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∞–ª–µ—Ä—Ç–æ–≤
const alertManager = new AlertManager();

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
alertManager.addHandler(new ConsoleAlertHandler());
alertManager.addHandler(new SlackAlertHandler(process.env.SLACK_WEBHOOK_URL!));

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Å–ª–æ–≤–∏—è –∞–ª–µ—Ä—Ç–æ–≤
const highResponseTimeCondition = new ConsecutiveCondition(
  new ThresholdCondition(1, 'gt'), // –±–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã
  3 // —Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–∞
);

// –ü—Ä–∏–º–µ—Ä middleware –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤
const alertingMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  
  res.on('finish', async () => {
    const duration = (Date.now() - start) / 1000;
    
    // –û—Ü–µ–Ω–∏–≤–∞–µ–º –∞–ª–µ—Ä—Ç –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    await alertManager.evaluateAlert(
      'high_response_time',
      'High response time detected',
      duration,
      highResponseTimeCondition,
      { 
        method: req.method, 
        route: req.route?.path || req.originalUrl,
        status_code: res.statusCode.toString()
      },
      'warning'
    );
    
    // –û—Ü–µ–Ω–∏–≤–∞–µ–º –∞–ª–µ—Ä—Ç –¥–ª—è –æ—à–∏–±–æ–∫
    if (res.statusCode >= 500) {
      await alertManager.evaluateAlert(
        'server_error',
        'Server error detected',
        res.statusCode,
        new ThresholdCondition(499, 'gt'),
        { 
          method: req.method, 
          route: req.route?.path || req.originalUrl,
          status_code: res.statusCode.toString()
        },
        'critical'
      );
    }
  });
  
  next();
};
```

## –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

### Prometheus Alertmanager

Alertmanager - —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Prometheus, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç–∞–º–∏:

```yaml
# alertmanager.yml
route:
  receiver: 'default-receiver'
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h

receivers:
- name: 'default-receiver'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/...'
    channel: '#alerts'
    text: '{{ .CommonAnnotations.summary }}'
```

### PagerDuty

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

```typescript
class PagerDutyAlertHandler implements AlertHandler {
  constructor(private integrationKey: string) {}
  
  async handle(alert: Alert) {
    const event = {
      routing_key: this.integrationKey,
      event_action: alert.status === 'firing' ? 'trigger' : 'resolve',
      payload: {
        summary: alert.description,
        source: 'typescript-app',
        severity: this.mapSeverity(alert.severity),
        custom_details: {
          name: alert.name,
          value: alert.value,
          labels: alert.labels
        }
      }
    };
    
    try {
      await fetch('https://events.pagerduty.com/v2/enqueue', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(event)
      });
    } catch (error) {
      console.error('Failed to send PagerDuty notification:', error);
    }
  }
  
  private mapSeverity(severity: 'critical' | 'warning' | 'info'): string {
    switch (severity) {
      case 'critical': return 'critical';
      case 'warning': return 'warning';
      case 'info': return 'info';
      default: return 'info';
    }
  }
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

### 1. –ü—Ä–∞–≤–∏–ª–æ "—Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω–æ–µ"

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∞–ª–µ—Ä—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è:

```typescript
// –ü–ª–æ—Ö–æ - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–ª–µ—Ä—Ç–æ–≤
await alertManager.evaluateAlert('request_count', 'High request count', requestCount, 
  new ThresholdCondition(100, 'gt'));

// –•–æ—Ä–æ—à–æ - —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
await alertManager.evaluateAlert('error_rate', 'High error rate', errorRate, 
  new ThresholdCondition(0.05, 'gt')); // 5% –æ—à–∏–±–æ–∫
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É

–ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∞–ª–µ—Ä—Ç–æ–≤:

```typescript
const labels = {
  service: 'user-service',
  environment: 'production',
  region: 'us-east-1',
  team: 'backend'
};

await alertManager.evaluateAlert(
  'high_cpu_usage',
  'CPU usage is too high',
  cpuUsage,
  highCpuCondition,
  labels,
  'critical'
);
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ø–∞–º–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∞–ª–µ—Ä—Ç–∞–º–∏:

```typescript
class DuplicateFilterHandler implements AlertHandler {
  private recentAlerts: Map<string, Date> = new Map();
  private minInterval: number = 300000; // 5 –º–∏–Ω—É—Ç
  
  constructor(private nextHandler: AlertHandler) {}
  
  async handle(alert: Alert) {
    const key = `${alert.name}-${JSON.stringify(alert.labels)}`;
    const lastAlertTime = this.recentAlerts.get(key);
    
    if (!lastAlertTime || Date.now() - lastAlertTime.getTime() > this.minInterval) {
      this.recentAlerts.set(key, new Date());
      await this.nextHandler.handle(alert);
    }
  }
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ TypeScript-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è –∞–ª–µ—Ä—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —à—É–º–∞.

–°–º. —Ç–∞–∫–∂–µ:
- [[–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ]]
- [[–ú–µ—Ç—Ä–∏–∫–∏]]
- [[–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞]]
- [[–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ]]