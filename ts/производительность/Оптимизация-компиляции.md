---
aliases: ["Компиляция TS", "Оптимизация компиляции TypeScript"]
tags: [typescript, performance, compilation, optimization]
---

# Оптимизация компиляции TypeScript

## Введение

Оптимизация компиляции TypeScript является критическим аспектом разработки высокопроизводительных приложений. Эффективная настройка компиляции может значительно сократить время сборки и улучшить общую производительность процесса разработки.

## Настройки компиляции для производительности

### Компиляторные флаги

Для оптимизации производительности компиляции TypeScript важно правильно настроить компиляторные флаги в файле `tsconfig.json`:

```json
{
  "compilerOptions": {
    "incremental": true,
    "composite": true,
    "tsBuildInfoFile": ".tsbuildinfo",
    "diagnostics": true,
    "forceConsistentCasingInFileNames": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "skipLibCheck": true,
    "strict": true
  },
  "exclude": [
    "node_modules",
    "dist",
    "build"
  ]
}
```

### Параметр `incremental`

Параметр `incremental` включает инкрементальную компиляцию, что позволяет TypeScript кэшировать информацию о типах между запусками компиляции. Это значительно ускоряет последующие сборки.

### Параметр `skipLibCheck`

Флаг `skipLibCheck` позволяет пропустить проверку типов в библиотечных файлах, что может значительно ускорить процесс компиляции без ущерба для безопасности типов в собственном коде.

## Оптимизация структуры проекта

### Разделение на модули

Разделение кода на отдельные модули позволяет TypeScript более эффективно выполнять проверку типов и компиляцию:

```typescript
// Модуль для работы с API
export namespace API {
  export interface User {
    id: number;
    name: string;
  }
  
  export async function fetchUser(id: number): Promise<User> {
    // реализация
    return { id, name: 'John Doe' };
  }
}

// Модуль для бизнес-логики
export namespace BusinessLogic {
  import { User } from './api';
  
  export function processUser(user: User): string {
    return `Processing user: ${user.name}`;
  }
}
```

### Использование composite проектов

Композитные проекты позволяют разбить большой код на отдельные проекты с собственными файлами `tsconfig.json`, что улучшает производительность компиляции:

```json
// tsconfig.json (корневой)
{
  "files": [],
  "references": [
    { "path": "./shared" },
    { "path": "./client" },
    { "path": "./server" }
  ]
}
```

## Оптимизация типов

### Избегайте сложных условных типов

Сложные условные типы могут значительно замедлить компиляцию:

```typescript
// Плохо - медленная компиляция
type ComplexType<T> = T extends string 
  ? { [K in T]: K extends 'a' | 'b' | 'c' ? string : number } 
  : T extends number 
    ? { [K in keyof T]: T[K] extends string ? number : string } 
    : never;

// Лучше - более простая структура
type SimpleType<T> = T extends string ? string : T extends number ? number : unknown;
```

### Использование `satisfies` оператора

Оператор `satisfies` позволяет проверить типы без потери информации о типах:

```typescript
// До TypeScript 4.9
const config = {
  host: 'localhost',
  port: 3000,
  secure: true
} as const;

// config будет иметь тип { readonly [x: string]: string | number | boolean }

// С оператором satisfies
const config = {
  host: 'localhost',
  port: 3000,
  secure: true
} satisfies Record<string, string | number | boolean>;

// config сохраняет свои конкретные типы
```

## Утилиты для оптимизации

### TypeScript Build Mode

Режим сборки TypeScript (`--build`) позволяет эффективно управлять зависимостями между проектами:

```bash
# Компиляция с отслеживанием зависимостей
tsc --build --verbose

# Очистка кэша компиляции
tsc --build --clean
```

### Использование ts-node с оптимизациями

Для разработки с использованием `ts-node` рекомендуется использовать оптимизации:

```bash
# Использование SWC для ускорения компиляции
ts-node --transpile-only --swc script.ts

# Использование tsx для еще более быстрой работы
tsx script.ts
```

## Мониторинг производительности компиляции

### Включение диагностики

Для мониторинга производительности компиляции используйте флаги диагностики:

```json
{
  "compilerOptions": {
    "diagnostics": true,
    "extendedDiagnostics": true,
    "listFiles": true
  }
}
```

### Анализ производительности

Используйте инструменты анализа производительности:

```bash
# Вывод детальной информации о времени компиляции
tsc --extendedDiagnostics --listEmittedFiles
```

## Заключение

Оптимизация компиляции TypeScript требует комплексного подхода, включающего правильную настройку компилятора, структурирование кода и мониторинг производительности. Применение этих техник может значительно сократить время сборки и улучшить опыт разработки.

См. также:
- [[Инкрементальная-компиляция]]
- [[Кэширование-типов]]
- [[Профилирование-типов]]
- [[Лучшие-практики-производительности]]