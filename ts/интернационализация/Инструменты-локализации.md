---
aliases: [Инструменты интернационализации, i18n библиотеки, Локализация инструменты]
tags: [typescript, интернационализация, инструменты, библиотеки, i18n]
---

# Инструменты локализации в TypeScript

## Обзор

Инструменты локализации играют ключевую роль в создании интернационализированных приложений на TypeScript. Они обеспечивают удобные API для работы с переводами, форматированием чисел, дат, валют и другими аспектами, специфичными для разных локалей. В этом разделе рассматриваются как встроенные возможности, так и сторонние библиотеки, которые упрощают процесс локализации.

## Встроенные инструменты интернационализации

### Intl API

`Intl` - это встроенный объект в JavaScript/TypeScript, предоставляющий API для интернационализации. Он включает в себя:

- `Intl.DateTimeFormat` - для форматирования дат и времени
- `Intl.NumberFormat` - для форматирования чисел и валют
- `Intl.PluralRules` - для определения форм множественного числа
- `Intl.RelativeTimeFormat` - для форматирования относительного времени
- `Intl.Collator` - для сравнения строк в зависимости от локали
- `Intl.ListFormat` - для форматирования списков
- `Intl.DisplayNames` - для получения локализованных названий языков, регионов и т.д.

```typescript
// Примеры использования Intl API
const date = new Date();

// Форматирование даты
const dateFormatter = new Intl.DateTimeFormat('ru-RU', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
console.log(dateFormatter.format(date)); // "23 ноября 2025 г."

// Форматирование числа
const numberFormatter = new Intl.NumberFormat('de-DE');
console.log(numberFormatter.format(1234567.89)); // "1.234.567,89"

// Форматирование валюты
const currencyFormatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD'
});
console.log(currencyFormatter.format(1234.56)); // "$1,234.56"

// Определение формы множественного числа
const pluralRules = new Intl.PluralRules('ru-RU');
console.log(pluralRules.select(1));  // "one"
console.log(pluralRules.select(2));  // "few"
console.log(pluralRules.select(5));  // "many"

// Форматирование относительного времени
const relativeTime = new Intl.RelativeTimeFormat('en-US');
console.log(relativeTime.format(-1, 'day')); // "1 day ago"

// Сравнение строк с учетом локали
const collator = new Intl.Collator('ru-RU');
const sorted = ['яблоко', 'апельсин', 'банан'].sort(collator.compare);
console.log(sorted); // ["апельсин", "банан", "яблоко"]

// Форматирование списков
const listFormatter = new Intl.ListFormat('en-US', { style: 'long', type: 'conjunction' });
console.log(listFormatter.format(['apples', 'oranges', 'bananas'])); // "apples, oranges, and bananas"
```

## Популярные сторонние библиотеки

### i18next

i18next - одна из самых популярных библиотек интернационализации, поддерживающая TypeScript.

#### Установка и настройка

```bash
npm install i18next
npm install @types/i18next --save-dev
```

#### Базовая конфигурация

```typescript
// i18n/config.ts
import i18next from 'i18next';
import { initReactI18next } from 'react-i18next';

// Файлы переводов
const resources = {
  en: {
    translation: {
      welcome: 'Welcome',
      greeting: 'Hello, {{name}}!',
      settings: {
        title: 'Settings',
        language: 'Language'
      }
    }
  },
  ru: {
    translation: {
      welcome: 'Добро пожаловать',
      greeting: 'Привет, {{name}}!',
      settings: {
        title: 'Настройки',
        language: 'Язык'
      }
    }
  }
};

i18next
  .use(initReactI18next) // связывает i18next с React
  .init({
    resources,
    lng: 'en',
    fallbackLng: 'en',
    interpolation: {
      escapeValue: false // React сам экранирует значения
    }
  });

export default i18next;
```

#### Использование в компонентах

```typescript
// components/WelcomeComponent.tsx
import React from 'react';
import { useTranslation } from 'react-i18next';

const WelcomeComponent: React.FC<{ name?: string }> = ({ name }) => {
  const { t, i18n } = useTranslation();
  
  const changeLanguage = (lng: string) => {
    i18n.changeLanguage(lng);
  };

  return (
    <div>
      <h1>{t('welcome')}</h1>
      <p>{name ? t('greeting', { name }) : t('greeting', { name: 'Guest' })}</p>
      <div>
        <button onClick={() => changeLanguage('en')}>EN</button>
        <button onClick={() => changeLanguage('ru')}>RU</button>
      </div>
    </div>
  );
};

export default WelcomeComponent;
```

### react-i18next

react-i18next - это пакет, который интегрирует i18next с React, предоставляя удобные хуки и компоненты.

#### Установка

```bash
npm install react-i18next i18next
npm install @types/react-i18next --save-dev
```

#### Примеры использования

```typescript
// hooks/useTranslation.ts
import { useTranslation as useI18NextTranslation } from 'react-i18next';

// Обертка для дополнительной типизации
export const useTranslation = () => {
  const { t, i18n, ready } = useI18NextTranslation();
  
  // Типизированный перевод
  const typedT = (key: keyof typeof resources['en']['translation'], options?: any) => {
    return t(key, options);
  };
  
  return {
    t: typedT,
    i18n,
    ready
  };
};
```

### LinguiJS

LinguiJS - современная библиотека интернационализации с отличной поддержкой TypeScript.

#### Установка

```bash
npm install @lingui/core @lingui/react
npm install --save-dev @lingui/cli @lingui/macro
```

#### Конфигурация

```typescript
// lingui.config.js
module.exports = {
  locales: ['en', 'ru', 'es', 'fr'],
  catalogs: [
    {
      path: '<rootDir>/src/locales/{locale}/messages',
      include: ['<rootDir>/src'],
    },
  ],
  format: 'po',
};
```

#### Использование

```typescript
// components/LinguiExample.tsx
import React from 'react';
import { Trans, t } from '@lingui/macro';
import { useLingui } from '@lingui/react';

const LinguiExample: React.FC = () => {
  const { i18n } = useLingui();
  
  return (
    <div>
      <h1>
        <Trans>Welcome</Trans>
      </h1>
      <p>{t`Hello, ${i18n.locale} user!`}</p>
    </div>
  );
};
```

### FormatJS (React Intl)

FormatJS предоставляет компоненты и хуки для форматирования сообщений, чисел и дат.

#### Установка

```bash
npm install @formatjs/intl
npm install react-intl
```

#### Использование

```typescript
// components/FormatJSExample.tsx
import React from 'react';
import { FormattedMessage, FormattedNumber, FormattedDate, useIntl } from 'react-intl';

const FormatJSExample: React.FC = () => {
  const intl = useIntl();
  const date = new Date();
  
  return (
    <div>
      <FormattedMessage 
        id="welcome" 
        defaultMessage="Welcome" 
        description="Welcome message"
      />
      <p>
        <FormattedMessage
          id="greeting"
          defaultMessage="Hello, {name}!"
          values={{ name: 'User' }}
        />
      </p>
      <p>
        <FormattedNumber value={12345.67} />
      </p>
      <p>
        <FormattedDate value={date} year="numeric" month="long" day="2-digit" />
      </p>
    </div>
  );
};
```

## Инструменты для извлечения и управления переводами

### i18next-parser

Инструмент для автоматического извлечения переводов из кода.

#### Установка и настройка

```bash
npm install --save-dev i18next-parser
```

#### Конфигурационный файл

```javascript
// i18next-parser.config.js
module.exports = {
  context: true,
  defaultValue: '__STRING_NOT_TRANSLATED__',
  keySeparator: false,
  namespaceSeparator: ':',
  pluralSeparator: '_',
  removeUnusedKeys: true,
  sort: true,
  useKeysAsDefaultValue: true,
  verbose: true,
  failOnWarnings: false,
  lexers: {
    ts: ['JavascriptLexer'],
    tsx: ['JsxLexer'],
  },
  input: ['src/**/*.{ts,tsx}'],
  output: 'src/locales/$LOCALE/$NAMESPACE.json',
  locales: ['en', 'ru', 'es', 'fr'],
  namespace: ['translation'],
};
```

### Lingui Extract

Инструмент извлечения переводов для LinguiJS.

```bash
# Извлечение переводов
npm run lingui extract

# Компиляция переводов
npm run lingui compile
```

## Инструменты для работы с RTL (справа налево)

### react-with-direction

Библиотека для управления направлением текста в React-компонентах.

```typescript
import { withDirection, DIRECTIONS } from 'react-with-direction';

interface MyComponentProps {
  direction: typeof DIRECTIONS[keyof typeof DIRECTIONS];
}

const MyComponent: React.FC<MyComponentProps> = ({ direction }) => {
  return (
    <div dir={direction}>
      {/* Содержимое компонента */}
    </div>
  );
};

export default withDirection(MyComponent);
```

## Инструменты для тестирования локализованных приложений

### i18next-browser-languagedetector

Плагин для определения языка пользователя в браузере.

```typescript
import LanguageDetector from 'i18next-browser-languagedetector';

i18next
  .use(LanguageDetector)
  .init({
    // ... остальные опции
    detection: {
      order: ['cookie', 'localStorage', 'navigator'],
      caches: ['cookie'],
    },
  });
```

## Инструменты для CI/CD и автоматизации

### @vitalets/google-translate-api

Инструмент для автоматического перевода строк (для разработки, не для продакшена).

```typescript
import translate from '@vitalets/google-translate-api';

const autoTranslate = async (text: string, targetLang: string) => {
  try {
    const result = await translate(text, { to: targetLang });
    return result.text;
  } catch (error) {
    console.error('Translation error:', error);
    return text;
  }
};
```

## Лучшие практики использования инструментов

### 1. Выбор подходящего инструмента

При выборе инструмента локализации учитывайте:

- Размер и сложность приложения
- Необходимость поддержки разных фреймворков
- Требования к производительности
- Уровень интеграции с TypeScript
- Поддержка автоматизации и CI/CD

### 2. Структура файлов переводов

Рекомендуется организовывать файлы переводов по модулям или компонентам:

```
locales/
├── en/
│   ├── common.json
│   ├── components/
│   │   ├── header.json
│   │   ├── footer.json
│   │   └── navigation.json
│   └── pages/
│       ├── home.json
│       ├── profile.json
│       └── settings.json
└── ru/
    ├── common.json
    ├── components/
    │   ├── header.json
    │   ├── footer.json
    │   └── navigation.json
    └── pages/
        ├── home.json
        ├── profile.json
        └── settings.json
```

### 3. Обработка отсутствующих переводов

```typescript
// Обработчик отсутствующих переводов
const missingKeyHandler = (lng: string, ns: string, key: string, fallbackValue: string) => {
  console.warn(`Missing translation for key: ${key} in namespace: ${ns}, language: ${lng}`);
  return fallbackValue;
};

i18next.on('missingKey', missingKeyHandler);
```

### 4. Кэширование переводов

```typescript
// Кэширование переводов для повышения производительности
class TranslationCache {
  private cache: Map<string, string> = new Map();
  
  get(key: string, locale: string): string | undefined {
    return this.cache.get(`${locale}:${key}`);
  }
  
  set(key: string, locale: string, value: string): void {
    this.cache.set(`${locale}:${key}`, value);
  }
}
```

## Сравнение инструментов

| Инструмент | Преимущества | Недостатки | Рекомендуется для |
|------------|--------------|------------|-------------------|
| i18next | Богатая экосистема, плагины, поддержка многих фреймворков | Может быть избыточным для простых приложений | Сложные приложения, требующие гибкой настройки |
| LinguiJS | Отличная типизация, современный подход | Меньше документации и сообщества | Приложения с высокими требованиями к типизации |
| FormatJS | Отличная поддержка форматирования, хорошая интеграция с React | Более сложный API | Приложения, требующие сложного форматирования |
| Встроенный Intl | Не требует дополнительных зависимостей | Ограниченные возможности по сравнению с библиотеками | Простые приложения с базовыми потребностями в локализации |

## Интеграция с различными фреймворками

### Angular с TypeScript

```typescript
// app/i18n.service.ts
import { Injectable } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';

@Injectable({
  providedIn: 'root'
})
export class I18nService {
  constructor(private translate: TranslateService) {
    this.translate.addLangs(['en', 'ru']);
    this.translate.setDefaultLang('en');
  }

  setLanguage(language: string) {
    this.translate.use(language);
  }

  getTranslation(key: string, params?: any): string {
    return this.translate.instant(key, params);
  }
}
```

### Vue с TypeScript

```typescript
// plugins/i18n.ts
import { createI18n } from 'vue-i18n';
import en from '../locales/en.json';
import ru from '../locales/ru.json';

const messages = {
  en,
  ru
};

export const i18n = createI18n({
  legacy: false,
  locale: 'en',
  fallbackLocale: 'en',
  messages,
});
```

## Заключение

Выбор подходящих инструментов локализации в TypeScript зависит от конкретных требований проекта. Для простых приложений может быть достаточно встроенного `Intl` API, тогда как для сложных приложений с многоязычной поддержкой рекомендуются специализированные библиотеки, такие как [[i18next]], [[linguijs]] или [[react-intl]].

Ключевые аспекты при выборе инструментов:

- Поддержка TypeScript
- Интеграция с используемым фреймворком
- Возможности автоматизации
- Производительность
- Поддержка сообщества
- Документация

Для достижения наилучших результатов рекомендуется использовать комбинацию встроенных возможностей и специализированных библиотек, адаптированных под конкретные потребности проекта.

## См. также

- [[Локализация-строк]]
- [[Форматирование-дат-и-времени]]
- [[Форматирование-чисел-и-валют]]
- [[Перевод-компонентов]]
- [[i18next]]
- [[linguijs]]
- [[react-intl]]