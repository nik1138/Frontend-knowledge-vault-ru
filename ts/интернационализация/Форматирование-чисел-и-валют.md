---
aliases: [Форматирование чисел, Локализация чисел, Intl.NumberFormat, Формат валюты, Формат чисел]
tags: [typescript, интернационализация, числа, валюта, форматирование, i18n]
---

# Форматирование чисел и валют в TypeScript

## Обзор

Форматирование чисел и валют - это важная часть интернационализации веб-приложений, поскольку различные регионы мира используют разные форматы представления чисел, включая разделители тысяч, десятичные разделители и обозначения валют. В TypeScript, как и в JavaScript, для этой цели используется встроенный объект `Intl.NumberFormat`, который позволяет форматировать числа в соответствии с локальными предпочтениями.

## Основы форматирования чисел

### Встроенный объект Intl.NumberFormat

`Intl.NumberFormat` - это конструктор объекта, позволяющий форматировать числа в зависимости от языка и региональных настроек. Он предоставляет гибкие возможности для настройки форматирования чисел, включая целые числа, десятичные числа, проценты и валюты.

```typescript
// Базовое использование
const number = 1234567.89;

// Форматирование для английского языка
const enFormatter = new Intl.NumberFormat('en-US');
console.log(enFormatter.format(number)); // "1,234,567.89"

// Форматирование для русского языка
const ruFormatter = new Intl.NumberFormat('ru-RU');
console.log(ruFormatter.format(number)); // "1 234 567,89"

// Форматирование для немецкого языка
const deFormatter = new Intl.NumberFormat('de-DE');
console.log(deFormatter.format(number)); // "1.234.567,89"
```

### Опции форматирования

`Intl.NumberFormat` принимает дополнительный параметр с опциями форматирования, которые позволяют настраивать представление чисел:

```typescript
const number = 1234567.89;

// Форматирование с опциями
const options: Intl.NumberFormatOptions = {
  style: 'currency',
  currency: 'USD',
  minimumFractionDigits: 2,
  maximumFractionDigits: 2
};

const currencyFormatter = new Intl.NumberFormat('en-US', options);
console.log(currencyFormatter.format(number)); // "$1,234,567.89"

// Форматирование в процентах
const percentageOptions: Intl.NumberFormatOptions = {
  style: 'percent',
  minimumFractionDigits: 1
};

const percentFormatter = new Intl.NumberFormat('en-US', percentageOptions);
console.log(percentFormatter.format(0.123)); // "12.3%"
```

## Практические примеры форматирования

### Форматирование целых чисел

```typescript
// Сервис форматирования целых чисел
export class IntegerFormatter {
  static format(value: number, locale: string = 'en-US', options?: Intl.NumberFormatOptions): string {
    const formatterOptions: Intl.NumberFormatOptions = {
      style: 'decimal',
      maximumFractionDigits: 0,
      ...options
    };

    return new Intl.NumberFormat(locale, formatterOptions).format(value);
  }

  // Форматирование с разделителями тысяч
  static formatWithSeparators(value: number, locale: string = 'en-US'): string {
    return new Intl.NumberFormat(locale, {
      style: 'decimal',
      maximumFractionDigits: 0
    }).format(value);
  }

  // Форматирование с сокращениями (K, M, B)
  static formatAbbreviated(value: number, locale: string = 'en-US'): string {
    if (value >= 1e9) {
      return new Intl.NumberFormat(locale, {
        notation: 'compact',
        maximumFractionDigits: 1
      }).format(value / 1e9) + 'B';
    } else if (value >= 1e6) {
      return new Intl.NumberFormat(locale, {
        notation: 'compact',
        maximumFractionDigits: 1
      }).format(value / 1e6) + 'M';
    } else if (value >= 1e3) {
      return new Intl.NumberFormat(locale, {
        notation: 'compact',
        maximumFractionDigits: 1
      }).format(value / 1e3) + 'K';
    }
    return new Intl.NumberFormat(locale, {
      notation: 'standard'
    }).format(value);
  }
}

// Использование
console.log(IntegerFormatter.format(1234567, 'en-US')); // "1,234,567"
console.log(IntegerFormatter.format(1234567, 'ru-RU')); // "1 234 567"
console.log(IntegerFormatter.formatAbbreviated(1234567, 'en-US')); // "1.2M"
```

### Форматирование десятичных чисел

```typescript
// Сервис форматирования десятичных чисел
export class DecimalFormatter {
  static format(
    value: number, 
    locale: string = 'en-US', 
    minFractionDigits: number = 2, 
    maxFractionDigits: number = 2
  ): string {
    return new Intl.NumberFormat(locale, {
      style: 'decimal',
      minimumFractionDigits: minFractionDigits,
      maximumFractionDigits: maxFractionDigits
    }).format(value);
  }

  // Форматирование с переменным количеством знаков после запятой
  static formatVariablePrecision(
    value: number, 
    locale: string = 'en-US', 
    maxPrecision: number = 6
  ): string {
    return new Intl.NumberFormat(locale, {
      style: 'decimal',
      minimumFractionDigits: 0,
      maximumFractionDigits: maxPrecision
    }).format(value);
  }

  // Форматирование для финансовых показателей
  static formatFinancial(
    value: number, 
    locale: string = 'en-US', 
    precision: number = 4
  ): string {
    return new Intl.NumberFormat(locale, {
      style: 'decimal',
      minimumFractionDigits: precision,
      maximumFractionDigits: precision
    }).format(value);
  }
}

// Использование
console.log(DecimalFormatter.format(1234.5, 'en-US', 2, 2)); // "1,234.50"
console.log(DecimalFormatter.format(1234.5, 'ru-RU', 2, 2)); // "1 234,50"
console.log(DecimalFormatter.formatVariablePrecision(1234.567890123, 'en-US')); // "1,234.56789"
```

### Форматирование валют

```typescript
// Сервис форматирования валют
export class CurrencyFormatter {
  static format(
    value: number, 
    currency: string, 
    locale: string = 'en-US',
    options?: Omit<Intl.NumberFormatOptions, 'style' | 'currency'>
  ): string {
    const formatterOptions: Intl.NumberFormatOptions = {
      style: 'currency',
      currency,
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
      ...options
    };

    return new Intl.NumberFormat(locale, formatterOptions).format(value);
  }

  // Форматирование с отображением символа валюты
  static formatWithSymbol(value: number, currency: string, locale: string = 'en-US'): string {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency,
      currencyDisplay: 'symbol'
    }).format(value);
  }

  // Форматирование с отображением кода валюты
  static formatWithCode(value: number, currency: string, locale: string = 'en-US'): string {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency,
      currencyDisplay: 'code'
    }).format(value);
  }

  // Форматирование для отображения в таблицах
  static formatForTable(value: number, currency: string, locale: string = 'en-US'): string {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency,
      currencyDisplay: 'symbol',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(value);
  }

  // Форматирование с сокращениями для больших сумм
  static formatAbbreviated(value: number, currency: string, locale: string = 'en-US'): string {
    const formatter = new Intl.NumberFormat(locale, {
      style: 'currency',
      currency,
      currencyDisplay: 'symbol',
      notation: 'compact',
      maximumFractionDigits: 1
    });

    return formatter.format(value);
  }
}

// Использование
console.log(CurrencyFormatter.format(1234.56, 'USD', 'en-US')); // "$1,234.56"
console.log(CurrencyFormatter.format(1234.56, 'EUR', 'de-DE')); // "1.234,56 €"
console.log(CurrencyFormatter.format(1234.56, 'RUB', 'ru-RU')); // "1 234,56 ₽"
console.log(CurrencyFormatter.formatAbbreviated(1234567.89, 'USD', 'en-US')); // "$1.2M"
```

### Форматирование процентов

```typescript
// Сервис форматирования процентов
export class PercentFormatter {
  static format(
    value: number, 
    locale: string = 'en-US',
    options?: Omit<Intl.NumberFormatOptions, 'style'>
  ): string {
    const formatterOptions: Intl.NumberFormatOptions = {
      style: 'percent',
      minimumFractionDigits: 1,
      maximumFractionDigits: 1,
      ...options
    };

    return new Intl.NumberFormat(locale, formatterOptions).format(value);
  }

  // Форматирование с переменной точностью
  static formatWithPrecision(
    value: number, 
    locale: string = 'en-US', 
    precision: number = 2
  ): string {
    return new Intl.NumberFormat(locale, {
      style: 'percent',
      minimumFractionDigits: precision,
      maximumFractionDigits: precision
    }).format(value);
  }

  // Форматирование для отображения изменений
  static formatChange(
    value: number, 
    locale: string = 'en-US'
  ): string {
    const prefix = value >= 0 ? '+' : '';
    const formattedValue = new Intl.NumberFormat(locale, {
      style: 'percent',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(Math.abs(value));
    
    return `${prefix}${formattedValue}`;
  }
}

// Использование
console.log(PercentFormatter.format(0.1234, 'en-US')); // "12.3%"
console.log(PercentFormatter.format(0.1234, 'ru-RU')); // "12,3%"
console.log(PercentFormatter.formatChange(0.0567, 'en-US')); // "+5.67%"
console.log(PercentFormatter.formatChange(-0.0234, 'en-US')); // "-2.34%"
```

## Расширенные возможности

### Форматирование с учетом региональных настроек

```typescript
// Класс для форматирования с учетом региональных настроек
export class RegionalNumberFormatter {
  // Получение региональных настроек для конкретной страны
  static getLocaleForCountry(countryCode: string): string {
    const countryLocales: Record<string, string> = {
      'US': 'en-US',
      'GB': 'en-GB',
      'RU': 'ru-RU',
      'DE': 'de-DE',
      'FR': 'fr-FR',
      'JP': 'ja-JP',
      'CN': 'zh-CN',
      'IN': 'en-IN'
    };

    return countryLocales[countryCode] || 'en-US';
  }

  // Форматирование с учетом региональных особенностей
  static formatByCountry(
    value: number,
    countryCode: string,
    formatType: 'number' | 'currency' | 'percent' = 'number',
    currency?: string
  ): string {
    const locale = this.getLocaleForCountry(countryCode);

    switch (formatType) {
      case 'currency':
        if (!currency) throw new Error('Currency is required for currency formatting');
        return CurrencyFormatter.format(value, currency, locale);
      case 'percent':
        return PercentFormatter.format(value, locale);
      case 'number':
      default:
        return new Intl.NumberFormat(locale).format(value);
    }
  }

  // Форматирование для международных пользователей
  static formatForUser(
    value: number,
    userLocale: string,
    formatType: 'number' | 'currency' | 'percent' = 'number',
    currency?: string
  ): string {
    switch (formatType) {
      case 'currency':
        if (!currency) throw new Error('Currency is required for currency formatting');
        return CurrencyFormatter.format(value, currency, userLocale);
      case 'percent':
        return PercentFormatter.format(value, userLocale);
      case 'number':
      default:
        return new Intl.NumberFormat(userLocale).format(value);
    }
  }
}
```

### Кастомные форматы

```typescript
// Класс для создания кастомных форматов чисел
export class CustomNumberFormatter {
  private formatters: Map<string, Intl.NumberFormat> = new Map();

  constructor(private locale: string = 'en-US') {}

  // Регистрация кастомного формата
  registerFormat(name: string, options: Intl.NumberFormatOptions): void {
    this.formatters.set(name, new Intl.NumberFormat(this.locale, options));
  }

  // Форматирование по зарегистрированному формату
  format(value: number, formatName: string): string {
    const formatter = this.formatters.get(formatName);
    if (!formatter) {
      throw new Error(`Format "${formatName}" is not registered`);
    }
    return formatter.format(value);
  }

  // Общие кастомные форматы
  static getCommonFormats(locale: string): Record<string, Intl.NumberFormatOptions> {
    return {
      'integer': { style: 'decimal', maximumFractionDigits: 0 },
      'decimal2': { style: 'decimal', minimumFractionDigits: 2, maximumFractionDigits: 2 },
      'decimal4': { style: 'decimal', minimumFractionDigits: 4, maximumFractionDigits: 4 },
      'percent': { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 },
      'currencyUSD': { style: 'currency', currency: 'USD', minimumFractionDigits: 2 },
      'currencyEUR': { style: 'currency', currency: 'EUR', minimumFractionDigits: 2 },
      'currencyRUB': { style: 'currency', currency: 'RUB', minimumFractionDigits: 2 },
      'scientific': { notation: 'scientific' },
      'compact': { notation: 'compact' },
      'compactLong': { notation: 'compact', compactDisplay: 'long' }
    };
  }
}

// Использование кастомных форматов
const customFormatter = new CustomNumberFormatter('ru-RU');
const commonFormats = CustomNumberFormatter.getCommonFormats('ru-RU');

// Регистрация общих форматов
Object.entries(commonFormats).forEach(([name, options]) => {
  customFormatter.registerFormat(name, options);
});

console.log(customFormatter.format(1234.567, 'integer')); // "1 235"
console.log(customFormatter.format(1234.567, 'decimal2')); // "1 234,57"
console.log(customFormatter.format(0.1234, 'percent')); // "12,34%"
```

## Лучшие практики

### 1. Кэширование форматтеров

Для повышения производительности при частом форматировании чисел рекомендуется кэшировать экземпляры `Intl.NumberFormat`:

```typescript
// Кэширование форматтеров
export class CachedNumberFormatter {
  private static formatterCache: Map<string, Intl.NumberFormat> = new Map();

  static getFormatter(locale: string, options?: Intl.NumberFormatOptions): Intl.NumberFormat {
    const key = `${locale}-${JSON.stringify(options || {})}`;
    
    if (!this.formatterCache.has(key)) {
      this.formatterCache.set(key, new Intl.NumberFormat(locale, options));
    }
    
    return this.formatterCache.get(key)!;
  }

  static format(value: number, locale: string, options?: Intl.NumberFormatOptions): string {
    const formatter = this.getFormatter(locale, options);
    return formatter.format(value);
  }

  // Кэширование для часто используемых форматов
  static formatCurrency(value: number, currency: string, locale: string): string {
    const key = `currency-${locale}-${currency}`;
    
    if (!this.formatterCache.has(key)) {
      this.formatterCache.set(key, new Intl.NumberFormat(locale, {
        style: 'currency',
        currency
      }));
    }
    
    return this.formatterCache.get(key)!.format(value);
  }
}
```

### 2. Обработка ошибок и граничных случаев

```typescript
// Форматирование с обработкой ошибок
export class SafeNumberFormatter {
  static format(
    value: unknown, 
    locale: string = 'en-US', 
    options?: Intl.NumberFormatOptions
  ): string {
    // Проверка на допустимое числовое значение
    if (typeof value !== 'number' || isNaN(value) || !isFinite(value)) {
      console.warn(`Invalid number value: ${value}`);
      return 'N/A';
    }

    try {
      return new Intl.NumberFormat(locale, options).format(value);
    } catch (error) {
      console.error(`Error formatting number: ${error}`);
      return String(value);
    }
  }

  static formatCurrency(
    value: unknown, 
    currency: string, 
    locale: string = 'en-US'
  ): string {
    // Проверка на допустимое числовое значение
    if (typeof value !== 'number' || isNaN(value) || !isFinite(value)) {
      console.warn(`Invalid number value: ${value}`);
      return 'N/A';
    }

    try {
      return new Intl.NumberFormat(locale, {
        style: 'currency',
        currency
      }).format(value);
    } catch (error) {
      console.error(`Error formatting currency: ${error}`);
      return `${value} ${currency}`;
    }
  }

  // Форматирование с округлением до ближайшего значения
  static formatRounded(
    value: number, 
    locale: string = 'en-US', 
    fractionDigits: number = 2,
    roundingMode: 'ceil' | 'floor' | 'expand' | 'trunc' | 'halfCeil' | 'halfFloor' | 'halfExpand' | 'halfTrunc' | 'halfEven' = 'halfExpand'
  ): string {
    if (isNaN(value) || !isFinite(value)) {
      return 'N/A';
    }

    try {
      return new Intl.NumberFormat(locale, {
        maximumFractionDigits: fractionDigits,
        minimumFractionDigits: fractionDigits,
        roundingMode
      }).format(value);
    } catch (error) {
      // Если roundingMode не поддерживается, используем стандартное форматирование
      return new Intl.NumberFormat(locale, {
        maximumFractionDigits: fractionDigits,
        minimumFractionDigits: fractionDigits
      }).format(value);
    }
  }
}
```

### 3. Управление точностью для финансовых приложений

```typescript
// Форматирование для финансовых приложений
export class FinancialNumberFormatter {
  // Форматирование с высокой точностью для расчетов
  static formatHighPrecision(value: number, locale: string = 'en-US'): string {
    return new Intl.NumberFormat(locale, {
      style: 'decimal',
      minimumFractionDigits: 10,
      maximumFractionDigits: 10
    }).format(value);
  }

  // Форматирование для отображения пользователю
  static formatForDisplay(value: number, locale: string = 'en-US', currency?: string): string {
    if (currency) {
      return new Intl.NumberFormat(locale, {
        style: 'currency',
        currency,
        minimumFractionDigits: 2,
        maximumFractionDigits: 6 // Для криптовалют
      }).format(value);
    } else {
      return new Intl.NumberFormat(locale, {
        style: 'decimal',
        minimumFractionDigits: 2,
        maximumFractionDigits: 6
      }).format(value);
    }
  }

  // Форматирование с учетом минимального значения для отображения
  static formatWithMinValue(value: number, minValue: number, locale: string = 'en-US', currency?: string): string {
    const displayValue = Math.abs(value) < minValue ? (value >= 0 ? minValue : -minValue) : value;
    
    if (currency) {
      return new Intl.NumberFormat(locale, {
        style: 'currency',
        currency,
        minimumFractionDigits: 2,
        maximumFractionDigits: 6
      }).format(displayValue);
    } else {
      return new Intl.NumberFormat(locale, {
        style: 'decimal',
        minimumFractionDigits: 2,
        maximumFractionDigits: 6
      }).format(displayValue);
    }
  }
}
```

## Интеграция с фреймворками

### React с TypeScript

```typescript
// Хук для форматирования чисел
import { useMemo } from 'react';

export function useNumberFormatter(
  locale?: string, 
  options?: Intl.NumberFormatOptions
) {
  const formatter = useMemo(() => {
    return new Intl.NumberFormat(locale || 'en-US', options);
  }, [locale, options]);

  return (value: number) => formatter.format(value);
}

// Хук для форматирования валют
export function useCurrencyFormatter(
  currency: string,
  locale?: string,
  options?: Omit<Intl.NumberFormatOptions, 'style' | 'currency'>
) {
  const formatter = useMemo(() => {
    return new Intl.NumberFormat(locale || 'en-US', {
      style: 'currency',
      currency,
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
      ...options
    });
  }, [locale, currency, options]);

  return (value: number) => formatter.format(value);
}

// Компонент для отображения отформатированного числа
interface FormattedNumberProps {
  value: number;
  locale?: string;
  format?: 'decimal' | 'percent' | 'currency';
  currency?: string;
  minimumFractionDigits?: number;
  maximumFractionDigits?: number;
}

function FormattedNumber({
  value,
  locale = 'en-US',
  format = 'decimal',
  currency,
  minimumFractionDigits = 2,
  maximumFractionDigits = 2
}: FormattedNumberProps) {
  const formatter = useMemo(() => {
    const options: Intl.NumberFormatOptions = {
      minimumFractionDigits,
      maximumFractionDigits
    };

    if (format === 'currency' && currency) {
      options.style = 'currency';
      options.currency = currency;
    } else if (format === 'percent') {
      options.style = 'percent';
    }

    return new Intl.NumberFormat(locale, options);
  }, [locale, format, currency, minimumFractionDigits, maximumFractionDigits]);

  return <span>{formatter.format(value)}</span>;
}
```

## Заключение

Форматирование чисел и валют в TypeScript с использованием `Intl.NumberFormat` предоставляет мощные и гибкие возможности для создания интернационализированных приложений. Ключевые аспекты:

- Использование встроенного API `Intl.NumberFormat`
- Понимание опций форматирования для разных типов чисел
- Кэширование для повышения производительности
- Обработка ошибок и граничных случаев
- Учет специфики финансовых приложений

Для более сложных сценариев форматирования чисел рекомендуется использовать специализированные библиотеки, такие как [[numeral.js]] или [[accounting.js]] с плагинами интернационализации.

## См. также

- [[Локализация-строк]]
- [[Форматирование-дат-и-времени]]
- [[Перевод-компонентов]]
- [[Инструменты-локализации]]
- [[numeral.js]]
- [[accounting.js]]