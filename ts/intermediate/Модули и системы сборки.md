---
tags: [typescript, frontend, modules, build-systems]
aliases: [Модули TypeScript, Системы сборки]
---

# Модули и системы сборки

## Введение

Модули и системы сборки являются ключевыми компонентами современной разработки на TypeScript, особенно в контексте frontend разработки. Модули позволяют организовать код в логические блоки, а системы сборки объединяют эти модули в готовые приложения.

## Модули в TypeScript

### Основы модулей

Модуль в TypeScript - это файл, который экспортирует переменные, функции, классы или другие элементы. Любой файл, содержащий import или export, считается модулем.

```ts
// math-utils.ts
export function add(a: number, b: number): number {
    return a + b;
}

export function multiply(a: number, b: number): number {
    return a * b;
}

// Могут быть как именованные, так и default экспорт
const PI = 3.14159;
export { PI };

// Default экспорт
export default function subtract(a: number, b: number): number {
    return a - b;
}
```

```ts
// calculator.ts
import subtract, { add, multiply, PI } from './math-utils';

// Использование импортированных функций
console.log(add(2, 3)); // 5
console.log(multiply(4, 5)); // 20
console.log(subtract(10, 3)); // 7
console.log(PI); // 3.14159
```

### Различные способы экспорта и импорта

```ts
// export-default.ts
export default class Calculator {
    static add(a: number, b: number): number {
        return a + b;
    }
}

// export-named.ts
export const MAX_VALUE = 100;
export const MIN_VALUE = 0;

export function validate(value: number): boolean {
    return value >= MIN_VALUE && value <= MAX_VALUE;
}

export interface ValidationResult {
    isValid: boolean;
    message: string;
}

// re-export.ts - реэкспорт из других модулей
export { default as Calculator } from './export-default';
export * from './export-named'; // реэкспорт всего
export { validate as validateNumber } from './export-named'; // переименованный экспорт
```

```ts
// usage.ts
import Calculator from './export-default';
import { MAX_VALUE, MIN_VALUE, validate, ValidationResult } from './export-named';
import { Calculator as Calc, validateNumber } from './re-export';

const calc = new Calculator();
console.log(calc.add(5, 3)); // 8

console.log(validateNumber(50)); // true
console.log(validateNumber(150)); // false
```

### Асинхронные импорты (Dynamic Imports)

```ts
// dynamic-imports.ts
async function loadMathModule() {
    const { add, multiply } = await import('./math-utils');
    
    console.log(add(1, 2)); // 3
    console.log(multiply(3, 4)); // 12
}

// Использование в React компонентах для ленивой загрузки
import { lazy, Suspense } from 'react';

// Ленивая загрузка компонентов
const LazyComponent = lazy(() => import('./LazyComponent'));

function App() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <LazyComponent />
        </Suspense>
    );
}
```

## Системы сборки

### TypeScript Compiler (tsc)

TypeScript Compiler - это основной инструмент для компиляции TypeScript в JavaScript.

#### Конфигурационный файл tsconfig.json

```json
{
  "compilerOptions": {
    /* Основные параметры */
    "target": "ES2020",                          /* Уровень ECMAScript */
    "module": "ESNext",                          /* Тип модуля */
    "lib": ["ES2020", "DOM"],                   /* Библиотеки */
    "allowJs": true,                            /* Разрешить JS файлы */
    "outDir": "./dist",                         /* Каталог вывода */
    "rootDir": "./src",                         /* Корневой каталог исходников */
    
    /* Параметры проверки типов */
    "strict": true,                             /* Включить все строгие проверки */
    "noImplicitAny": true,                      /* Запретить неявный any */
    "strictNullChecks": true,                   /* Строгая проверка null/undefined */
    "strictFunctionTypes": true,                /* Строгая проверка типов функций */
    
    /* Параметры модулей */
    "moduleResolution": "node",                 /* Стратегия разрешения модулей */
    "baseUrl": "./",                            /* Базовый URL для неабсолютных путей */
    "paths": {                                  /* Псевдонимы для путей */
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"]
    },
    
    /* Дополнительные проверки */
    "esModuleInterop": true,                    /* Позволить интероп ES и CommonJS */
    "skipLibCheck": true,                       /* Пропустить проверку файлов .d.ts */
    "forceConsistentCasingInFileNames": true    /* Строгая проверка регистра файлов */
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
```

### Webpack

Webpack - популярная система сборки для frontend приложений.

#### Пример конфигурации webpack.config.js

```js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  entry: './src/index.ts',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    clean: true, // очищает dist перед сборкой
  },
  resolve: {
    extensions: ['.ts', '.tsx', '.js'], // расширения файлов
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
    },
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html',
    }),
  ],
  devServer: {
    static: './dist',
    port: 3000,
    open: true,
  },
};
```

### Vite

Vite - современная система сборки, обеспечивающая быструю разработку.

#### Пример конфигурации vite.config.ts

```ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@utils': resolve(__dirname, 'src/utils'),
    },
  },
  server: {
    port: 3000,
    open: true,
  },
  build: {
    outDir: 'dist',
  },
});
```

## Практические примеры для frontend разработки

### Модуль для работы с API

```ts
// api/types.ts
export interface User {
  id: number;
  name: string;
  email: string;
}

export interface ApiResponse<T> {
  data: T;
  status: number;
  message?: string;
}

// api/config.ts
export const API_CONFIG = {
  BASE_URL: process.env.API_BASE_URL || 'https://api.example.com',
  TIMEOUT: 5000,
};

// api/client.ts
import { API_CONFIG } from './config';
import { ApiResponse } from './types';

class ApiClient {
  private baseUrl: string;
  private timeout: number;

  constructor(config = API_CONFIG) {
    this.baseUrl = config.BASE_URL;
    this.timeout = config.TIMEOUT;
  }

  async request<T>(endpoint: string, options: RequestInit = {}): Promise<ApiResponse<T>> {
    const url = `${this.baseUrl}${endpoint}`;
    
    const response = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
    });

    const data = await response.json();
    
    return {
      data,
      status: response.status,
    };
  }

  async get<T>(endpoint: string): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { method: 'GET' });
  }

  async post<T>(endpoint: string, data: any): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, {
      method: 'POST',
      body: JSON.stringify(data),
    });
  }
}

// Экземпляр клиента по умолчанию
export const apiClient = new ApiClient();

// Экспорт для переиспользования
export default ApiClient;
```

### Модуль для управления состоянием

```ts
// store/types.ts
export interface State {
  user: User | null;
  theme: 'light' | 'dark';
  loading: boolean;
}

export interface Action {
  type: string;
  payload?: any;
}

// store/index.ts
import { State, Action } from './types';
import { User } from '../api/types';

const initialState: State = {
  user: null,
  theme: 'light',
  loading: false,
};

class Store {
  private state: State = initialState;
  private listeners: Array<() => void> = [];

  getState(): State {
    return this.state;
  }

  dispatch(action: Action): void {
    this.state = this.reducer(this.state, action);
    this.listeners.forEach(listener => listener());
  }

  subscribe(listener: () => void): () => void {
    this.listeners.push(listener);
    return () => {
      const index = this.listeners.indexOf(listener);
      if (index > -1) {
        this.listeners.splice(index, 1);
      }
    };
  }

  private reducer(state: State, action: Action): State {
    switch(action.type) {
      case 'SET_USER':
        return { ...state, user: action.payload as User };
      case 'SET_THEME':
        return { ...state, theme: action.payload as 'light' | 'dark' };
      case 'SET_LOADING':
        return { ...state, loading: action.payload as boolean };
      default:
        return state;
    }
  }
}

export const store = new Store();
export default Store;
```

### Модуль для хуков (React)

```ts
// hooks/useApi.ts
import { useState, useEffect } from 'react';
import { apiClient } from '../api/client';
import { ApiResponse } from '../api/types';

export function useApi<T>(endpoint: string) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const response: ApiResponse<T> = await apiClient.get<T>(endpoint);
        setData(response.data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'An error occurred');
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [endpoint]);

  return { data, loading, error };
}

// hooks/useLocalStorage.ts
import { useState, useEffect } from 'react';

export function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T) => void] {
  const [storedValue, setStoredValue] = useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });

  const setValue = (value: T) => {
    try {
      setStoredValue(value);
      window.localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue, setValue];
}
```

## Практические советы

### Организация модулей

1. **Группировка по функциональности**:
   - api/ - модули для работы с API
   - components/ - React компоненты
   - hooks/ - кастомные хуки
   - utils/ - вспомогательные функции
   - store/ - управление состоянием
   - types/ - общие типы

2. **Использование barrel-файлов (index.ts)**:
```ts
// components/index.ts
export { default as Button } from './Button';
export { default as Input } from './Input';
export { default as Card } from './Card';

// Использование
import { Button, Input, Card } from '@/components';
```

### Оптимизация сборки

1. **Ленивая загрузка**:
```ts
// routes.tsx
import { lazy } from 'react';

const HomePage = lazy(() => import('./pages/Home'));
const AboutPage = lazy(() => import('./pages/About'));
```

2. **Code splitting**:
```ts
// webpack.config.js
splitChunks: {
  chunks: 'all',
  cacheGroups: {
    vendor: {
      test: /[\\/]node_modules[\\/]/,
      name: 'vendors',
      chunks: 'all',
    },
  },
}
```

## Заключение

Модули и системы сборки играют ключевую роль в организации и оптимизации frontend приложений на TypeScript. Правильное использование модулей позволяет создавать чистую, поддерживаемую архитектуру, а системы сборки обеспечивают эффективную доставку кода пользователям.

> [!tip] Совет
> Используйте barrel-файлы (index.ts) для упрощения импортов и лучшей организации кода.

> [!warning] Важно
> Всегда настраивайте систему сборки с учетом производительности и безопасности приложения.

## Связанные темы

- [[Дженерики и условные типы]]
- [[Инструменты и линтеры для TypeScript]]
- [[Практические примеры для frontend разработки]]