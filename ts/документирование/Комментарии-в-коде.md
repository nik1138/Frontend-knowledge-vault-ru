---
aliases: [Комментирование кода, Писать комментарии]
tags: [typescript, documentation, code-comments]
---

# Комментарии в TypeScript коде

## Обзор

Комментарии в коде являются важной частью процесса разработки, особенно в TypeScript проектах. Они помогают другим разработчикам (и вам в будущем) понимать логику, намерения и контекст реализации. В этом руководстве мы рассмотрим различные подходы к комментированию кода, лучшие практики и когда комментарии действительно необходимы.

## Типы комментариев

### Однострочные комментарии (//)

Однострочные комментарии используются для кратких пояснений:

```typescript
function calculateTax(income: number, taxRate: number): number {
    // Проверка на отрицательный доход
    if (income < 0) {
        throw new Error('Доход не может быть отрицательным');
    }
    
    // Расчет налога с округлением до 2 знаков после запятой
    return Number((income * taxRate).toFixed(2));
}
```

### Многострочные комментарии (/* */)

Многострочные комментарии полезны для более подробных объяснений:

```typescript
function processData(data: any[]): ProcessedData[] {
    /* 
     * Этот алгоритм фильтрует и преобразует данные следующим образом:
     * 1. Удаляет элементы с недостающими обязательными полями
     * 2. Преобразует даты из строкового формата в объект Date
     * 3. Нормализует числовые значения в диапазоне 0-1
     * 4. Добавляет вычисленные производные значения
     */
    return data
        .filter(item => item.id && item.value)
        .map(item => ({
            ...item,
            date: new Date(item.dateString),
            normalizedValue: normalize(item.value)
        }));
}
```

### Документационные комментарии (/** */)

Документационные комментарии используются для создания API документации:

```typescript
/**
 * Асинхронно загружает данные из внешнего API
 * @param endpoint - Конечная точка API
 * @param options - Опции запроса
 * @returns Promise с результатом запроса
 * @throws {NetworkError} Если произошла сетевая ошибка
 * @throws {AuthenticationError} Если токен аутентификации недействителен
 * 
 * @example
 * ```ts
 * const users = await fetchApiData('/users', { 
 *   headers: { 'Authorization': 'Bearer token' } 
 * });
 * ```
 */
async function fetchApiData<T>(
    endpoint: string, 
    options: RequestInit = {}
): Promise<T> {
    // реализация
}
```

## Когда использовать комментарии

### 1. Объяснение сложной логики

```typescript
function calculateComplexFormula(input: number): number {
    // Алгоритм основан на методе Ньютона-Рафсона для приближенного вычисления
    // См. https://en.wikipedia.org/wiki/Newton%27s_method
    let x = input;
    for (let i = 0; i < 10; i++) {
        const fx = x * x - input;      // f(x) = x² - input
        const dfx = 2 * x;             // f'(x) = 2x
        x = x - fx / dfx;              // x_new = x - f(x)/f'(x)
    }
    return x;
}
```

### 2. Временные решения и TODO

```typescript
class DataProcessor {
    processData(data: string[]): ProcessedItem[] {
        // TODO: Заменить на более эффективный алгоритм O(n log n)
        // Временное решение работает за O(n²), но приемлемо для текущего объема данных
        return data.map(item => this.transform(item));
    }
}
```

### 3. Объяснение неочевидных решений

```typescript
function handleUserInput(input: string): void {
    // Используем регулярное выражение вместо встроенных методов для 
    // обеспечения совместимости с устаревшими браузерами
    const sanitized = input.replace(/[<>'"&]/g, (match) => {
        const escapeMap: { [key: string]: string } = {
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#x27;',
            '&': '&amp;'
        };
        return escapeMap[match];
    });
    
    displayContent(sanitized);
}
```

## Лучшие практики комментирования

### 1. Пишите комментарии как объяснения "почему", а не "что"

**Плохо:**
```typescript
// Увеличиваем счетчик на 1
counter++;
```

**Хорошо:**
```typescript
// Увеличиваем счетчик для отслеживания успешных операций
counter++;
```

### 2. Используйте осмысленные комментарии

```typescript
class CacheManager {
    private cache: Map<string, any> = new Map();
    
    /**
     * Получает значение из кэша
     * Если значение отсутствует или просрочено, возвращает undefined
     * @param key - Ключ для поиска значения
     * @param maxAge - Максимальное время жизни значения в миллисекундах
     */
    get(key: string, maxAge?: number): any | undefined {
        const cached = this.cache.get(key);
        if (!cached) return undefined;
        
        // Проверяем, не истекло ли время жизни кэшированного значения
        if (maxAge && Date.now() - cached.timestamp > maxAge) {
            this.cache.delete(key); // Удаляем просроченное значение
            return undefined;
        }
        
        return cached.value;
    }
}
```

### 3. Обновляйте комментарии при изменении кода

```typescript
// Плохо: комментарий не соответствует коду
/**
 * Удаляет пользователя из системы
 * @param userId - Идентификатор пользователя
 * @returns Promise<boolean> - true если пользователь удален
 */
async function deactivateUser(userId: string): Promise<User> {
    // код обновляет статус пользователя, а не удаляет его
    return await updateUserStatus(userId, 'inactive');
}
```

**Правильно:**
```typescript
/**
 * Деактивирует пользователя, изменяя его статус
 * @param userId - Идентификатор пользователя
 * @returns Promise<User> - Обновленный объект пользователя
 */
async function deactivateUser(userId: string): Promise<User> {
    return await updateUserStatus(userId, 'inactive');
}
```

## Стили комментариев

### 1. Блок-комментарии для разделов

```typescript
////////////////////////////////////////////////////
// СЕКЦИЯ: ВАЛИДАЦИЯ ДАННЫХ
////////////////////////////////////////////////////

function validateUserData(data: UserData): ValidationResult {
    // реализация валидации
}

////////////////////////////////////////////////////
// СЕКЦИЯ: ОБРАБОТКА ДАННЫХ
////////////////////////////////////////////////////

function processValidatedData(data: UserData): ProcessedData {
    // реализация обработки
}
```

### 2. Инлайн комментарии для уточнений

```typescript
function calculateDiscount(
    price: number, 
    isPremium: boolean,
    couponCode?: string
): number {
    let discount = 0;
    
    if (isPremium) discount += 0.1;      // 10% скидка для премиум пользователей
    if (couponCode) discount += 0.05;    // 5% скидка по купону
    
    return price * discount;
}
```

## Антипаттерны комментирования

### 1. Избыточные комментарии

```typescript
// ПЛОХО: комментарий повторяет очевидное
// Устанавливаем значение count в 0
let count = 0;

// ПЛОХО: комментарий описывает то, что очевидно из кода
// Проходим по каждому элементу массива
for (const item of items) {
    // обработка элемента
}
```

### 2. Запутанные или устаревшие комментарии

```typescript
/**
 * @param name Имя пользователя
 * @param age Возраст пользователя  
 * @returns Объект пользователя
 * @deprecated Используйте createUserV2 вместо этого метода
 */
// ^-- Но функция не устарела и продолжает использоваться
function createUser(name: string, age: number): User {
    // реализация
}
```

### 3. Комментарии вместо рефакторинга

```typescript
// ПЛОХО: лучше вынести в отдельную функцию
// Сначала сортируем по возрасту, потом по имени, 
// затем фильтруем по активности и, наконец, 
// преобразуем в формат, подходящий для отображения
const result = users
    .sort((a, b) => a.age - b.age || a.name.localeCompare(b.name))
    .filter(user => user.isActive)
    .map(user => transformForDisplay(user));
```

**Лучше:**
```typescript
const result = processUsers(users);

function processUsers(users: User[]): DisplayUser[] {
    return users
        .sort(compareByAgeAndName)
        .filter(isActiveUser)
        .map(transformForDisplay);
}
```

## Специальные комментарии

### 1. TODO, FIXME, HACK

```typescript
class DataProcessor {
    processData(): void {
        // TODO: Реализовать кэширование результатов
        // FIXME: Временное решение - убрать после исправления бэкенда
        const result = this.expensiveOperation();
        
        // HACK: Временное решение для обхода бага в библиотеке third-party
        setTimeout(() => this.updateUI(result), 0);
    }
}
```

### 2. NOTE, WARNING

```typescript
function decryptData(encrypted: string): string {
    // NOTE: Эта функция использует устаревший алгоритм шифрования
    // который не рекомендуется для новых проектов
    const decrypted = legacyDecrypt(encrypted);
    
    // WARNING: Не вызывайте эту функцию из публичного API
    // она не проверяет целостность данных
    return decrypted;
}
```

## Автоматизация и инструменты

### ESLint правила для комментариев

```json
{
  "rules": {
    "spaced-comment": ["error", "always"],
    "capitalized-comments": ["error", "always"],
    "require-jsdoc": ["error", {
      "require": {
        "FunctionDeclaration": true,
        "MethodDefinition": true,
        "ClassDeclaration": true
      }
    }]
  }
}
```

## Связанные темы

- [[JSDoc]] - Стандарт документирования JavaScript
- [[TSDoc]] - Современный стандарт документирования TypeScript
- [[Документация-API]] - Подробное руководство по документированию API
- [[Документирование-библиотек]] - Рекомендации по документированию библиотек