---
aliases: [Трансформеры TypeScript, AST-трансформации]
tags: [typescript, метапрограммирование, трансформеры, компилятор]
---

# Трансформеры в TypeScript

## Обзор

Трансформеры — это функции, которые преобразуют AST (Abstract Syntax Tree) TypeScript во время компиляции. Они позволяют изменять структуру кода перед его компиляцией в JavaScript. Трансформеры могут использоваться для добавления дополнительной логики, генерации кода, оптимизации и других целей.

## Основы

Трансформеры работают на уровне AST и могут изменять узлы дерева синтаксиса. Они могут быть использованы в плагинах компилятора для изменения поведения компиляции TypeScript.

## Примеры использования

### Простой трансформер

```typescript
import * as ts from 'typescript';

function removeComments(): ts.TransformerFactory<ts.SourceFile> {
  return (context: ts.TransformationContext) => {
    const visitor: ts.Visitor = (node: ts.Node): ts.VisitResult<ts.Node> => {
      if (ts.isIdentifier(node) && node.text === 'TODO') {
        return ts.factory.createIdentifier('FIXED');
      }
      return ts.visitEachChild(node, visitor, context);
    };
    return (sourceFile: ts.SourceFile) => ts.visitNode(sourceFile, visitor);
  };
}

// Использование трансформера
const program = ts.createProgram(['input.ts'], {});
const sourceFile = program.getSourceFile('input.ts')!;
const result = ts.transform(sourceFile, [removeComments()]);
```

### Трансформер для добавления логирования

```typescript
import * as ts from 'typescript';

function addLogging(): ts.TransformerFactory<ts.SourceFile> {
  return (context: ts.TransformationContext) => {
    const visitor: ts.Visitor = (node: ts.Node): ts.VisitResult<ts.Node> => {
      if (ts.isMethodDeclaration(node)) {
        const method = node as ts.MethodDeclaration;
        if (method.name && ts.isIdentifier(method.name)) {
          const logStatement = ts.factory.createExpressionStatement(
            ts.factory.createCallExpression(
              ts.factory.createPropertyAccessExpression(
                ts.factory.createIdentifier('console'),
                'log'
              ),
              undefined,
              [ts.factory.createStringLiteral(`Calling method: ${method.name.text}`)]
            )
          );
          
          const newBody = ts.factory.updateBlock(method.body!, [
            logStatement,
            ...method.body!.statements
          ]);
          
          return ts.factory.updateMethodDeclaration(
            method,
            method.decorators,
            method.modifiers,
            method.asteriskToken,
            method.name,
            method.questionToken,
            method.typeParameters,
            method.parameters,
            method.type,
            newBody
          );
        }
      }
      return ts.visitEachChild(node, visitor, context);
    };
    return (sourceFile: ts.SourceFile) => ts.visitNode(sourceFile, visitor);
  };
}
```

## Практическое применение

Трансформеры используются для создания плагинов компилятора, которые могут изменять поведение TypeScript, добавлять спефичные для проекта функции, генерировать код, оптимизировать производительность и другие задачи.

## Связанные темы

- [[Плагины-компилятора]]
- [[Декораторы]]
- [[Метаданные]]

## Ключевые выводы

- Трансформеры позволяют изменять AST во время компиляции
- Они могут использоваться для добавления логики, генерации кода и оптимизации
- Требуют глубокого понимания структуры AST и API компилятора TypeScript