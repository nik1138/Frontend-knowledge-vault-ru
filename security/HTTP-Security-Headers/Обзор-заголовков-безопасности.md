---
aliases: ["HTTP заголовки безопасности", "Заголовки безопасности", "Web Security Headers"]
tags: [security, http-headers, web-security, security-headers]
---

# Обзор HTTP заголовков безопасности

## Введение

HTTP заголовки безопасности — это специальные заголовки HTTP, которые помогают защитить веб-приложения от различных типов атак. Эти заголовки позволяют веб-серверам сообщать браузерам о политике безопасности, ограничивая потенциально опасные функции и поведение.

## Классификация заголовков безопасности

### 1. Заголовки, предотвращающие XSS

- `Content-Security-Policy` — контролирует источники контента
- `X-XSS-Protection` — включает встроенный XSS-фильтр браузера
- `X-Content-Type-Options` — предотвращает MIME-уязвимости

### 2. Заголовки, защищающие от кликджекинга

- `X-Frame-Options` — контролирует возможность фрейминга
- `Content-Security-Policy` (frame-ancestors) — альтернатива X-Frame-Options

### 3. Заголовки, обеспечивающие безопасность передачи данных

- `Strict-Transport-Security` — принудительное использование HTTPS
- `Public-Key-Pins` — защита от поддельных SSL-сертификатов

### 4. Заголовки, защищающие от других уязвимостей

- `X-Content-Type-Options` — предотвращает MIME-уязвимости
- `Referrer-Policy` — контролирует информацию в заголовке Referer
- `Feature-Policy` — контролирует доступ к браузерным API

## Основные заголовки безопасности

### 1. Content-Security-Policy (CSP)

Самый мощный заголовок безопасности, позволяющий контролировать источники различных типов контента.

```
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self';
```

### 2. Strict-Transport-Security (HSTS)

Принудительно перенаправляет HTTP-запросы на HTTPS и предотвращает downgrade-атаки.

```
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
```

### 3. X-Frame-Options

Предотвращает встраивание страницы в iframe на других сайтах.

```
X-Frame-Options: DENY
```

### 4. X-Content-Type-Options

Предотвращает MIME-уязвимости, заставляя браузер придерживаться объявленного типа содержимого.

```
X-Content-Type-Options: nosniff
```

### 5. Referrer-Policy

Контролирует, какая информация отправляется в заголовке Referer.

```
Referrer-Policy: no-referrer-when-downgrade
```

## Реализация заголовков безопасности

### 1. В Express.js

```javascript
const helmet = require('helmet');

// Использование Helmet для установки большинства заголовков
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
      fontSrc: ["'self'"],
      connectSrc: ["'self'"],
      frameAncestors: ["'none'"],
      objectSrc: ["'none'"],
      baseUri: ["'self'"]
    }
  },
  hsts: {
    maxAge: 31536000,
    includeSubDomains: true,
    preload: true
  },
  frameguard: {
    action: 'deny'
  },
  noSniff: true,
  referrerPolicy: {
    policy: ['no-referrer-when-downgrade']
  }
}));

// Или установка заголовков вручную
app.use((req, res, next) => {
  // Content Security Policy
  res.setHeader('Content-Security-Policy', 
    "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self'; report-uri /csp-report");
  
  // Strict Transport Security
  res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');
  
  // X-Frame-Options
  res.setHeader('X-Frame-Options', 'DENY');
  
  // X-Content-Type-Options
  res.setHeader('X-Content-Type-Options', 'nosniff');
  
  // Referrer Policy
  res.setHeader('Referrer-Policy', 'no-referrer-when-downgrade');
  
  next();
});
```

### 2. В Apache

```
# В .htaccess или конфигурационном файле Apache
<IfModule mod_headers.c>
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self'"
    
    # Strict Transport Security
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # X-Frame-Options
    Header always set X-Frame-Options "DENY"
    
    # X-Content-Type-Options
    Header always set X-Content-Type-Options "nosniff"
    
    # Referrer Policy
    Header always set Referrer-Policy "no-referrer-when-downgrade"
</IfModule>
```

### 3. В Nginx

```
# В конфигурационном файле Nginx
server {
    # Strict Transport Security
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    
    # Content Security Policy
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self'" always;
    
    # X-Frame-Options
    add_header X-Frame-Options "DENY" always;
    
    # X-Content-Type-Options
    add_header X-Content-Type-Options "nosniff" always;
    
    # Referrer Policy
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
}
```

## Подробное описание ключевых заголовков

### Content-Security-Policy

Самый важный заголовок безопасности, который помогает предотвратить XSS, clickjacking и другие атаки, контролируя, какие ресурсы могут быть загружены и выполнены на странице.

#### Основные директивы:
- `default-src` — базовая политика для всех ресурсов
- `script-src` — источники JavaScript
- `style-src` — источники CSS
- `img-src` — источники изображений
- `font-src` — источники шрифтов
- `connect-src` — источники для XHR, fetch, WebSocket
- `frame-ancestors` — разрешенные родительские фреймы
- `object-src` — источники для <object>, <embed>, <applet>

### Strict-Transport-Security (HSTS)

Заставляет браузер использовать HTTPS вместо HTTP для всех будущих запросов к сайту.

#### Параметры:
- `max-age` — время в секундах, на которое запоминается политика
- `includeSubDomains` — применяется ко всем поддоменам
- `preload` — добавляет сайт в HSTS preload list

### X-Frame-Options

Предотвращает встраивание страницы в iframe на других сайтах, защищая от clickjacking атак.

#### Значения:
- `DENY` — запретить фрейминг на всех сайтах
- `SAMEORIGIN` — разрешить фрейминг только на том же домене
- `ALLOW-FROM uri` — разрешить фрейминг на указанном сайте (не поддерживается во всех браузерах)

### X-Content-Type-Options

Предотвращает MIME-уязвимости, заставляя браузер придерживаться объявленного типа содержимого.

#### Значения:
- `nosniff` — не пытаться определить MIME-тип по содержимому

## Современные альтернативы

### 1. Feature-Policy (ныне Permissions-Policy)

Контролирует, какие браузерные API доступны странице.

```
Feature-Policy: geolocation 'none'; camera 'self'; microphone 'self';
```

### 2. Expect-CT

Помогает обнаруживать и предотвращать атаки с использованием поддельных SSL-сертификатов.

```
Expect-CT: max-age=86400, report-uri="https://example.com/ct-report"
```

### 3. Cross-Origin-Embedder-Policy

Предотвращает загрузку ресурсов из других источников без разрешения.

```
Cross-Origin-Embedder-Policy: require-corp
```

### 4. Cross-Origin-Opener-Policy

Иolирует окно от других окон с другим происхождением.

```
Cross-Origin-Opener-Policy: same-origin
```

### 5. Cross-Origin-Resource-Policy

Контролирует, какие источники могут получить доступ к ресурсу.

```
Cross-Origin-Resource-Policy: same-origin
```

## Практические примеры

### 1. Комплексная политика безопасности

```javascript
// Полная политика безопасности для веб-приложения
function securityHeaders(req, res, next) {
  // Content Security Policy
  res.setHeader('Content-Security-Policy', [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval'",
    "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
    "img-src 'self' data: blob: https:",
    "font-src 'self' https://fonts.gstatic.com",
    "connect-src 'self' https://api.example.com",
    "frame-ancestors 'none'",
    "object-src 'none'",
    "base-uri 'self'",
    "report-uri /csp-report"
  ].join('; '));
  
  // Strict Transport Security
  res.setHeader('Strict-Transport-Security', 
    'max-age=31536000; includeSubDomains; preload');
  
  // X-Frame-Options
  res.setHeader('X-Frame-Options', 'DENY');
  
  // X-Content-Type-Options
  res.setHeader('X-Content-Type-Options', 'nosniff');
  
  // Referrer Policy
  res.setHeader('Referrer-Policy', 'no-referrer-when-downgrade');
  
  // Permissions Policy
  res.setHeader('Permissions-Policy', 
    'geolocation=(), microphone=(), camera=()');
  
  // Cross-Origin policies
  res.setHeader('Cross-Origin-Embedder-Policy', 'require-corp');
  res.setHeader('Cross-Origin-Opener-Policy', 'same-origin');
  res.setHeader('Cross-Origin-Resource-Policy', 'same-origin');
  
  next();
}

app.use(securityHeaders);
```

### 2. Заголовки для API

```javascript
// Заголовки безопасности для API
function apiSecurityHeaders(req, res, next) {
  // Для API обычно не нужны CSP для UI, но важна защита от других атак
  res.setHeader('X-Content-Type-Options', 'nosniff');
  res.setHeader('X-Frame-Options', 'DENY');
  res.setHeader('Referrer-Policy', 'no-referrer');
  
  // Установка CORS заголовков (если применимо)
  res.setHeader('Access-Control-Allow-Origin', 'https://trusted-frontend.com');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  
  next();
}

app.use('/api', apiSecurityHeaders);
```

## Лучшие практики

> [!tip] Лучшие практики HTTP заголовков безопасности
> 1. Используйте комплексный подход — не полагайтесь на один заголовок
> 2. Регулярно обновляйте политики безопасности
> 3. Тестируйте заголовки в разных браузерах
> 4. Используйте инструменты для проверки заголовков
> 5. Мониторьте эффективность заголовков через отчеты

### Проверка заголовков

```javascript
// Инструмент для проверки HTTP заголовков безопасности
function checkSecurityHeaders(url) {
  return fetch(url, { method: 'HEAD' })
    .then(response => {
      const headers = {};
      const securityHeaders = [
        'Content-Security-Policy',
        'Strict-Transport-Security', 
        'X-Frame-Options',
        'X-Content-Type-Options',
        'Referrer-Policy'
      ];
      
      securityHeaders.forEach(header => {
        headers[header] = response.headers.get(header);
      });
      
      return headers;
    });
}

// Использование
checkSecurityHeaders('https://example.com')
  .then(headers => {
    console.log('Security Headers:', headers);
  });
```

## Совместимость с браузерами

### Поддержка основных заголовков:

- **Content-Security-Policy**: Chrome 25+, Firefox 23+, Safari 7+, Edge 12+
- **Strict-Transport-Security**: Chrome 4+, Firefox 4+, Safari 7+, Edge 12+
- **X-Frame-Options**: Chrome 4+, Firefox 3.6.9+, Safari 4+, IE 8+
- **X-Content-Type-Options**: Chrome 4+, Firefox 50+, Safari 10+, Edge 12+
- **Referrer-Policy**: Chrome 61+, Firefox 59+, Safari 12+, Edge 79+

## Оценка эффективности

### 1. Использование онлайн-инструментов

- securityheaders.com — проверка заголовков безопасности
- observatory.mozilla.org — комплексный аудит безопасности
- csp-evaluator.withgoogle.com — анализ CSP

### 2. Автоматизированные проверки

```javascript
// Автоматизированная проверка заголовков в тестах
function validateSecurityHeaders(response) {
  const requiredHeaders = {
    'X-Content-Type-Options': 'nosniff',
    'X-Frame-Options': 'DENY|SAMEORIGIN',
    'Referrer-Policy': '.*'
  };
  
  let passed = true;
  const results = {};
  
  for (const [header, expectedPattern] of Object.entries(requiredHeaders)) {
    const value = response.headers.get(header);
    const pattern = new RegExp(expectedPattern);
    
    results[header] = {
      present: !!value,
      matches: value ? pattern.test(value) : false,
      actual: value
    };
    
    if (!results[header].present || !results[header].matches) {
      passed = false;
    }
  }
  
  return { passed, results };
}
```

## Связь с другими аспектами безопасности

HTTP заголовки безопасности тесно связаны с:
- [[Content-Security-Policy]] — подробное рассмотрение CSP
- [[X-Frame-Options]] — детальное рассмотрение защиты от фрейминга
- [[X-Content-Type-Options]] — защита от MIME-уязвимостей
- [[Strict-Transport-Security]] — защита транспортного уровня
- [[Распространенные-уязвимости]] — предотвращение известных уязвимостей
- [[Тестирование-безопасности]] — методы проверки заголовков

## Заключение

HTTP заголовки безопасности являются важным слоем защиты веб-приложений. Правильная настройка этих заголовков может значительно повысить безопасность приложения, предотвращая различные типы атак. Однако важно понимать, что заголовки безопасности — это лишь один из аспектов комплексной стратегии безопасности, которая должна включать и другие меры защиты.

## Дополнительные ресурсы

- OWASP Secure Headers Project
- Mozilla Web Security Guidelines
- RFC 7231 (HTTP Semantics)
- Security Headers Documentation