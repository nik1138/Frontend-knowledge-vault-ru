---
aliases: [Анализ CSP, Оценка политики безопасности контента, Эффективность CSP]
tags: [security, csp, content-security-policy, web-security]
---

# Оценка-CSP

## Обзор

Оценка CSP (Content Security Policy) - это процесс анализа эффективности и правильности реализации политики безопасности контента в веб-приложении. Эта оценка помогает определить, насколько хорошо CSP защищает приложение от атак, таких как XSS, и других форм внедрения вредоносного контента.

## Цели оценки CSP

### 1. Оценка уровня защиты
- Определение степени защиты от XSS-атак
- Проверка защиты от других форм инъекций
- Оценка эффективности ограничения загрузки ресурсов

### 2. Проверка корректности реализации
- Проверка синтаксиса CSP-директив
- Оценка совместимости с различными браузерами
- Проверка на наличие конфликтов между директивами

### 3. Анализ влияния на функциональность
- Проверка, не блокирует ли CSP легитимные функции приложения
- Оценка влияния на производительность
- Проверка совместимости с внешними сервисами

## Методы оценки CSP

### 1. Автоматический анализ
- Использование инструментов для проверки CSP-заголовков
- Анализ соответствия директив лучшим практикам
- Проверка на наличие распространенных ошибок

### 2. Ручная проверка
- Анализ каждой директивы на предмет безопасности
- Проверка соответствия политик бизнес-требованиям
- Оценка потенциальных обходов политики

### 3. Тестирование в реальных условиях
- Проверка работы приложения с включенной CSP
- Тестирование сценариев обхода политики
- Мониторинг отчетов о нарушениях

## Критерии оценки CSP

### 1. Полное покрытие угроз
- **Высокий уровень**: Политика защищает от всех основных типов атак
- **Средний уровень**: Политика защищает от большинства атак, но имеют исключения
- **Низкий уровень**: Политика имеет значительные уязвимости

### 2. Строгость политик
- Использование максимально строгих директив
- Минимизация разрешений для внешних источников
- Правильное использование nonce и hash для inline-контента

### 3. Совместимость
- Поддержка основных браузеров
- Совместимость с используемыми библиотеками
- Отсутствие конфликтов с легитимными функциями

## Инструменты для оценки CSP

### CSP Evaluator (Google)
- Онлайн-инструмент для анализа CSP
- Проверка на распространенные ошибки
- Рекомендации по улучшению политики

### CSP Auditor (Chrome Extension)
- Расширение для Chrome для анализа CSP на страницах
- Выявление слабых мест в политике
- Предложения по улучшению

### OWASP ZAP CSP Scanner
- Часть OWASP ZAP
- Автоматическое сканирование CSP
- Интеграция с процессом тестирования безопасности

## Пример анализа CSP

### Пример слабой политики
```
Content-Security-Policy: default-src 'self'; script-src 'unsafe-inline' 'unsafe-eval'
```
**Проблемы:**
- Использование 'unsafe-inline' и 'unsafe-eval'
- Отсутствие защиты от XSS

### Пример улучшенной политики
```
Content-Security-Policy: default-src 'self'; script-src 'self' 'nonce-abc123'; style-src 'self' 'unsafe-inline'
```
**Улучшения:**
- Устранение 'unsafe-eval'
- Использование nonce для inline-скриптов

### Пример строгой политики
```
Content-Security-Policy: default-src 'none'; script-src 'self'; style-src 'self'; img-src 'self' data:; font-src 'self'; connect-src 'self'
```
**Преимущества:**
- Минимизация разрешений
- Высокий уровень защиты

## Отчеты о нарушениях CSP

### Настройка отчетности
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; report-uri /csp-report">
```

### Анализ отчетов
- Мониторинг частоты нарушений
- Идентификация легитимных источников, блокируемых CSP
- Постоянное улучшение политики на основе данных

## Ошибки при реализации CSP

### 1. Слишком широкие разрешения
- Использование 'unsafe-inline' и 'unsafe-eval'
- Разрешение всех внешних источников
- Отсутствие ограничений на выполнение скриптов

### 2. Неполные политики
- Отсутствие директив для критических ресурсов
- Неправильное использование default-src
- Пропуск важных типов контента

### 3. Несовместимость с приложением
- Блокировка легитимных функций приложения
- Проблемы с внешними библиотеками
- Потеря производительности

## Лучшие практики оценки CSP

### 1. Поэтапное внедрение
- Начинайте с режима отчетности (report-only)
- Поэтапно усиливайте политику
- Постоянный мониторинг и корректировка

### 2. Тестирование в изолированной среде
- Используйте тестовые стенды для проверки CSP
- Тестируйте все функции приложения
- Проверяйте совместимость с различными браузерами

### 3. Регулярный аудит
- Периодическая проверка эффективности CSP
- Обновление политик в соответствии с изменениями приложения
- Анализ новых угроз и адаптация политик

## Связанные темы

- [[Директивы-CSP]]
- [[Отчеты-о-нарушениях-CSP]]
- [[Реализация-CSP]]
- [[Формирование-CSP-политики]]

> [!tip] Совет
> Используйте режим report-only перед внедрением CSP в продакшен, чтобы выявить потенциальные проблемы без влияния на пользователей.

> [!warning] Важно
> CSP не является панацеей от XSS и других атак, она должна использоваться в комплексе с другими мерами безопасности.