---
aliases: [Криптографические ключи, Управление ключами, Шифрование на клиенте - ключи]
tags: [security, encryption, web-crypto, client-side, keys]
---

# Управление криптографическими ключами

## Введение в управление криптографическими ключами

Управление криптографическими ключами — это критически важный аспект безопасности приложений, особенно при реализации шифрования на клиенте. Ключи являются основой криптографических операций, и их неправильное управление может привести к серьезному компрометированию данных. В контексте веб-приложений, где код выполняется в потенциально небезопасной среде браузера, управление ключами требует особого внимания.

Эффективное управление ключами включает в себя:
- Генерацию ключей с использованием криптографически безопасных методов
- Надежное хранение ключей в браузере
- Защиту ключей от несанкционированного доступа
- Контроль жизненного цикла ключей от создания до уничтожения
- Безопасное распределение и обмен ключами

## Типы криптографических ключей

В криптографии различают несколько типов ключей, каждый из которых используется для определенных целей:

### Симметричные ключи
- Используются в симметричных криптографических алгоритмах (например, AES)
- Один и тот же ключ используется для шифрования и дешифрования
- Требуют надежного распределения ключей между участниками
- Обычно имеют длину 128, 192 или 256 бит

### Асимметричные ключи
- Используются в асимметричных криптографических системах (например, RSA, ECDSA)
- Состоят из пары: открытый и закрытый ключ
- Открытый ключ может быть свободно распространяем, а закрытый должен храниться в секрете
- Используются для шифрования, цифровой подписи и обмена ключами

### Ключи для хеширования
- Используются в HMAC (Hash-based Message Authentication Code)
- Комбинируют криптографическую хеш-функцию с секретным ключом
- Применяются для проверки целостности и аутентичности данных

## Жизненный цикл ключей

Жизненный цикл криптографического ключа включает несколько фаз:

1. **Генерация** — создание ключа с использованием криптографически безопасного генератора случайных чисел
2. **Распределение** — безопасная передача ключа между участниками системы
3. **Активация** — начало использования ключа для криптографических операций
4. **Использование** — выполнение шифрования, дешифрования, подписи и т.д.
5. **Ротация** — замена старого ключа на новый
6. **Деактивация** — прекращение использования ключа
7. **Уничтожение** — удаление ключа из системы

Каждая фаза требует соблюдения строгих мер безопасности для предотвращения компрометации ключа.

## Генерация ключей

Генерация ключей — это первый и один из самых важных шагов в управлении ключами. В браузере для генерации ключей используется Web Crypto API.

### Симметричные ключи

Для генерации симметричных ключей (например, AES) можно использовать:

```javascript
const key = await window.crypto.subtle.generateKey(
  {
    name: "AES-GCM",
    length: 256, // длина в битах
  },
  true, // экспортируемый
  ["encrypt", "decrypt"] // цели использования
);
```

### Асимметричные ключи

Для генерации асимметричных ключей (например, RSA):

```javascript
const keyPair = await window.crypto.subtle.generateKey(
  {
    name: "RSA-OAEP",
    modulusLength: 2048,
    publicExponent: new Uint8Array([1, 0, 1]),
    hash: "SHA-256",
  },
  true, // экспортируемый
  ["encrypt", "decrypt"]
);
```

Важно использовать криптографически безопасный генератор случайных чисел, который предоставляется браузером.

## Хранение ключей в браузере

Хранение криптографических ключей в браузере требует особой осторожности. Существует несколько подходов:

### Хранение в памяти JavaScript
- Ключи хранятся в переменных JavaScript
- Не сохраняются между сессиями
- Наиболее безопасный метод, но неудобный для долгосрочного использования

### Хранение в IndexedDB
- Более стойкое хранилище
- Требует дополнительных мер безопасности
- Ключи могут быть зашифрованы перед сохранением

### Хранение в localStorage/sessionStorage
- Не рекомендуется для хранения криптографических ключей
- Уязвимы для XSS-атак
- Доступны в текстовом виде

### Использование SubtleCrypto
- Ключи могут храниться в защищенном хранилище браузера
- Ограничения на экспорт (non-extractable keys)
- Требует careful управления доступом

## Защита ключей в браузере

Защита криптографических ключей в браузере включает:

### Ограничение экспорта
Использование неэкспортируемых ключей (non-extractable keys) предотвращает возможность получения ключа в открытом виде:

```javascript
const key = await window.crypto.subtle.generateKey(
  {
    name: "AES-GCM",
    length: 256,
  },
  false, // не экспортируемый
  ["encrypt", "decrypt"]
);
```

### Защита от XSS
- Ограничение доступа к ключам только доверенным скриптам
- Использование Content Security Policy (CSP)
- Проверка источника запросов к криптографическим операциям

### Использование защищенного контекста
- Все криптографические операции должны выполняться в HTTPS
- Использование Secure Context API для проверки безопасности среды

## Использование Web Crypto API

Web Crypto API предоставляет стандартный интерфейс для выполнения криптографических операций в браузере. Основные функции:

### Шифрование и дешифрование
```javascript
// Шифрование
const encrypted = await window.crypto.subtle.encrypt(
  {
    name: "AES-GCM",
    iv: iv, // инициализационный вектор
  },
  key, // ваш симметричный ключ
  data // данные для шифрования
);

// Дешифрование
const decrypted = await window.crypto.subtle.decrypt(
  {
    name: "AES-GCM",
    iv: iv,
  },
  key,
  encrypted
);
```

### Создание цифровой подписи
```javascript
const signature = await window.crypto.subtle.sign(
  {
    name: "RSASSA-PKCS1-v1_5",
    hash: {name: "SHA-256"},
  },
  privateKey,
  data
);
```

### Проверка цифровой подписи
```javascript
const isValid = await window.crypto.subtle.verify(
  {
    name: "RSASSA-PKCS1-v1_5",
    hash: {name: "SHA-256"},
  },
  publicKey,
  signature,
  data
);
```

## Импорт и экспорт ключей

Web Crypto API позволяет импортировать и экспортировать ключи в различных форматах:

### Экспорт ключа
```javascript
const exportedKey = await window.crypto.subtle.exportKey(
  "jwk", // или "raw", "spki", "pkcs8"
  key
);
```

### Импорт ключа
```javascript
const importedKey = await window.crypto.subtle.importKey(
  "jwk",
  jwk,
  {
    name: "AES-GCM",
  },
  false, // extractable
  ["encrypt", "decrypt"]
);
```

Важно понимать риски, связанные с экспортом ключей, и использовать этот функционал с осторожностью.

## Обмен ключами

Обмен ключами между участниками системы требует особой осторожности:

### Протокол Диффи-Хеллмана
Web Crypto API поддерживает обмен ключами по протоколу Диффи-Хеллмана:

```javascript
const sharedSecret = await window.crypto.subtle.deriveKey(
  {
    name: "ECDH",
    public: otherPublicKey,
  },
  privateKey,
  {
    name: "AES-GCM",
    length: 256,
  },
  true,
  ["encrypt", "decrypt"]
);
```

### Использование сертификатов
Для аутентификации участников можно использовать X.509 сертификаты.

## Ротация ключей

Ротация ключей — это процесс замены старых ключей на новые. Это важная мера безопасности:

- Ограничение срока действия ключей
- Предотвращение компрометации ключей в случае утечки
- Соблюдение нормативных требований

Процесс ротации может включать:
1. Генерацию новых ключей
2. Обновление зашифрованных данных новыми ключами
3. Архивирование старых ключей на случай необходимости дешифрования
4. Уничтожение старых ключей после установленного периода

## Уничтожение ключей

Правильное уничтожение ключей критически важно:

- Использование `crypto.subtle.importKey` с флагом `extractable: false` и последующее удаление ссылок
- Перезапись памяти (ограничено возможностями JavaScript)
- Удаление всех копий ключей из хранилищ

## Безопасное распределение ключей

Распределение ключей между клиентами и серверами требует использования безопасных каналов:

- Использование TLS для передачи ключей
- Применение асимметричного шифрования для защиты симметричных ключей
- Использование протоколов обмена ключами (например, ECDH)

## Механизмы резервного копирования

Для восстановления доступа к данным при потере ключей могут использоваться:

- Шифрование ключей резервной копии другим ключом
- Использование схем разделения секрета (secret sharing)
- Хранение резервных копий в защищенном хранилище

## Практические рекомендации

При реализации управления криптографическими ключами в браузере следует учитывать следующие рекомендации:

- Использовать Web Crypto API вместо сторонних библиотек
- Не хранить ключи в открытом виде в localStorage
- Использовать неэкспортируемые ключи, когда это возможно
- Обеспечить защиту от XSS и CSRF атак
- Реализовать надежную аутентификацию перед доступом к ключам
- Внедрить мониторинг и логирование доступа к ключам
- Регулярно обновлять ключи в соответствии с политикой безопасности
- Использовать защищенные соединения (HTTPS) для всех криптографических операций

## Ссылки на связанные файлы

- [[Шифрование-на-клиенте]]
- [[Web-Crypto-API]]
- [[Защита-от-XSS]]
- [[HTTPS-и-безопасность]]
- [[Аутентификация-в-браузере]]
- [[IndexedDB-безопасность]]
- [[Content-Security-Policy]]
- [[Протоколы-обмена-ключами]]
- [[Цифровая-подпись]]
- [[Симметричное-шифрование]]
- [[Асимметричное-шифрование]]
- [[HMAC-и-аутентификация]]
- [[Управление-сессиями]]
- [[Резервное-копирование-данных]]
- [[Многофакторная-аутентификация]]