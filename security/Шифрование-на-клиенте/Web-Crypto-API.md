---
aliases: [Web Crypto API, Криптография в браузере, Клиентская криптография]
tags: [security, cryptography, web-api, client-side, encryption, decryption, keys, browser-api]
---

# Web Crypto API

## Введение в Web Crypto API

Web Crypto API предоставляет интерфейс для выполнения криптографических операций в браузере, таких как шифрование, расшифровка, генерация ключей, подпись и верификация. Это стандартный API, встроенный в современные браузеры, который позволяет выполнять криптографические операции без необходимости загрузки внешних библиотек.

API предоставляет доступ к криптографическим функциям, которые реализуются непосредственно в браузере, что делает его более безопасным по сравнению с JavaScript-библиотеками, реализующими криптографические алгоритмы.

## Возможности и функции

Web Crypto API предоставляет широкий спектр криптографических возможностей:

- **Шифрование и расшифровка** данных с использованием различных алгоритмов
- **Генерация криптографических ключей** для различных алгоритмов
- **Подпись и верификация** цифровых подписей
- **Хеширование** данных с использованием криптографических хеш-функций
- **Обмен ключами** по протоколу Diffie-Hellman
- **Производство криптографически безопасных случайных чисел**

API поддерживает как симметричные (AES, DES), так и асимметричные (RSA, ECDSA) алгоритмы шифрования.

## Поддержка браузерами

Web Crypto API поддерживается всеми современными браузерами:

- Chrome: с версии 37
- Firefox: с версии 34
- Safari: с версии 7 (частичная поддержка в более ранних версиях)
- Edge: с версии 12
- Opera: с версии 24

Для работы с API необходимо использовать HTTPS или localhost, так как API недоступен на небезопасных соединениях.

## Основные методы

### encrypt()

Метод `encrypt()` используется для шифрования данных с помощью симметричного или асимметричного ключа:

```javascript
const encrypted = await window.crypto.subtle.encrypt(
  {
    name: "AES-GCM",
    iv: ivBuffer
  },
  key,
  data
);
```

### decrypt()

Метод `decrypt()` используется для расшифровки данных:

```javascript
const decrypted = await window.crypto.subtle.decrypt(
  {
    name: "AES-GCM",
    iv: ivBuffer
  },
  key,
  encryptedData
);
```

### sign()

Метод `sign()` создает цифровую подпись:

```javascript
const signature = await window.crypto.subtle.sign(
  {
    name: "RSASSA-PKCS1-v1_5"
  },
  privateKey,
  data
);
```

### verify()

Метод `verify()` проверяет цифровую подпись:

```javascript
const isValid = await window.crypto.subtle.verify(
  {
    name: "RSASSA-PKCS1-v1_5"
  },
  publicKey,
  signature,
  data
);
```

## Поддерживаемые алгоритмы

Web Crypto API поддерживает широкий спектр криптографических алгоритмов:

### Алгоритмы шифрования
- AES-CTR (Advanced Encryption Standard - Counter mode)
- AES-CBC (Advanced Encryption Standard - Cipher Block Chaining)
- AES-GCM (Advanced Encryption Standard - Galois/Counter Mode)
- RSA-OAEP (Rivest-Shamir-Adleman - Optimal Asymmetric Encryption Padding)

### Алгоритмы хеширования
- SHA-1 (Secure Hash Algorithm 1)
- SHA-256 (Secure Hash Algorithm 256)
- SHA-384 (Secure Hash Algorithm 384)
- SHA-512 (Secure Hash Algorithm 512)

### Алгоритмы подписи
- RSASSA-PKCS1-v1_5 (RSA Signature Algorithm)
- RSA-PSS (RSA Probabilistic Signature Scheme)
- ECDSA (Elliptic Curve Digital Signature Algorithm)

## Генерация ключей

Для генерации криптографических ключей используется метод `generateKey()`:

```javascript
// Генерация RSA ключевой пары
const { publicKey, privateKey } = await window.crypto.subtle.generateKey(
  {
    name: "RSA-OAEP",
    modulusLength: 2048,
    publicExponent: new Uint8Array([1, 0, 1]),
    hash: "SHA-256",
  },
  true,
  ["encrypt", "decrypt"]
);

// Генерация симметричного ключа AES
const aesKey = await window.crypto.subtle.generateKey(
  {
    name: "AES-GCM",
    length: 256,
  },
  true,
  ["encrypt", "decrypt"]
);
```

## Импорт и экспорт ключей

Для работы с существующими ключами Web Crypto API предоставляет методы `importKey()` и `exportKey()`:

```javascript
// Импорт ключа из буфера
const importedKey = await window.crypto.subtle.importKey(
  "jwk", // или "raw", "spki", "pkcs8"
  keyData,
  {
    name: "AES-GCM",
  },
  true,
  ["encrypt", "decrypt"]
);

// Экспорт ключа
const exportedKey = await window.crypto.subtle.exportKey(
  "jwk", // или "raw", "spki", "pkcs8"
  key
);
```

## Примеры использования

### Простое шифрование и расшифровка

```javascript
// Генерация ключа
const key = await window.crypto.subtle.generateKey(
  {
    name: "AES-GCM",
    length: 256,
  },
  true,
  ["encrypt", "decrypt"]
);

// Подготовка данных для шифрования
const encoder = new TextEncoder();
const data = encoder.encode("Секретные данные");

// Генерация IV (инициализационного вектора)
const iv = window.crypto.getRandomValues(new Uint8Array(12));

// Шифрование
const encrypted = await window.crypto.subtle.encrypt(
  {
    name: "AES-GCM",
    iv: iv
  },
  key,
  data
);

// Расшифровка
const decrypted = await window.crypto.subtle.decrypt(
  {
    name: "AES-GCM",
    iv: iv
  },
  key,
  encrypted
);

const decoder = new TextDecoder();
console.log(decoder.decode(decrypted)); // "Секретные данные"
```

### Подпись данных

```javascript
// Генерация ключевой пары для подписи
const { privateKey, publicKey } = await window.crypto.subtle.generateKey(
  {
    name: "ECDSA",
    namedCurve: "P-256",
  },
  true,
  ["sign", "verify"]
);

// Подготовка данных
const encoder = new TextEncoder();
const data = encoder.encode("Данные для подписи");

// Создание подписи
const signature = await window.crypto.subtle.sign(
  {
    name: "ECDSA",
    hash: { name: "SHA-256" },
  },
  privateKey,
  data
);

// Проверка подписи
const isValid = await window.crypto.subtle.verify(
  {
    name: "ECDSA",
    hash: { name: "SHA-256" },
  },
  publicKey,
  signature,
  data
);

console.log("Подпись действительна:", isValid);
```

## Безопасность использования API

При использовании Web Crypto API необходимо учитывать несколько важных аспектов безопасности:

- **Хранение ключей**: Ключи, созданные с помощью Web Crypto API, не могут быть извлечены в открытом виде, что повышает безопасность
- **Использование HTTPS**: API недоступен на небезопасных соединениях
- **Случайные числа**: Использование `crypto.getRandomValues()` для генерации криптографически безопасных случайных чисел
- **Инициализационные векторы**: Необходимо использовать уникальные IV для каждого шифрования

> [!warning]
> Не храните криптографические ключи в открытом виде в localStorage или sessionStorage, так как это может привести к их компрометации.

## Ограничения и подводные камни

### Ограничения API
- Недоступен на небезопасных соединениях (не HTTPS)
- Некоторые алгоритмы могут не поддерживаться в определенных браузерах
- Ограниченная поддержка в старых браузерах

### Подводные камни
- Не все алгоритмы поддерживают все операции
- Некорректное использование IV может привести к уязвимостям
- Экспорт ключей возможен только при определенных условиях

## Сравнение с другими библиотеками

Web Crypto API отличается от сторонних криптографических библиотек следующими аспектами:

| Характеристика | Web Crypto API | Сторонние библиотеки (CryptoJS и др.) |
|---|---|---|
| Производительность | Высокая (реализация на уровне браузера) | Ниже (реализация на JavaScript) |
| Безопасность | Высокая (ключи не извлекаются в открытом виде) | Ниже (ключи могут быть доступны в памяти) |
| Поддержка | Ограниченная (только современные браузеры) | Широкая (поддержка старых браузеров) |
| Размер | Нет (встроено в браузер) | Дополнительный размер пакета |

## Практические сценарии

### Защита конфиденциальных данных в браузере

Web Crypto API идеально подходит для шифрования чувствительных данных, хранящихся в браузере, таких как персональная информация или токены аутентификации.

### Безопасный обмен данными

API может использоваться для шифрования данных перед отправкой на сервер, обеспечивая конфиденциальность даже при компрометации канала связи.

### Цифровая подпись документов

С помощью Web Crypto API можно реализовать функциональность цифровой подписи документов непосредственно в браузере без необходимости отправки данных на сервер.

## Лучшие практики

1. **Используйте безопасные алгоритмы**: Предпочтительно использовать AES-GCM для симметричного шифрования и RSA с длиной ключа 2048 бит или более
2. **Генерируйте уникальные IV**: Для каждого шифрования используйте новый случайный инициализационный вектор
3. **Не экспортируйте ключи без необходимости**: Экспорт ключей увеличивает риск их компрометации
4. **Проверяйте поддержку браузером**: Перед использованием API проверяйте его доступность
5. **Используйте HTTPS**: Всегда используйте защищенное соединение при работе с криптографическими функциями

## Тестирование криптографических функций

При тестировании криптографических функций важно учитывать:

- Тестирование на различных браузерах
- Проверка корректности шифрования и расшифровки
- Тестирование производительности
- Проверка безопасности (например, устойчивость к атакам по времени)

Для тестирования можно использовать специализированные библиотеки, такие как [[Jest]] или [[Mocha]], адаптированные для тестирования асинхронных криптографических операций.

## Ссылки на связанные файлы

- [[Клиентская криптография]]
- [[Алгоритмы шифрования]]
- [[HTTPS и безопасность]]
- [[JWT токены]]
- [[Аутентификация в веб-приложениях]]
- [[Защита данных в браузере]]
- [[Безопасность веб-приложений]]
- [[Криптографические атаки]]
- [[Регулярные выражения для безопасности]]
- [[CSP (Content Security Policy)]]
- [[XSS-защита]]
- [[CSRF-защита]]
- [[Хеширование паролей]]
- [[Сессии и куки]]
- [[OAuth 2.0]]

## Заключение

Web Crypto API предоставляет мощный и безопасный способ выполнения криптографических операций в браузере. При правильном использовании он может значительно повысить безопасность веб-приложений за счет шифрования данных на стороне клиента, генерации ключей и создания цифровых подписей без передачи конфиденциальной информации на сервер.

Однако при работе с API важно учитывать его ограничения и следовать лучшим практикам безопасности, чтобы избежать потенциальных уязвимостей.