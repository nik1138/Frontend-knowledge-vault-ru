---
aliases: ["Input Sanitization", "Санитизация ввода", "Очистка пользовательского ввода"]
tags: [security, input-sanitization, data-validation, web-security]
---

# Санитизация ввода

## Обзор

Санитизация ввода - это процесс очистки пользовательских данных от потенциально опасного содержимого перед их обработкой, хранением или отображением в приложении. Это критически важный аспект безопасности веб-приложений, который помогает предотвратить такие уязвимости, как межсайтовый скриптинг (XSS), SQL-инъекции, внедрение команд и другие.

## Зачем нужна санитизация ввода

### Основные угрозы

1. **XSS (Cross-Site Scripting)**: Внедрение вредоносного JavaScript-кода
2. **SQL-инъекции**: Внедрение SQL-кода в запросы к базе данных
3. **Command injection**: Выполнение системных команд через пользовательский ввод
4. **Path traversal**: Доступ к файлам за пределами разрешенной директории
5. **HTML-инъекции**: Внедрение вредоносного HTML-кода

### Принципы санитизации

- **Белый список**: Разрешение только известных безопасных значений
- **Контекстно-зависимая обработка**: Разные методы для разных случаев использования
- **Многоуровневая защита**: Комбинация валидации, санитизации и кодирования
- **Проверка на границах**: Санитизация данных на входе в систему

## Методы санитизации ввода

### 1. Экранирование (Escaping)

Преобразование специальных символов в безопасные эквиваленты:

```javascript
// Функция экранирования HTML
function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;',
    '/': '&#x2F;',
    '`': '&#x60;',
    '=': '&#x3D;'
  };

  return text.replace(/[&<>"'`=\/]/g, m => map[m]);
}

// Пример использования
const userInput = '<script>alert("XSS")</script>';
const safeOutput = escapeHtml(userInput);
console.log(safeOutput); // &lt;script&gt;alert(&quot;XSS&quot;)&lt;&#x2F;script&gt;
```

### 2. Санитизация HTML

Удаление или преобразование потенциально опасных HTML-тегов и атрибутов:

```javascript
// Пример санитизации HTML с использованием DOMPurify
const DOMPurify = require('dompurify');
const { JSDOM } = require('jsdom');

// Настройка DOMPurify
const window = new JSDOM('').window;
const purify = DOMPurify(window);

// Санитизация с ограничениями
const cleanHtml = purify.sanitize(userInput, {
  ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'ul', 'ol', 'li'],
  ALLOWED_ATTR: ['class', 'style'],
  FORBID_TAGS: ['script', 'iframe', 'object'],
  FORBID_ATTR: ['src', 'href', 'on*'] // запретить все атрибуты, начинающиеся с 'on'
});

console.log(cleanHtml);
```

### 3. Параметризованные запросы

Использование параметров вместо конкатенации строк в SQL-запросах:

```javascript
// НЕБЕЗОПАСНО - уяз