---
aliases: [Тестирование SRI, Проверка целостности ресурсов]
tags: 
  - security
  - sri
  - testing
  - web-security
  - integrity-check
---

# Тестирование Subresource Integrity (SRI)

## 1. Введение в тестирование SRI

Subresource Integrity (SRI) - это важная функция безопасности веб-браузеров, позволяющая проверять целостность загружаемых внешних ресурсов, таких как JavaScript и CSS файлы. Тестирование SRI включает в себя проверку корректности работы механизма целостности ресурсов, чтобы убедиться, что браузер отклоняет измененные или поддельные ресурсы.

Тестирование SRI важно для обеспечения того, что реализация соответствует стандартам и надежно защищает от потенциальных атак, связанных с подменой ресурсов. Это включает как ручные, так и автоматизированные проверки различных сценариев использования.

## 2. Зачем тестировать SRI

Тестирование SRI необходимо по нескольким важным причинам:

- **Обнаружение уязвимостей**: Проверка помогает выявить потенциальные слабые места в реализации целостности ресурсов.
- **Проверка соответствия стандартам**: Убедиться, что реализация соответствует спецификации W3C SRI.
- **Проверка совместимости**: Проверить, как различные браузеры обрабатывают SRI хэши.
- **Предотвращение атак**: Убедиться, что система надежно защищает от атак типа "man-in-the-middle" и подмены ресурсов.
- **Контроль целостности**: Подтвердить, что измененные ресурсы действительно блокируются браузером.

Тестирование SRI также помогает убедиться, что приложение продолжает работать корректно даже при сбоях загрузки ресурсов из-за проверок целостности.

## 3. Типы тестов для SRI

Существует несколько типов тестов, которые применяются для проверки SRI:

- **Функциональные тесты**: Проверяют, что SRI работает корректно при нормальных условиях.
- **Тесты на отказ**: Проверяют, что браузер корректно отклоняет ресурсы с неправильными хэшами.
- **Тесты совместимости**: Проверяют работу SRI в различных браузерах.
- **Тесты производительности**: Оценивают влияние SRI на время загрузки страницы.
- **Интеграционные тесты**: Проверяют работу SRI в контексте всего приложения.

Каждый тип теста решает свои специфические задачи и помогает обеспечить надежность механизма целостности ресурсов.

## 4. Ручное тестирование

Ручное тестирование SRI включает в себя:

- Проверку наличия атрибутов `integrity` и `crossorigin` в тегах `<script>` и `<link>`.
- Проверку корректности формата хэшей (должны быть в формате `sha256-`, `sha384-` или `sha512-`).
- Проверку поведения браузера при загрузке ресурсов с правильными и неправильными хэшами.
- Проверку консоли браузера на наличие ошибок SRI.
- Проверку отображения страницы при блокировке ресурса из-за несоответствия хэша.

Ручное тестирование особенно важно при первоначальной настройке SRI и при отладке проблем с конкретными ресурсами.

## 5. Автоматизированное тестирование

Автоматизированное тестирование SRI может включать:

- Проверку наличия атрибутов SRI в HTML-коде с помощью скриптов.
- Автоматическую генерацию хэшей для ресурсов и проверку их соответствия.
- Тестирование в различных браузерах с использованием Selenium или Puppeteer.
- Проверку отсутствия ошибок SRI в логах браузера.
- Интеграцию с CI/CD процессами для регулярной проверки SRI.

Автоматизированные тесты позволяют быстро выявлять проблемы при изменении ресурсов и обеспечивают постоянный контроль за целостностью.

## 6. Инструменты для тестирования SRI

Для тестирования SRI доступны следующие инструменты:

- **Browser DevTools**: Позволяют проверить наличие атрибутов SRI и ошибки в консоли.
- **SRI Hash Generator**: Инструменты для генерации хэшей ресурсов.
- **Selenium/Puppeteer**: Для автоматизированного тестирования в браузерах.
- **Lighthouse**: Может проверять наличие SRI для ресурсов.
- **Security Scanners**: Инструменты безопасности, проверяющие использование SRI.

Эти инструменты помогают как при ручной проверке, так и при автоматизации процесса тестирования.

## 7. Примеры тестов

Вот примеры тестов для проверки SRI:

### Тест на наличие атрибута integrity
```javascript
const scripts = document.querySelectorAll('script[src]');
scripts.forEach(script => {
  if (!script.hasAttribute('integrity')) {
    console.error('Script without integrity attribute:', script.src);
  }
});
```

### Тест на корректность хэша (псевдокод)
```javascript
// Проверка соответствия хэша содержимому файла
const expectedHash = 'sha384-...';
const actualHash = calculateHash(resourceContent);
if (expectedHash !== actualHash) {
  console.error('SRI hash mismatch');
}
```

Эти примеры показывают, как можно программно проверить правильность реализации SRI.

## 8. Обнаружение проблем с SRI

Для обнаружения проблем с SRI можно использовать:

- Проверку консоли браузера на наличие ошибок типа "Failed to find a valid digest in the 'integrity' attribute".
- Мониторинг отказов загрузки ресурсов.
- Сравнение хэшей ресурсов с эталонными значениями.
- Проверку корректности формата атрибутов SRI.
- Анализ логов сервера на предмет запросов с подозрительным поведением.

Регулярное обнаружение проблем позволяет быстро реагировать на потенциальные угрозы безопасности.

## 9. Анализ ошибок SRI

Частые ошибки SRI включают:

- **Неправильный формат хэша**: Хэш не соответствует формату `sha256-`, `sha384-` или `sha512-`.
- **Несоответствие содержимого**: Хэш не соответствует фактическому содержимому ресурса.
- **Отсутствие атрибута crossorigin**: Для CORS-ресурсов требуется атрибут `crossorigin`.
- **Истечение срока действия хэша**: При изменении ресурса хэш должен обновляться.

Анализ этих ошибок помогает улучшить реализацию SRI и избежать проблем в будущем.

## 10. Мониторинг SRI в продакшене

Мониторинг SRI в продакшене включает:

- Отслеживание ошибок SRI в системах логирования.
- Мониторинг отказов загрузки ресурсов.
- Проверку соответствия хэшей ресурсов эталонным значениям.
- Анализ влияния SRI на производительность.
- Оповещения о сбоях проверки целостности.

Эффективный мониторинг позволяет быстро реагировать на проблемы и поддерживать высокий уровень безопасности.

## 11. Лучшие практики тестирования

Лучшие практики тестирования SRI включают:

- Регулярное обновление хэшей при изменении ресурсов.
- Использование безопасных алгоритмов хэширования (SHA-256 и выше).
- Тестирование в разных браузерах и версиях.
- Интеграция проверок SRI в процесс CI/CD.
- Документирование процедур тестирования.

Следование этим практикам помогает обеспечить надежную защиту с помощью SRI.

## 12. Возможные ложные срабатывания

Возможные ложные срабатывания при тестировании SRI:

- **Прокси-серверы**: Некоторые прокси могут изменять содержимое ресурсов, вызывая ошибки SRI.
- **Компрессия**: Алгоритмы сжатия могут изменять содержимое, влияя на хэш.
- **Кэширование**: Старые версии ресурсов могут сохраняться в кэше.
- **CDN особенности**: Некоторые CDN могут изменять содержимое ресурсов.

Понимание этих факторов помогает избежать ложных срабатываний и правильно интерпретировать результаты тестирования.

## 13. Отладка SRI

Для отладки SRI рекомендуется:

- Проверить консоль браузера на наличие ошибок SRI.
- Убедиться, что хэши сгенерированы правильно для несжатого содержимого.
- Проверить, что атрибут `crossorigin` указан при необходимости.
- Использовать DevTools для проверки заголовков запросов и ответов.
- Сравнить содержимое ресурса с эталонным.

Отладка SRI требует внимательного анализа всех аспектов загрузки ресурсов.

## 14. Ссылки на другие связанные файлы

- [[SRI-безопасность]] - Основы безопасности с использованием SRI
- [[Генерация-хэшей-SRI]] - Как генерировать хэши для SRI
- [[Реализация-SRI]] - Практическое внедрение SRI
- [[Проверка-целостности-ресурсов]] - Общие принципы проверки целостности
- [[Web-Security-Basics]] - Основы веб-безопасности
- [[Content-Security-Policy]] - Политика безопасности контента
- [[Cross-Origin-Resource-Sharing]] - Совместное использование ресурсов между источниками
- [[HTTPS-и-безопасность]] - Роль HTTPS в безопасности веб-приложений
- [[Frontend-Security]] - Безопасность на стороне клиента
- [[Security-Testing-Tools]] - Инструменты для тестирования безопасности

## 15. Использование формата Obsidian

Этот файл использует формат Obsidian для лучшей организации знаний:

- Заголовки разного уровня для структурирования информации
- Внутренние ссылки для навигации по базе знаний
- Теги для категоризации и поиска
- Блоки кода для примеров
- Выделение важной информации с помощью форматирования

Формат Obsidian позволяет эффективно управлять знаниями о тестировании SRI и легко находить нужную информацию.
