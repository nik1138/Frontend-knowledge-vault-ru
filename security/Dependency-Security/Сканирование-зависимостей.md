---
aliases: ["Dependency Scanning", "Сканирование зависимостей", "Поиск уязвимостей в зависимостях"]
tags: [security, dependencies, scanning, vulnerabilities]
---

# Сканирование зависимостей

## Обзор

Сканирование зависимостей - это процесс проверки библиотек и пакетов, используемых в проекте, на наличие известных уязвимостей безопасности. Современные приложения полагаются на множество сторонних зависимостей, и каждая из них может содержать уязвимости, которые могут быть использованы злоумышленниками для компрометации системы.

## Почему важно сканирование зависимостей

### Статистика угроз

- Более 70% кода современных приложений состоит из сторонних зависимостей
- Уязвимости в зависимостях являются одной из основных причин инцидентов безопасности
- Злоумышленники активно сканируют публичные репозитории для поиска уязвимых зависимостей

### Типичные уязвимости

- Уязвимости в коде библиотек (например, XSS, SQL-инъекции)
- Уязвимости при аутентификации и авторизации
- Уязвимости в логике обработки данных
- Устаревшие библиотеки с известными проблемами

## Инструменты сканирования зависимостей

### npm audit

Для Node.js проектов:

```bash
# Проверка уязвимостей в зависимостях
npm audit

# Проверка с подробным выводом
npm audit --audit-level high

# Автоматическое исправление
npm audit fix

# Исправление с принудительным обновлением
npm audit fix --force
```

### OWASP Dependency-Check

Универсальный инструмент для сканирования зависимостей:

```bash
# Установка и запуск
dependency-check --project "My App" --scan /path/to/project --out /path/to/report

# Поддерживаемые форматы: Java, .NET, Node.js, Python, Ruby и другие
```

### Snyk

Платформа для поиска и устранения уязвимостей:

```bash
# Установка
npm install -g snyk

# Аутентификация
snyk auth

# Проверка проекта
snyk test

# Мониторинг проекта
snyk monitor
```

### WhiteSource

Коммерческое решение для управления безопасностью зависимостей:

- Интеграция с CI/CD
- Автоматическое сканирование
- Политики безопасности

## Интеграция в CI/CD

### GitHub Actions

```yaml
name: Security Scan
on: [push, pull_request]
jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: Install dependencies
        run: npm install
      - name: Run npm audit
        run: npm audit --audit-level high
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

### GitLab CI

```yaml
stages:
  - security

dependency_scanning:
  stage: security
  image: registry.gitlab.com/gitlab-org/security-products/dependency-scanning:latest
  script:
    - dependency-scanning
  artifacts:
    reports:
      dependency_scanning: gl-dependency-scanning-report.json
```

## Настройка автоматического сканирования

### package-lock.json и yarn.lock

Важно использовать lock-файлы для обеспечения воспроизводимости зависимостей:

```json
{
  "name": "my-app",
  "version": "1.0.0",
  "lockfileVersion": 2,
  "requires": true,
  "packages": {
    // Зависимости и их версии
  }
}
```

### Автоматическое обновление зависимостей

Использование Dependabot или Renovate Bot:

```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
    reviewers:
      - "security-team"
```

## Анализ результатов сканирования

### Классификация уязвимостей

- **Critical (Критические)**: Позволяют получить полный контроль над системой
- **High (Высокие)**: Позволяют получить значительный контроль или доступ к данным
- **Medium (Средние)**: Потенциальные проблемы, требующие внимания
- **Low (Низкие)**: Менее серьезные проблемы

### Оценка рисков

При анализе уязвимостей учитывайте:

- Степень экспозиции уязвимого кода
- Требуемые привилегии для эксплуатации
- Сложность эксплуатации
- Возможные последствия

## Управление уязвимостями

### Приоритизация исправлений

1. Критические уязвимости в публично доступных компонентах
2. Высокие уязвимости в основных библиотеках
3. Уязвимости, затрагивающие чувствительные данные
4. Все остальные уязвимости

### Временные меры

Когда невозможно немедленно исправить уязвимость:

- Ограничение доступа к затронутым компонентам
- Добавление дополнительных проверок безопасности
- Мониторинг использования уязвимого кода
- Использование патчей безопасности от поставщиков

## Практические примеры

### Проверка уязвимостей в Node.js проекте

```javascript
// package.json
{
  "name": "vulnerable-app",
  "dependencies": {
    "lodash": "4.17.11",  // Уязвимая версия
    "express": "4.16.3"   // Уязвимая версия
  }
}

// Проверка
npm audit
```

Результат:
```
┌───────────────┬──────────────────────────────────────────────────────────────┐
│ Critical      │ Prototype Pollution in lodash                                │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ Low           │ Regular Expression Denial of Service in debug                │
└───────────────┴──────────────────────────────────────────────────────────────┘
```

### Использование npm audit с CI

```javascript
// scripts/security-check.js
const { execSync } = require('child_process');
const fs = require('fs');

try {
  // Проверяем наличие package-lock.json
  if (!fs.existsSync('package-lock.json')) {
    console.error('package-lock.json не найден');
    process.exit(1);
  }

  // Выполняем npm audit
  const auditResult = execSync('npm audit --json', { encoding: 'utf-8' });
  const auditData = JSON.parse(auditResult);

  // Проверяем количество уязвимостей
  const vulnerabilities = auditData.audit.auditReportVersion ? 
    auditData.audit.vulnerabilities : 
    auditData.metadata.vulnerabilities;

  const totalVulns = vulnerabilities.total;
  const critical = vulnerabilities.critical || 0;
  const high = vulnerabilities.high || 0;

  console.log(`Найдено уязвимостей: ${totalVulns}`);
  console.log(`Критические: ${critical}`);
  console.log(`Высокие: ${high}`);

  // Если есть критические или высокие уязвимости - завершаем с ошибкой
  if (critical > 0 || high > 0) {
    console.error('Обнаружены критические или высокие уязвимости!');
    process.exit(1);
  }

  console.log('Безопасность в норме');
} catch (error) {
  console.error('Ошибка при проверке безопасности:', error.message);
  process.exit(1);
}
```

## Лучшие практики

### 1. Регулярное сканирование

- Интегрируйте сканирование в CI/CD
- Проверяйте зависимости при каждом коммите
- Используйте автоматические обновления с проверкой безопасности

### 2. Политики безопасности

- Определите допустимые уровни уязвимостей
- Установите сроки устранения уязвимостей
- Создайте процедуры для работы с уязвимостями в продакшене

### 3. Обновление зависимостей

- Используйте автоматические инструменты обновления
- Тестируйте совместимость после обновлений
- Поддерживайте зависимости в актуальном состоянии

### 4. Мониторинг новых уязвимостей

- Подпишитесь на уведомления от поставщиков
- Используйте инструменты мониторинга уязвимостей
- Регулярно перепроверяйте зависимости

## Заключение

Сканирование зависимостей - критически важный элемент безопасности современных приложений. Регулярное сканирование и оперативное устранение уязвимостей помогают предотвратить компрометацию систем и защитить данные пользователей.

## Связанные темы

- [[Управление-пакетами]]
- [[Инструменты-аудита-безопасности]]
- [[Оценка-уязвимостей]]
- [[Тестирование-безопасности]]