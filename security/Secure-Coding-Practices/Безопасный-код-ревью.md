---
aliases: [безопасное код-ревью, secure code review, безопасное ревью]
tags: [security, code-review, secure-coding, best-practices]
---

# Безопасное код-ревью

## Введение в безопасное код-ревью

Безопасное код-ревью (secure code review) — это процесс систематического анализа исходного кода с целью выявления уязвимостей безопасности, которые могут быть эксплуатированы злоумышленниками. В отличие от обычного код-ревью, которое фокусируется на стиле кода, производительности и функциональности, безопасное ревью направлено на поиск потенциальных уязвимостей, логических ошибок и недостатков архитектуры, которые могут привести к компрометации системы.

Безопасное ревью является важной частью процесса разработки программного обеспечения и помогает выявлять уязвимости на ранних стадиях, когда их исправление обходится дешевле, чем на более поздних этапах жизненного цикла разработки.

## Зачем нужно безопасное код-ревью

> [!important] Важность безопасного код-ревью
> Безопасное код-ревью позволяет предотвратить появление уязвимостей в продакшене и значительно снизить риски безопасности приложения.

Безопасное код-ревью необходимо по следующим причинам:

- **Раннее выявление уязвимостей** — позволяет обнаружить и устранить проблемы безопасности до попадания кода в продакшен
- **Снижение стоимости исправления** — уязвимости, найденные на стадии разработки, исправляются дешевле, чем после деплоя
- **Повышение осведомленности команды** — регулярное проведение безопасного ревью повышает уровень безопасности в команде разработки
- **Соответствие стандартам** — многие стандарты безопасности (например, OWASP, PCI DSS) требуют проведения безопасного код-ревью
- **Предотвращение атак** — позволяет заблокировать потенциальные векторы атак до их эксплуатации

## Отличие безопасного ревью от обычного

| Аспект | Обычное ревью | Безопасное ревью |
|--------|---------------|------------------|
| Цель | Проверка качества кода, стиля, производительности | Поиск уязвимостей и логических ошибок безопасности |
| Фокус | Функциональность, читаемость, архитектура | Уязвимости, входные данные, обработка ошибок |
| Инструменты | Ручная проверка, статические анализаторы | Специализированные сканеры, методологии, чек-листы |
| Участники | Разработчики, тимлиды | Безопасники, разработчики, аудиторы |

## Методологии безопасного код-ревью

### 1. OWASP Code Review Guide

Методология от Open Web Application Security Project, включающая:

- Проверку входных данных и валидацию
- Анализ обработки ошибок
- Проверку аутентификации и авторизации
- Оценку криптографических практик
- Анализ сессий и управления состоянием

### 2. SANS Secure Code Review Methodology

Структурированный подход, включающий:

- Планирование ревью
- Подготовку команды
- Систематическую проверку кода
- Документирование результатов
- Отслеживание исправлений

### 3. Microsoft SDL (Security Development Lifecycle)

Интеграция безопасного ревью в жизненный цикл разработки:

- Установка требований безопасности
- Проектирование с учетом безопасности
- Реализация безопасного кода
- Проверка безопасности
- Ответ на инциденты

## Чек-листы для безопасного ревью

### Валидация входных данных

- [ ] Проверка всех точек входа (параметры URL, тело запроса, заголовки)
- [ ] Использование белого списка разрешенных символов
- [ ] Проверка размера и типа данных
- [ ] Санитизация и эскейпинг данных перед использованием

### Управление аутентификацией

- [ ] Проверка надежности хэширования паролей (использование bcrypt, Argon2)
- [ ] Защита от brute-force атак (ограничение попыток)
- [ ] Правильная реализация сброса пароля
- [ ] Использование безопасных сессий

### Управление авторизацией

- [ ] Проверка прав доступа на каждом уровне (ACL, RBAC)
- [ ] Защита от привилегированных атак (horizontal/vertical privilege escalation)
- [ ] Правильная обработка ролей и разрешений
- [ ] Защита от CSRF-атак

### Обработка ошибок

- [ ] Отсутствие утечки информации в сообщениях об ошибках
- [ ] Логирование ошибок без чувствительных данных
- [ ] Правильная обработка исключений
- [ ] Защита от DoS-атак через ошибки

## Инструменты для автоматизации

### SAST (Static Application Security Testing)

- **SonarQube** — интеграция в CI/CD с поддержкой безопасности
- **Checkmarx** — коммерческое решение для анализа безопасности
- **Semgrep** — гибкий инструмент с кастомными правилами
- **Bandit** — для Python-приложений
- **ESLint с плагинами безопасности** — для JavaScript/TypeScript

### DAST (Dynamic Application Security Testing)

- **OWASP ZAP** — бесплатный инструмент для динамического анализа
- **Burp Suite** — профессиональный инструмент для тестирования безопасности
- **Netsparker** — автоматизированный сканер уязвимостей

### IAST (Interactive Application Security Testing)

- **Contrast Security** — инструмент, работающий в runtime
- **Synopsys Seeker** — интерактивный анализ безопасности

## Ручные методы проверки

### Анализ потоков данных

- Отслеживание передачи данных от входных точек к чувствительным функциям
- Проверка на наличие недостаточной валидации
- Поиск потенциальных XSS, SQL-инъекций, command injection

### Проверка бизнес-логики

- Анализ логических ошибок в приложении
- Проверка на bypass аутентификации/авторизации
- Тестирование неожиданных последовательностей действий

### Криптографический анализ

- Проверка использования устаревших алгоритмов
- Анализ правильности генерации ключей
- Проверка хранения и передачи чувствительных данных

## Типичные уязвимости при ревью

### Injection (OWASP Top 10 #1)

```javascript
// НЕБЕЗОПАСНЫЙ КОД
const query = `SELECT * FROM users WHERE id = ${userId}`;
db.query(query);
```

```javascript
// БЕЗОПАСНЫЙ КОД
const query = 'SELECT * FROM users WHERE id = ?';
db.query(query, [userId]);
```

### Broken Authentication (OWASP Top 10 #2)

- Неправильная реализация сессий
- Отсутствие ограничений на попытки входа
- Хранение паролей в открытом виде

### Sensitive Data Exposure (OWASP Top 10 #3)

- Незашифрованное хранение паролей
- Передача чувствительных данных по HTTP
- Утечка информации в логах

### XML External Entities (OWASP Top 10 #4)

- Парсинг XML без ограничений
- Возможность XXE-атак

### Broken Access Control (OWASP Top 10 #5)

- Отсутствие проверки прав доступа
- Direct object references без проверки

## Практические примеры ревью

### Пример 1: SQL-инъекция

**Проблема**: Приложение использует конкатенацию строк для построения SQL-запросов

```python
def get_user_data(user_id):
    query = f"SELECT * FROM users WHERE id = {user_id}"
    return db.execute(query)
```

**Решение**: Использование параметризованных запросов

```python
def get_user_data(user_id):
    query = "SELECT * FROM users WHERE id = %s"
    return db.execute(query, (user_id,))
```

### Пример 2: XSS-уязвимость

**Проблема**: Вывод непроверенных данных на страницу

```html
<div>Привет, {{ user_input }}!</div>
```

**Решение**: Эскейпинг или санитизация данных

```html
<div>Привет, {{ escape(user_input) }}!</div>
```

## Оформление результатов ревью

### Структура отчета

1. **Общая информация**
   - Название проекта
   - Дата ревью
   - Участники
   - Версия приложения

2. **Найденные уязвимости**
   - Уровень критичности
   - Описание проблемы
   - Расположение в коде
   - Потенциальный вред
   - Рекомендации по исправлению

3. **Рекомендации**
   - Общие рекомендации по улучшению безопасности
   - План по устранению уязвимостей
   - Дополнительные проверки

### Шаблон уязвимости

```
ID: SEC-001
Критичность: Высокая
Категория: SQL Injection
Файл: src/database/users.js
Строка: 45
Описание: Возможность выполнения SQL-инъекции через параметр userId
Риск: Злоумышленник может получить доступ к базе данных
Рекомендация: Использовать подготовленные выражения (prepared statements)
```

## Интеграция в процесс разработки

### В CI/CD пайплайне

- Запуск SAST-инструментов при каждом коммите
- Блокировка сборки при критических уязвимостях
- Автоматическое создание задач в системе трекинга

### В процессе pull request

- Обязательное ревью безопасности для чувствительных изменений
- Использование ботов для автоматического анализа
- Проверка политик безопасности

### В процессе планирования

- Учет требований безопасности при планировании спринтов
- Оценка рисков для новых функций
- Планирование времени на безопасное ревью

## Обучение команды безопасному ревью

### Программы обучения

- Регулярные тренинги по безопасности
- OWASP Top 10 для разработчиков
- Практические задания и CTF

### Менторство

- Назначение безопасных менторов
- Регулярные ревью с фокусом на безопасность
- Совместное обучение на реальных примерах

### Ресурсы

- [[OWASP-Top-10]]
- [[Secure-Coding-Standards]]
- [[Security-Training-Materials]]

## Метрики и KPI для оценки

### Количество уязвимостей

- Обнаруженные уязвимости по критичности
- Время исправления уязвимостей
- Процент устраненных уязвимостей

### Процесс ревью

- Время на ревью кода
- Количество ревьюеров
- Покрытие кода безопасным ревью

### Образование

- Количество обученных разработчиков
- Уровень осведомленности о безопасности
- Частота безопасных практик в коде

## Лучшие практики

### Для ревьюеров

- Понимание архитектуры приложения
- Знание OWASP Top 10
- Использование чек-листов
- Проверка критических путей выполнения

### Для разработчиков

- Писать безопасный код с первого раза
- Проводить само-ревью перед коммитом
- Следовать принципу наименьших привилегий
- Использовать безопасные библиотеки и фреймворки

### Для команды

- Регулярное обучение безопасности
- Создание культуры безопасности
- Интеграция безопасности в процесс разработки
- Постоянное улучшение процессов

## Связанные материалы

- [[OWASP-Top-10]] — основные угрозы безопасности веб-приложений
- [[Secure-Coding-Standards]] — стандарты безопасного программирования
- [[Security-Checklists]] — чек-листы безопасности
- [[Threat-Modeling]] — моделирование угроз
- [[Security-Testing]] — методы тестирования безопасности
- [[Vulnerability-Management]] — управление уязвимостями
- [[Security-Architecture]] — безопасная архитектура приложений
- [[Security-Training-Materials]] — материалы для обучения безопасности
- [[Penetration-Testing]] — пентестирование приложений
- [[Security-Policies]] — политики безопасности в организации

## Теги

#security #code-review #secure-coding #best-practices #owasp #vulnerability #sast #dast