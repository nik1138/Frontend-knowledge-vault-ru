---
aliases: ["Предотвращение инъекций", "Injection Prevention", "Защита от инъекций"]
tags: [security, injection, prevention]
created: 2025-11-18
updated: 2025-11-18
---

# Предотвращение инъекций

Предотвращение инъекций - это комплекс мер и практик, направленных на защиту приложений от атак, при которых злоумышленник внедряет вредоносный код в приложение через входные данные.

## Введение

Инъекционные атаки являются одной из самых распространенных и опасных угроз для веб-приложений. Они происходят, когда приложение не проверяет или неправильно обрабатывает пользовательский ввод, позволяя внедрять вредоносный код, который затем выполняется системой.

## Типы инъекционных атак

### SQL-инъекции

Внедрение SQL-кода в запросы к базе данных:

- Изменение логики запросов
- Получение несанкционированного доступа к данным
- Удаление или изменение информации
- Обход аутентификации

### Командные инъекции

Внедрение команд операционной системы:

- Выполнение произвольных команд
- Получение контроля над системой
- Удаление файлов
- Установка вредоносного ПО

### Скриптовые инъекции (XSS)

Внедрение клиентских скриптов:

- Перехват сессий пользователей
- Перенаправление на вредоносные сайты
- Кража cookies и токенов
- Подделка действий пользователя

### Инъекции LDAP

Внедрение в запросы к LDAP:

- Обход аутентификации
- Получение конфиденциальной информации
- Изменение настроек каталога
- Атаки на систему аутентификации

## Принципы предотвращения

### Проверка входных данных

Самая важная мера защиты:

- Проверка типов данных
- Ограничение длины полей
- Проверка формата значений
- Белый список разрешенных символов

```javascript
// Пример валидации email
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

// Пример проверки числового значения
function validateId(id) {
  if (!Number.isInteger(Number(id)) || Number(id) <= 0) {
    throw new Error('Invalid ID');
  }
  return Number(id);
}
```

### Использование параметризованных запросов

Для защиты от SQL-инъекций:

```javascript
// Плохо: конкатенация строк
const query = `SELECT * FROM users WHERE id = ${userId}`;

// Хорошо: параметризованный запрос
const query = 'SELECT * FROM users WHERE id = ?';
db.query(query, [userId]);
```

### Санитизация вывода

Очистка данных перед отображением:

- Экранирование специальных символов
- Использование HTML-сущностей
- Проверка содержимого перед отображением

## Лучшие практики

### Проверка и фильтрация данных

#### Белый список

Разрешать только известные безопасные значения:

```javascript
// Пример белого списка для типа контента
const allowedContentTypes = ['text', 'image', 'document'];
if (!allowedContentTypes.includes(contentType)) {
  throw new Error('Invalid content type');
}
```

#### Черный список

Блокировать известные опасные паттерны:

```javascript
// Пример черного списка для SQL-инъекций
const sqlInjectionPatterns = [
  /(\b(union|select|insert|delete|update|drop|create|alter)\b)/gi,
  /(;|--|\/\*|\*\/|xp_|sp_|exec|execute)/gi
];

function hasSqlInjection(input) {
  return sqlInjectionPatterns.some(pattern => pattern.test(input));
}
```

### Правила обработки ошибок

- Не раскрывать информацию о внутренней структуре
- Использовать общие сообщения об ошибках
- Вести логи ошибок для анализа
- [[Анализ-логов]] для выявления атак

### Ограничение привилегий

- Использовать учетные записи с минимальными правами
- Разделение ролей для разных компонентов
- Ограничение доступа к системным ресурсам
- [[Управление-доступом]] на основе ролей

## Методы защиты

### Валидация на стороне сервера

- Обязательная проверка всех входных данных
- Независимо от клиентской валидации
- Использование строгих схем данных
- Проверка типа, формата и диапазона значений

### Экранирование специальных символов

Преобразование потенциально опасных символов:

```javascript
// Экранирование HTML-символов
function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}
```

### Использование ORM и безопасных API

- Использование объектно-реляционного отображения
- Применение безопасных методов доступа к данным
- Избегание прямых SQL-запросов
- Использование встроенных механизмов безопасности

## Инструменты и технологии

### Web Application Firewalls (WAF)

Системы фильтрации запросов:

- Блокировка известных паттернов атак
- Анализ трафика в реальном времени
- Автоматическое обновление правил
- Интеграция с [[Сигнализация-безопасности]]

### Статический анализ кода

Инструменты для обнаружения уязвимостей:

- SonarQube
- ESLint с плагинами безопасности
- Bandit (для Python)
- Find Security Bugs (для Java)

### Проверка безопасности на этапе разработки

- Code review с акцентом на безопасность
- Автоматизированные сканировщики
- Тестирование на проникновение
- [[Анализ-логов]] во время тестирования

## Обнаружение инъекций

### Мониторинг аномального поведения

- Необычные шаблоны запросов
- Повторяющиеся ошибки базы данных
- Подозрительные строки в логах
- [[Инструменты-мониторинга-безопасности]]

### Анализ логов

Отслеживание потенциальных инъекций:

```bash
# Поиск потенциальных SQL-инъекций в логах
grep -E "(union|select|insert|drop|exec)" /var/log/app.log
```

## Тестирование на уязвимости

### Автоматизированные сканеры

- OWASP ZAP
- Burp Suite
- Nikto
- SQLMap (для тестирования SQL-инъекций)

### Ручное тестирование

- Тестирование с использованием специальных символов
- Проверка обработки неожиданных входных данных
- Тестирование граничных значений
- Проверка обработки ошибок

## Примеры защиты

### Защита от SQL-инъекций

```javascript
// Использование подготовленных выражений
const getUserById = async (userId) => {
  // Проверка типа и диапазона
  if (!Number.isInteger(userId) || userId <= 0) {
    throw new Error('Invalid user ID');
  }
  
  // Подготовленный запрос
  const query = 'SELECT id, name, email FROM users WHERE id = ?';
  const result = await db.execute(query, [userId]);
  
  return result;
};
```

### Защита от командных инъекций

```javascript
const { spawn } = require('child_process');

// Небезопасно
// const ls = spawn('sh', ['-c', `ls ${userInput}`]);

// Безопасно
const ls = spawn('ls', [userInput]); // Только один аргумент
```

### Защита от XSS

```javascript
// Небезопасно
// res.send(`<h1>Welcome, ${username}!</h1>`);

// Безопасно
const escapedUsername = escapeHtml(username);
res.send(`<h1>Welcome, ${escapedUsername}!</h1>`);
```

> [!tip] Совет
> Используйте систему типов и схемы данных для автоматической валидации входных параметров.

> [!warning] Важно
> Никогда не доверяйте пользовательскому вводу. Всегда проверяйте и фильтруйте данные.

## Заключение

Предотвращение инъекций требует комплексного подхода, включающего валидацию входных данных, использование безопасных методов программирования и регулярное тестирование приложений. Только сочетание всех мер может обеспечить эффективную защиту от инъекционных атак.