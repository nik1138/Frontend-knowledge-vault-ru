---
aliases: ["Безопасность манифеста кэша", "Cache Manifest Security"]
tags: [security, caching, web-security, html5, manifest]
---

# Безопасность манифеста кэша

Манифест кэша (Cache Manifest) - это механизм HTML5, позволяющий разработчикам определять ресурсы, которые должны быть доступны оффлайн. Несмотря на то, что этот API устарел в пользу Service Workers, понимание его безопасности важно для поддержки существующих приложений и исторического контекста.

## Введение в манифест кэша

Манифест кэша - это текстовый файл, который указывает браузеру, какие файлы должны быть закэшированы для оффлайн использования. Он используется с помощью атрибута `manifest` в теге `<html>`:

```html
<html manifest="cache.manifest">
```

Файл манифеста имеет следующую структуру:

```
CACHE MANIFEST
# Версия 1.0

CACHE:
/styles/main.css
/scripts/app.js
/images/logo.png

NETWORK:
/api/user/profile
/login

FALLBACK:
/ /offline.html
```

Хотя этот механизм устарел и заменен Service Workers, он все еще используется в некоторых приложениях и создает определенные риски безопасности.

## Основные риски безопасности манифеста кэша

### Утечка конфиденциальной информации

Одним из самых серьезных рисков является возможность кэширования конфиденциальных данных. Если в манифест включены страницы или ресурсы, содержащие личную информацию пользователя, эта информация может остаться на устройстве пользователя даже после выхода из системы.

### Атаки подмены кэша (Cache Poisoning)

Злоумышленник может попытаться изменить манифест кэша, чтобы подставить вредоносные ресурсы. Поскольку кэш обновляется только при изменении содержимого манифеста, вредоносные ресурсы могут оставаться закэшированными долгое время.

### Персистентность угроз

Кэшированные вредоносные ресурсы могут оставаться на устройстве пользователя до тех пор, пока не будет обновлен манифест или пользователь не очистит кэш вручную. Это делает манифест кэша потенциальным вектором для персистентных атак.

### Ограничения управления кэшем

В отличие от Service Workers, манифест кэша предоставляет ограниченные возможности для управления кэшем программно, что затрудняет реализацию сложных политик безопасности.

## Безопасные практики использования манифеста кэша

### 1. Не включать конфиденциальные данные

Никогда не включайте в манифест кэша ресурсы, содержащие конфиденциальную информацию:

```
# НЕПРАВИЛЬНО
CACHE MANIFEST

CACHE:
/profile.html
/user-data.json
/private-messages.html

# ПРАВИЛЬНО
CACHE MANIFEST

CACHE:
/index.html
/styles/main.css
/scripts/app.js
/images/logo.png

NETWORK:
/profile.html
/user-data.json
/private-messages.html
```

### 2. Использование секции NETWORK для динамического контента

Помещайте динамический и конфиденциальный контент в секцию `NETWORK`, чтобы он всегда загружался с сервера:

```
CACHE MANIFEST

CACHE:
/static-content.html
/public-data.json

NETWORK:
/api/user/profile
/api/messages
/login
/logout
```

### 3. Правильное использование секции FALLBACK

Секция `FALLBACK` должна использоваться осторожно, чтобы не кэшировать чувствительные страницы:

```
CACHE MANIFEST

CACHE:
/index.html
/styles/main.css

FALLBACK:
/ /offline.html
/api /api-offline.html
```

### 4. Контроль версий манифеста

Для принудительного обновления кэша изменяйте комментарии в манифесте:

```
CACHE MANIFEST
# Версия 1.2.3

CACHE:
/styles/main.css
/scripts/app.js
```

## Пример безопасного манифеста кэша

Вот пример безопасного манифеста кэша, следующего лучшим практикам:

```
CACHE MANIFEST
# Безопасный манифест кэша версии 2.1.0
# Обновлено: 2023-11-18

CACHE:
/index.html
/styles/main.css
/scripts/main.js
/images/logo.png
/images/icon.png
/offline.html

NETWORK:
/api/
/user/
/login
/logout
/secure/

FALLBACK:
/ /offline.html
```

В этом примере:
- Статические ресурсы (CSS, JS, изображения) помещены в секцию `CACHE`
- Все API-запросы, пользовательские данные и аутентификация помещены в секцию `NETWORK`
- В секции `FALLBACK` определена страница для оффлайн режима

## Защита от атак

### Проверка целостности манифеста

Хотя манифест кэша не предоставляет встроенных механизмов проверки целостности, рекомендуется использовать HTTPS для доставки манифеста, чтобы предотвратить его подделку.

### Ограничение доступа к манифесту

Убедитесь, что манифест кэша не содержит информации, которая может быть использована для атак:

- Не включайте пути к административным панелям
- Не включайте пути к файлам конфигурации
- Не включайте пути к тестовым или отладочным ресурсам

### Мониторинг изменений манифеста

Регулярно проверяйте содержимое манифеста кэша на наличие несанкционированных изменений.

## Сравнение с Service Workers

| Особенность | Манифест кэша | Service Workers |
|-------------|---------------|-----------------|
| Безопасность | Ограниченная | Высокая |
| Контроль | Ограниченный | Полный |
| Гибкость | Низкая | Высокая |
| Совместимость | Широкая | Современные браузеры |
| Уязвимости | Высокий риск | Меньше рисков при правильной реализации |

Service Workers предоставляют гораздо более безопасный и гибкий способ управления кэшем, и рекомендуется использовать их вместо манифеста кэша.

## Миграция с манифеста кэша

Для приложений, все еще использующих манифест кэша, рекомендуется планировать миграцию на Service Workers:

1. Идентифицируйте все ресурсы, перечисленные в манифесте
2. Реализуйте эквивалентную функциональность с помощью Service Worker
3. Проверьте безопасность новой реализации
4. Удалите атрибут `manifest` из HTML
5. Удалите файл манифеста

## Совместимость с CSP

При использовании манифеста кэша учитывайте его взаимодействие с Content Security Policy:

- CSP может ограничивать загрузку ресурсов, указанных в манифесте
- Убедитесь, что политики CSP совместимы с кэшированными ресурсами

## Заключение

Хотя манифест кэша устарел, понимание его безопасности важно для поддержки существующих приложений. Основные принципы безопасности включают избегание кэширования конфиденциальных данных, правильное использование секций `NETWORK` и `FALLBACK`, а также планирование миграции на более современные и безопасные технологии, такие как Service Workers.

Для новых приложений настоятельно рекомендуется использовать Service Workers вместо манифеста кэша из-за более высокого уровня безопасности и гибкости.

Для дальнейшего изучения рекомендуется ознакомиться с [[Кэширование-в-сервис-воркерах]], [[Политики-безопасности-кэширования]] и [[Безопасность-HTTP-кэширования]].

## См. также

- [[Кэширование-в-сервис-воркерах]]
- [[Политики-безопасности-кэширования]]
- [[Безопасность-HTTP-кэширования]]
- [[Service Workers]]
- [[Content Security Policy]]

#security #caching #web-security #html5 #manifest