---
aliases: ["Фронтенд аналитика", "Пользовательская аналитика", "Аналитика веб-приложений"]
tags: [analytics, frontend, monitoring, user-behavior, business-intelligence]
---

# Аналитика фронтенд-приложений

## Общее понимание

Аналитика фронтенд-приложений представляет собой процесс сбора, обработки и анализа данных о поведении пользователей, использовании функций приложения и бизнес-метриках. В условиях российских реалий 2025 года, аналитика должна учитывать как международные практики, так и требования локального законодательства и отказ от зарубежных сервисов.

## Типы аналитики

### 1. Поведенческая аналитика

#### Пользовательские пути
- Пути пользователей по приложению
- Часто посещаемые страницы
- Точки выхода
- Сессионная активность

#### Взаимодействие с интерфейсом
- Клик-аналитика
- Heatmap взаимодействий
- Время на элементах
- Прокрутка и вовлеченность

#### Конверсионная аналитика
- Воронки конверсии
- Потери на этапах
- Время до конверсии
- Повторные конверсии

### 2. Бизнес-аналитика

#### Метрики роста
- Количество новых пользователей
- Удержание пользователей
- Частота использования
- Время сессии

#### Доходная аналитика
- Конверсии в покупки
- Средний чек
- Lifetime Value (LTV)
- Customer Acquisition Cost (CAC)

#### Метрики продукта
- Использование функций
- Частота использования функций
- Отзывы пользователей
- Удовлетворенность пользователей

### 3. Техническая аналитика

#### Производительность
- Влияние производительности на поведение
- Связь метрик производительности с конверсиями
- Региональные различия в производительности

#### Совместимость
- Использование различных браузеров
- Устройства пользователей
- Версии операционных систем
- Поддержка старых версий

## Архитектура аналитики

### 1. Сбор данных

#### Event-based tracking
```javascript
class AnalyticsTracker {
  constructor(config) {
    this.config = config;
    this.queue = [];
    this.batchSize = config.batchSize || 10;
    this.flushInterval = config.flushInterval || 5000;
    
    // Инициализация трекинга
    this.init();
  }

  init() {
    // Отслеживание основных событий
    this.trackPageView();
    this.trackClicks();
    this.trackScrollDepth();
    this.trackFormInteractions();
    
    // Регулярная отправка данных
    setInterval(() => this.flush(), this.flushInterval);
  }

  track(eventType, properties = {}) {
    const event = {
      type: eventType,
      timestamp: Date.now(),
      sessionId: this.getSessionId(),
      userId: this.getUserId(),
      url: window.location.href,
      referrer: document.referrer,
      userAgent: navigator.userAgent,
      ...properties
    };

    this.queue.push(event);
    
    if (this.queue.length >= this.batchSize) {
      this.flush();
    }
  }

  trackPageView() {
    // Трекинг просмотра страницы
    this.track('page_view', {
      page: window.location.pathname,
      title: document.title
    });
    
    // Трекинг навигации
    window.addEventListener('popstate', () => {
      this.track('page_view', {
        page: window.location.pathname,
        title: document.title
      });
    });
  }

  trackClicks() {
    document.addEventListener('click', (event) => {
      const target = event.target;
      const elementInfo = {
        tagName: target.tagName,
        className: target.className,
        id: target.id,
        text: target.textContent?.substring(0, 100)
      };
      
      this.track('click', { element: elementInfo });
    });
  }

  trackScrollDepth() {
    let maxScroll = 0;
    const updateScroll = () => {
      const scrollPercent = Math.round(
        (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100
      );
      
      if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        
        // Отправляем события при достижении определенных порогов
        if ([25, 50, 75, 90].includes(scrollPercent)) {
          this.track('scroll_depth', { depth: scrollPercent });
        }
      }
    };
    
    window.addEventListener('scroll', updateScroll);
  }

  flush() {
    if (this.queue.length === 0) return;

    const batch = [...this.queue];
    this.queue = [];

    // Отправка батча данных
    this.sendBatch(batch);
  }

  sendBatch(batch) {
    // Используем sendBeacon для надежной отправки
    if (navigator.sendBeacon) {
      navigator.sendBeacon(
        this.config.endpoint,
        JSON.stringify({ events: batch })
      );
    } else {
      // Резервный метод
      fetch(this.config.endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ events: batch }),
        keepalive: true
      }).catch(err => console.error('Analytics error:', err));
    }
  }

  getSessionId() {
    if (!sessionStorage.getItem('sessionId')) {
      const sessionId = Math.random().toString(36).substring(2, 15) + 
                        Math.random().toString(36).substring(2, 15);
      sessionStorage.setItem('sessionId', sessionId);
    }
    return sessionStorage.getItem('sessionId');
  }

  getUserId() {
    return localStorage.getItem('userId') || null;
  }
}
```

### 2. Хранение данных

#### Архитектура хранилища

Для российских реалий 2025 года предпочтительны:
- ClickHouse для хранения событийной аналитики
- Elasticsearch для полнотекстового поиска по событиям
- PostgreSQL для хранения пользовательских профилей
- Внутренние решения вместо BigQuery, Redshift и т.д.

Пример структуры таблицы в ClickHouse:
```sql
CREATE TABLE user_events (
    event_id UUID DEFAULT generateUUIDv4(),
    event_type String,
    user_id Nullable(String),
    session_id String,
    timestamp DateTime,
    properties JSON,
    url String,
    referrer String,
    user_agent String,
    ip_address Nullable(IPv4),
    country_code Nullable(FixedString(2)),
    city Nullable(String),
    INDEX idx_timestamp timestamp TYPE minmax GRANULARITY 1,
    INDEX idx_event_type event_type TYPE bloom_filter GRANULARITY 1
) ENGINE = MergeTree()
ORDER BY (event_type, timestamp, user_id)
PARTITION BY toYYYYMM(timestamp);
```

### 3. Обработка и агрегация

#### Real-time processing
```javascript
class RealTimeProcessor {
  constructor() {
    this.aggregations = new Map();
    this.windows = new Map(); // для скользящих окон
  }

  processEvent(event) {
    // Агрегация в реальном времени
    this.updateCounters(event);
    this.detectAnomalies(event);
    this.updateUserJourney(event);
  }

  updateCounters(event) {
    const key = `${event.event_type}:${this.getTimeWindow()}`;
    const current = this.aggregations.get(key) || 0;
    this.aggregations.set(key, current + 1);
  }

  getTimeWindow() {
    // Окно в 1 минуту
    return Math.floor(Date.now() / 60000);
  }

  detectAnomalies(event) {
    // Простое обнаружение аномалий
    const eventType = event.event_type;
    const currentWindow = this.getTimeWindow();
    const previousWindow = currentWindow - 1;
    
    const currentCount = this.aggregations.get(`${eventType}:${currentWindow}`) || 0;
    const previousCount = this.aggregations.get(`${eventType}:${previousWindow}`) || 0;
    
    // Если текущее количество в 3 раза больше предыдущего
    if (previousCount > 0 && currentCount / previousCount > 3) {
      this.triggerAnomalyAlert(eventType, currentCount, previousCount);
    }
  }

  triggerAnomalyAlert(eventType, current, previous) {
    console.log(`Аномалия обнаружена: ${eventType}, ${current} vs ${previous}`);
    // Здесь может быть интеграция с системой алертинга
  }
}
```

## Инструменты аналитики

### 1. Кастомные решения

```javascript
class CustomAnalytics {
  constructor(config) {
    this.config = config;
    this.tracker = new AnalyticsTracker(config.tracking);
    this.processor = new RealTimeProcessor();
    this.storage = new AnalyticsStorage(config.storage);
  }

  trackEvent(name, properties = {}) {
    const event = {
      name,
      properties,
      timestamp: Date.now(),
      userId: this.getCurrentUserId(),
      sessionId: this.getCurrentSessionId()
    };

    // Локальная обработка
    this.processor.processEvent(event);
    
    // Отправка в хранилище
    this.tracker.track(name, properties);
  }

  identify(userId, traits = {}) {
    // Идентификация пользователя
    localStorage.setItem('userId', userId);
    
    this.trackEvent('$identify', {
      userId,
      traits
    });
  }

  page(category, name, properties = {}) {
    this.trackEvent('$page', {
      category,
      name,
      ...properties
    });
  }

  trackUserJourney(userId) {
    // Анализ пользовательского пути
    return this.storage.getUserJourney(userId);
  }

  getCurrentUserId() {
    return localStorage.getItem('userId');
  }

  getCurrentSessionId() {
    return sessionStorage.getItem('sessionId');
  }
}
```

### 2. Визуализация данных

#### Интеграция с Grafana
```javascript
// Пример запроса для Grafana
const grafanaQueries = {
  userActivity: `
    SELECT 
      toStartOfInterval(timestamp, INTERVAL 1 MINUTE) AS time,
      count(DISTINCT user_id) AS active_users
    FROM user_events 
    WHERE timestamp >= now() - INTERVAL 1 DAY
    GROUP BY time
    ORDER BY time
  `,
  
  conversionFunnel: `
    SELECT 
      step,
      count(*) AS users
    FROM (
      SELECT 
        user_id,
        CASE 
          WHEN event_type = 'page_view' THEN 1
          WHEN event_type = 'add_to_cart' THEN 2
          WHEN event_type = 'checkout_start' THEN 3
          WHEN event_type = 'purchase' THEN 4
        END AS step
      FROM user_events 
      WHERE timestamp >= now() - INTERVAL 1 DAY
        AND event_type IN ('page_view', 'add_to_cart', 'checkout_start', 'purchase')
    ) 
    WHERE step IS NOT NULL
    GROUP BY step
    ORDER BY step
  `
};
```

## Российские особенности 2025 года

### 1. Отказ от зарубежных решений

В 2025 году российские компании переходят от:
- Google Analytics → Российские аналитические решения
- Mixpanel/Pendo → Внутренние разработки
- Amplitude → Локальные решения на базе ClickHouse

### 2. Требования законодательства

- Соответствие 152-ФЗ "О персональных данных"
- Локальное хранение данных без передачи за границу
- Обезличивание данных пользователей
- Согласование с регуляторами при сборе данных

### 3. Инфраструктурные особенности

- Учет особенностей работы в сетях российских провайдеров
- Адаптация к возможным ограничениям на доступ к зарубежным сервисам
- Резервные системы аналитики

## Практические рекомендения

### 1. Снижение нагрузки на приложение

```javascript
class EfficientAnalytics {
  constructor(options = {}) {
    this.samplingRate = options.samplingRate || 1.0; // 100% по умолчанию
    this.debounceTime = options.debounceTime || 100;
    this.maxQueueSize = options.maxQueueSize || 1000;
    
    this.eventQueue = [];
    this.debouncedSend = this.debounce(() => this.flush(), this.debounceTime);
  }

  track(eventType, properties = {}) {
    // Сэмплирование
    if (Math.random() > this.samplingRate) {
      return;
    }

    const event = {
      type: eventType,
      timestamp: Date.now(),
      ...properties
    };

    this.eventQueue.push(event);
    
    if (this.eventQueue.length >= this.maxQueueSize) {
      this.flush();
    } else {
      this.debouncedSend();
    }
  }

  flush() {
    if (this.eventQueue.length === 0) return;

    const batch = [...this.eventQueue];
    this.eventQueue = [];

    // Отправка батча
    this.sendBatch(batch);
  }

  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  sendBatch(batch) {
    // Используем sendBeacon или fetch с keepalive
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics/track', JSON.stringify(batch));
    } else {
      fetch('/analytics/track', {
        method: 'POST',
        body: JSON.stringify(batch),
        keepalive: true
      }).catch(() => {
        // В случае ошибки, можно сохранить в IndexedDB для последующей отправки
        this.saveOffline(batch);
      });
    }
  }

  saveOffline(batch) {
    // Сохранение в IndexedDB для отправки позже
    if ('indexedDB' in window) {
      const request = indexedDB.open('AnalyticsDB', 1);
      
      request.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['events'], 'readwrite');
        const store = transaction.objectStore('events');
        
        batch.forEach(event => store.add(event));
      };
    }
  }
}
```

### 2. Защита конфиденциальности

```javascript
class PrivacyAwareAnalytics {
  constructor() {
    this.sensitiveFields = [
      'email', 'phone', 'name', 'address', 
      'credit_card', 'password', 'token'
    ];
  }

  sanitizeProperties(properties) {
    const sanitized = {};
    
    for (const [key, value] of Object.entries(properties)) {
      if (this.isSensitiveField(key)) {
        // Хешируем чувствительные поля
        sanitized[key] = this.hash(value);
      } else if (typeof value === 'string' && this.containsSensitiveData(value)) {
        sanitized[key] = this.redactSensitiveData(value);
      } else {
        sanitized[key] = value;
      }
    }
    
    return sanitized;
  }

  isSensitiveField(fieldName) {
    return this.sensitiveFields.some(sensitive => 
      fieldName.toLowerCase().includes(sensitive)
    );
  }

  containsSensitiveData(value) {
    // Проверяем, содержит ли строка потенциально чувствительные данные
    const patterns = [
      /\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/, // кредитные карты
      /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/, // email
      /\+\d{10,15}/ // телефоны
    ];
    
    return patterns.some(pattern => pattern.test(value));
  }

  redactSensitiveData(value) {
    // Заменяем чувствительные данные на маскированные
    return value
      .replace(/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g, '****-****-****-****')
      .replace(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g, '***@***.**')
      .replace(/\+(\d{1})(\d{3})(\d{3})(\d{2})(\d{2})/g, '+$1***$3**$5');
  }

  hash(value) {
    // Простое хеширование для чувствительных данных
    return btoa(encodeURIComponent(value)).substring(0, 16);
  }
}
```

### 3. A/B тестирование

```javascript
class ABTestAnalytics {
  constructor() {
    this.experiments = new Map();
    this.userAssignments = new Map();
  }

  createExperiment(name, variants, trafficAllocation = 1.0) {
    this.experiments.set(name, {
      name,
      variants,
      trafficAllocation,
      createdAt: new Date()
    });
  }

  assignUserToVariant(userId, experimentName) {
    const experiment = this.experiments.get(experimentName);
    if (!experiment) return null;

    // Проверяем, попадает ли пользователь в трафик эксперимента
    if (Math.random() > experiment.trafficAllocation) {
      return 'control'; // контрольная группа
    }

    // Проверяем, есть ли уже назначение
    const key = `${userId}:${experimentName}`;
    if (this.userAssignments.has(key)) {
      return this.userAssignments.get(key);
    }

    // Назначаем вариант на основе хеша пользователя
    const hash = this.simpleHash(userId + experimentName);
    const variantIndex = hash % experiment.variants.length;
    const variant = experiment.variants[variantIndex];

    this.userAssignments.set(key, variant);
    return variant;
  }

  simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash |= 0; // Преобразуем в 32-битное целое
    }
    return Math.abs(hash);
  }

  trackConversion(userId, experimentName, variant, success = true) {
    // Трекинг конверсии для A/B теста
    analytics.track('ab_test_conversion', {
      experiment: experimentName,
      variant,
      success,
      userId
    });
  }
}
```

## Заключение

Аналитика фронтенд-приложений в 2025 году требует особого внимания к требованиям безопасности и конфиденциальности данных, особенно в российском контексте. Важно строить гибкую систему аналитики, способную адаптироваться к изменяющимся требованиям законодательства и обеспечивать ценные инсайты для бизнеса без нарушения прав пользователей.

> [!tip] Совет
> Регулярно пересматривайте события, которые вы отслеживаете, удаляя неиспользуемые метрики и добавляя новые, более релевантные бизнес-целям.

> [!warning] Важно
> При сборе аналитических данных строго соблюдайте требования законодательства о защите персональных данных и не передавайте чувствительную информацию за границу.