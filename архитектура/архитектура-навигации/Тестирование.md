---
aliases: [Тестирование навигации, Тестирование маршрутов, Проверка навигации]
tags: [архитектура, навигация, фронтенд, тестирование, юнит-тесты, интеграционные-тесты, React, Vue, Angular, Jest, Cypress]
---

# Тестирование

## Введение в тестирование архитектуры навигации

Тестирование архитектуры навигации - это критически важный аспект разработки веб-приложений, который обеспечивает надежность, стабильность и корректную работу механизмов навигации. В контексте современных SPA-приложений тестирование навигации включает проверку маршрутов, защиты маршрутов, истории навигации и ленивой загрузки компонентов.

## Типы тестов для архитектуры навигации

### Юнит-тесты

Юнит-тесты проверяют отдельные компоненты навигации, такие как:
- Роут-компоненты
- Защитные компоненты (guards)
- Хуки навигации
- Вспомогательные функции

### Интеграционные тесты

Интеграционные тесты проверяют взаимодействие между различными частями системы навигации:
- Взаимодействие роутера с компонентами
- Работа защиты маршрутов в комплексе
- Корректность передачи параметров между маршрутами

### E2E (сквозные) тесты

E2E тесты проверяют полный пользовательский путь навигации:
- Переходы между страницами
- Работа кнопок "назад/вперед"
- Сохранение состояния при навигации
- Защита доступа к маршрутам

## Тестирование в популярных фреймворках

### React

#### Юнит-тестирование с Jest и React Testing Library

```jsx
// Тестирование защищенного маршрута
import { render, screen } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import { AuthProvider } from '../context/AuthContext';
import ProtectedRoute from '../components/ProtectedRoute';

// Mock хука аутентификации
jest.mock('../hooks/useAuth', () => ({
  useAuth: jest.fn()
}));

import { useAuth } from '../hooks/useAuth';

describe('ProtectedRoute', () => {
  test('рендерит дочерний компонент если пользователь аутентифицирован', () => {
    useAuth.mockReturnValue({ isAuthenticated: true });
    
    render(
      <MemoryRouter initialEntries={['/dashboard']}>
        <AuthProvider>
          <ProtectedRoute>
            <div>Дашборд</div>
          </ProtectedRoute>
        </AuthProvider>
      </MemoryRouter>
    );
    
    expect(screen.getByText('Дашборд')).toBeInTheDocument();
  });

  test('перенаправляет на /login если пользователь не аутентифицирован', () => {
    useAuth.mockReturnValue({ isAuthenticated: false });
    
    render(
      <MemoryRouter initialEntries={['/dashboard']}>
        <AuthProvider>
          <ProtectedRoute>
            <div>Дашборд</div>
          </ProtectedRoute>
        </AuthProvider>
      </MemoryRouter>
    );
    
    expect(screen.queryByText('Дашборд')).not.toBeInTheDocument();
    expect(window.location.pathname).toBe('/login');
  });
});

// Тестирование компонента навигации
import { fireEvent } from '@testing-library/react';

test('корректный переход по маршрутам', () => {
  render(
    <MemoryRouter initialEntries={['/']}>
      <App />
    </MemoryRouter>
  );
  
  fireEvent.click(screen.getByText('О нас'));
  expect(screen.getByText('Страница о нас')).toBeInTheDocument();
  
  fireEvent.click(screen.getByText('Контакты'));
  expect(screen.getByText('Контактная информация')).toBeInTheDocument();
});
```

#### E2E тестирование с Cypress

```javascript
// cypress/e2e/navigation.cy.js
describe('Навигация по приложению', () => {
  beforeEach(() => {
    cy.visit('/');
  });

  it('проверяет переход по основным маршрутам', () => {
    cy.get('nav a').contains('Главная').click();
    cy.url().should('include', '/');
    
    cy.get('nav a').contains('О нас').click();
    cy.url().should('include', '/about');
    cy.get('h1').should('contain', 'О нас');
    
    cy.get('nav a').contains('Контакты').click();
    cy.url().should('include', '/contact');
  });

  it('проверяет защиту маршрутов', () => {
    cy.visit('/dashboard');
    cy.url().should('include', '/login'); // Должен перенаправить на логин
    
    // Логинимся
    cy.get('[data-testid="email"]').type('user@example.com');
    cy.get('[data-testid="password"]').type('password');
    cy.get('button[type="submit"]').click();
    
    // Теперь должен иметь доступ к дашборду
    cy.visit('/dashboard');
    cy.url().should('include', '/dashboard');
    cy.get('[data-testid="dashboard"]').should('exist');
  });

  it('проверяет историю навигации', () => {
    cy.visit('/');
    cy.get('nav a').contains('О нас').click();
    cy.go('back');
    cy.url().should('include', '/');
  });
});
```

### Vue

#### Юнит-тестирование с Jest и Vue Test Utils

```javascript
// Тестирование компонента с роутингом
import { mount } from '@vue/test-utils';
import { createRouter, createWebHistory } from 'vue-router';
import { createTestingPinia } from '@pinia/testing';
import MyComponent from '@/components/MyComponent.vue';

const routes = [
  { path: '/', component: { template: '<div>Главная</div>' } },
  { path: '/about', component: { template: '<div>О нас</div>' } }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

describe('MyComponent', () => {
  test('корректно отображает текущий маршрут', async () => {
    router.push('/');
    await router.isReady();

    const wrapper = mount(MyComponent, {
      global: {
        plugins: [router, createTestingPinia()]
      }
    });

    expect(wrapper.text()).toContain('Главная');
  });

  test('выполняет навигацию при событии', async () => {
    router.push('/');
    await router.isReady();

    const wrapper = mount(MyComponent, {
      global: {
        plugins: [router, createTestingPinia()]
      }
    });

    await wrapper.find('[data-testid="nav-to-about"]').trigger('click');
    
    expect(router.currentRoute.value.path).toBe('/about');
  });
});

// Тестирование guard-а
import { mockNavigate } from '@/utils/test-helpers';

describe('AuthGuard', () => {
  test('разрешает доступ аутентифицированному пользователю', async () => {
    // Mock store
    const pinia = createTestingPinia({
      initialState: {
        auth: { isAuthenticated: true }
      }
    });

    const route = { path: '/protected' };
    const mockNext = jest.fn();

    await authGuard(route, null, mockNext);
    
    expect(mockNext).toHaveBeenCalledWith();
  });

  test('перенаправляет неаутентифицированного пользователя', async () => {
    const pinia = createTestingPinia({
      initialState: {
        auth: { isAuthenticated: false }
      }
    });

    const mockNext = jest.fn();

    await authGuard({ path: '/protected' }, null, mockNext);
    
    expect(mockNext).toHaveBeenCalledWith('/login');
  });
});
```

### Angular

#### Юнит-тестирование с Jasmine и Karma

```typescript
// Тестирование guard-а
import { TestBed } from '@angular/core/testing';
import { Router } from '@angular/router';
import { AuthGuard } from './auth.guard';
import { AuthService } from './auth.service';

describe('AuthGuard', () => {
  let guard: AuthGuard;
  let authService: jasmine.SpyObj<AuthService>;
  let router: jasmine.SpyObj<Router>;

  beforeEach(() => {
    const authSpy = jasmine.createSpyObj('AuthService', ['isAuthenticated']);
    const routerSpy = jasmine.createSpyObj('Router', ['navigate']);

    TestBed.configureTestingModule({
      providers: [
        AuthGuard,
        { provide: AuthService, useValue: authSpy },
        { provide: Router, useValue: routerSpy }
      ]
    });

    guard = TestBed.inject(AuthGuard);
    authService = TestBed.inject(AuthService) as jasmine.SpyObj<AuthService>;
    router = TestBed.inject(Router) as jasmine.SpyObj<Router>;
  });

  it('должен разрешить доступ если пользователь аутентифицирован', () => {
    authService.isAuthenticated.and.returnValue(true);
    
    const result = guard.canActivate();
    
    expect(result).toBe(true);
  });

  it('должен перенаправить на логин если пользователь не аутентифицирован', () => {
    authService.isAuthenticated.and.returnValue(false);
    
    const result = guard.canActivate();
    
    expect(result).toBe(false);
    expect(router.navigate).toHaveBeenCalledWith(['/login']);
  });
});

// Тестирование компонента с роутингом
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { Router } from '@angular/router';
import { Location } from '@angular/common';
import { AppComponent } from './app.component';

describe('AppComponent with routing', () => {
  let component: AppComponent;
  let fixture: ComponentFixture<AppComponent>;
  let router: Router;
  let location: Location;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [RouterTestingModule.withRoutes([
        { path: '', component: HomeComponent },
        { path: 'about', component: AboutComponent }
      ])],
      declarations: [AppComponent, HomeComponent, AboutComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(AppComponent);
    component = fixture.componentInstance;
    router = TestBed.inject(Router);
    location = TestBed.inject(Location);

    router.initialNavigation();
  });

  it('должен перейти на /about', async () => {
    router.navigate(['/about']);
    await fixture.whenStable();
    
    expect(location.path()).toBe('/about');
  });
});
```

## Тестирование истории навигации

### Тестирование с использованием MemoryRouter (React)

```jsx
import { render, screen } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import NavigationHistoryTest from './NavigationHistoryTest';

test('проверяет сохранение и восстановление состояния при навигации', () => {
  render(
    <MemoryRouter initialEntries={['/', { state: { testData: 'initial' } }]}>
      <NavigationHistoryTest />
    </MemoryRouter>
  );

  // Проверяем начальное состояние
  expect(screen.getByText('initial')).toBeInTheDocument();

  // Выполняем навигацию
  fireEvent.click(screen.getByText('Перейти к данным'));
  
  // Возвращаемся назад
  fireEvent.click(screen.getByText('Назад'));
  
  // Проверяем, что состояние восстановлено
  expect(screen.getByText('initial')).toBeInTheDocument();
});
```

### Тестирование истории в E2E

```javascript
// Cypress тест истории навигации
describe('История навигации', () => {
  it('сохраняет состояние при переходе назад', () => {
    cy.visit('/search');
    cy.get('[data-testid="search-input"]').type('поиск');
    cy.get('[data-testid="search-button"]').click();
    
    // Переход на страницу результатов
    cy.get('[data-testid="result-link"]').first().click();
    
    // Возврат назад должен восстановить состояние поиска
    cy.go('back');
    cy.get('[data-testid="search-input"]').should('have.value', 'поиск');
  });
});
```

## Тестирование ленивой загрузки

### Тестирование с Jest

```javascript
// Тестирование ленивой загрузки компонентов
import { render, waitFor } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import App from './App';

jest.mock('./components/Dashboard', () => ({
  __esModule: true,
  default: () => <div data-testid="dashboard">Дашборд</div>
}));

test('корректно загружает компонент при навигации', async () => {
  render(
    <MemoryRouter initialEntries={['/']}>
      <App />
    </MemoryRouter>
  );

  // Имитация навигации на маршрут с ленивой загрузкой
  const router = require('react-router-dom').useNavigate;
  router('/dashboard');

  // Проверяем, что компонент загружен
  await waitFor(() => {
    expect(screen.getByTestId('dashboard')).toBeInTheDocument();
  });
});
```

## Лучшие практики тестирования навигации

### Тестирование пользовательских сценариев

- Создавайте тесты, соответствующие реальным сценариям использования
- Проверяйте переходы, которые пользователи действительно совершают
- Учитывайте различные пути взаимодействия (мышь, клавиатура, сенсор)

### Тестирование защиты маршрутов

- Проверяйте все возможные сценарии аутентификации/авторизации
- Тестируйте поведение при истечении срока действия токенов
- Проверяйте доступ к маршрутам с разными ролями пользователей

### Тестирование производительности

- Измеряйте время загрузки маршрутов
- Проверяйте, что ленивая загрузка работает корректно
- Тестируйте поведение при медленном соединении

## Тестирование в российских условиях 2025 года

### Тестирование на отечественных браузерах

Важно тестировать навигацию в отечественных браузерах (Яндекс.Браузер, Mail.Ru Browser), так как они могут иметь особенности в реализации History API и других веб-технологий.

### Тестирование при ограниченной пропускной способности

Российские пользователи могут сталкиваться с ограничениями скорости интернета, особенно в регионах. Необходимо тестировать приложения при различных скоростях соединения.

### Тестирование соответствия требованиям

С учетом требований российского законодательства, важно тестировать защиту персональных данных в контексте навигации и истории.

### Использование отечественных инструментов тестирования

В условиях санкционных ограничений может потребоваться использование отечественных или альтернативных инструментов тестирования.

## Инструменты для тестирования навигации

### Jest + React Testing Library
- Отлично подходят для юнит-тестирования компонентов с роутингом
- Хорошая интеграция с React Router
- Поддержка асинхронных тестов

### Cypress
- Отличный выбор для E2E тестирования
- Хорошая поддержка навигации и истории браузера
- Возможность тестирования на разных браузерах

### Puppeteer
- Подходит для автоматизированного тестирования сценариев навигации
- Хорош для тестирования производительности
- Поддержка различных сценариев загрузки

## Заключение

Тестирование архитектуры навигации - это многоуровневый процесс, требующий подходов от юнит-тестов до сквозного тестирования. В российских условиях 2025 года особенно важно учитывать специфику отечественных браузеров, ограничения пропускной способности и требования к защите персональных данных. Правильное тестирование обеспечивает надежность и стабильность пользовательского опыта в веб-приложениях.

## См. также

- [[Роутинг]]
- [[История-навигации]]
- [[Защита-маршрутов]]
- [[Ленивая-загрузка]]
- [[SPA-архитектура]]
- [[Тестирование-компонентов]]

## Теги

#архитектура #навигация #фронтенд #тестирование #юнит-тесты #интеграционные-тесты #E2E #React #Vue #Angular #Jest #Cypress #2025 #Россия