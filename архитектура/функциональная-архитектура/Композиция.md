---
aliases: [Function Composition, Композиция функций, Композиция]
tags: [programming, functional-programming, javascript, frontend, architecture]
---

# Композиция

## Определение

**Композиция** — это процесс объединения простых функций для построения более сложных функций. В функциональном программировании композиция функций позволяет создавать сложную логику из простых, переиспользуемых компонентов.

## Принципы композиции

1. **Разделение ответственности**: каждая функция выполняет одну конкретную задачу
2. **Переиспользуемость**: простые функции можно использовать в различных комбинациях
3. **Предсказуемость**: результат композиции зависит только от результатов составляющих функций
4. **Модульность**: легкость замены или модификации отдельных компонентов

## Математическое определение

Композиция функций f и g определяется как (f ∘ g)(x) = f(g(x)), что означает: "примени g к x, а затем примени f к результату".

## Примеры в JavaScript

### Простая композиция
```javascript
// Определим простые функции
const add10 = x => x + 10;
const multiplyBy2 = x => x * 2;
const subtract5 = x => x - 5;

// Ручная композиция
const result = subtract5(multiplyBy2(add10(5))); // ((5 + 10) * 2) - 5 = 25

// Функция композиции
const compose = (...fns) => (value) => fns.reduceRight((acc, fn) => fn(acc), value);

// Использование композиции
const complexOperation = compose(subtract5, multiplyBy2, add10);
console.log(complexOperation(5)); // 25
```

### Функция композиции слева направо
```javascript
const pipe = (...fns) => (value) => fns.reduce((acc, fn) => fn(acc), value);

// pipe применяет функции в порядке их следования
const processNumber = pipe(
  add10,        // 5 + 10 = 15
  multiplyBy2,  // 15 * 2 = 30
  subtract5     // 30 - 5 = 25
);

console.log(processNumber(5)); // 25
```

### Более сложный пример с обработкой данных
```javascript
// Функции для обработки пользовательских данных
const toLowerCase = str => str.toLowerCase();
const removeSpaces = str => str.replace(/\s+/g, '');
const addDomain = str => `${str}@example.com`;
const formatForDisplay = email => `Email: ${email}`;

// Композиция для создания email из имени пользователя
const createEmail = pipe(
  toLowerCase,
  removeSpaces,
  addDomain,
  formatForDisplay
);

console.log(createEmail('John Doe')); // "Email: johnDoe@example.com"
```

## Реализации функции композиции

### Классическая композиция (справа налево)
```javascript
const compose = (...fns) => {
  return (initialValue) => {
    return fns.reduceRight((acc, fn) => fn(acc), initialValue);
  };
};
```

### Композиция слева направо (pipe)
```javascript
const pipe = (...fns) => {
  return (initialValue) => {
    return fns.reduce((acc, fn) => fn(acc), initialValue);
  };
};
```

### Безопасная композиция с обработкой ошибок
```javascript
const safeCompose = (...fns) => {
  return (initialValue) => {
    try {
      return fns.reduceRight((acc, fn) => {
        if (acc instanceof Error) return acc;
        try {
          return fn(acc);
        } catch (error) {
          return error;
        }
      }, initialValue);
    } catch (error) {
      return error;
    }
  };
};
```

## Практическое применение в фронтенд-разработке

### 1. Обработка данных
```javascript
// Композиция для валидации и форматирования данных
const trim = str => str.trim();
const toLowerCase = str => str.toLowerCase();
const isValidEmail = email => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

const validateEmail = pipe(
  trim,
  toLowerCase,
  (email) => isValidEmail(email) ? email : new Error('Invalid email')
);
```

### 2. Трансформация данных в API-ответах
```javascript
// Функции для обработки API-ответов
const extractData = response => response.data;
const normalizeUsers = users => users.map(user => ({
  ...user,
  fullName: `${user.firstName} ${user.lastName}`
}));
const filterActiveUsers = users => users.filter(user => user.active);

// Композиция для обработки ответа API
const processUsersResponse = pipe(
  extractData,
  normalizeUsers,
  filterActiveUsers
);
```

### 3. Композиция в React-компонентах
```javascript
// Композиция функций для вычислений в компонентах
const calculateTotal = pipe(
  calculateSubtotal,
  applyDiscount,
  addTax
);

function OrderSummary({ items, discount, taxRate }) {
  const total = calculateTotal({ items, discount, taxRate });
  
  return <div>Total: ${total.toFixed(2)}</div>;
}
```

## Продвинутые паттерны композиции

### Композиция с частичным применением
```javascript
const multiply = (a, b) => a * b;
const add = (a, b) => a + b;

// Создание конкретных функций с частичным применением
const double = (x) => multiply(2, x);
const addTen = (x) => add(10, x);

const complexCalculation = pipe(
  double,
  addTen,
  double
);
```

### Условная композиция
```javascript
const conditionalCompose = (condition, fn1, fn2) => (value) => {
  return condition(value) ? fn1(value) : fn2(value);
};

const processWithCondition = conditionalCompose(
  x => x > 0,
  x => x * 2,    // для положительных чисел
  x => x * -1    // для отрицательных чисел
);
```

## Практические рекомендации для российских реалий 2025

- Использование композиции для создания переиспользуемых утилит в проектах
- Применение композиции в системах управления состоянием (Redux, Zustand)
- Создание библиотек функций высшего порядка
- Интеграция композиции с TypeScript для строгой типизации
- Обучение команд работе с функциональными паттернами
- Использование композиции в SSR для обработки данных перед рендерингом
- Применение композиции в микросервисной архитектуре для обработки запросов

## Инструменты и библиотеки

### Ramda
```javascript
import { compose, pipe, map, filter, propEq } from 'ramda';

const activeUsers = pipe(
  filter(propEq('status', 'active')),
  map(user => ({ ...user, fullName: `${user.firstName} ${user.lastName}` }))
);
```

### Lodash/fp
```javascript
import { compose, map, filter, propEq } from 'lodash/fp';

const processUsers = compose(
  map(user => ({ ...user, fullName: `${user.firstName} ${user.lastName}` })),
  filter(propEq('status', 'active'))
);
```

## Композиция и тестирование [[Тестирование]]

Композиция упрощает тестирование, так как:

- Можно тестировать каждую функцию по отдельности
- Результат композиции предсказуем
- Легко создавать моки для тестирования

```javascript
// Тестируем отдельные функции
describe('compose functions', () => {
  it('should compose functions correctly', () => {
    const add = x => x + 1;
    const multiply = x => x * 2;
    
    const composed = pipe(add, multiply);
    expect(composed(3)).toBe(8); // (3 + 1) * 2 = 8
  });
});
```

## Связь с другими концепциями

- [[Функциональное-программирование]] - композиция как основной способ построения сложных функций
- [[Чистые-функции]] - композиция работает лучше с чистыми функциями
- [[Неизменяемость]] - часто используется вместе с композицией
- [[Тестирование]] - упрощается при использовании композиции

## Заключение

Композиция - это мощный инструмент функционального программирования, который позволяет создавать сложные функции из простых компонентов. В условиях современной фронтенд-разработки в России в 2025 году, композиция помогает создавать более модульный, тестируемый и поддерживаемый код, особенно в крупных проектах с высокими требованиями к архитектуре.