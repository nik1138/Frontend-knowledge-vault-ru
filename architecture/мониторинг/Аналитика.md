---
aliases: ["Аналитика фронтенда", "Frontend Analytics", "User Analytics"]
tags: 
  - monitoring
  - analytics
  - frontend
  - business_intelligence
---

# Аналитика фронтенд-приложений

## Обзор

Аналитика фронтенд-приложений - это процесс сбора, анализа и визуализации данных о поведении пользователей, производительности приложения и бизнес-показателях на стороне клиента. Эффективная аналитика позволяет принимать обоснованные решения на основе данных, улучшать пользовательский опыт и оптимизировать бизнес-процессы.

## Типы аналитики

### 1. Аналитика пользовательского поведения (User Behavior Analytics)

Отслеживание взаимодействия пользователей с интерфейсом:

- Пути пользователей по приложению
- Время на страницах
- Кликабельные элементы
- События формы (отправка, ошибки валидации)
- Продолжительность сессий

```javascript
// Система отслеживания пользовательских событий
class UserBehaviorTracker {
  constructor() {
    this.events = [];
    this.sessionId = this.generateSessionId();
    this.startTime = Date.now();
    
    this.setupEventListeners();
  }
  
  setupEventListeners() {
    // Отслеживание кликов
    document.addEventListener('click', (event) => {
      this.trackEvent('click', {
        element: event.target.tagName,
        target: event.target.id || event.target.className,
        position: this.getElementPosition(event.target)
      });
    });
    
    // Отслеживание просмотров страниц
    window.addEventListener('popstate', () => {
      this.trackPageView(window.location.pathname);
    });
    
    // Отслеживание прокрутки
    let scrollTimeout;
    document.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        this.trackScrollDepth();
      }, 100);
    });
  }
  
  trackEvent(type, data) {
    const event = {
      type: type,
      data: data,
      timestamp: Date.now(),
      sessionId: this.sessionId,
      url: window.location.href
    };
    
    this.events.push(event);
    this.sendEvent(event);
  }
  
  generateSessionId() {
    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }
  
  getElementPosition(element) {
    const rect = element.getBoundingClientRect();
    return {
      x: rect.left,
      y: rect.top,
      width: rect.width,
      height: rect.height
    };
  }
  
  trackPageView(path) {
    this.trackEvent('page_view', { path: path });
  }
  
  trackScrollDepth() {
    const scrollPercent = Math.round(
      (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100
    );
    
    if (scrollPercent >= 25 && !this.tracked25) {
      this.trackEvent('scroll_depth', { percentage: 25 });
      this.tracked25 = true;
    }
    if (scrollPercent >= 50 && !this.tracked50) {
      this.trackEvent('scroll_depth', { percentage: 50 });
      this.tracked50 = true;
    }
    if (scrollPercent >= 75 && !this.tracked75) {
      this.trackEvent('scroll_depth', { percentage: 75 });
      this.tracked75 = true;
    }
  }
  
  sendEvent(event) {
    // Отправка события на сервер аналитики
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics', JSON.stringify(event));
    } else {
      fetch('/analytics', {
        method: 'POST',
        body: JSON.stringify(event),
        headers: { 'Content-Type': 'application/json' }
      }).catch(() => {
        // Игнорируем ошибки отправки аналитики
      });
    }
  }
}
```

### 2. Аналитика производительности (Performance Analytics)

Анализ метрик производительности приложения:

- Время загрузки страниц
- Core Web Vitals
- Время отклика на взаимодействие
- Ошибки производительности

```javascript
// Сбор и анализ метрик производительности
class PerformanceAnalytics {
  constructor() {
    this.metrics = {
      lcp: null,
      fid: null,
      cls: null,
      fcp: null,
      ttfb: null
    };
    
    this.setupPerformanceTracking();
  }
  
  setupPerformanceTracking() {
    import('web-vitals').then(vitals => {
      vitals.getLCP(entry => {
        this.metrics.lcp = entry.value;
        this.reportPerformanceMetric('lcp', entry.value);
      });
      
      vitals.getFID(entry => {
        this.metrics.fid = entry.value;
        this.reportPerformanceMetric('fid', entry.value);
      });
      
      vitals.getCLS(entry => {
        this.metrics.cls = entry.value;
        this.reportPerformanceMetric('cls', entry.value);
      });
      
      vitals.getFCP(entry => {
        this.metrics.fcp = entry.value;
        this.reportPerformanceMetric('fcp', entry.value);
      });
      
      vitals.getTTFB(entry => {
        this.metrics.ttfb = entry.value;
        this.reportPerformanceMetric('ttfb', entry.value);
      });
    });
  }
  
  reportPerformanceMetric(name, value) {
    const metricData = {
      type: 'performance_metric',
      metric: name,
      value: value,
      timestamp: Date.now(),
      url: window.location.href,
      userAgent: navigator.userAgent
    };
    
    this.sendAnalytics(metricData);
  }
  
  sendAnalytics(data) {
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics', JSON.stringify(data));
    } else {
      fetch('/analytics', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      }).catch(() => {
        // Игнорируем ошибки отправки
      });
    }
  }
}
```

### 3. Бизнес-аналитика (Business Analytics)

Отслеживание ключевых бизнес-показателей:

- Конверсии
- Доходы
- Клики на рекламу
- Время до покупки
- Поведение клиентов

```javascript
// Отслеживание бизнес-событий
class BusinessAnalytics {
  constructor() {
    this.setupConversionTracking();
  }
  
  setupConversionTracking() {
    // Отслеживание покупок
    document.addEventListener('purchase_completed', (event) => {
      this.trackConversion('purchase', {
        value: event.detail.amount,
        currency: event.detail.currency,
        productId: event.detail.productId
      });
    });
    
    // Отслеживание регистрации
    document.addEventListener('registration_completed', (event) => {
      this.trackConversion('registration', {
        userId: event.detail.userId,
        source: event.detail.source
      });
    });
  }
  
  trackConversion(type, data) {
    const conversionEvent = {
      type: 'conversion',
      conversionType: type,
      data: data,
      timestamp: Date.now(),
      sessionId: this.getSessionId()
    };
    
    this.sendAnalytics(conversionEvent);
  }
  
  getSessionId() {
    // Получение ID сессии из трекера поведения
    return sessionStorage.getItem('analytics_session_id') || 
           this.generateAndStoreSessionId();
  }
  
  generateAndStoreSessionId() {
    const sessionId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    sessionStorage.setItem('analytics_session_id', sessionId);
    return sessionId;
  }
  
  sendAnalytics(data) {
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics', JSON.stringify(data));
    } else {
      fetch('/analytics', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      }).catch(() => {
        // Игнорируем ошибки отправки
      });
    }
  }
}
```

## Визуализация данных

### 1. Дашборды производительности

```javascript
// Пример компонента дашборда производительности
class PerformanceDashboard {
  constructor(containerId) {
    this.container = document.getElementById(containerId);
    this.data = {};
  }
  
  async loadPerformanceData() {
    try {
      const response = await fetch('/api/analytics/performance');
      this.data = await response.json();
      this.render();
    } catch (error) {
      console.error('Ошибка загрузки данных производительности:', error);
    }
  }
  
  render() {
    if (!this.container) return;
    
    this.container.innerHTML = `
      <div class="performance-dashboard">
        <h3>Метрики производительности</h3>
        <div class="metrics-grid">
          <div class="metric-card">
            <h4>LCP</h4>
            <div class="metric-value">${this.formatMetric(this.data.lcp, 'ms')}</div>
            <div class="metric-trend">${this.getTrendIcon(this.data.lcpTrend)}</div>
          </div>
          <div class="metric-card">
            <h4>FID</h4>
            <div class="metric-value">${this.formatMetric(this.data.fid, 'ms')}</div>
            <div class="metric-trend">${this.getTrendIcon(this.data.fidTrend)}</div>
          </div>
          <div class="metric-card">
            <h4>CLS</h4>
            <div class="metric-value">${this.formatMetric(this.data.cls, '')}</div>
            <div class="metric-trend">${this.getTrendIcon(this.data.clsTrend)}</div>
          </div>
        </div>
      </div>
    `;
  }
  
  formatMetric(value, unit) {
    if (value === null || value === undefined) return 'N/A';
    return `${Math.round(value)}${unit}`;
  }
  
  getTrendIcon(trend) {
    if (trend > 0) return '↗️'; // Рост
    if (trend < 0) return '↘️'; // Снижение
    return '➡️'; // Без изменений
  }
}
```

### 2. Графики пользовательской активности

```javascript
// Пример визуализации пользовательской активности
class UserActivityChart {
  constructor(canvasId) {
    this.canvas = document.getElementById(canvasId);
    if (!this.canvas) return;
    
    this.ctx = this.canvas.getContext('2d');
  }
  
  async renderActivityChart() {
    try {
      const response = await fetch('/api/analytics/user-activity');
      const activityData = await response.json();
      
      this.drawChart(activityData);
    } catch (error) {
      console.error('Ошибка загрузки данных активности:', error);
    }
  }
  
  drawChart(data) {
    if (!this.ctx) return;
    
    // Очищаем canvas
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    
    // Рисуем график
    this.ctx.beginPath();
    this.ctx.strokeStyle = '#3b82f6';
    this.ctx.lineWidth = 2;
    
    const pointSpacing = this.canvas.width / (data.length - 1);
    
    data.forEach((point, index) => {
      const x = index * pointSpacing;
      const y = this.canvas.height - (point.value / this.getMaxValue(data)) * this.canvas.height;
      
      if (index === 0) {
        this.ctx.moveTo(x, y);
      } else {
        this.ctx.lineTo(x, y);
      }
    });
    
    this.ctx.stroke();
  }
  
  getMaxValue(data) {
    return Math.max(...data.map(d => d.value), 1);
  }
}
```

## Аналитика в реальном времени

```javascript
// Система аналитики в реальном времени
class RealTimeAnalytics {
  constructor() {
    this.eventSource = null;
    this.setupRealTimeConnection();
  }
  
  setupRealTimeConnection() {
    if (typeof EventSource !== 'undefined') {
      this.eventSource = new EventSource('/api/analytics/stream');
      
      this.eventSource.onmessage = (event) => {
        const analyticsData = JSON.parse(event.data);
        this.updateRealTimeDashboard(analyticsData);
      };
      
      this.eventSource.onerror = (error) => {
        console.error('Ошибка соединения с потоком аналитики:', error);
        this.reconnect();
      };
    }
  }
  
  updateRealTimeDashboard(data) {
    // Обновляем элементы интерфейса в реальном времени
    const activeUsersElement = document.getElementById('active-users');
    if (activeUsersElement) {
      activeUsersElement.textContent = data.activeUsers;
    }
    
    const eventsPerSecondElement = document.getElementById('events-per-second');
    if (eventsPerSecondElement) {
      eventsPerSecondElement.textContent = data.eventsPerSecond;
    }
  }
  
  reconnect() {
    setTimeout(() => {
      this.eventSource.close();
      this.setupRealTimeConnection();
    }, 5000); // Повторная попытка через 5 секунд
  }
}
```

## А/Б тестирование

```javascript
// Система аналитики для A/B тестирования
class ABTestingAnalytics {
  constructor() {
    this.experiments = {};
    this.setupExperimentTracking();
  }
  
  setupExperimentTracking() {
    // Инициализация экспериментов
    this.initializeExperiments();
    
    // Отслеживание событий для экспериментов
    document.addEventListener('ab_test_event', (event) => {
      this.trackExperimentEvent(event.detail);
    });
  }
  
  initializeExperiments() {
    // Пример: A/B тестирование кнопки
    const experimentVariants = ['control', 'variant-a', 'variant-b'];
    const selectedVariant = this.selectVariant(experimentVariants);
    
    this.experiments['cta-button-test'] = {
      variant: selectedVariant,
      startDate: new Date()
    };
    
    // Применение варианта к интерфейсу
    this.applyVariant('cta-button-test', selectedVariant);
  }
  
  selectVariant(variants) {
    // Простой алгоритм случайного выбора варианта
    return variants[Math.floor(Math.random() * variants.length)];
  }
  
  applyVariant(experimentId, variant) {
    // Применение варианта к интерфейсу
    const button = document.getElementById('cta-button');
    if (button) {
      button.className = `btn-${variant}`;
    }
  }
  
  trackExperimentEvent(detail) {
    const experimentEvent = {
      type: 'experiment_event',
      experimentId: detail.experimentId,
      variant: this.experiments[detail.experimentId]?.variant,
      event: detail.event,
      timestamp: Date.now()
    };
    
    this.sendAnalytics(experimentEvent);
  }
  
  sendAnalytics(data) {
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics', JSON.stringify(data));
    } else {
      fetch('/analytics', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      }).catch(() => {
        // Игнорируем ошибки отправки
      });
    }
  }
}
```

## Приватность и GDPR

```javascript
// Система аналитики с учетом требований приватности
class PrivacyCompliantAnalytics {
  constructor() {
    this.consentGiven = this.checkConsent();
    this.setupPrivacyControls();
  }
  
  checkConsent() {
    // Проверка согласия пользователя на сбор данных
    return localStorage.getItem('analytics_consent') === 'true';
  }
  
  setupPrivacyControls() {
    // Показ баннера согласия при необходимости
    if (!this.consentGiven) {
      this.showConsentBanner();
    }
  }
  
  showConsentBanner() {
    const banner = document.createElement('div');
    banner.className = 'analytics-consent-banner';
    banner.innerHTML = `
      <p>Мы используем аналитические данные для улучшения нашего сервиса. 
         Продолжая использовать сайт, вы соглашаетесь на сбор анонимных данных.</p>
      <button id="accept-analytics">Принять</button>
      <button id="decline-analytics">Отклонить</button>
    `;
    
    document.body.appendChild(banner);
    
    document.getElementById('accept-analytics').addEventListener('click', () => {
      this.giveConsent();
      document.body.removeChild(banner);
    });
    
    document.getElementById('decline-analytics').addEventListener('click', () => {
      this.declineConsent();
      document.body.removeChild(banner);
    });
  }
  
  giveConsent() {
    this.consentGiven = true;
    localStorage.setItem('analytics_consent', 'true');
  }
  
  declineConsent() {
    this.consentGiven = false;
    localStorage.setItem('analytics_consent', 'false');
  }
  
  trackEvent(eventType, eventData) {
    if (!this.consentGiven) {
      return; // Не отслеживаем без согласия
    }
    
    // Анонимизация данных перед отправкой
    const anonymizedData = this.anonymizeData(eventData);
    
    // Отправка анонимизированных данных
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/analytics', JSON.stringify({
        type: eventType,
        data: anonymizedData,
        timestamp: Date.now()
      }));
    }
  }
  
  anonymizeData(data) {
    // Удаление или маскировка персональных данных
    const anonymized = { ...data };
    
    // Удаление чувствительных полей
    delete anonymized.email;
    delete anonymized.phone;
    delete anonymized.creditCard;
    
    // Анонимизация IP-адреса
    if (anonymized.ip) {
      anonymized.ip = anonymized.ip.replace(/\.\d+$/, '.0');
    }
    
    return anonymized;
  }
}
```

## Заключение

Аналитика фронтенд-приложений - мощный инструмент для понимания поведения пользователей, оптимизации производительности и принятия обоснованных бизнес-решений. При правильной реализации она может значительно улучшить пользовательский опыт и бизнес-результаты, при этом соблюдая требования приватности и обеспечивая защиту персональных данных.

## См. также

- [[Архитектура-мониторинга]]
- [[Сбор-метрик]]
- [[Логирование]]
- [[Алертинг]]