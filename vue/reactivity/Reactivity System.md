---
aliases: []
tags: [vue, reactivity, architecture]
---

# Reactivity System

Реактивная система - это фундаментальная особенность Vue.js, которая позволяет автоматически обновлять пользовательский интерфейс при изменении данных. Это одна из ключевых причин, почему Vue так прост в использовании и эффективен для создания интерактивных пользовательских интерфейсов.

## Основные принципы реактивности

Реактивная система Vue основана на отслеживании зависимостей в режиме выполнения. Когда компонент читает реактивное свойство, система отслеживает это свойство как зависимость. Когда свойство изменяется, система уведомляет все компоненты, зависящие от этого свойства, чтобы они могли обновиться.

## Как работает реактивность в Vue

### В Vue 2

В Vue 2 реактивная система была реализована с использованием `Object.defineProperty()`. Vue обходит все свойства объекта состояния и превращает их в геттеры/сеттеры. Когда свойство читается, оно регистрируется как зависимость, а когда изменяется - запускается обновление.

### В Vue 3

В Vue 3 реактивная система была переписана с использованием прокси-объектов JavaScript. Это позволило улучшить производительность и расширить возможности реактивности, включая поддержку Map, Set, классов и других типов данных.

## Пример реактивности

```javascript
import { reactive, effect } from 'vue'

// Создание реактивного объекта
const state = reactive({
  count: 0
})

// Реактивный эффект
effect(() => {
  console.log(state.count) // Будет вызываться при изменении state.count
})

// Изменение реактивного состояния
state.count++ // Выведет 1
```

## Реактивные API

Vue предоставляет несколько API для работы с реактивностью:

- `reactive()` - создает реактивный объект
- `ref()` - оборачивает значение в реактивную ссылку
- `computed()` - создает вычисляемое свойство
- `watch()` и `watchEffect()` - позволяют наблюдать за изменениями

## Реактивность в компонентах

В компонентах Vue автоматически отслеживает зависимости, используемые в шаблоне:

```vue
<template>
  <div>{{ message }}</div>
</template>

<script>
export default {
  data() {
    return {
      message: 'Hello Vue!'
    }
  }
}
</script>
```

Когда `message` изменяется, Vue автоматически обновляет DOM.

## Оптимизация реактивности

### Избегание ненужных вычислений

Vue оптимизирует обновления, отслеживая зависимости только во время рендеринга компонента. Это означает, что если вычисление не используется в шаблоне, оно не будет автоматически обновляться.

### Шаллоу реактивность

Для больших объектов можно использовать `shallowReactive()`, чтобы сделать реактивным только верхний уровень:

```javascript
import { shallowReactive } from 'vue'

const state = shallowReactive({
  level1: {
    level2: 'deep value'
  }
})

// Только level1 будет реактивным
```

## Практические применения

Реактивная система Vue используется в следующих сценариях:

1. Отображение данных в шаблонах
2. Вычисляемые свойства
3. Наблюдение за изменениями данных
4. Управление состоянием приложения
5. Асинхронные операции с данными

## Проблемы и решения

### Асинхронность обновлений

Обновления DOM в Vue асинхронны. Это означает, что изменения в состоянии не сразу отражаются в DOM. Для доступа к обновленному DOM после изменений используйте `nextTick()`:

```javascript
import { nextTick } from 'vue'

export default {
  methods: {
    async updateData() {
      this.message = 'updated'
      await nextTick()
      // Теперь DOM обновлен
      console.log(this.$el.textContent)
    }
  }
}
```

### Работа с массивами

Vue не может отслеживать изменения индексов массивов или изменения длины массива. В таких случаях используйте специальные методы:

```javascript
// Вместо arr[index] = newValue
Vue.set(arr, index, newValue)
// или
arr.splice(index, 1, newValue)
```

См. также: [[Vue компоненты]], [[Composition API]], [[Options API]]