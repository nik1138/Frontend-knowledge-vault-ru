---
aliases: [Тестирование хранилищ, Тестирование состояния, Vuex тестирование, Pinia тестирование]
tags: [vue, testing, store, state-management, pinia, vuex]
---

# Тестирование-хранилищ

## Общие сведения

Тестирование хранилищ в Vue-приложениях - это процесс проверки корректности управления состоянием приложения. В 2025 году основным подходом является использование [[Pinia]] вместо устаревшего Vuex для новых проектов.

## Подходы к тестированию хранилищ

### Тестирование с Pinia

[[Pinia]] предоставляет удобные возможности для тестирования благодаря своей модульной архитектуре:

```javascript
import { setActivePinia, createPinia } from 'pinia'
import { useUserStore } from '@/stores/user'

describe('User Store', () => {
  let store

  beforeEach(() => {
    // Устанавливаем активный pinia
    setActivePinia(createPinia())
    store = useUserStore()
  })

  test('инициализирует пустого пользователя', () => {
    expect(store.user).toEqual({})
    expect(store.isLoggedIn).toBe(false)
  })

  test('авторизует пользователя', () => {
    const userData = { id: 1, name: 'Иван Петров' }
    
    store.login(userData)
    
    expect(store.user).toEqual(userData)
    expect(store.isLoggedIn).toBe(true)
  })

  test('разлогинивает пользователя', () => {
    store.login({ id: 1, name: 'Иван Петров' })
    store.logout()
    
    expect(store.user).toEqual({})
    expect(store.isLoggedIn).toBe(false)
  })
})
```

### Тестирование асинхронных действий

Для тестирования асинхронных операций (например, API вызовов) используются mock-объекты:

```javascript
import { setActivePinia, createPinia } from 'pinia'
import { useUserStore } from '@/stores/user'
import * as api from '@/api/users'

// Мокаем API модуль
jest.mock('@/api/users')

describe('User Store API', () => {
  let store

  beforeEach(() => {
    setActivePinia(createPinia())
    store = useUserStore()
  })

  test('загружает профиль пользователя', async () => {
    const mockUser = { id: 1, name: 'Иван Петров', email: 'ivan@example.com' }
    api.fetchUserProfile.mockResolvedValue(mockUser)

    await store.fetchProfile()
    
    expect(store.user).toEqual(mockUser)
    expect(api.fetchUserProfile).toHaveBeenCalled()
  })

  test('обрабатывает ошибки при загрузке профиля', async () => {
    const error = new Error('Сервер недоступен')
    api.fetchUserProfile.mockRejectedValue(error)

    await expect(store.fetchProfile()).rejects.toThrow('Сервер недоступен')
    expect(store.error).toBe('Сервер недоступен')
  })
})
```

## Тестирование вычисляемых свойств

Вычисляемые свойства в хранилищах также требуют тестирования:

```javascript
import { setActivePinia, createPinia } from 'pinia'
import { useCartStore } from '@/stores/cart'

describe('Cart Store', () => {
  let store

  beforeEach(() => {
    setActivePinia(createPinia())
    store = useCartStore()
  })

  test('вычисляет общую стоимость корзины', () => {
    store.items = [
      { id: 1, name: 'Товар 1', price: 100, quantity: 2 },
      { id: 2, name: 'Товар 2', price: 200, quantity: 1 }
    ]

    expect(store.totalPrice).toBe(400)
  })

  test('проверяет, пуста ли корзина', () => {
    store.items = []
    expect(store.isEmpty).toBe(true)

    store.items = [{ id: 1, name: 'Товар', price: 100, quantity: 1 }]
    expect(store.isEmpty).toBe(false)
  })
})
```

## Тестирование с Vuex (устаревший подход)

Для поддержки старых проектов, все еще использующих Vuex, тестирование выглядит следующим образом:

```javascript
import { createStore } from 'vuex'
import userModule from '@/store/modules/user'

describe('User Module', () => {
  let store

  beforeEach(() => {
    store = createStore({
      modules: {
        user: userModule
      }
    })
  })

  test('изменяет состояние авторизации', () => {
    store.dispatch('user/login', { id: 1, name: 'Иван' })
    
    expect(store.getters['user/isLoggedIn']).toBe(true)
    expect(store.state.user.profile).toEqual({ id: 1, name: 'Иван' })
  })
})
```

## Практические рекомендации

### Изолированное тестирование

Хранилища должны тестироваться изолированно от компонентов:

```javascript
// ❌ Плохо: тестирование через компонент
test('user login through component', async () => {
  const wrapper = mount(LoginComponent)
  // ...
})

// ✅ Хорошо: прямое тестирование хранилища
test('user login action', () => {
  const store = useUserStore()
  store.login(userData)
  expect(store.isLoggedIn).toBe(true)
})
```

### Тестирование сайд-эффектов

Важно тестировать сайд-эффекты, такие как сохранение в localStorage:

```javascript
import { setActivePinia, createPinia } from 'pinia'
import { usePreferencesStore } from '@/stores/preferences'

// Мокаем localStorage
const mockLocalStorage = {
  getItem: jest.fn(),
  setItem: jest.fn(),
  removeItem: jest.fn()
}
Object.defineProperty(window, 'localStorage', {
  value: mockLocalStorage
})

describe('Preferences Store', () => {
  let store

  beforeEach(() => {
    setActivePinia(createPinia())
    store = usePreferencesStore()
  })

  test('сохраняет настройки в localStorage', () => {
    store.setTheme('dark')
    
    expect(window.localStorage.setItem).toHaveBeenCalledWith(
      'theme',
      'dark'
    )
  })
})
```

### Проверка производительности

Для критических хранилищ можно тестировать производительность:

```javascript
test('обрабатывает большое количество элементов эффективно', () => {
  const store = useLargeDataStore()
  const startTime = performance.now()
  
  store.addManyItems(Array.from({ length: 10000 }, (_, i) => ({ id: i, data: `item ${i}` })))
  
  const endTime = performance.now()
  const duration = endTime - startTime
  
  expect(duration).toBeLessThan(100) // Менее 100ms для 10000 элементов
})
```

## Особенности российского рынка в 2025 году

- Требования к локализации: хранилища должны корректно обрабатывать русские строки и даты
- Ограничения на использование внешних сервисов: тестирование должно учитывать альтернативные решения
- Совместимость с отечественными решениями: возможно использование специфических API
- Безопасность: хранилища не должны хранить чувствительные данные в открытом виде

## Интеграция с CI/CD

Тесты хранилищ должны быть частью автоматизированного процесса:

```yaml
# .github/workflows/test.yml
test-store:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: npm ci
    - run: npm run test:store
```

## Рекомендуемые практики

- Тестировать все публичные методы и геттеры хранилища
- Проверять корректность обработки ошибок
- Тестировать граничные условия (пустые массивы, нулевые значения)
- Использовать фикстуры для сложных данных
- Покрывать тестами как успешные, так и неуспешные сценарии

## См. также

- [[Тестирование-компонентов]]
- [[E2E-тестирование]]
- [[Pinia]]
- [[Vuex]]
- [[Jest]]