---
tags:
  - vue
  - security
  - csrf
  - frontend
  - backend
aliases:
  - Защита от подделывания межсайтовых запросов
  - Vue CSRF Protection
---

# Защита от CSRF (Подделывание межсайтовых запросов)

## Введение

Подделывание межсайтовых запросов (CSRF) — это тип уязвимости веб-приложений, при котором злоумышленник обманом заставляет аутентифицированного пользователя выполнить нежелательное действие на веб-сайте, доверяющем пользователю. Это может привести к изменению данных, выполнению транзакций или другим нежелательным действиям. Защита от CSRF требует как клиентских, так и серверных мер.

## Что такое CSRF?

CSRF-атака происходит, когда злоумышленник создает вредоносную страницу или электронное письмо, которое содержит ссылку или форму, отправляющую запрос на уязвимый веб-сайт. Если пользователь, который аутентифицирован на уязвимом сайте, посетит вредоносную страницу и выполнит действие (например, нажмёт кнопку), браузер автоматически включит аутентификационные данные (например, cookie) в запрос, и сервер выполнит действие от имени пользователя.

## Как Vue может помочь в защите от CSRF

Vue.js сам по себе не защищает от CSRF, так как это уязвимость, связанная с аутентификацией и сессией на сервере. Однако Vue-приложение может играть важную роль в реализации клиентской части защиты:

- **Использование токенов аутентификации:** Вместо использования сессионных cookie для аутентификации, можно использовать токены (например, JWT), которые передаются в заголовках HTTP-запросов. Это делает CSRF-атаки менее эффективными, так как браузер не включает токены в заголовки при запросах с других сайтов.
- **Управление токенами:** Vue-приложение должно безопасно хранить токены (например, в `localStorage` или `sessionStorage`) и включать их в каждый запрос к API.
- **CSRF-токены:** Если используется сессионная аутентификация, сервер должен генерировать CSRF-токен, который отправляется клиенту (например, в заголовке ответа или в теле HTML). Клиент должен затем включить этот токен в каждый запрос, изменяющий состояние (например, POST, PUT, DELETE). Это можно реализовать с помощью Axios interceptors или других HTTP-клиентов.

## Практические рекомендации

- **Используйте токены аутентификации:** Отдавайте предпочтение токенам (например, JWT) вместо сессионных cookie. Это снижает риск CSRF, так как токены не передаются автоматически браузером.
- **Храните токены безопасно:** Не храните токены в сессионных cookie, если только не реализована дополнительная защита (например, SameSite attribute). `localStorage` и `sessionStorage` более безопасны для токенов, но подвержены XSS-атакам, если приложение уязвимо.
- **Реализуйте CSRF-токены при сессионной аутентификации:** Если вы используете сессии, убедитесь, что сервер генерирует и проверяет CSRF-токены. Клиент должен получить токен и включить его в заголовок или тело запроса.
- **Используйте Axios interceptors:** Для автоматического добавления токенов аутентификации или CSRF-токенов ко всем запросам.
- **SameSite cookie attribute:** Если вы используете сессионные cookie, установите атрибут `SameSite=Strict` или `SameSite=Lax`, чтобы ограничить отправку cookie в межсайтовых запросах.

## Примеры кода

**Использование токена аутентификации с Axios:**

```javascript
// Установка токена аутентификации в Axios defaults
import axios from 'axios';

const token = localStorage.getItem('authToken');
if (token) {
  axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
}

// Или с помощью interceptors для динамического обновления
axios.interceptors.request.use(
  config => {
    const token = localStorage.getItem('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  error => {
    return Promise.reject(error);
  }
);
```

**Пример CSRF-токена с Axios (при сессионной аутентификации):**

```javascript
// Получение CSRF-токена от сервера (обычно при загрузке страницы или в отдельном API-вызове)
// Предположим, токен приходит в заголовке 'X-CSRF-TOKEN'
axios.interceptors.response.use(
  response => {
    const csrfToken = response.headers['x-csrf-token'];
    if (csrfToken) {
      localStorage.setItem('csrfToken', csrfToken); // или sessionStorage
    }
    return response;
  },
  error => {
    return Promise.reject(error);
  }
);

// Добавление CSRF-токена к запросам
axios.interceptors.request.use(
  config => {
    const csrfToken = localStorage.getItem('csrfToken');
    if (csrfToken) {
      config.headers['X-CSRF-Token'] = csrfToken;
    }
    return config;
  },
  error => {
    return Promise.reject(error);
  }
);
```

## Ссылки на другие файлы безопасности

- [[Защита-от-XSS]]
- [[CSP]]
- [[Валидация-входных-данных]]
- [[Аутентификация]]

## Заключение

Защита от CSRF требует комплексного подхода, включающего как клиентские, так и серверные меры. Vue-приложение может внести свой вклад, правильно обрабатывая токены аутентификации и, при необходимости, CSRF-токены. Использование токенов вместо сессионных cookie значительно снижает риск CSRF-атак. Важно всегда следовать лучшим практикам безопасности и обновлять знания в свете новых угроз.
