---
tags:
  - vue
  - security
  - csp
  - frontend
  - http
aliases:
  - Content Security Policy
  - Политика безопасности контента
---

# Content Security Policy (CSP)

## Введение

Content Security Policy (CSP) — это важная мера безопасности, реализуемая на уровне HTTP, которая помогает предотвратить и смягчить последствия атак, таких как межсайтовый скриптинг (XSS) и clickjacking. CSP позволяет веб-сайтам объявлять источники контента, которые браузер считает безопасными. Это делается путем отправки специального HTTP-заголовка `Content-Security-Policy` сервером или с помощью тега `<meta>` в HTML.

## Что такое CSP?

CSP — это белый список источников ресурсов, разрешенных для загрузки и выполнения на веб-странице. Эти источники могут включать скрипты, стили, изображения, шрифты, фреймы и другие ресурсы. Браузер строго следует этой политике и блокирует загрузку или выполнение любых ресурсов, которые не соответствуют политике.

## Как CSP помогает в защите?

- **Предотвращение XSS:** CSP может предотвратить выполнение встроенных скриптов (`<script>` теги в HTML) и inline-стилей, что является распространенным вектором атак XSS. Директивы `script-src` и `style-src` контролируют, откуда могут загружаться скрипты и стили.
- **Ограничение загрузки ресурсов:** CSP позволяет ограничить, с каких доменов могут загружаться изображения, шрифты, аудио, видео и другие ресурсы, предотвращая загрузку вредоносного контента.
- **Предотвращение clickjacking:** Директива `frame-ancestors` позволяет контролировать, кто может встраивать ваш сайт во фреймы, тем самым защищая от clickjacking-атак.
- **Отчеты о нарушениях:** CSP может быть настроена для отправки отчетов о нарушениях политики на указанный URL, что помогает разработчикам выявлять и исправлять проблемы безопасности.

## Практические рекомендации по настройке CSP для Vue-приложений

- **Определите разрешенные источники:** Тщательно продумайте, с каких доменов ваше приложение должно загружать скрипты, стили, шрифты и другие ресурсы. Включайте только те домены, которым вы доверяете.
- **Избегайте `'unsafe-inline'` и `'unsafe-eval'`:** Эти директивы позволяют выполнение встроенных скриптов и `eval()`, что значительно снижает эффективность CSP. Старайтесь обходиться без них.
- **Используйте хэши или nonce для inline-скриптов (если необходимо):** Если вы не можете избежать inline-скриптов, используйте хэши (`'sha256-...'`) или nonce (`'nonce-...'`) для разрешения конкретных скриптов.
- **Настройте заголовки на сервере:** CSP обычно настраивается на сервере, который обслуживает ваше Vue-приложение. Это может быть Nginx, Apache, Express.js или другой веб-сервер. Убедитесь, что заголовок `Content-Security-Policy` отправляется с каждым HTML-ответом.
- **Тестирование:** Используйте директиву `Content-Security-Policy-Report-Only` для тестирования политики без блокировки ресурсов. Это позволяет собирать отчеты о нарушениях, чтобы вы могли отладить политику перед её активацией.
- **Обновления зависимостей:** При обновлении зависимостей вашего Vue-приложения, проверяйте, не нарушают ли они вашу CSP. Например, новая библиотека может загружать скрипты с нового домена.

## Примеры директив CSP

- `default-src 'self';`: По умолчанию разрешает загрузку всех ресурсов только с того же домена.
- `script-src 'self' https://trusted-cdn.com;`: Разрешает выполнение скриптов только с того же домена и с `https://trusted-cdn.com`. Запрещает `'unsafe-inline'` и `'unsafe-eval'`.
- `style-src 'self' 'unsafe-inline';`: Разрешает загрузку стилей с того же домена и inline-стили (использование `'unsafe-inline'` для стилей менее критично, чем для скриптов, но всё равно не рекомендуется).
- `img-src 'self' data: https://images.example.com;`: Разрешает загрузку изображений с того же домена, встроенных изображений в base64 (data:) и с `https://images.example.com`.
- `font-src 'self' https://fonts.googleapis.com;`: Разрешает загрузку шрифтов с того же домена и с `https://fonts.googleapis.com`.
- `frame-ancestors 'none';`: Запрещает встраивание страницы во фреймы.
- `report-uri /csp-report-endpoint;`: Отправляет отчеты о нарушениях CSP на `/csp-report-endpoint`.

## Пример настройки CSP в Nginx

```nginx
# В блоке server или location
add_header Content-Security-Policy "default-src 'self'; script-src 'self' https://trusted-cdn.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' https://fonts.googleapis.com; frame-ancestors 'none'; report-uri /csp-report-endpoint;";
```

## Ссылки на другие файлы безопасности

- [[Защита-от-XSS]]
- [[Защита-от-CSRF]]
- [[Валидация-входных-данных]]
- [[Аутентификация]]

## Заключение

Content Security Policy — мощный инструмент для повышения безопасности веб-приложений. Хотя его настройка может показаться сложной, особенно для приложений с множеством зависимостей, правильная реализация CSP может значительно снизить риск XSS и других атак. Начните с простой политики и постепенно усложняйте её, убедившись, что она не нарушает функциональность вашего Vue-приложения.
