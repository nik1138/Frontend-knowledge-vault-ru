---
aliases: ["Анализ бандла Vue", "Bundle Analysis"]
tags: ["#vue", "#bundle-analysis", "#performance", "#optimization", "#size-monitoring"]
---

# Анализ-бандла

## Обзор

[[Анализ бандла]] - это процесс изучения содержимого собранного JavaScript-бандла приложения для выявления возможностей оптимизации. В 2025 году, особенно в условиях российского интернета, где скорость соединения может быть ограничена, а доступ к зарубежным ресурсам - ограничен, анализ бандла становится критически важным для обеспечения высокой производительности Vue приложений.

## Зачем нужен анализ бандла

### Основные цели

- **Определение размера бандла**: понимание общего размера и состава бандла
- **Выявление "тяжелых" зависимостей**: нахождение библиотек, занимающих много места
- **Оптимизация разделения кода**: проверка эффективности code splitting
- **Выявление дубликатов**: обнаружение повторяющегося кода
- **Мониторинг изменений**: отслеживание роста размера бандла

### Показатели производительности

- Общий размер бандла (JavaScript, CSS, изображения)
- Время загрузки и выполнения
- Размер начального чанка
- Количество HTTP-запросов
- Время до интерактивности (TTI)

## Инструменты анализа бандла

### Webpack Bundle Analyzer

Для проектов с Webpack:

```bash
npm install --save-dev webpack-bundle-analyzer
```

```js
// webpack.config.js
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'static', // Создает HTML-отчет
      openAnalyzer: false,
      reportFilename: 'bundle-report.html',
      defaultSizes: 'gzip' // Показывать размеры с gzip сжатием
    })
  ]
}
```

### Rollup Plugin Visualizer для Vite

Для проектов с [[Vite]]:

```bash
npm install --save-dev rollup-plugin-visualizer
```

```js
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    vue(),
    visualizer({
      filename: './bundle-analysis.html',
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ]
})
```

### Встроенные инструменты Vite

```js
// vite.config.js
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // Настройка для лучшей визуализации
          vendor: ['vue', 'vue-router'],
          ui: ['element-plus', '@unocss/runtime'],
          charts: ['chart.js', 'vue-chartjs']
        }
      }
    },
    // Включение подробного вывода при сборке
    sourcemap: true,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true
      }
    }
  }
})
```

## Интерпретация результатов анализа

### Понимание диаграмм

#### Treemap (древовидная карта)
- Каждый прямоугольник представляет модуль
- Размер прямоугольника пропорционален размеру модуля
- Помогает визуально определить "тяжелые" зависимости

#### Sunburst (солнечная диаграмма)
- Показывает иерархию зависимостей
- Внутренние кольца - более глубокие зависимости
- Полезна для понимания структуры бандла

### Ключевые метрики

```js
// Пример анализа бандла
const bundleMetrics = {
  totalSize: '2.4 MB', // Общий размер
  initialChunkSize: '850 KB', // Размер начального чанка
  vendorChunkSize: '1.2 MB', // Размер чанка зависимостей
  jsSize: '2.1 MB', // Размер JavaScript
  cssSize: '300 KB', // Размер CSS
  numberOfRequests: 12, // Количество HTTP-запросов
  largestAsset: 'chart.js - 450 KB' // Самый большой ресурс
}
```

## Практический анализ Vue приложений

### 1. Анализ зависимостей

```bash
# Использование npm для анализа зависимостей
npm ls --depth=0

# Использование команды для анализа размера зависимостей
npx webpack-bundle-analyzer dist/static/js/*.js
```

### 2. Идентификация проблемных мест

```vue
<!-- Пример компонента, который может увеличить размер бандла -->
<template>
  <div>
    <!-- Избегайте импорта целых библиотек -->
    <!-- ПЛОХО: import * as Lodash from 'lodash' -->
    <!-- ХОРОШО: import { debounce } from 'lodash-es' -->
    <heavy-component v-if="showAdvanced" />
  </div>
</template>

<script>
// Плохо - импорт всей библиотеки
// import * as Chart from 'chart.js'

// Хорошо - импорт только нужных частей
import { Chart, registerables } from 'chart.js'
Chart.register(...registerables)

// Еще лучше - ленивая загрузка
const HeavyComponent = () => import('./HeavyComponent.vue')

export default {
  components: {
    HeavyComponent
  },
  data() {
    return {
      showAdvanced: false
    }
  }
}
</script>
```

### 3. Сравнение сборок

Для мониторинга изменений размера бандла между версиями:

```js
// scripts/bundle-size-report.js
const fs = require('fs');
const path = require('path');

function analyzeBundleSizes(distPath) {
  const files = fs.readdirSync(distPath);
  const jsFiles = files.filter(file => file.endsWith('.js'));
  
  const sizes = jsFiles.map(file => {
    const filePath = path.join(distPath, file);
    const stats = fs.statSync(filePath);
    return {
      name: file,
      size: stats.size,
      sizeKB: (stats.size / 1024).toFixed(2) + ' KB'
    };
  });
  
  sizes.sort((a, b) => b.size - a.size);
  
  console.log('=== Размеры файлов бандла ===');
  sizes.forEach(file => {
    console.log(`${file.name}: ${file.sizeKB}`);
  });
  
  const totalSize = sizes.reduce((sum, file) => sum + file.size, 0);
  console.log(`\nОбщий размер JS: ${(totalSize / 1024).toFixed(2)} KB`);
}

// Использование: node scripts/bundle-size-report.js dist
analyzeBundleSizes(process.argv[2] || 'dist');
```

## Оптимизация на основе анализа

### 1. Удаление неиспользуемых зависимостей

```bash
# Поиск неиспользуемых зависимостей
npm install -g depcheck
depcheck

# Удаление неиспользуемых зависимостей
npm prune
```

### 2. Оптимизация импортов

```js
// Было
import * as Lodash from 'lodash'
const result = Lodash.debounce(func, 300)

// Стало
import { debounce } from 'lodash-es'
const result = debounce(func, 300)
```

### 3. Использование альтернативных библиотек

```js
// Вместо moment.js (67KB gzipped)
// import moment from 'moment'

// Использовать day.js (2KB gzipped)
import dayjs from 'dayjs'
```

### 4. Tree Shaking

Убедитесь, что ваша конфигурация поддерживает tree shaking:

```js
// vite.config.js
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        format: 'es', // ES modules лучше подходят для tree shaking
        manualChunks: {
          // Явное разделение для лучшего tree shaking
          'vue-core': ['vue', 'vue-router'],
          'utils': ['lodash-es', 'axios']
        }
      }
    },
    target: 'es2020', // Поддержка современных возможностей
    cssCodeSplit: true // Разделение CSS
  }
})
```

## Мониторинг в CI/CD

### Интеграция с GitHub Actions

```yaml
# .github/workflows/bundle-size.yml
name: Bundle Size Check
on:
  pull_request:
    branches: [main]

jobs:
  bundle-size:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Build project
        run: npm run build
        
      - name: Check bundle size
        uses: preactjs/compressed-size-action@v2
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          build-script: npm run build
          pattern: './dist/**/*'
```

### Использование BundleWatch

```bash
npm install --save-dev bundlewatch
```

```json
// .bundlewatch.config.json
{
  "files": [
    {
      "path": "dist/assets/*.js",
      "maxSize": "250KB"
    },
    {
      "path": "dist/assets/*.css",
      "maxSize": "50KB"
    }
  ],
  "ci": {
    "trackBranches": ["main"],
    "repoBranchBase": "main"
  }
}
```

## Российские особенности

### Работа с ограничениями

В условиях российского интернета в 2025 году:

- Уделяйте особое внимание размеру начального бандла
- Используйте современные форматы сжатия (Brotli)
- Оптимизируйте изображения и медиафайлы
- Учитывайте ограничения на доступ к зарубежным CDN

### Локализация и производительность

- Использование локальных CDN для статических ресурсов
- Минимизация внешних зависимостей
- Оптимизация под медленные соединения

## Заключение

Анализ бандла - важный этап оптимизации Vue приложений, особенно в условиях ограниченной пропускной способности интернета. Регулярный анализ позволяет выявлять проблемы с производительностью на ранних стадиях и поддерживать оптимальный размер бандла. В условиях российского сегмента интернета в 2025 году это становится особенно критичным фактором успеха приложения.

См. также:
- [[Конфигурация-сборки]]
- [[Оптимизация]]
- [[Code-splitting]]
- [[Lazy-loading]]
- [[Vue DevTools]]