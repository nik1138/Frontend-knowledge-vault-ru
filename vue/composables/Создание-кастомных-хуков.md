---
aliases: ["Пользовательские Composables", "Разработка Composables", "Custom Hooks Vue"]
tags: ["#vue", "#composables", "#custom-hooks", "#reactivity", "#frontend-development"]
---

# Создание кастомных хуков (Composables) в Vue 3

## Введение

Composables (или пользовательские хуки) в Vue 3 представляют собой функции, которые инкапсулируют и повторно используют логику с состоянием. Они позволяют извлекать логику компонентов в переиспользуемые функции, что особенно полезно в российской разработке, где важна модульность и поддержка кода.

## Основы создания Composables

### Простой пример Composable

```javascript
// composables/useCounter.js
import { ref } from 'vue'

export function useCounter(initialValue = 0) {
  const count = ref(initialValue)
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => count.value = initialValue

  return {
    count,
    increment,
    decrement,
    reset
  }
}
```

### Использование в компоненте

```vue
<template>
  <div>
    <p>Счетчик: {{ counter.count }}</p>
    <button @click="counter.increment">+</button>
    <button @click="counter.decrement">-</button>
    <button @click="counter.reset">Сброс</button>
  </div>
</template>

<script setup>
import { useCounter } from '@/composables/useCounter'

const counter = useCounter(0)
</script>
```

## Правила именования Composables

В российской разработке принято использовать следующие соглашения:

- Все Composables должны начинаться с префикса `use`
- Использовать camelCase для именования
- Давать описательные имена, отражающие функциональность

### Примеры хороших имен:

- `useUserAuth` - для аутентификации
- `useLocalStorage` - для работы с localStorage
- `useApiData` - для запросов к API
- `useFormValidation` - для валидации форм

## Структура типичного Composable

```javascript
// composables/useUserData.js
import { ref, computed, onMounted } from 'vue'
import { fetchUser } from '@/api/users'

export function useUserData(userId) {
  // Состояние
  const user = ref(null)
  const loading = ref(false)
  const error = ref(null)

  // Вычисляемые свойства
  const isUserLoaded = computed(() => user.value !== null)

  // Методы
  const loadUser = async () => {
    loading.value = true
    error.value = null
    
    try {
      user.value = await fetchUser(userId)
    } catch (err) {
      error.value = err.message
    } finally {
      loading.value = false
    }
  }

  // Жизненный цикл
  onMounted(() => {
    if (userId) {
      loadUser()
    }
  })

  // Возвращаем публичный API
  return {
    user,
    loading,
    error,
    isUserLoaded,
    loadUser
  }
}
```

## Распространенные паттерны

### 1. Composable с опциями

```javascript
// composables/useModal.js
import { ref } from 'vue'

export function useModal(options = {}) {
  const {
    initialOpen = false,
    onClose = () => {},
    onOpen = () => {}
  } = options

  const isOpen = ref(initialOpen)

  const open = () => {
    isOpen.value = true
    onOpen()
  }

  const close = () => {
    isOpen.value = false
    onClose()
  }

  return {
    isOpen,
    open,
    close
  }
}
```

### 2. Composable с событиями

```javascript
// composables/useClickOutside.js
import { onMounted, onUnmounted, ref } from 'vue'

export function useClickOutside(callback) {
  const element = ref(null)

  const handleClick = (event) => {
    if (element.value && !element.value.contains(event.target)) {
      callback()
    }
  }

  onMounted(() => {
    document.addEventListener('click', handleClick)
  })

  onUnmounted(() => {
    document.removeEventListener('click', handleClick)
  })

  return { element }
}
```

### 3. Composable с реактивными параметрами

```javascript
// composables/useDebounce.js
import { ref, watch } from 'vue'

export function useDebounce(value, delay = 300) {
  const debouncedValue = ref(value.value)

  watch(value, (newValue) => {
    setTimeout(() => {
      debouncedValue.value = newValue
    }, delay)
  })

  return debouncedValue
}
```

## Лучшие практики российских разработчиков

### 1. Документирование Composables

```javascript
/**
 * Composable для управления состоянием формы
 * @param {Object} initialValues - Начальные значения формы
 * @returns {Object} Объект с состоянием формы и методами управления
 */
export function useForm(initialValues) {
  // реализация
}
```

### 2. Обработка ошибок

```javascript
// composables/useApiCall.js
import { ref } from 'vue'

export function useApiCall(apiFunction) {
  const data = ref(null)
  const loading = ref(false)
  const error = ref(null)

  const execute = async (...args) => {
    loading.value = true
    error.value = null

    try {
      const result = await apiFunction(...args)
      data.value = result
      return result
    } catch (err) {
      error.value = err
      throw err
    } finally {
      loading.value = false
    }
  }

  return {
    data,
    loading,
    error,
    execute
  }
}
```

### 3. Типизация (для TypeScript проектов)

```typescript
// composables/useUser.ts
import { ref, Ref } from 'vue'

interface User {
  id: number
  name: string
  email: string
}

export function useUser(): {
  user: Ref<User | null>
  loading: Ref<boolean>
  error: Ref<string | null>
  fetchUser: (id: number) => Promise<void>
} {
  const user = ref<User | null>(null)
  const loading = ref(false)
  const error = ref<string | null>(null)

  // реализация
}
```

## Структура директории Composables

В крупных проектах российские разработчики часто организуют структуру следующим образом:

```
composables/
├── auth/
│   ├── useUserAuth.js
│   ├── usePermissions.js
│   └── useToken.js
├── data/
│   ├── useApiData.js
│   ├── usePagination.js
│   └── useFilters.js
├── ui/
│   ├── useModal.js
│   ├── useToast.js
│   └── useDropdown.js
└── utils/
    ├── useLocalStorage.js
    └── useDebounce.js
```

## Заключение

Создание кастомных хуков в Vue 3 позволяет эффективно организовать логику приложения и обеспечивает высокую степень повторного использования кода. Следуя принятым в российской разработке практикам, можно создавать чистый, понятный и поддерживаемый код.

## См. также

- [[Повторное-использование]]
- [[Тестирование-Composables]]
- [[Реактивные-объявления]]
- [[Состояние-формы]]