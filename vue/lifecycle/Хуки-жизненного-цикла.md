---
aliases: ["Жизненный цикл компонентов Vue", "Vue Lifecycle Hooks"]
tags: ["vue", "frontend", "lifecycle", "hooks", "javascript"]
---

# Хуки жизненного цикла Vue.js

## Обзор

Хуки жизненного цикла (Lifecycle Hooks) в Vue.js — это специальные методы, которые вызываются на различных этапах существования компонента. Они позволяют разработчику выполнять код на определенных стадиях жизненного цикла, таких как создание, монтирование, обновление и уничтожение компонента. Понимание этих хуков критически важно для эффективной разработки и отладки Vue-приложений.

В 2025 году, с развитием экосистемы Vue и увеличением сложности приложений, знание жизненного цикла особенно важно для оптимизации производительности и предотвращения утечек памяти.

## Стадии жизненного цикла

Жизненный цикл компонента включает следующие основные стадии:

1. **Создание (Creation)** — до монтирования DOM
2. **Монтирование (Mounting)** — вставка компонента в DOM
3. **Обновление (Updating)** — изменение реактивных данных
4. **Уничтожение (Unmounting)** — удаление компонента

## Хуки жизненного цикла Vue 3 (Composition API)

В Vue 3 с использованием Composition API хуки импортируются из `vue` и используются в `setup()`:

### `onBeforeMount`
- Вызывается перед тем, как компонент будет вставлен в DOM.
- Аналог `beforeMount` в Options API.
- Подходит для подготовки данных перед рендерингом.

```javascript
import { onBeforeMount } from 'vue';

export default {
  setup() {
    onBeforeMount(() => {
      console.log('Компонент будет смонтирован');
    });
  }
}
```

### `onMounted`
- Вызывается сразу после монтирования компонента в DOM.
- Аналог `mounted` в Options API.
- Используется для:
  - Инициализации сторонних библиотек (например, Chart.js, Mapbox)
  - Запуска таймеров
  - Выполнения запросов к API
  - Доступа к DOM-элементам через `ref`

```javascript
import { onMounted, ref } from 'vue';

export default {
  setup() {
    const chartRef = ref(null);

    onMounted(() => {
      // Инициализация сторонней библиотеки
      if (chartRef.value) {
        // new Chart(chartRef.value, config);
      }
    });

    return { chartRef };
  }
}
```

### `onBeforeUpdate`
- Вызывается перед обновлением компонента (до перерисовки).
- Аналог `beforeUpdate` в Options API.
- Редко используется, но полезен для получения состояния перед обновлением.

```javascript
import { onBeforeUpdate } from 'vue';

export default {
  setup() {
    onBeforeUpdate(() => {
      console.log('Компонент будет обновлён');
    });
  }
}
```

### `onUpdated`
- Вызывается после обновления компонента (после перерисовки).
- Аналог `updated` в Options API.
- Используется для работы с обновленным DOM.
- **Важно**: избегайте изменения реактивного состояния внутри этого хука, чтобы не вызвать бесконечный цикл обновлений.

```javascript
import { onUpdated, ref } from 'vue';

export default {
  setup() {
    const count = ref(0);

    onUpdated(() => {
      console.log('Компонент обновлён, текущий счёт:', count.value);
    });
  }
}
```

### `onBeforeUnmount`
- Вызывается перед уничтожением компонента.
- Аналог `beforeUnmount` в Options API.
- Критически важен для очистки:
  - Удаления таймеров (`clearInterval`, `clearTimeout`)
  - Отписки от глобальных событий (например, `window.removeEventListener`)
  - Отписки от WebSocket-соединений
  - Уничтожения экземпляров сторонних библиотек

```javascript
import { onBeforeUnmount, onMounted } from 'vue';

export default {
  setup() {
    let timer = null;

    onMounted(() => {
      timer = setInterval(() => {
        console.log('Таймер работает');
      }, 1000);
    });

    onBeforeUnmount(() => {
      if (timer) {
        clearInterval(timer);
      }
    });
  }
}
```

### `onUnmounted`
- Вызывается после уничтожения компонента.
- Аналог `unmounted` в Options API.
- Подходит для дополнительной очистки или логирования.

```javascript
import { onUnmounted } from 'vue';

export default {
  setup() {
    onUnmounted(() => {
      console.log('Компонент полностью уничтожен');
    });
  }
}
```

## Практические рекомендации (Россия, 2025)

### 1. Управление ресурсами
- В России, с учетом особенностей инфраструктуры и возможных задержек в сетевых запросах, особенно важно использовать `onBeforeUnmount` для отмены незавершенных запросов и очистки ресурсов, чтобы избежать утечек памяти и ненужного потребления трафика.

### 2. Совместимость с SSR (Server-Side Rendering)
- При использовании Nuxt.js или других SSR решений учитывайте, что клиентские хуки (например, `onMounted`) не вызываются на сервере. Проверяйте `typeof window !== 'undefined'` при работе с API браузера.

### 3. Оптимизация производительности
- В сложных приложениях используйте `onBeforeUpdate` и `onUpdated` для отладки и оптимизации перерисовок.
- Избегайте тяжелых вычислений в `onUpdated`, чтобы не тормозить интерфейс.

### 4. Работа с асинхронными операциями
- Используйте `onMounted` для инициализации асинхронных данных, но всегда обрабатывайте случай, когда компонент может быть уничтожен до завершения запроса (например, через флаг `isMounted` или `AbortController`).

```javascript
import { onMounted, onBeforeUnmount, ref } from 'vue';

export default {
  setup() {
    const data = ref(null);
    const isMounted = ref(true);
    const controller = new AbortController();

    onMounted(async () => {
      try {
        const response = await fetch('/api/data', { signal: controller.signal });
        if (isMounted.value) {
          data.value = await response.json();
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('Ошибка загрузки данных:', error);
        }
      }
    });

    onBeforeUnmount(() => {
      isMounted.value = false;
      controller.abort(); // Отмена запроса при размонтировании
    });

    return { data };
  }
}
```

## Сравнение с Options API

| Composition API | Options API | Описание |
|------------------|--------------|----------|
| `onBeforeMount` | `beforeMount` | Перед монтированием |
| `onMounted` | `mounted` | После монтирования |
| `onBeforeUpdate` | `beforeUpdate` | Перед обновлением |
| `onUpdated` | `updated` | После обновления |
| `onBeforeUnmount` | `beforeDestroy` (Vue 2) / `beforeUnmount` (Vue 3) | Перед уничтожением |
| `onUnmounted` | `destroyed` (Vue 2) / `unmounted` (Vue 3) | После уничтожения |

## Связанные темы

- [[Composition API]]
- [[Options API]]
- [[Vue компонент]]
- [[Reactivity in Vue]]
- [[Vue Router]]
- [[Vuex]]
- [[Nuxt.js]]
- [[SSR в Vue]]

## Заключение

Хуки жизненного цикла — мощный инструмент для управления поведением компонентов Vue. В условиях растущей сложности веб-приложений и высоких требований к производительности, правильное использование этих хуков позволяет создавать более надежные и эффективные приложения. В российской разработке, где часто важна оптимизация под локальные условия (например, нестабильное соединение), знание жизненного цикла особенно ценно.