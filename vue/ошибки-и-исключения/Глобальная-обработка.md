---
aliases: [Глобальная обработка ошибок, Централизованная обработка ошибок, Глобальный обработчик ошибок]
tags: [vue, global-error-handling, error-boundary, frontend, javascript]
---

# Глобальная обработка ошибок в Vue.js

## Введение

Глобальная обработка ошибок в Vue.js позволяет централизованно управлять ошибками, возникающими во всем приложении. Это важный аспект разработки надежных приложений, особенно в условиях российской разработки 2025 года, где требования к стабильности и контролю ошибок становятся все более строгими. Глобальный обработчик ошибок помогает предотвратить падение всего приложения при возникновении ошибки в одном из компонентов.

## Встроенные глобальные обработчики Vue

### config.errorHandler

Основной механизм глобальной обработки ошибок в Vue:

```javascript
import { createApp } from 'vue'
import App from './App.vue'

const app = createApp(App)

// Глобальный обработчик ошибок
app.config.errorHandler = (err, instance, info) => {
  console.error('Глобальная ошибка:', err)
  console.error('Компонент:', instance?.$options.name)
  console.error('Информация:', info)
  
  // Отправка ошибки в систему мониторинга
  reportErrorToService(err, instance, info)
  
  // Дополнительная обработка в зависимости от типа ошибки
  if (err.name === 'NetworkError') {
    handleNetworkError(err)
  } else if (err.name === 'AuthError') {
    handleAuthError(err)
  }
}

function reportErrorToService(err, instance, info) {
  // Отправка ошибки в удаленную систему
  fetch('/api/errors', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message: err.message,
      stack: err.stack,
      component: instance?.$options.name,
      info: info,
      url: window.location.href,
      userAgent: navigator.userAgent,
      timestamp: new Date().toISOString()
    })
  }).catch(e => {
    console.error('Ошибка отправки отчета об ошибке:', e)
  })
}

function handleNetworkError(err) {
  // Обработка сетевых ошибок
  console.log('Обработка сетевой ошибки:', err)
}

function handleAuthError(err) {
  // Обработка ошибок аутентификации
  console.log('Обработка ошибки аутентификации:', err)
}
```

### config.warnHandler

Обработчик предупреждений Vue:

```javascript
// В режиме разработки
if (process.env.NODE_ENV === 'development') {
  app.config.warnHandler = (msg, instance, trace) => {
    console.warn(`[Vue Предупреждение]: ${msg}`)
    console.warn(`Компонент: ${instance?.$options.name}`)
    console.warn(`Трассировка: ${trace}`)
    
    // В производстве можно отправлять предупреждения в систему мониторинга
    if (process.env.NODE_ENV === 'production') {
      reportWarningToService(msg, instance, trace)
    }
  }
}
```

## Реализация глобального обработчика ошибок

### Создание плагина для глобальной обработки

```javascript
// plugins/globalErrorHandler.js
import { createApp } from 'vue'

export default {
  install(app, options = {}) {
    const {
      onError = null,
      onWarning = null,
      logLevel = 'error',
      reportingService = null
    } = options

    // Глобальный обработчик ошибок
    app.config.errorHandler = (err, instance, info) => {
      // Вызов пользовательской обработки
      if (onError) {
        onError(err, instance, info)
      } else {
        // Стандартная обработка
        defaultErrorHandler(err, instance, info, reportingService)
      }
    }

    // Обработчик предупреждений
    if (onWarning) {
      app.config.warnHandler = (msg, instance, trace) => {
        onWarning(msg, instance, trace)
      }
    }

    // Обработчик не перехваченных Promise ошибок
    window.addEventListener('unhandledrejection', event => {
      console.error('Не перехваченный Promise:', event.reason)
      if (reportingService) {
        reportingService.report(event.reason, 'unhandled-promise')
      }
      // Предотвращение стандартного поведения (console.error)
      event.preventDefault()
    })

    // Обработчик ошибок JavaScript
    window.addEventListener('error', event => {
      console.error('Ошибка JavaScript:', event.error)
      if (reportingService) {
        reportingService.report(event.error, 'javascript-error')
      }
    })
  }
}

function defaultErrorHandler(err, instance, info, reportingService) {
  console.error('Vue ошибка:', {
    message: err.message,
    stack: err.stack,
    component: instance?.$options.name,
    info: info,
    timestamp: new Date().toISOString()
  })

  // Отправка в систему отчетности
  if (reportingService) {
    reportingService.report(err, 'vue-error', {
      component: instance?.$options.name,
      info: info
    })
  }
}
```

### Использование плагина

```javascript
// main.js
import { createApp } from 'vue'
import App from './App.vue'
import GlobalErrorHandler from './plugins/globalErrorHandler'
import ReportingService from './services/ReportingService'

const app = createApp(App)

// Установка глобального обработчика ошибок
app.use(GlobalErrorHandler, {
  reportingService: new ReportingService(),
  onError: (err, instance, info) => {
    // Пользовательская логика обработки ошибки
    console.error('Кастомная обработка ошибки:', err)
  }
})

app.mount('#app')
```

## Глобальные обработчики для разных окружений

### Различная обработка в разработке и продакшене

```javascript
// utils/environmentErrorHandler.js
class EnvironmentErrorHandler {
  constructor() {
    this.isProduction = process.env.NODE_ENV === 'production'
  }

  setupGlobalHandlers(app) {
    if (this.isProduction) {
      this.setupProductionHandlers(app)
    } else {
      this.setupDevelopmentHandlers(app)
    }
  }

  setupDevelopmentHandlers(app) {
    // В разработке - больше информации для отладки
    app.config.errorHandler = (err, instance, info) => {
      console.group('❌ Ошибка Vue')
      console.error('Сообщение:', err.message)
      console.error('Стек:', err.stack)
      console.error('Компонент:', instance?.$options.name)
      console.error('Информация:', info)
      console.groupEnd()
      
      // Отправка в систему отладки
      this.sendToDebugService(err, instance, info)
    }

    app.config.warnHandler = (msg, instance, trace) => {
      console.warn(`[Vue Варнинг] ${msg}`)
      console.warn('Компонент:', instance?.$options.name)
      console.warn('Трассировка:', trace)
    }
  }

  setupProductionHandlers(app) {
    // В продакшене - минимизация информации, максимизация отчетности
    app.config.errorHandler = (err, instance, info) => {
      console.error('Произошла ошибка в приложении')
      
      // Отправка подробной информации в систему мониторинга
      this.sendToReportingService(err, instance, info)
      
      // Показ пользовательского интерфейса ошибки (если возможно)
      this.showUserErrorInterface()
    }
  }

  sendToDebugService(err, instance, info) {
    // Отправка в систему отладки (например, собственный логгер)
    console.debug('Отладочная информация об ошибке:', {
      error: err,
      component: instance?.$options.name,
      info: info,
      userAgent: navigator.userAgent,
      url: window.location.href
    })
  }

  sendToReportingService(err, instance, info) {
    // Отправка в систему мониторинга ошибок
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: err.message,
        stack: err.stack,
        component: instance?.$options.name,
        info: info,
        userAgent: navigator.userAgent,
        url: window.location.href,
        timestamp: new Date().toISOString()
      })
    }).catch(e => {
      console.error('Не удалось отправить отчет об ошибке:', e)
    })
  }

  showUserErrorInterface() {
    // Показ пользовательского интерфейса ошибки
    // Например, всплывающее окно или специальный компонент
    const errorOverlay = document.getElementById('global-error-overlay')
    if (errorOverlay) {
      errorOverlay.style.display = 'block'
    }
  }
}

export default new EnvironmentErrorHandler()
```

## Error Boundary компоненты

### Создание компонента Error Boundary

```vue
<!-- components/ErrorBoundary.vue -->
<template>
  <div v-if="!error" class="error-boundary">
    <slot />
  </div>
  <div v-else class="error-boundary-fallback">
    <h2>Произошла ошибка</h2>
    <p>{{ error.message }}</p>
    <details v-if="showDetails" class="error-details">
      <pre>{{ error.stack }}</pre>
    </details>
    <div class="error-actions">
      <button @click="retry" class="retry-button">Попробовать снова</button>
      <button @click="toggleDetails" class="details-button">
        {{ showDetails ? 'Скрыть' : 'Показать' }} детали
      </button>
      <button @click="reportError" class="report-button">Сообщить об ошибке</button>
    </div>
  </div>
</template>

<script>
export default {
  name: 'ErrorBoundary',
  props: {
    showDialog: {
      type: Boolean,
      default: true
    }
  },
  data() {
    return {
      error: null,
      showDetails: false
    }
  },
  methods: {
    async retry() {
      this.error = null
      this.showDetails = false
      
      // Опционально: сброс состояния родительского компонента
      if (this.$parent) {
        // Сброс ключа для пересоздания компонента
        if (this.$parent.$vnode) {
          this.$parent.$vnode.key = Date.now()
        }
      }
    },
    
    toggleDetails() {
      this.showDetails = !this.showDetails
    },
    
    reportError() {
      // Отправка ошибки в систему отчетности
      if (this.error) {
        fetch('/api/errors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: this.error.message,
            stack: this.error.stack,
            component: this.$parent?.$options.name,
            url: window.location.href,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString()
          })
        })
      }
    }
  },
  
  errorCaptured(err, instance, info) {
    this.error = err
    console.error('Ошибка перехвачена ErrorBoundary:', err, info)
    
    // Опционально: отправка в глобальную систему отчетности
    if (window.globalErrorHandler) {
      window.globalErrorHandler.captureError(err, instance, info)
    }
    
    // Предотвращение распространения ошибки выше
    return false
  }
}
</script>

<style scoped>
.error-boundary-fallback {
  padding: 20px;
  border: 2px solid #ff6b6b;
  border-radius: 8px;
  background-color: #fff5f5;
  color: #333;
}

.error-details {
  margin-top: 10px;
  padding: 10px;
  background-color: #f8f9fa;
  border-radius: 4px;
  max-height: 200px;
  overflow-y: auto;
}

.error-actions {
  margin-top: 15px;
}

.retry-button, .details-button, .report-button {
  margin-right: 10px;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.retry-button {
  background-color: #007bff;
  color: white;
}

.details-button {
  background-color: #6c757d;
  color: white;
}

.report-button {
  background-color: #dc3545;
  color: white;
}
</style>
```

### Использование Error Boundary

```vue
<!-- App.vue -->
<template>
  <div id="app">
    <ErrorBoundary>
      <router-view />
    </ErrorBoundary>
  </div>
</template>

<script>
import ErrorBoundary from './components/ErrorBoundary.vue'

export default {
  name: 'App',
  components: {
    ErrorBoundary
  }
}
</script>
```

## Управление состоянием ошибок

### Глобальное состояние ошибок

```javascript
// store/modules/errors.js
export default {
  namespaced: true,
  
  state: {
    errors: [],
    globalError: null,
    errorCount: 0,
    lastErrorTime: null
  },
  
  mutations: {
    ADD_ERROR(state, error) {
      state.errors.push({
        ...error,
        id: Date.now() + Math.random(),
        timestamp: new Date().toISOString()
      })
      state.errorCount++
      state.lastErrorTime = new Date().toISOString()
    },
    
    SET_GLOBAL_ERROR(state, error) {
      state.globalError = error
    },
    
    CLEAR_GLOBAL_ERROR(state) {
      state.globalError = null
    },
    
    CLEAR_ERRORS(state) {
      state.errors = []
      state.errorCount = 0
    }
  },
  
  actions: {
    addError({ commit }, error) {
      commit('ADD_ERROR', error)
      
      // Отправка в систему отчетности
      this._vm.$reportingService.report(error)
    },
    
    setGlobalError({ commit }, error) {
      commit('SET_GLOBAL_ERROR', error)
    },
    
    clearGlobalError({ commit }) {
      commit('CLEAR_GLOBAL_ERROR')
    }
  },
  
  getters: {
    recentErrors: (state) => (minutes = 5) => {
      const cutoff = new Date()
      cutoff.setMinutes(cutoff.getMinutes() - minutes)
      
      return state.errors.filter(error => 
        new Date(error.timestamp) > cutoff
      )
    },
    
    errorRate: (state) => {
      if (!state.lastErrorTime) return 0
      
      const timeDiff = (new Date() - new Date(state.lastErrorTime)) / 1000 / 60 // в минутах
      return state.errorCount / timeDiff
    }
  }
}
```

### Интеграция с глобальным обработчиком

```javascript
// plugins/vuexErrorHandler.js
export default {
  install(app, store) {
    app.config.errorHandler = (err, instance, info) => {
      // Сохранение ошибки в хранилище
      store.dispatch('errors/addError', {
        message: err.message,
        stack: err.stack,
        component: instance?.$options.name,
        info: info,
        url: window.location.href,
        userAgent: navigator.userAgent
      })
      
      // Показ глобального интерфейса ошибки
      showGlobalErrorUI(err)
    }
  }
}

function showGlobalErrorUI(err) {
  // Показ пользовательского интерфейса ошибки
  const errorElement = document.createElement('div')
  errorElement.id = 'global-vue-error'
  errorElement.innerHTML = `
    <div style="position: fixed; top: 20px; right: 20px; background: #ff6b6b; color: white; padding: 15px; border-radius: 5px; z-index: 9999;">
      <h4>Произошла ошибка в приложении</h4>
      <p>${err.message}</p>
      <button onclick="this.parentElement.remove()" style="background: white; color: #ff6b6b; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Закрыть</button>
    </div>
  `
  document.body.appendChild(errorElement)
}
```

## Лучшие практики глобальной обработки

1. **Не замалчивать ошибки** - всегда обрабатывать или логировать
2. **Отделять разработку и продакшен** - разное поведение в разных окружениях
3. **Использовать Error Boundary компоненты** - для изоляции ошибок
4. **Отправлять ошибки в систему мониторинга** - для анализа и улучшения
5. **Предоставлять пользовательский интерфейс ошибок** - информировать пользователя
6. **Ограничивать количество отправляемых ошибок** - избегать флуда систему

## Связь с другими концепциями

- [[Обработка-ошибок]] - основы обработки ошибок
- [[Логирование-ошибок]] - системы логирования ошибок
- [[Восстановление-после-ошибок]] - восстановление после ошибок
- [[Тестирование-обработки-ошибок]] - проверка глобальных обработчиков

## Заключение

Глобальная обработка ошибок в Vue.js - это фундаментальный элемент надежного веб-приложения. В условиях российской разработки 2025 года, где важна стабильность и контролируемость систем, правильно реализованные глобальные обработчики ошибок обеспечивают:

1. Централизованный контроль над ошибками
2. Улучшенный пользовательский опыт
3. Возможность анализа и улучшения приложения
4. Быстрое реагирование на проблемы

Эффективная глобальная обработка ошибок требует сочетания встроенных механизмов Vue, пользовательских компонентов и систем мониторинга.