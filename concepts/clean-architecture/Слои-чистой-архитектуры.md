---
aliases: ["Слои чистой архитектуры", "Архитектурные слои"]
tags: 
  - "#архитектура"
  - "#слои"
  - "#принципы-программирования"
---

# Слои чистой архитектуры

Чистая архитектура организована в виде концентрических колец, где каждый слой имеет определенную ответственность. Внешние слои зависят от внутренних, но не наоборот. Давайте рассмотрим каждый слой подробно.

## Слой сущностей

**Слой сущностей** (Entities) содержит бизнес-объекты приложения. Это самые внутренние и фундаментальные бизнес-правила, которые будут существовать независимо от остальной части системы.

```python
# Пример сущности в Python
class User:
    def __init__(self, user_id, name, email):
        self.user_id = user_id
        self.name = name
        self.email = email
    
    def change_email(self, new_email):
        # Бизнес-правило: проверка формата email
        if "@" in new_email:
            self.email = new_email
        else:
            raise ValueError("Invalid email format")
```

### Характеристики слоя сущностей:
- Содержит бизнес-объекты
- Не зависит от внешних факторов
- Содержит фундаментальные бизнес-правила
- Может быть переиспользован в других приложениях

> [!info] Важно
> Слой сущностей не должен зависеть от базы данных, веб-фреймворков или любых внешних библиотек.

## Слой сценариев использования

**Слой сценариев использования** (Use Cases) содержит бизнес-логику, специфичную для конкретного приложения. Он координирует работу сущностей и направляет их выполнение.

```python
# Пример сценария использования
class RegisterUserUseCase:
    def __init__(self, user_repository, email_service):
        self.user_repository = user_repository
        self.email_service = email_service
    
    def execute(self, name, email):
        # Создание нового пользователя
        user = User(None, name, email)
        
        # Проверка уникальности email
        if self.user_repository.exists_by_email(email):
            raise ValueError("User with this email already exists")
        
        # Сохранение пользователя
        saved_user = self.user_repository.save(user)
        
        # Отправка приветственного письма
        self.email_service.send_welcome_email(saved_user.email)
        
        return saved_user
```

### Характеристики слоя сценариев использования:
- Содержит бизнес-логику приложения
- Не зависит от UI, базы данных или внешних фреймворков
- Определяет, как данные будут передаваться между сущностями
- Реализует конкретные бизнес-сценарии

## Слой интерфейсных адаптеров

**Слой интерфейсных адаптеров** (Interface Adapters) преобразует данные из формата, удобного для внутренних слоев, в формат, удобный для внешних слоев, и наоборот.

```python
# Пример контроллера в слое интерфейсных адаптеров
class UserController:
    def __init__(self, register_user_use_case):
        self.register_user_use_case = register_user_use_case
    
    def register_user(self, request_data):
        name = request_data.get('name')
        email = request_data.get('email')
        
        try:
            user = self.register_user_use_case.execute(name, email)
            return {
                'status': 'success',
                'user_id': user.user_id,
                'message': 'User registered successfully'
            }
        except ValueError as e:
            return {
                'status': 'error',
                'message': str(e)
            }
```

### Характеристики слоя интерфейсных адаптеров:
- Преобразует данные между слоями
- Содержит адаптеры для UI, базы данных и других внешних сервисов
- Могут включать контроллеры, презентеры, сериализаторы
- Зависит от внутренних слоев, но не наоборот

## Слой фреймворков и драйверов

**Слой фреймворков и драйверов** (Frameworks & Drivers) - это самый внешний слой, который содержит все внешние зависимости: веб-фреймворки, базы данных, внешние API и т.д.

```python
# Пример реализации репозитория в слое фреймворков
from sqlalchemy import create_engine, Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

Base = declarative_base()

class UserEntity(Base):
    __tablename__ = 'users'
    
    id = Column(Integer, primary_key=True)
    name = Column(String(50))
    email = Column(String(100))

class SqlUserRepository:
    def __init__(self, session):
        self.session = session
    
    def save(self, user):
        db_user = UserEntity(name=user.name, email=user.email)
        self.session.add(db_user)
        self.session.commit()
        user.user_id = db_user.id
        return user
    
    def exists_by_email(self, email):
        return self.session.query(UserEntity).filter_by(email=email).first() is not None
```

### Характеристики слоя фреймворков и драйверов:
- Содержит внешние зависимости
- Реализует интерфейсы, определенные внутренними слоями
- Включает фреймворки, базы данных, веб-серверы
- Полностью зависит от внутренних слоев

## Правило зависимости

Важно помнить, что **зависимости всегда направлены внутрь**:

```
[Фреймворки и драйверы] → [Интерфейсные адаптеры] → [Сценарии использования] → [Сущности]
```

Это означает, что внешние слои могут зависеть от внутренних, но внутренние слои не должны зависеть от внешних.

## Визуализация архитектуры

Архитектура может быть представлена в виде концентрических колец:

```
┌─────────────────────────────────────┐
│   Фреймворки и драйверы            │
│   (Frameworks & Drivers)           │
├─────────────────────────────────────┤
│   Интерфейсные адаптеры            │
│   (Interface Adapters)             │
├─────────────────────────────────────┤
│   Сценарии использования           │
│   (Use Cases)                      │
├─────────────────────────────────────┤
│   Сущности                         │
│   (Entities)                       │
└─────────────────────────────────────┘
```

## Связанные концепции

- [[Чистая-архитектура]]
- [[Инверсия-зависимостей]]
- [[Зависимости-и-их-управление]]
- [[Разделение-ответственности]]

## Теги

#архитектура #слои #принципы-программирования #чистая-архитектура