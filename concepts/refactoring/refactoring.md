---
aliases: ["Рефакторинг", "Рефакторинг кода"]
tags: [programming, refactoring, code-quality, clean-code]
---

# Рефакторинг

## Определение рефакторинга

**Рефакторинг** — это процесс изменения внутренней структуры кода без изменения его внешнего поведения. Цель рефакторинга — улучшить читаемость, поддерживаемость и понятность кода, не добавляя новых функций.

> [!tip] Основная идея
> Рефакторинг делает код проще и понятнее, не изменяя его функциональности.

## Когда рефакторить

Рефакторинг необходим в следующих ситуациях:

- Код сложно понимать и изменять
- Повторяющийся код (дублирование)
- Методы слишком длинные
- Сложные условия и ветвления
- При добавлении новых функций
- При исправлении багов
- В процессе код-ревью

## Принципы рефакторинга

1. **Тесты в приоритете** — перед рефакторингом убедитесь, что у вас есть тесты
2. **Маленькие шаги** — выполняйте изменения постепенно
3. **Постоянная проверка** — регулярно запускайте тесты во время рефакторинга
4. **Ясность и читаемость** — код должен быть понятным для других разработчиков
5. **Единообразие** — следуйте принятому стилю кодирования в проекте

## Техники рефакторинга

### Извлечение метода (Extract Method)

Преобразование части кода в отдельный метод:

```javascript
// До рефакторинга
function printOwing(invoice) {
  printBanner();
  console.log(`name: ${invoice.customer}`);
  console.log(`amount: ${invoice.amount}`);
}

// После рефакторинга
function printOwing(invoice) {
  printBanner();
  printDetails(invoice);
}

function printDetails(invoice) {
  console.log(`name: ${invoice.customer}`);
  console.log(`amount: ${invoice.amount}`);
}
```

### Переименование (Rename)

Изменение имен переменных, методов или классов для лучшего понимания:

```javascript
// До
const d = 86400000; // миллисекунд в дне

// После
const MILLISECONDS_PER_DAY = 86400000;
```

### Перемещение метода (Move Method)

Перемещение метода в более подходящий класс:

```javascript
class Account {
  // Метод лучше подходит к классу AccountType
  interestForAmount_days(amount, days) {
    return amount * this.accountType.interestRate * days / 365;
  }
}

// После перемещения
class AccountType {
  interestForAmount_days(amount, days) {
    return amount * this.interestRate * days / 365;
  }
}
```

### Извлечение класса (Extract Class)

Создание нового класса из части функциональности существующего:

```javascript
// До
class Person {
  constructor(name, officeAreaCode, officeNumber) {
    this.name = name;
    this.officeAreaCode = officeAreaCode;
    this.officeNumber = officeNumber;
  }
}

// После
class Person {
  constructor(name, areaCode, number) {
    this.name = name;
    this.telephoneNumber = new TelephoneNumber(areaCode, number);
  }
}

class TelephoneNumber {
  constructor(areaCode, number) {
    this.areaCode = areaCode;
    this.number = number;
  }
}
```

## Тестирование во время рефакторинга

- Пишите тесты до начала рефакторинга
- Используйте юнит-тесты для проверки корректности изменений
- Регулярно запускайте тесты после каждого шага рефакторинга
- Используйте интеграционные тесты для проверки взаимодействия компонентов
- Не добавляйте новые функции во время рефакторинга

## Запахи кода (Code Smells)

### Длинные методы
- Методы более 10-20 строк
- Решение: извлеките методы

### Длинные параметры
- Методы с 3+ параметрами
- Решение: объедините параметры в объект

### Повторяющийся код
- Одинаковая логика в разных местах
- Решение: извлеките общий метод

### Глобальные переменные
- Использование глобальных данных
- Решение: инкапсулируйте в класс или модуль

## Автоматизированные инструменты

### IDE-инструменты
- **IntelliJ IDEA/WebStorm**: рефакторинг методов, классов, переменных
- **Visual Studio Code**: расширения для рефакторинга
- **Visual Studio**: встроенные инструменты рефакторинга

### Инструменты анализа
- **ESLint**: выявление запахов кода
- **SonarQube**: анализ качества кода
- **CodeClimate**: автоматический рефакторинг

## Рефакторинг vs Переписывание

| Рефакторинг | Переписывание |
|-------------|---------------|
| Сохраняет функциональность | Может изменить поведение |
| Пошаговый процесс | Часто одномоментное изменение |
| Поддержка тестов | Тестирование после завершения |
| Меньший риск | Высокий риск |
| Улучшает существующий код | Создает новый код |

## Влияние на командные процессы

### Код-ревью
- Рефакторинг должен быть отдельным этапом
- Комментарии должны касаться улучшений, а не функциональности
- Используйте отдельные пулл-реквесты для рефакторинга

### Совместная работа
- Согласуйте стандарты рефакторинга в команде
- Обучайте новых членов команды техникам рефакторинга
- Используйте автоматизированные инструменты в CI/CD

### Управление рисками
- Планируйте рефакторинг в спринтах
- Оценивайте сложность изменений
- Документируйте принятые решения

## Связи с другими концепциями

- [[clean-code]] — принципы написания чистого кода
- [[testing]] — тестирование и его роль в рефакторинге
- [[code-quality]] — метрики и оценка качества кода
- [[design-patterns]] — паттерны проектирования, используемые при рефакторинге
- [[architecture/dependency-injection]] — внедрение зависимостей как способ улучшения тестируемости

## Заключение

Рефакторинг — важная часть разработки программного обеспечения, которая помогает поддерживать высокое качество кода. Регулярный рефакторинг делает код более понятным, упрощает сопровождение и снижает вероятность ошибок. Правильный подход к рефакторингу включает тестирование, пошаговые изменения и командную работу.