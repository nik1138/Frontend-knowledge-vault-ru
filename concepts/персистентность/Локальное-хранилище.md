---
aliases: [LocalStorage, Local Storage]
tags: [frontend, persistence, storage, javascript]
---

# Локальное хранилище (LocalStorage)

**Локальное хранилище** (LocalStorage) - это механизм веб-браузера, который позволяет веб-приложениям хранить данные локально в браузере пользователя без ограничения по времени действия. Данные, сохраненные в LocalStorage, остаются доступными даже после перезагрузки страницы или закрытия браузера.

## Основные характеристики

- **Персистентность**: Данные сохраняются до тех пор, пока пользователь или приложение не удалит их
- **Объем**: Обычно доступно от 5 до 10 МБ (в зависимости от браузера)
- **Доступ**: Только из того же домена/origin
- **Формат**: Только строковые данные (необходима сериализация для объектов)

## API LocalStorage

### Сохранение данных

```javascript
// Сохранение строки
localStorage.setItem('ключ', 'значение');

// Сохранение объекта (с сериализацией)
const пользователь = { имя: 'Иван', возраст: 30 };
localStorage.setItem('пользователь', JSON.stringify(пользователь));

// Сохранение числа
localStorage.setItem('счетчик', '42');
```

### Получение данных

```javascript
// Получение строки
const значение = localStorage.getItem('ключ');

// Получение объекта (с десериализацией)
const пользователь = JSON.parse(localStorage.getItem('пользователь'));

// Получение числа
const счетчик = parseInt(localStorage.getItem('счетчик'));
```

### Удаление данных

```javascript
// Удаление конкретного ключа
localStorage.removeItem('ключ');

// Очистка всего хранилища
localStorage.clear();
```

### Получение ключа по индексу

```javascript
// Получение ключа по индексу
const ключ = localStorage.key(0);
```

## Практические примеры использования

### Сохранение пользовательских настроек

```javascript
// Сохранение настроек темы
function сохранитьНастройкиТемы(тема) {
  localStorage.setItem('настройки_темы', JSON.stringify({
    тема: тема,
    время: new Date().toISOString()
  }));
}

// Загрузка настроек темы
function загрузитьНастройкиТемы() {
  const настройки = localStorage.getItem('настройки_темы');
  return настройки ? JSON.parse(настройки) : { тема: 'светлая' };
}

// Пример использования
сохранитьНастройкиТемы('тёмная');
const текущаяТема = загрузитьНастройкиТемы();
console.log(текущаяТема.тема); // 'тёмная'
```

### Сохранение состояния формы

```javascript
// Сохранение данных формы при вводе
function инициализироватьСохранениеФормы() {
  const форма = document.getElementById('форма-данных');
  const поля = форма.querySelectorAll('input, textarea, select');
  
  // Загрузка сохранённых данных при загрузке
  поля.forEach(поле => {
    const сохранённоеЗначение = localStorage.getItem(`форма_данных_${поле.name}`);
    if (сохранённоеЗначение) {
      if (поле.type === 'checkbox' || поле.type === 'radio') {
        поле.checked = сохранённоеЗначение === 'true';
      } else {
        поле.value = сохранённоеЗначение;
      }
    }
    
    // Сохранение при изменении
    поле.addEventListener('input', () => {
      let значение = поле.value;
      if (поле.type === 'checkbox' || поле.type === 'radio') {
        значение = поле.checked ? 'true' : 'false';
      }
      localStorage.setItem(`форма_данных_${поле.name}`, значение);
    });
  });
}

// Очистка данных формы при успешной отправке
function очиститьСохранённыеДанныеФормы() {
  Object.keys(localStorage).forEach(ключ => {
    if (ключ.startsWith('форма_данных_')) {
      localStorage.removeItem(ключ);
    }
  });
}
```

## Преимущества LocalStorage

- **Простота использования**: Прямой доступ к данным без необходимости подключения к серверу
- **Синхронный доступ**: Данные доступны немедленно
- **Широкая поддержка**: Поддерживается всеми современными браузерами
- **Не влияет на производительность**: Не создает нагрузку на сервер

## Ограничения и недостатки

- **Ограничение объема**: Обычно 5-10 МБ на домен
- **Только строковые данные**: Необходима сериализация для сложных объектов
- **Синхронная работа**: Может блокировать основной поток при работе с большими объемами данных
- **Отсутствие контроля версий**: Нет встроенной поддержки версионирования данных
- **Безопасность**: Данные могут быть доступны другим скриптам на том же домене

## Лучшие практики

### 1. Обработка ошибок

```javascript
function безопасныйLocalStorage(действие, ...аргументы) {
  try {
    return действие(...аргументы);
  } catch (ошибка) {
    if (ошибка.name === 'QuotaExceededError') {
      console.warn('LocalStorage переполнен. Очистка старых данных...');
      // Очистка старых данных или уведомление пользователя
      очиститьСтарыеДанные();
    } else {
      console.error('Ошибка работы с LocalStorage:', ошибка);
    }
    return null;
  }
}

function безопасныйSetItem(ключ, значение) {
  return безопасныйLocalStorage(localStorage.setItem, ключ, значение);
}

function безопасныйGetItem(ключ) {
  return безопасныйLocalStorage(localStorage.getItem, ключ);
}
```

### 2. Сериализация и десериализация

```javascript
class LocalStorageManager {
  static set(ключ, данные) {
    try {
      const сериализованныеДанные = JSON.stringify(данные);
      localStorage.setItem(ключ, сериализованныеДанные);
      return true;
    } catch (ошибка) {
      console.error(`Ошибка сохранения данных с ключом "${ключ}":`, ошибка);
      return false;
    }
  }

  static get(ключ) {
    try {
      const сериализованныеДанные = localStorage.getItem(ключ);
      return сериализованныеДанные ? JSON.parse(сериализованныеДанные) : null;
    } catch (ошибка) {
      console.error(`Ошибка получения данных с ключом "${ключ}":`, ошибка);
      return null;
    }
  }

  static remove(ключ) {
    localStorage.removeItem(ключ);
  }
}
```

### 3. Валидация данных

```javascript
function получитьДанныеСВалидацией(ключ, валидатор) {
  const данные = LocalStorageManager.get(ключ);
  if (данные && валидатор(данные)) {
    return данные;
  }
  return null;
}

// Пример валидатора
const валидаторПользователя = (данные) => {
  return данные && 
         typeof данные === 'object' && 
         typeof данные.имя === 'string' && 
         typeof данные.возраст === 'number';
};
```

## Сравнение с другими методами хранения

| Метод | Персистентность | Объем | Доступ | Синхронность |
|-------|----------------|-------|--------|--------------|
| LocalStorage | Постоянная | ~5-10 МБ | Тот же origin | Синхронный |
| [[Сессионное-хранилище]] | Сессия | ~5-10 МБ | Тот же origin | Синхронный |
| [[Куки]] | Настроена | ~4 КБ | Тот же origin + сервер | Синхронный |
| [[IndexedDB]] | Постоянная | ~Много | Тот же origin | Асинхронный |

## События изменения хранилища

LocalStorage поддерживает событие `storage`, которое срабатывает при изменении данных в другом окне/вкладке:

```javascript
window.addEventListener('storage', (событие) => {
  console.log(`Ключ "${событие.key}" изменился с "${событие.oldValue}" на "${событие.newValue}"`);
  console.log(`Домен: ${событие.url}`);
});
```

## Заключение

LocalStorage - это мощный инструмент для локального хранения данных в веб-приложениях. Он особенно полезен для сохранения пользовательских настроек, состояния приложения и временных данных. Однако важно учитывать его ограничения и использовать в сочетании с другими методами хранения данных, такими как [[IndexedDB]] для более сложных сценариев.

Для большинства задач фронтенд-разработки LocalStorage предоставляет простое и эффективное решение для персистентности данных на стороне клиента.

## См. также

- [[Сессионное-хранилище]]
- [[IndexedDB]]
- [[Куки]]
- [[Кэширование-данных]]
- [[Синхронизация-данных]]
- [[Персистентность-данных-в-веб-приложениях]]