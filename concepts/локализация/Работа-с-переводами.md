---
aliases: [Управление переводами, Системы перевода, Переводы в приложениях]
tags: [programming, localization, translation, frontend]
---

# Работа с переводами

## Обзор

Работа с переводами включает в себя управление, хранение, загрузку и использование локализованных строк в приложении. Это ключевой аспект процесса [[Локализация-контента|локализации]], который требует тщательной организации и использования подходящих инструментов.

## Системы управления переводами

### JSON-файлы

Самый простой способ хранения переводов — JSON-файлы:

```javascript
// locales/ru/common.json
{
  "greeting": "Привет",
  "farewell": "До свидания",
  "navigation": {
    "home": "Главная",
    "about": "О нас",
    "contact": "Контакты"
  }
}

// locales/en/common.json
{
  "greeting": "Hello",
  "farewell": "Goodbye",
  "navigation": {
    "home": "Home",
    "about": "About",
    "contact": "Contact"
  }
}
```

### YAML-файлы

Альтернатива JSON с более читаемым форматом:

```yaml
# locales/ru/common.yaml
greeting: "Привет"
farewell: "До свидания"
navigation:
  home: "Главная"
  about: "О нас"
  contact: "Контакты"
```

## Загрузка переводов

### Статическая загрузка

```javascript
import i18n from 'i18next';
import ruCommon from './locales/ru/common.json';
import enCommon from './locales/en/common.json';

i18n.init({
  lng: 'ru',
  resources: {
    ru: { translation: ruCommon },
    en: { translation: enCommon }
  }
});
```

### Динамическая загрузка

```javascript
import i18n from 'i18next';
import Backend from 'i18next-http-backend';

i18n
  .use(Backend)
  .init({
    lng: 'ru',
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json'
    }
  });
```

### Загрузка по требованию

```javascript
// Загрузка конкретного пространства имен
await i18n.loadNamespaces('user');
await i18n.changeLanguage('en');
```

## Организация переводов

### По модулям

Разделение переводов по функциональным модулям приложения:

```
locales/
├── ru/
│   ├── common.json
│   ├── user.json
│   ├── settings.json
│   └── dashboard.json
└── en/
    ├── common.json
    ├── user.json
    ├── settings.json
    └── dashboard.json
```

### По компонентам

```javascript
// Для конкретного компонента
// components/UserProfile/translations/ru.json
{
  "title": "Профиль пользователя",
  "edit": "Редактировать профиль",
  "save": "Сохранить изменения"
}
```

## Инструменты для работы с переводами

### i18next

```javascript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

i18n
  .use(initReactI18next)
  .init({
    lng: 'ru',
    fallbackLng: 'en',
    resources: {
      ru: {
        translation: {
          "welcome": "Добро пожаловать"
        }
      },
      en: {
        translation: {
          "welcome": "Welcome"
        }
      }
    },
    interpolation: {
      escapeValue: false
    }
  });
```

### FormatJS (React Intl)

```jsx
import { FormattedMessage } from 'react-intl';

function MyComponent() {
  return (
    <FormattedMessage 
      id="welcome" 
      defaultMessage="Welcome" 
      description="Приветственное сообщение на главной странице"
    />
  );
}
```

## Интерполяция и параметры

### Простая интерполяция

```javascript
// В файле переводов
{
  "greeting": "Привет, {{name}}!",
  "items_count": "У вас {{count}} элементов"
}

// В коде
const greeting = i18n.t('greeting', { name: userName });
const countMessage = i18n.t('items_count', { count: items.length });
```

### Сложная интерполяция с форматированием

```javascript
// Использование форматирования даты и чисел в переводах
const message = i18n.t('order_info', {
  productName: 'iPhone',
  price: formatCurrency(price, currency),
  date: formatDate(orderDate, locale)
});
```

## Множественное число

### i18next

```javascript
// В файле переводов
{
  "items": "{{count}} элемент",
  "items_plural": "{{count}} элементов",
  "items_few": "{{count}} элемента"
}

// Использование
const message = i18n.t('items', { count: itemCount });
```

### ICU MessageFormat

```javascript
// С использованием ICU
{
  "items": "{count, plural, one {# элемент} few {# элемента} many {# элементов} other {# элемента}}"
}

// В коде
const message = i18n.t('items', { count: itemCount });
```

## Плагины и расширения

### Плагин для проверки непереведённых строк

```javascript
// Плагин для отслеживания использования непереведённых ключей
const missingKeyHandler = (lng, ns, key, fallbackValue) => {
  console.warn(`Missing translation key: ${key} for language: ${lng}`);
  return fallbackValue;
};

i18n.init({
  missingKeyHandler,
  // ... другие настройки
});
```

### Плагин для автоматического сохранения непереведённых строк

```javascript
// Плагин для сбора непереведённых строк
const saveMissing = (lng, ns, key, fallbackValue) => {
  // Отправка непереведённой строки в систему управления переводами
  sendToTranslationSystem({ lng, ns, key, fallbackValue });
};

i18n.init({
  saveMissing: true,
  missingKeyHandler: saveMissing,
  // ... другие настройки
});
```

## Кэширование и оптимизация

### Кэширование переводов

```javascript
// Использование localStorage для кэширования переводов
const cache = {
  get: (lng, ns) => {
    const key = `i18n_${lng}_${ns}`;
    const cached = localStorage.getItem(key);
    return cached ? JSON.parse(cached) : null;
  },
  
  set: (lng, ns, data) => {
    const key = `i18n_${lng}_${ns}`;
    localStorage.setItem(key, JSON.stringify(data));
  }
};

i18n.use({
  type: 'backend',
  init: () => {},
  read: (lng, ns, callback) => {
    const cached = cache.get(lng, ns);
    if (cached) {
      callback(null, cached);
    } else {
      // Загрузка с сервера и сохранение в кэш
      fetch(`/locales/${lng}/${ns}.json`)
        .then(response => response.json())
        .then(data => {
          cache.set(lng, ns, data);
          callback(null, data);
        });
    }
  }
});
```

## Тестирование переводов

### Unit-тесты для переводов

```javascript
import { renderHook } from '@testing-library/react';
import { useTranslation } from 'react-i18next';

test('should return correct Russian translation', () => {
  const { result, rerender } = renderHook(() => useTranslation());
  
  // Установка русской локали
  result.current.i18n.changeLanguage('ru');
  rerender();
  
  const { t } = result.current;
  expect(t('common.save')).toBe('Сохранить');
});

test('should handle interpolation correctly', () => {
  const { result } = renderHook(() => useTranslation());
  const { t } = result.current;
  
  const message = t('greeting', { name: 'Иван' });
  expect(message).toBe('Привет, Иван!');
});
```

## Автоматизация процессов

### Извлечение строк для перевода

```bash
# Использование инструментов для извлечения строк из кода
# Например, i18next-parser
npx i18next-parser 'src/**/*.{js,jsx,ts,tsx}' --config i18next-parser.config.js
```

### Конфигурация i18next-parser

```javascript
// i18next-parser.config.js
module.exports = {
  contextSeparator: '_',
  createOldCatalogs: false,
  defaultNamespace: 'translation',
  defaultValue: '',
  indentation: 2,
  keepRemoved: false,
  keySeparator: '.',
  lexers: {
    js: ['JavascriptLexer'],
    jsx: ['JsxLexer'],
    ts: ['TypescriptLexer'],
   tsx: ['JsxLexer']
  },
  lineEnding: 'auto',
  locales: ['ru', 'en'],
  namespaceSeparator: ':',
  output: 'locales/$LOCALE/$NAMESPACE.json',
  input: ['src/**/*.{js,jsx,ts,tsx}']
};
```

## Практические рекомендации

### 1. Использование осмысленных ключей

```javascript
// Хорошо: описательные ключи
{
  "user_profile_save_button": "Сохранить профиль",
  "user_profile_edit_title": "Редактирование профиля"
}

// Плохо: неинформативные ключи
{
  "btn1": "Сохранить профиль",
  "title2": "Редактирование профиля"
}
```

### 2. Комментарии к переводам

```javascript
// Добавление комментариев к строкам для контекста
{
  "delete_confirmation": "Вы уверены, что хотите удалить этот элемент?",
  // context: "Подтверждение удаления элемента в списке"
  "submit_button": "Отправить",
  // context: "Кнопка отправки формы на странице контактов"
}
```

### 3. Проверка на дубликаты

Регулярно проверяйте файлы переводов на наличие дубликатов и устаревших строк.

## Заключение

Эффективная работа с переводами требует системного подхода, использования подходящих инструментов и автоматизации процессов. Хорошо организованная система управления переводами значительно упрощает процесс [[Локализация-контента|локализации]] и поддержку приложения на различных языках.

> [!tip]
> Используйте системы управления переводами (TMS) для сложных проектов с множеством языков.

> [!warning]
> Регулярно обновляйте переводы при изменении пользовательского интерфейса, чтобы избежать несоответствий.