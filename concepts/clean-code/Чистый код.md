# Чистый код (Clean Code)

Чистый код — это код, который легко читать, понимать и поддерживать. Концепция чистого кода основана на принципах, практиках и паттернах, которые делают программный код более качественным и надежным.

## Что такое чистый код

Чистый код обладает следующими характеристиками:
- Легко читается и понимается
- Имеет явные и понятные имена переменных, функций и классов
- Следует принципам SOLID, DRY, KISS и YAGNI
- Хорошо протестирован
- Имеет минимальную сложность
- Легко модифицируется

## Принципы чистого кода

### Именование

#### Плохое именование
```javascript
// Плохой пример
const d = new Date();
const elapsed = d.getTime() - creation.getTime();
const u = getUserById(id);
const n = u.name.split(' ').length;
```

#### Хорошее именование
```javascript
// Хороший пример
const currentDate = new Date();
const daysSinceCreation = currentDate.getTime() - creationDate.getTime();
const user = getUserById(userId);
const namePartsCount = user.fullName.split(' ').length;
```

### Функции

#### Длинные функции с множеством ответственностей
```javascript
// Плохой пример
function processUserOrder(userId, orderId) {
  // Получение пользователя
  const user = database.getUser(userId);
  if (!user) {
    throw new Error('Пользователь не найден');
  }
  
  // Получение заказа
  const order = database.getOrder(orderId);
  if (!order) {
    throw new Error('Заказ не найден');
  }
  
  // Проверка прав доступа
  if (user.id !== order.userId && !user.isAdmin) {
    throw new Error('Нет прав доступа к заказу');
  }
  
  // Расчет стоимости
  let total = 0;
  for (const item of order.items) {
    total += item.price * item.quantity;
  }
  
  // Применение скидки
  if (user.isVip) {
    total *= 0.9;
  }
  
  // Обновление статуса заказа
  order.status = 'processed';
  order.total = total;
  database.updateOrder(order);
  
  // Отправка уведомления
  emailService.send({
    to: user.email,
    subject: 'Заказ обработан',
    body: `Ваш заказ #${order.id} на сумму ${total} обработан`
  });
  
  // Логирование
  logger.info(`Заказ ${orderId} обработан для пользователя ${userId}`);
}
```

#### Короткие функции с одной ответственностью
```javascript
// Хороший пример
function processUserOrder(userId, orderId) {
  const user = this.getUserOrThrow(userId);
  const order = this.getOrderOrThrow(orderId);
  this.validateUserAccess(user, order);
  
  const total = this.calculateOrderTotal(order, user);
  this.updateOrderStatus(order, total);
  this.sendOrderNotification(user, order, total);
  this.logOrderProcessing(orderId, userId);
}

function getUserOrThrow(userId) {
  const user = database.getUser(userId);
  if (!user) {
    throw new Error('Пользователь не найден');
  }
  return user;
}

function getOrderOrThrow(orderId) {
  const order = database.getOrder(orderId);
  if (!order) {
    throw new Error('Заказ не найден');
  }
  return order;
}

function validateUserAccess(user, order) {
  if (user.id !== order.userId && !user.isAdmin) {
    throw new Error('Нет прав доступа к заказу');
  }
}
```

### Комментарии

#### Бесполезные комментарии
```javascript
// Плохой пример
// Увеличиваем i на 1
i++;

// Эта функция обрабатывает заказ
function processOrder(order) {
  // Обрабатываем заказ
  // ...
}

// TODO: сделать что-нибудь
// FIXME: исправить это
// HACK: костыль
```

#### Полезные комментарии
```javascript
// Хороший пример
// Алгоритм Брезенхэма для рисования линий
// Оптимизирован для работы с целочисленной арифметикой

// Временное решение из-за бага в API v2.3
// Удалить после обновления до v3.0
if (apiVersion === '2.3') {
  workaroundForApiBug();
}

/**
 * Рассчитывает стоимость доставки с учетом веса и расстояния
 * @param {number} weight - Вес посылки в кг
 * @param {number} distance - Расстояние в км
 * @returns {number} Стоимость доставки в рублях
 */
function calculateShippingCost(weight, distance) {
  // ...
}
```

## Чистый код в CSS

### Грязные стили
```css
/* Плохой пример */
.header {
  background-color: #333;
  color: white;
  padding: 10px;
  margin: 0;
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  border-bottom: 1px solid #ccc;
  position: relative;
  z-index: 100;
  box-sizing: border-box;
  width: 100%;
  height: 60px;
  line-height: 60px;
  /* Смешанные стили для разных целей */
}

.sidebar {
  width: 200px;
  float: left;
  background: #f5f5f5;
  padding: 20px;
  margin-top: 20px;
  border-right: 1px solid #ddd;
  /* Дублирование стилей */
}
```

### Чистые стили
```css
/* Хороший пример */
/* Базовые стили */
.base-padding {
  padding: 10px;
}

.base-margin {
  margin: 0;
}

/* Семантические стили */
.page-header {
  background-color: var(--color-primary);
  color: var(--color-text-light);
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  text-align: center;
  border-bottom: 1px solid var(--color-border);
  height: var(--header-height);
  line-height: var(--header-height);
}

.sidebar {
  width: var(--sidebar-width);
  background-color: var(--color-background-secondary);
  border-right: 1px solid var(--color-border);
}
```

## Чистый код в HTML

### Грязная разметка
```html
<!-- Плохой пример -->
<div>
  <div>
    <div onclick="doSomething()" style="color: red; font-size: 20px;">
      Заголовок
    </div>
  </div>
  <div>
    <p style="margin: 10px; padding: 5px; background: #f0f0f0;">
      Текст абзаца с инлайновыми стилями
    </p>
  </div>
</div>
```

### Чистая разметка
```html
<!-- Хороший пример -->
<article class="news-article">
  <header class="news-header">
    <h2 class="news-title">Заголовок новости</h2>
  </header>
  <div class="news-content">
    <p class="news-paragraph">Текст новости</p>
  </div>
</article>
```

## Тестирование чистого кода

### Грязные тесты
```javascript
// Плохой пример
test('user processing', () => {
  const user = { id: 1, name: 'John', email: 'john@example.com' };
  const order = { id: 1, userId: 1, items: [{ price: 100, quantity: 2 }] };
  
  // Сложный тест, проверяющий много всего сразу
  const result = processUserOrder(user, order);
  
  expect(result).toBeDefined();
  expect(result.user).toEqual(user);
  expect(result.order.total).toBe(200);
  expect(result.order.status).toBe('processed');
  expect(emailService.send).toHaveBeenCalled();
  // ... и так далее
});
```

### Чистые тесты
```javascript
// Хороший пример
describe('processUserOrder', () => {
  describe('when user exists', () => {
    it('should calculate correct total for regular user', () => {
      const user = createUser({ isVip: false });
      const order = createOrder({ items: [{ price: 100, quantity: 2 }] });
      
      const total = calculateOrderTotal(order, user);
      
      expect(total).toBe(200);
    });
    
    it('should apply discount for VIP user', () => {
      const user = createUser({ isVip: true });
      const order = createOrder({ items: [{ price: 100, quantity: 2 }] });
      
      const total = calculateOrderTotal(order, user);
      
      expect(total).toBe(180); // 10% скидка
    });
  });
  
  describe('when user does not exist', () => {
    it('should throw error', () => {
      expect(() => {
        getUserOrThrow(null);
      }).toThrow('Пользователь не найден');
    });
  });
});
```

## Преимущества чистого кода

### Для разработчиков
- Легче читать и понимать
- Проще тестировать
- Легче поддерживать и модифицировать
- Меньше ошибок

### Для бизнеса
- Быстрее разработка новых функций
- Меньше времени на исправление багов
- Легче найм новых разработчиков
- Долгосрочная стоимость поддержки ниже

## Практики написания чистого кода

### Code Review
Регулярный код-ревью помогает находить проблемы с чистотой кода и делиться знаниями между членами команды.

### Рефакторинг
Постоянный рефакторинг кода для улучшения его чистоты и качества.

### Автоматизированное тестирование
Тесты помогают убедиться, что рефакторинг не сломал существующую функциональность.

### Статический анализ
Использование линтеров и других инструментов для автоматической проверки качества кода.

## Связь с другими концепциями

- [[SOLID]] - Принципы SOLID являются основой чистого кода
- [[DRY (Don't Repeat Yourself)]] - Избегание дублирования делает код чище
- [[KISS (Keep It Simple, Stupid)]] - Простота является ключевой характеристикой чистого кода
- [[YAGNI (You Aren't Gonna Need It)]] - Избегание ненужной функциональности делает код чище
- [[Наследование]] - Правильное использование наследования способствует чистому коду
- [[Композиция]] - Предпочтение композиции над наследованием делает код чище
- [[Интерфейсы]] - Интерфейсы помогают создавать чистую архитектуру
- [[Дженерики]] - Правильное использование дженериков способствует типобезопасности

## Применение в различных технологиях

### В TypeScript

В [[ts]] чистый код реализуется особенно эффективно благодаря:
- Системе типов, которая делает код самодокументируемым
- Интерфейсам и абстрактным классам для создания чистой архитектуры
- Дженерикам для создания переиспользуемых компонентов
- Модулям для организации кода

### В HTML

В [[html]] чистый код проявляется в:
- Семантической разметке
- Правильной структуре документа
- Доступности и SEO-оптимизации
- Разделении содержимого и оформления

### В CSS

В [[css]] чистый код проявляется в:
- Методологиях организации стилей (БЭМ, OOCSS, SMACSS)
- Переиспользуемых компонентах
- Переменных и кастомных свойствах
- Адаптивном дизайне

## Теги
#clean-code #programming-concepts #best-practices #code-quality #readability