---
aliases: [Иммутабельные структуры данных, Неизменяемые коллекции]
tags: [programming, data-structures, immutability, javascript]
---

# Неизменяемые структуры данных

Неизменяемые структуры данных (immutable data structures) — это структуры данных, которые не могут быть изменены после создания. Любая операция над такой структурой создает новую структуру, оставляя исходную неизменной. Это фундаментальное понятие в функциональном программировании и современных архитектурах приложений.

## Что такое иммутабельность

Иммутабельность означает, что объект не может быть изменен после его создания. В контексте структур данных это означает, что при выполнении операций (например, добавление элемента в список) создается новая структура данных, а не модифицируется существующая.

```javascript
// Мутабельная структура данных
const arr = [1, 2, 3];
arr.push(4); // arr теперь [1, 2, 3, 4] - исходный массив изменен

// Иммутабельная операция
const newArr = [...arr, 4]; // создает новый массив, оставляя исходный неизменным
```

## Основные типы неизменяемых структур данных

### Списки (Lists)

Неизменяемые списки позволяют выполнять операции вставки, удаления и обновления без модификации исходного списка. Вместо этого создается новая версия списка с минимальными изменениями.

```javascript
// Пример работы с неизменяемым списком
const originalList = [1, 2, 3, 4, 5];
const updatedList = originalList.filter(item => item !== 3); // [1, 2, 4, 5]
// originalList остается [1, 2, 3, 4, 5]
```

### Словари/Карты (Maps)

Неизменяемые словари позволяют добавлять, удалять и изменять пары ключ-значение без изменения исходной структуры.

```javascript
// Пример работы с неизменяемым объектом
const originalMap = { name: 'John', age: 30 };
const updatedMap = { ...originalMap, age: 31 }; // создает новый объект
// originalMap остается неизменным
```

### Множества (Sets)

Неизменяемые множества позволяют добавлять и удалять элементы, создавая новые версии множества.

```javascript
// Пример работы с неизменяемым Set
const originalSet = new Set([1, 2, 3]);
const updatedSet = new Set([...originalSet, 4]); // создает новый Set
// originalSet остается неизменным
```

## Реализации неизменяемых структур данных

### На основе структур с разделяемой историей (Structural sharing)

Одним из ключевых преимуществ неизменяемых структур данных является эффективность. Они используют концепцию структурного разделения (structural sharing), при которой новые структуры данных разделяют неизмененные части с исходными структурами.

```javascript
// Иллюстрация структурного разделения
const obj1 = { a: 1, b: { c: 2 } };
const obj2 = { ...obj1, b: { ...obj1.b, d: 3 } }; // новый объект b, но a остается общим
```

### Паттерн "Persistent data structures"

Постоянные (persistent) структуры данных — это особый класс неизменяемых структур данных, где все версии структуры остаются доступными. Это позволяет эффективно работать с историей изменений.

## Преимущества неизменяемых структур данных

1. **Предсказуемость**: Поскольку структуры не изменяются, результаты операций всегда предсказуемы.
2. **Безопасность при параллелизме**: Несколько потоков могут безопасно использовать одну и ту же структуру данных.
3. **Упрощение отладки**: Легче отслеживать изменения и находить ошибки.
4. **Оптимизация производительности**: Структурное разделение позволяет избежать копирования всей структуры.

## Примеры использования

### В React-компонентах

Неизменяемые структуры данных особенно полезны в React-приложениях, где они помогают оптимизировать процесс рендеринга:

```javascript
import React, { memo, useMemo } from 'react';

const UserList = memo(({ users }) => {
  // users - неизменяемый массив
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
});

// Родительский компонент
function App() {
  const [users, setUsers] = useState([{ id: 1, name: 'Alice' }]);
  
  const addUser = (newUser) => {
    // Создаем новый массив вместо изменения существующего
    setUsers([...users, newUser]);
  };
  
  return <UserList users={users} />;
}
```

### В управлении состоянием

При использовании Redux или других систем управления состоянием неизменяемые структуры данных помогают избежать неожиданных изменений состояния:

```javascript
// Redux reducer
const userReducer = (state = initialState, action) => {
  switch (action.type) {
    case 'ADD_USER':
      return {
        ...state,
        users: [...state.users, action.payload]
      };
    case 'UPDATE_USER':
      return {
        ...state,
        users: state.users.map(user => 
          user.id === action.payload.id ? { ...user, ...action.payload } : user
        )
      };
    default:
      return state;
  }
};
```

## Заключение

Неизменяемые структуры данных — мощный инструмент в арсенале разработчика, особенно при создании сложных приложений, где предсказуемость и безопасность изменений критически важны. Понимание и использование этих структур помогает создавать более надежные и поддерживаемые приложения.

См. также: [[Преимущества-иммутабельности]], [[Иммутабельность-в-JavaScript]], [[Библиотеки-иммутабельности]]