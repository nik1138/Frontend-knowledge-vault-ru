---
aliases: [Библиотеки иммутабельности, Инструменты иммутабельности]
tags: [programming, libraries, immutability, javascript]
---

# Библиотеки иммутабельности

В JavaScript существует множество библиотек, которые помогают работать с неизменяемыми структурами данных. Эти библиотеки предоставляют удобные API для создания, модификации и работы с иммутабельными коллекциями, обеспечивая производительность и удобство использования.

## Immutable.js

Immutable.js от Facebook — одна из самых известных библиотек для работы с неизменяемыми структурами данных в JavaScript.

### Основные особенности

- Предоставляет богатый набор неизменяемых структур данных: List, Map, Set, OrderedMap, Record и другие
- Использует структурное разделение (structural sharing) для высокой производительности
- Встроенные методы для преобразования данных (map, filter, reduce и т.д.)

### Установка

```bash
npm install immutable
```

### Примеры использования

```javascript
import { Map, List, fromJS } from 'immutable';

// Создание неизменяемой карты
const initialMap = Map({ a: 1, b: 2, c: 3 });

// Модификация создает новую структуру
const updatedMap = initialMap.set('d', 4);
console.log(initialMap.toObject()); // { a: 1, b: 2, c: 3 }
console.log(updatedMap.toObject()); // { a: 1, b: 2, c: 3, d: 4 }

// Создание неизменяемого списка
const initialList = List([1, 2, 3]);
const updatedList = initialList.push(4);
console.log(initialList.toArray()); // [1, 2, 3]
console.log(updatedList.toArray()); // [1, 2, 3, 4]

// Работа с вложенными структурами
const nestedData = fromJS({
  users: [
    { id: 1, name: 'Alice', profile: { age: 25 } },
    { id: 2, name: 'Bob', profile: { age: 30 } }
  ]
});

const updatedNested = nestedData.updateIn(
  ['users', 0, 'profile', 'age'], 
  age => age + 1
);

console.log(nestedData.getIn(['users', 0, 'profile', 'age'])); // 25
console.log(updatedNested.getIn(['users', 0, 'profile', 'age'])); // 26
```

## Immer

Immer — библиотека, которая позволяет работать с неизменяемыми структурами данных, используя мутабельный синтаксис.

### Основные особенности

- Позволяет писать мутабельный код, который трансформируется в иммутабельный
- Маленький размер и высокая производительность
- Широко используется в Redux Toolkit

### Установка

```bash
npm install immer
```

### Примеры использования

```javascript
import { produce } from 'immer';

const baseState = [
  {
    todo: "Learn Immer",
    done: true
  },
  {
    todo: "Try Immer",
    done: false
  }
];

// Мутабельный синтаксис, но результат иммутабельный
const nextState = produce(baseState, draft => {
  draft.push({todo: "Tweet about it", done: false});
  draft[1].done = true;
});

console.log(baseState === nextState); // false
console.log(baseState[0] === nextState[0]); // true (структурное разделение)
```

## Seamless Immutable

Простая библиотека для создания неизменяемых структур данных, которая расширяет встроенные JavaScript объекты и массивы.

### Основные особенности

- Простота использования - работает с привычным синтаксисом
- Маленький размер
- Совместимость с существующим кодом

### Установка

```bash
npm install seamless-immutable
```

### Примеры использования

```javascript
import Immutable from 'seamless-immutable';

const state = Immutable({ users: [], count: 0 });

// Попытка мутации выбросит ошибку в strict mode
// state.count = 5; // Ошибка!

// Использование методов для создания новых структур
const newState = state.set('count', 5).update('users', users => 
  users.asMutable().concat([{ id: 1, name: 'John' }])
);

console.log(state.count); // 0
console.log(newState.count); // 5
```

## Mori

Библиотека, реализующая структуры данных Clojure для JavaScript.

### Основные особенности

- Постоянные структуры данных (persistent data structures)
- Функциональный подход
- Высокая производительность за счет структурного разделения

### Установка

```bash
npm install mori
```

### Примеры использования

```javascript
import * as m from 'mori';

// Создание неизменяемого вектора
const v1 = m.vector(1, 2, 3);
const v2 = m.conj(v1, 4); // [1, 2, 3, 4]

console.log(m.toJs(v1)); // [1, 2, 3]
console.log(m.toJs(v2)); // [1, 2, 3, 4]

// Работа с картами
const m1 = m.map("a", 1, "b", 2);
const m2 = m.assoc(m1, "c", 3);

console.log(m.get(m1, "a")); // 1
console.log(m.get(m2, "c")); // 3
```

## Immutable Collections

Более легковесная альтернатива Immutable.js.

### Основные особенности

- Меньше функций, чем Immutable.js
- Простота и легкость
- Хорошая производительность

### Установка

```bash
npm install @bloomberg/immutable-collection
```

## Использование в React-приложениях

Библиотеки иммутабельности особенно полезны в React-приложениях:

```javascript
import React, { useState } from 'react';
import { produce } from 'immer';

function TodoList() {
  const [todos, setTodos] = useState([]);
  
  const addTodo = (text) => {
    setTodos(produce(draft => {
      draft.push({ id: Date.now(), text, completed: false });
    }));
  };
  
  const toggleTodo = (id) => {
    setTodos(produce(draft => {
      const todo = draft.find(t => t.id === id);
      if (todo) todo.completed = !todo.completed;
    }));
  };
  
  return (
    <div>
      <button onClick={() => addTodo('New todo')}>Add Todo</button>
      {todos.map(todo => (
        <div key={todo.id}>
          <span 
            style={{ textDecoration: todo.completed ? 'line-through' : 'none' }}
            onClick={() => toggleTodo(todo.id)}
          >
            {todo.text}
          </span>
        </div>
      ))}
    </div>
  );
}
```

## Сравнение библиотек

| Библиотека | Размер | Сложность | Производительность | Особенности |
|------------|--------|-----------|-------------------|-------------|
| Immutable.js | Большой | Высокая | Высокая | Богатый API |
| Immer | Маленький | Низкая | Высокая | Мутабельный синтаксис |
| Seamless Immutable | Маленький | Средняя | Средняя | Совместимость |
| Mori | Средний | Высокая | Высокая | Clojure-стиль |

## Заключение

Выбор библиотеки иммутабельности зависит от конкретных потребностей проекта. Immutable.js подходит для сложных приложений с глубокой вложенностью данных, Immer - для упрощения работы с неизменяемыми структурами, а Seamless Immutable - для легкого перехода к иммутабельности в существующих приложениях.

См. также: [[Неизменяемые-структуры-данных]], [[Преимущества-иммутабельности]], [[Иммутабельность-в-JavaScript]]