---
aliases: [Node Package Manager, Менеджер пакетов NPM]
tags: [npm, package-manager, frontend, dependencies]
---

# NPM (Node Package Manager)

## Введение

NPM (Node Package Manager) - это стандартный менеджер пакетов для Node.js и один из самых популярных инструментов в экосистеме JavaScript. Он позволяет разработчикам легко устанавливать, обновлять и управлять зависимостями в своих проектах. NPM также предоставляет платформу для публикации и распространения пакетов, что делает его важным компонентом современной разработки.

## История и развитие

NPM был создан в 2010 году и стал неотъемлемой частью Node.js с самого начала. С тех пор он превратился в крупнейший репозиторий пакетов в мире, содержащий сотни тысяч пакетов. NPM был разработан как решение для управления зависимостями в Node.js проектах, но позже стал использоваться и в фронтенд-разработке.

## Основные функции NPM

### Установка пакетов

NPM позволяет устанавливать пакеты несколькими способами:

```bash
# Установка пакета как зависимости
npm install package-name

# Установка пакета как зависимости разработки
npm install package-name --save-dev

# Установка глобального пакета
npm install -g package-name

# Сокращенные версии команд
npm i package-name  # install
npm d package-name  # uninstall
npm up package-name # update
```

### Управление зависимостями

NPM управляет зависимостями через файлы package.json и package-lock.json:
- package.json - содержит метаданные проекта и зависимости
- package-lock.json - фиксирует точные версии установленных пакетов

### Скрипты

NPM позволяет определять пользовательские скрипты в package.json:

```json
{
  "scripts": {
    "start": "node index.js",
    "build": "webpack --mode production",
    "test": "jest",
    "dev": "nodemon index.js"
  }
}
```

## Конфигурация NPM

### Файл .npmrc

Файл .npmrc позволяет настраивать поведение NPM для конкретного проекта или глобально. Пример содержимого:

```
# Установка режима продакшена по умолчанию
engine-strict=true

# Использование сканирования уязвимостей
audit=true

# Установка максимального количества одновременных соединений
maxsockets=20

# Настройка приватного репозитория
@mycompany:registry=https://npm.mycompany.com
```

### Глобальная конфигурация

Команда `npm config` позволяет управлять настройками:

```bash
# Просмотр всех настроек
npm config list

# Установка значения
npm config set key value

# Просмотр конкретного значения
npm config get key

# Удаление значения
npm config delete key
```

## Управление версиями

### Семантическое версионирование

NPM следует принципам семантического версионирования (SemVer):
- MAJOR.MINOR.PATCH (например, 1.0.0)
- ^ (карет) - разрешает обновления до следующей мажорной версии
- ~ (тильда) - разрешает обновления до следующей патч-версии

### Обновление пакетов

```bash
# Обновление конкретного пакета
npm update package-name

# Обновление всех пакетов
npm update

# Проверка устаревших пакетов
npm outdated

# Аудит безопасности
npm audit
npm audit fix
```

## Пакеты и публикация

### Создание пакета

Для создания пакета необходимо:
1. Создать package.json с метаданными
2. Реализовать функциональность
3. Убедиться, что пакет соответствует стандартам

Пример package.json для пакета:
```json
{
  "name": "@username/package-name",
  "version": "1.0.0",
  "description": "Описание пакета",
  "main": "index.js",
  "scripts": {
    "test": "jest"
  },
  "keywords": ["ключевые", "слова"],
  "author": "Имя автора",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/username/repo.git"
  }
}
```

### Публикация пакета

```bash
# Вход в аккаунт
npm login

# Публикация пакета
npm publish

# Публикация приватного пакета
npm publish --access restricted
```

## Безопасность

### Аудит зависимостей

NPM предоставляет встроенный инструмент для аудита безопасности:

```bash
# Проверка уязвимостей
npm audit

# Автоматическое исправление уязвимостей
npm audit fix

# Проверка с определенным уровнем уязвимости
npm audit --audit-level high
```

### Управление уязвимостями

- Регулярное обновление зависимостей
- Использование npm audit для мониторинга
- Проверка лицензий пакетов
- Использование приватных репозиториев для чувствительных пакетов

## Производительность и оптимизация

### Кэширование

NPM кэширует установленные пакеты для ускорения установки:

```bash
# Очистка кэша
npm cache clean --force

# Просмотр директории кэша
npm config get cache

# Проверка кэша
npm cache verify
```

### Оптимизация установки

- Использование package-lock.json для воспроизводимости
- Регулярное обновление NPM до последней версии
- Использование npm ci для CI/CD (чистая установка без обновлений)

### CI/CD оптимизации

```yaml
# GitHub Actions
- name: Setup Node.js
  uses: actions/setup-node@v3
  with:
    node-version: '18'
    cache: 'npm'

- name: Install dependencies
  run: npm ci
```

## Скрипты и задачи

### Стандартные скрипты

NPM имеет встроенные скрипты, которые запускаются автоматически:
- preinstall - перед установкой
- install - при установке
- postinstall - после установки
- preuninstall - перед удалением
- uninstall - при удалении
- postuninstall - после удаления

### Пользовательские скрипты

```json
{
  "scripts": {
    "prebuild": "rimraf dist",
    "build": "webpack --mode production",
    "postbuild": "echo 'Build completed'",
    "dev": "webpack serve --mode development",
    "test": "jest --coverage",
    "lint": "eslint src/",
    "format": "prettier --write src/"
  }
}
```

## Работа с различными окружениями

### Режимы разработки и продакшена

NPM позволяет устанавливать зависимости для разных режимов:

```bash
# Установка зависимостей разработки
npm install --save-dev jest webpack

# Установка продакшен зависимостей
npm install --save react lodash

# Установка с игнорированием devDependencies
npm install --production
```

### Управление NODE_ENV

Переменная NODE_ENV влияет на поведение многих пакетов:

```bash
# Установка в Unix системах
export NODE_ENV=production
npm run start

# Установка в Windows
set NODE_ENV=production
npm run start

# Использование cross-env для кроссплатформенности
npm install --save-dev cross-env

# В package.json
{
  "scripts": {
    "start": "cross-env NODE_ENV=production node index.js"
  }
}
```

## Лучшие практики

### Структура package.json

Хорошо организованный package.json должен содержать:
- Понятное имя и описание
- Актуальную версию
- Правильные зависимости
- Полезные скрипты
- Информацию о репозитории
- Лицензию

### Управление зависимостями

- Регулярное обновление зависимостей
- Использование диапазонов версий с умом
- Удаление неиспользуемых зависимостей
- Проверка безопасности перед установкой

### Оптимизация размера

- Использование tree-shaking
- Удаление неиспользуемых файлов из зависимостей
- Использование легковесных альтернатив
- Оптимизация сборки

## Расширенные функции

### Работа с приватными репозиториями

NPM поддерживает работу с приватными репозиториями:

```bash
# Настройка приватного репозитория
npm config set @mycompany:registry https://npm.mycompany.com

# Установка пакета из приватного репозитория
npm install @mycompany/my-package
```

### Использование npm link

Для разработки локальных пакетов:

```bash
# В директории пакета
npm link

# В проекте, использующем пакет
npm link package-name
```

## Мониторинг и аналитика

### npm stats

Получение статистики по пакетам:

```bash
# Просмотр загрузок пакета
npm view package-name downloads

# Просмотр информации о пакете
npm view package-name

# Просмотр зависимостей
npm ls
npm ls --depth=0
```

## Совместимость и поддержка

### Поддержка Node.js версий

NPM поддерживает различные версии Node.js, и важно учитывать совместимость:

```json
{
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  }
}
```

### Проверка совместимости

```bash
# Проверка совместимости с engines
npm config set engine-strict true
```

## Заключение

NPM остается фундаментальным инструментом в экосистеме JavaScript и Node.js. Его возможности по управлению зависимостями, публикации пакетов и автоматизации задач делают его незаменимым инструментом для разработчиков.

Понимание всех аспектов работы с NPM - от базовой установки пакетов до продвинутых функций безопасности и оптимизации - критически важно для эффективной разработки современных приложений.

## Связанные концепции

- [[Dependency Management]] - Управление зависимостями
- [[Version Management]] - Управление версиями
- [[Yarn]] - Альтернативный менеджер пакетов
- [[PNPM]] - Быстрый менеджер пакетов
- [[Package Management]] - Общие принципы управления пакетами