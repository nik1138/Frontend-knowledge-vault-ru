---
aliases: ["Серверная валидация", "Валидация данных на сервере"]
tags: ["#validation", "#backend", "#security", "#data-integrity"]
---

# Валидация на сервере

Валидация на сервере является критически важной частью веб-разработки, обеспечивающей целостность данных и безопасность приложений. В отличие от клиентской валидации, серверная валидация не может быть обойдена пользователем и поэтому обязательна для всех приложений, работающих с пользовательскими данными.

## Основные принципы

- **Доверяй, но проверяй**: Всегда проверяй данные, поступающие от клиента, даже если они прошли валидацию на фронтенде
- **Раннее прерывание**: Валидируй данные как можно раньше в процессе обработки запроса
- **Соответствие бизнес-логике**: Валидация должна учитывать бизнес-правила, а не только технические ограничения

## Общие подходы

### Проверка типов данных
```javascript
// Пример валидации типа в Node.js
function validateUserInput(data) {
  if (typeof data.email !== 'string') {
    throw new Error('Email должен быть строкой');
  }
  
  if (!Number.isInteger(data.age)) {
    throw new Error('Возраст должен быть целым числом');
  }
}
```

### Санитизация данных
```javascript
// Пример санитизации ввода
const sanitizeInput = (input) => {
  return input.trim()
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
};
```

## Валидация в различных фреймворках

### Express.js
```javascript
const { body, validationResult } = require('express-validator');

app.post('/user', [
  body('email').isEmail().normalizeEmail(),
  body('password').isLength({ min: 6 }),
], (req, res) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({ errors: errors.array() });
  }
  
  // Обработка валидных данных
});
```

### FastAPI (Python)
```python
from pydantic import BaseModel, EmailStr
from fastapi import FastAPI

class User(BaseModel):
    email: EmailStr
    age: int = Field(ge=0, le=120)

@app.post("/user/")
def create_user(user: User):
    return user
```

## Безопасность и защита

### Предотвращение SQL-инъекций
```javascript
// Использование подготовленных выражений
const stmt = db.prepare('SELECT * FROM users WHERE id = ?');
stmt.run(userId);
```

### Защита от XSS
```javascript
// Санитизация HTML-вывода
const sanitizeHTML = (html) => {
  const div = document.createElement('div');
  div.textContent = html;
  return div.innerHTML;
};
```

## Лучшие практики

- **Валидация на границах**: Проверяй все входящие данные на границе твоего приложения
- **Использование схем**: Используй библиотеки для валидации схем, такие как Joi, Yup или Zod
- **Логирование ошибок**: Логируй валидационные ошибки для анализа и улучшения системы
- **Обратная связь пользователю**: Возвращай понятные сообщения об ошибках валидации

## Связанные темы
- [[Валидация-в-React]]
- [[Валидация-в-Vue]]
- [[Валидация-в-Svelte]]
- [[Схема-валидации]]
- [[Безопасность-веб-приложений]]

## Ключевые выводы
- Серверная валидация - это последняя линия защиты данных
- Валидация должна быть комплексной и учитывать все возможные уязвимости
- Использование проверенных библиотек упрощает процесс валидации