---
aliases: ["API Design", "Application Programming Interface", "REST API", "GraphQL API"]
tags: ["#api", "#rest", "#graphql", "#web-development", "#backend", "#design-patterns", "#architecture"]
---

# API Design - Принципы проектирования интерфейсов программирования приложений

API (Application Programming Interface) - это набор определений, протоколов и инструментов для создания программного обеспечения и приложений. API определяет взаимодействие между различными программными компонентами, позволяя им обмениваться данными и функциональностью.

## Определение API

API - это контракт между клиентом и сервером, определяющий, как они будут взаимодействовать. API описывает доступные методы, параметры, форматы данных и ожидаемые результаты. Хорошо спроектированный API должен быть понятным, последовательным и надежным.

API могут быть:
- Внутренними (для внутреннего использования в компании)
- Внешними (для использования сторонними разработчиками)
- Публичными (открытыми для всех)
- Частными (ограниченными для определенных пользователей)

## Принципы REST

REST (Representational State Transfer) - это архитектурный стиль для проектирования сетевых приложений. RESTful API следуют следующим принципам:

### Основные принципы REST:

1. **Client-Server архитектура** - разделение интересов между клиентом и сервером
2. **Stateless (без состояния)** - каждый запрос от клиента к серверу должен содержать всю информацию, необходимую для понимания и обработки запроса
3. **Cacheable (кешируемость)** - клиенты могут кешировать ответы
4. **Uniform Interface (единообразный интерфейс)** - единый способ взаимодействия с ресурсом
5. **Layered System (многоуровневая система)** - клиент может не знать, подключен ли он напрямую к серверу или через посредника
6. **Code on Demand (опционально)** - сервер может расширять функциональность клиента, передавая ему исполняемый код

### HTTP методы в REST:

```http
GET    /users          # Получить список пользователей
POST   /users          # Создать нового пользователя
GET    /users/123      # Получить информацию о конкретном пользователе
PUT    /users/123      # Обновить пользователя (полная замена)
PATCH  /users/123      # Частичное обновление пользователя
DELETE /users/123      # Удалить пользователя
```

## GraphQL vs REST

### REST:
- Использует несколько конечных точек
- Предопределенная структура данных
- Может привести к over-fetching или under-fetching данных
- Использует стандартные HTTP методы
- Хорошо документирован и понятен

### GraphQL:
- Одна конечная точка
- Клиент запрашивает только нужные данные
- Избегает over-fetching и under-fetching
- Типизированный язык запросов
- Более сложен в реализации и кешировании

```graphql
# Пример GraphQL запроса
{
  user(id: "123") {
    name
    email
    posts {
      title
      comments {
        text
      }
    }
  }
}
```

## Версионирование API

Версионирование API необходимо для поддержки обратной совместимости и постепенного обновления. Существует несколько подходов:

1. **URL версионирование**:
   ```
   https://api.example.com/v1/users
   https://api.example.com/v2/users
   ```

2. **Заголовки**:
   ```
   Accept: application/vnd.myapi.v1+json
   ```

3. **Параметры запроса**:
   ```
   https://api.example.com/users?version=1
   ```

## Обработка ошибок в API

API должен возвращать согласованные и понятные сообщения об ошибках:

```http
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid email format",
    "details": [
      {
        "field": "email",
        "issue": "Email format is invalid"
      }
    ]
  }
}
```

### Стандартные HTTP коды ошибок:
- `200 OK` - Успешный запрос
- `201 Created` - Ресурс успешно создан
- `400 Bad Request` - Неверный запрос
- `401 Unauthorized` - Неавторизованный доступ
- `403 Forbidden` - Доступ запрещен
- `404 Not Found` - Ресурс не найден
- `429 Too Many Requests` - Превышено ограничение скорости
- `500 Internal Server Error` - Внутренняя ошибка сервера

## Аутентификация и авторизация

### Аутентификация:
- **API ключи** - простой способ идентификации
- **OAuth 2.0** - стандарт для авторизации
- **JWT (JSON Web Tokens)** - токены для передачи информации
- **HTTP Basic Auth** - простая аутентификация

### Авторизация:
- Проверка прав доступа к ресурсам
- Ролевая модель (RBAC)
- Атрибутно-ориентированная модель (ABAC)

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Ограничение скорости (Rate Limiting)

Ограничение скорости защищает API от чрезмерного использования:

```http
HTTP/1.1 200 OK
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1609459200
```

## Документация API

Хорошая документация API должна включать:
- Описание всех конечных точек
- Примеры запросов и ответов
- Информацию об аутентификации
- Коды ошибок и их значения
- Примеры кода для различных языков

Инструменты для документации:
- [[OpenAPI/Swagger]]
- [[Postman Collections]]
- [[API Blueprint]]

## Стратегии тестирования

### Тестирование API включает:
- **Модульное тестирование** - тестирование отдельных функций
- **Интеграционное тестирование** - тестирование взаимодействия между компонентами
- **Функциональное тестирование** - тестирование конечных точек API
- **Нагрузочное тестирование** - проверка производительности под нагрузкой

```javascript
// Пример теста API
describe('Users API', () => {
  it('should create a new user', async () => {
    const response = await request(app)
      .post('/api/v1/users')
      .send({ name: 'John Doe', email: 'john@example.com' })
      .expect(201);
    
    expect(response.body.name).toBe('John Doe');
  });
});
```

## Лучшие практики

1. **Используйте понятные имена ресурсов**
   - `/users` вместо `/getUsers`
   - `/users/123/orders` для вложенных ресурсов

2. **Следуйте соглашениям об именовании**
   - Используйте kebab-case или snake_case для параметров
   - Используйте camelCase для полей JSON

3. **Возвращайте согласованные ответы**
   - Структурируйте ответы одинаково
   - Включайте метаданные при необходимости

4. **Обрабатывайте даты согласованно**
   - Используйте ISO 8601 формат
   - Предпочтительно в формате UTC

5. **Предоставляйте фильтрацию, сортировку и пагинацию**
   ```http
   GET /users?limit=10&offset=20&sort=created_at&order=desc&status=active
   ```

## Связи с другими концепциями

- [[HTTP-протокол]] - основа для REST API
- [[JSON]] - распространенный формат данных
- [[Authentication]] - важная часть безопасности API
- [[CORS]] - политика безопасности для веб-приложений
- [[Rate Limiting]] - защита от чрезмерного использования
- [[Error Handling]] - обработка ошибок в приложениях
- [[Testing]] - тестирование API для обеспечения качества
- [[Security]] - безопасность веб-приложений

## Заключение

Хорошо спроектированный API является критически важным компонентом современных приложений. Следование принципам REST, обеспечение безопасности, документирование и тестирование API позволяет создавать надежные и масштабируемые системы. Важно учитывать как текущие потребности, так и будущее развитие API.
