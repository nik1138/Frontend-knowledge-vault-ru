---
aliases: ["Градуальное улучшение", "Progressive Enhancement", "Progressive Web App"]
tags: [programming/enhancement, frontend, web-development, accessibility]
---

# Градуальное-улучшение

## Обзор

Градуальное улучшение (progressive enhancement) — это стратегия веб-разработки, при которой создается базовая функциональность, доступная для всех пользователей, а затем постепенно добавляются более продвинутые функции для пользователей с более современными браузерами и устройствами. Это подход, который начинает с доступного, семантически корректного HTML и постепенно улучшает опыт для более способных клиентов.

## Основные принципы градуального улучшения

### 1. Базовый уровень доступности

Сначала создается базовая версия сайта, которая работает даже в минимальных условиях:

```html
<!-- Базовая HTML-структура -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Мой сайт</title>
  <!-- Базовые стили -->
  <link rel="stylesheet" href="basic.css">
</head>
<body>
  <header>
    <h1>Мой сайт</h1>
    <nav>
      <ul>
        <li><a href="/">Главная</a></li>
        <li><a href="/about">О нас</a></li>
        <li><a href="/contact">Контакты</a></li>
      </ul>
    </nav>
  </header>
  
  <main>
    <article>
      <h2>Заголовок статьи</h2>
      <p>Содержимое статьи...</p>
    </article>
  </main>
  
  <footer>
    <p>&copy; 2023 Мой сайт</p>
  </footer>
  
  <!-- Базовая функциональность -->
  <script src="basic.js"></script>
  
  <!-- Улучшения для современных браузеров -->
  <script src="enhancements.js"></script>
</body>
</html>
```

### 2. Проверка возможностей (Feature Detection)

Вместо определения браузера, проверяются конкретные возможности:

```javascript
// Плохо: проверка браузера
if (navigator.userAgent.indexOf('MSIE') !== -1) {
  // специфичный код для IE
}

// Хорошо: проверка возможностей
if ('serviceWorker' in navigator) {
  // Регистрация сервис-воркера
  navigator.serviceWorker.register('/sw.js');
}

if ('geolocation' in navigator) {
  // Использование геолокации
  navigator.geolocation.getCurrentPosition(showPosition);
}

if ('IntersectionObserver' in window) {
  // Использование IntersectionObserver для lazy loading
  initLazyLoading();
} else {
  // Резервный вариант
  initScrollBasedLoading();
}
```

### 3. Пошаговое улучшение

```css
/* Базовый уровень - стили для всех браузеров */
.button {
  display: inline-block;
  padding: 10px 15px;
  background-color: #007cba;
  color: white;
  text-decoration: none;
  border: none;
  cursor: pointer;
}

/* Улучшение для браузеров с поддержкой flexbox */
@supports (display: flex) {
  .button-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
}

/* Улучшение для браузеров с поддержкой CSS Grid */
@supports (display: grid) {
  .layout {
    display: grid;
    grid-template-columns: 1fr 3fr;
    gap: 20px;
  }
}

/* Улучшение для браузеров с поддержкой современных цветов */
@supports (color: color(display-p3 1 0 0)) {
  .high-color-element {
    color: color(display-p3 1 0 0);
  }
}
```

## Практические примеры градуального улучшения

### 1. Формы

```html
<!-- Базовая форма -->
<form action="/submit" method="post">
  <div>
    <label for="email">Email:</label>
    <input type="text" id="email" name="email" required>
  </div>
  
  <div>
    <label for="date">Дата:</label>
    <input type="text" id="date" name="date"> <!-- Базовый текстовый ввод -->
  </div>
  
  <button type="submit">Отправить</button>
</form>

<script>
// Улучшение формы для современных браузеров
if ('input' in document.createElement('input')) {
  // Проверяем поддержку специфичных типов ввода
  const input = document.createElement('input');
  input.type = 'date';
  
  // Если браузер поддерживает тип date, обновляем поле
  if (input.type === 'date') {
    document.getElementById('date').type = 'date';
  } else {
    // Иначе подключаем календарь для старых браузеров
    loadDatePicker();
  }
}
</script>
```

### 2. Изображения

```html
<!-- Базовая версия с резервным изображением -->
<div class="image-container">
  <img src="fallback.jpg" alt="Описание изображения" id="dynamic-image">
</div>

<script>
// Улучшение для поддержки современных форматов
function loadOptimizedImage() {
  const img = document.getElementById('dynamic-image');
  
  // Проверяем поддержку WebP
  const webP = new Image();
  webP.onload = webP.onerror = function () {
    if (webP.height === 2) {
      // WebP поддерживается
      img.src = 'image.webp';
    }
    // Если WebP не поддерживается, остаемся с fallback.jpg
  };
  webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
}

// Вызываем улучшение
loadOptimizedImage();
</script>
```

### 3. Анимации

```css
/* Базовый стиль без анимации */
.menu-item {
  padding: 10px;
  background-color: #f0f0f0;
}

/* Улучшение для поддержки CSS-анимаций */
@supports (animation-name: test) {
  .menu-item {
    transition: background-color 0.3s ease;
  }
  
  .menu-item:hover {
    background-color: #e0e0e0;
  }
}

/* Дополнительное улучшение для поддержки prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .menu-item {
    transition: none;
  }
}
```

## Градуальное улучшение и доступность

```html
<!-- Пример градуального улучшения с учетом доступности -->
<button id="menu-toggle" aria-expanded="false" aria-controls="main-menu">
  Меню
</button>

<nav id="main-menu" hidden>
  <ul>
    <li><a href="/">Главная</a></li>
    <li><a href="/about">О нас</a></li>
    <li><a href="/contact">Контакты</a></li>
  </ul>
</nav>

<script>
// Базовая функциональность
document.getElementById('menu-toggle').addEventListener('click', function() {
  const menu = document.getElementById('main-menu');
  const isExpanded = this.getAttribute('aria-expanded') === 'true';
  
  this.setAttribute('aria-expanded', !isExpanded);
  menu.hidden = isExpanded;
});

// Улучшение для поддержки современных возможностей
if ('animate' in Element.prototype) {
  // Добавляем анимацию для современных браузеров
  document.getElementById('menu-toggle').addEventListener('click', function() {
    const menu = document.getElementById('main-menu');
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    
    if (!isExpanded) {
      menu.hidden = false;
      menu.animate([
        { opacity: 0, transform: 'translateY(-10px)' },
        { opacity: 1, transform: 'translateY(0)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      });
    } else {
      menu.animate([
        { opacity: 1, transform: 'translateY(0)' },
        { opacity: 0, transform: 'translateY(-10px)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      }).onfinish = () => {
        menu.hidden = true;
      };
    }
    
    this.setAttribute('aria-expanded', !isExpanded);
  });
}
</script>
```

## Проверка возможностей браузера

### 1. Создание проверок возможностей

```javascript
// Утилита для проверки возможностей
const FeatureDetection = {
  // Проверка поддержки CSS-свойства
  supportsCSS: function(property, value) {
    const div = document.createElement('div');
    div.style.cssText = property + ':' + value;
    return div.style.length !== 0;
  },
  
  // Проверка поддержки медиа-запроса
  supportsMediaQuery: function(query) {
    return window.matchMedia && window.matchMedia(query).matches;
  },
  
  // Проверка поддержки API
  supportsAPI: function(api) {
    return api in window;
  }
};

// Использование
if (FeatureDetection.supportsCSS('display', 'grid')) {
  document.body.classList.add('supports-grid');
} else {
  document.body.classList.add('no-grid');
}

if (FeatureDetection.supportsMediaQuery('(prefers-color-scheme: dark)')) {
  // Добавляем поддержку темной темы
  initDarkMode();
}
```

### 2. Улучшение для современных браузеров

```javascript
// Улучшения для современных браузеров
function applyProgressiveEnhancements() {
  // Проверка поддержки современных возможностей
  const features = {
    serviceWorker: 'serviceWorker' in navigator,
    webP: checkWebPSupport(),
    intersectionObserver: 'IntersectionObserver' in window,
    webAnimations: 'animate' in Element.prototype,
    cssGrid: CSS.supports('display', 'grid'),
    flexbox: CSS.supports('display', 'flex'),
    customProperties: CSS.supports('color', 'var(--fake-var)'),
    es6Modules: 'noModule' in HTMLScriptElement.prototype
  };
  
  // Применение улучшений на основе поддержки
  if (features.serviceWorker) {
    registerServiceWorker();
  }
  
  if (features.intersectionObserver) {
    initLazyLoading();
  } else {
    initScrollBasedLoading();
  }
  
  if (features.webAnimations) {
    initSmoothAnimations();
  }
  
  if (features.customProperties) {
    initThemeSystem();
  }
  
  // Добавление классов для CSS-улучшений
  Object.keys(features).forEach(feature => {
    if (features[feature]) {
      document.documentElement.classList.add(`supports-${feature}`);
    } else {
      document.documentElement.classList.add(`no-${feature}`);
    }
  });
}

// Вызов функции улучшения
applyProgressiveEnhancements();
```

## Градуальное улучшение и производительность

```javascript
// Улучшение производительности на основе возможностей устройства
function optimizeForDeviceCapabilities() {
  // Определение производительности устройства
  const deviceInfo = {
    hardwareConcurrency: navigator.hardwareConcurrency || 2,
    connection: navigator.connection ? navigator.connection.effectiveType : '4g',
    memory: navigator.deviceMemory || 4
  };
  
  // Для слабых устройств - упрощенная функциональность
  if (deviceInfo.hardwareConcurrency < 4 || deviceInfo.memory < 4) {
    // Отключение сложных анимаций
    disableComplexAnimations();
    
    // Использование упрощенных изображений
    useLowQualityImages();
    
    // Отложенная загрузка контента
    enableLazyLoading();
  } else {
    // Для мощных устройств - полная функциональность
    enableComplexAnimations();
    useHighQualityImages();
  }
  
  // Оптимизация для медленного соединения
  if (deviceInfo.connection === 'slow-2g' || deviceInfo.connection === '2g') {
    disableAutoPlayVideos();
    loadLowQualityImages();
  }
}
```

## Практические рекомендации

### 1. Структура проекта

```
project/
├── core/                 # Базовая функциональность
│   ├── html/            # Базовая HTML-структура
│   ├── css/
│   │   └── base.css     # Базовые стили
│   └── js/
│       └── base.js      # Базовая функциональность
├── enhancements/         # Улучшения
│   ├── css/
│   │   ├── grid.css     # Улучшения для Grid
│   │   └── animations.css # Анимации
│   └── js/
│       ├── grid.js      # Улучшения для Grid
│       └── animations.js # Анимации
└── feature-detection/   # Проверки возможностей
    └── detector.js
```

### 2. Загрузка улучшений

```html
<!-- Загрузка скриптов с градуальным улучшением -->
<script>
  // Базовая функциональность
  loadScript('core/js/base.js', function() {
    // После загрузки базовой функциональности
    // проверяем возможности и загружаем улучшения
    
    if ('serviceWorker' in navigator) {
      loadScript('enhancements/js/serviceworker.js');
    }
    
    if ('IntersectionObserver' in window) {
      loadScript('enhancements/js/intersection-observer.js');
    }
    
    // Загрузка CSS-улучшений
    if (CSS.supports('display', 'grid')) {
      loadCSS('enhancements/css/grid.css');
    }
    
    if (CSS.supports('(display: flex) and (display: grid)')) {
      loadCSS('enhancements/css/modern-layout.css');
    }
  });
  
  function loadScript(src, callback) {
    const script = document.createElement('script');
    script.src = src;
    script.onload = callback;
    document.head.appendChild(script);
  }
  
  function loadCSS(href) {
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  }
</script>
```

## Заключение

Градуальное улучшение — это мощная стратегия, которая позволяет создавать веб-приложения, доступные для всех пользователей, при этом предоставляя улучшенный опыт для пользователей с современными браузерами и устройствами. Этот подход способствует лучшей доступности, совместимости и пользовательскому опыту.

## См. также

- [[Кросс-браузерная-совместимость]]
- [[Адаптивность]]
- [[Поддержка-разных-устройств]]
- [[Прогрессивное-улучшение]]
- [[Accessibility]]
- [[Feature Detection]]
- [[Progressive Web Apps]]