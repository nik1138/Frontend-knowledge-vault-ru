---
aliases: ["Прогрессивное улучшение", "Progressive Web Apps", "PWA"]
tags: [programming/pwa, frontend, web-development, enhancement]
---

# Прогрессивное-улучшение

## Обзор

Прогрессивное улучшение (progressive enhancement) — это стратегия веб-разработки, при которой создается базовый уровень функциональности, доступный всем пользователям, а затем постепенно добавляются более продвинутые функции для пользователей с более современными браузерами и возможностями. Это подход, который обеспечивает доступность и совместимость, начиная с семантически правильного HTML и добавляя улучшения по мере возможности.

## Основные принципы прогрессивного улучшения

### 1. Базовая функциональность для всех

Создание минимально жизнеспособного продукта, который работает во всех браузерах:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Прогрессивное улучшение</title>
  <!-- Базовые стили -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    nav ul {
      list-style: none;
      padding: 0;
    }
    
    nav li {
      display: inline-block;
      margin-right: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Мой сайт</h1>
      <nav>
        <ul>
          <li><a href="/">Главная</a></li>
          <li><a href="/about">О нас</a></li>
          <li><a href="/contact">Контакты</a></li>
        </ul>
      </nav>
    </header>
    
    <main>
      <article>
        <h2>Статья</h2>
        <p>Содержимое статьи доступно всем пользователям.</p>
      </article>
    </main>
    
    <footer>
      <p>&copy; 2023 Мой сайт</p>
    </footer>
  </div>
  
  <!-- Базовая функциональность -->
  <script>
    // Базовая функциональность, которая работает везде
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Базовая функциональность загружена');
    });
  </script>
</body>
</html>
```

### 2. Проверка возможностей (Feature Detection)

Проверка конкретных возможностей вместо определения браузера:

```javascript
// Проверка поддержки конкретных API
const FeatureChecks = {
  serviceWorker: 'serviceWorker' in navigator,
  webP: checkWebPSupport(),
  geolocation: 'geolocation' in navigator,
  localStorage: 'localStorage' in window,
  webSocket: 'WebSocket' in window,
  canvas: !!document.createElement('canvas').getContext,
  video: !!document.createElement('video').canPlayType,
  touch: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
  webAnimations: 'animate' in Element.prototype,
  intersectionObserver: 'IntersectionObserver' in window,
  resizeObserver: 'ResizeObserver' in window,
  webComponents: 'customElements' in window
};

function checkWebPSupport() {
  const webP = new Image();
  webP.onload = webP.onerror = function () {
    return webP.height === 2;
  };
  webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
}

// Использование проверок возможностей
if (FeatureChecks.serviceWorker) {
  // Регистрация сервис-воркера
  navigator.serviceWorker.register('/sw.js')
    .then(function(registration) {
      console.log('SW зарегистрирован: ', registration);
    })
    .catch(function(error) {
      console.log('SW ошибка регистрации: ', error);
    });
}

if (FeatureChecks.geolocation) {
  // Использование геолокации
  navigator.geolocation.getCurrentPosition(
    function(position) {
      console.log('Широта: ' + position.coords.latitude);
      console.log('Долгота: ' + position.coords.longitude);
    },
    function(error) {
      console.error('Ошибка геолокации: ', error);
    }
  );
}
```

### 3. Улучшения через CSS

```css
/* Базовые стили для всех браузеров */
.grid-container {
  /* Резервный вариант для старых браузеров */
  display: block;
}

.grid-item {
  width: 100%;
  margin-bottom: 10px;
}

/* Улучшение для браузеров с поддержкой flexbox */
@supports (display: flex) {
  .grid-container {
    display: flex;
    flex-wrap: wrap;
  }
  
  .grid-item {
    flex: 1 1 300px;
    margin: 5px;
  }
}

/* Дополнительное улучшение для браузеров с поддержкой grid */
@supports (display: grid) {
  .grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 10px;
  }
  
  .grid-item {
    margin: 0;
  }
}

/* Улучшение для поддержки современных цветов */
@supports (color: color(display-p3 1 0 0)) {
  .modern-color-element {
    color: color(display-p3 1 0 0);
  }
}

/* Улучшение для поддержки container queries (экспериментально) */
@supports (width: container) {
  .adaptive-component {
    container-type: inline-size;
  }
  
  @container (min-width: 400px) {
    .adaptive-component .inner {
      display: flex;
    }
  }
}
```

## Прогрессивное улучшение в формах

### 1. Базовая форма

```html
<form action="/submit" method="post" id="contact-form">
  <div class="form-group">
    <label for="name">Имя:</label>
    <input type="text" id="name" name="name" required>
  </div>
  
  <div class="form-group">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
  </div>
  
  <div class="form-group">
    <label for="date">Дата:</label>
    <!-- Базовый текстовый ввод -->
    <input type="text" id="date" name="date">
  </div>
  
  <div class="form-group">
    <label for="range">Диапазон:</label>
    <!-- Базовый слайдер -->
    <input type="range" id="range" name="range" min="0" max="100" value="50">
  </div>
  
  <button type="submit">Отправить</button>
</form>
```

### 2. Улучшение формы

```javascript
// Улучшение формы для современных браузеров
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contact-form');
  
  // Проверка поддержки специфичных типов ввода
  const inputTest = document.createElement('input');
  
  // Улучшение для поля даты
  inputTest.type = 'date';
  if (inputTest.type === 'date') {
    document.getElementById('date').type = 'date';
  } else {
    // Подключение календаря для старых браузеров
    initDatePicker('date');
  }
  
  // Улучшение для поля диапазона
  inputTest.type = 'range';
  if (inputTest.type === 'range') {
    // Современные браузеры поддерживают range
    document.getElementById('range').addEventListener('input', function() {
      // Обновление значения в реальном времени
      updateRangeValue(this.value);
    });
  } else {
    // Резервный вариант для старых браузеров
    replaceWithNumberInput('range');
  }
  
  // Улучшение валидации
  if (form.checkValidity) {
    // Современные браузеры поддерживают встроенную валидацию
    form.addEventListener('submit', function(e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        showValidationErrors(form);
      }
    });
  } else {
    // Резервная валидация для старых браузеров
    form.addEventListener('submit', function(e) {
      if (!validateForm(form)) {
        e.preventDefault();
      }
    });
  }
});

// Резервные функции для старых браузеров
function validateForm(form) {
  // Ручная проверка валидации для старых браузеров
  let isValid = true;
  const inputs = form.querySelectorAll('input[required]');
  
  for (let input of inputs) {
    if (!input.value.trim()) {
      showError(input, 'Это поле обязательно');
      isValid = false;
    }
  }
  
  return isValid;
}

function showValidationErrors(form) {
  // Показ ошибок валидации для современных браузеров
  const invalidInputs = form.querySelectorAll('input:invalid');
  
  invalidInputs.forEach(input => {
    const message = input.validationMessage;
    showError(input, message);
  });
}
```

## Прогрессивное улучшение с использованием сервис-воркеров

```javascript
// service-worker.js
const CACHE_NAME = 'my-site-v1';
const urlsToCache = [
  '/',
  '/styles/main.css',
  '/scripts/main.js',
  '/images/logo.png'
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        console.log('Кэш открыт');
        return cache.addAll(urlsToCache);
      })
  );
});

self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        // Возвращаем кэшированный ответ или делаем сетевой запрос
        if (response) {
          return response;
        }
        return fetch(event.request);
      }
    )
  );
});

// В основном скрипте
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('SW зарегистрирован с областью:', registration.scope);
      }, function(err) {
        console.log('SW регистрация не удалась:', err);
      });
  });
}
```

## Прогрессивное улучшение и доступность

```html
<!-- Пример прогрессивного улучшения с учетом доступности -->
<button id="menu-toggle" aria-expanded="false" aria-controls="mobile-menu" class="menu-toggle">
  <span class="sr-only">Открыть меню</span>
  <span class="hamburger"></span>
</button>

<nav id="mobile-menu" class="mobile-menu" hidden>
  <ul>
    <li><a href="/">Главная</a></li>
    <li><a href="/about">О нас</a></li>
    <li><a href="/contact">Контакты</a></li>
  </ul>
</nav>

<style>
/* Базовые стили */
.menu-toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 10px;
  position: relative;
  width: 40px;
  height: 40px;
}

.hamburger {
  display: block;
  width: 20px;
  height: 2px;
  background-color: #333;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.hamburger:before,
.hamburger:after {
  content: '';
  display: block;
  width: 20px;
  height: 2px;
  background-color: #333;
  position: absolute;
  left: 0;
}

.hamburger:before {
  top: -6px;
}

.hamburger:after {
  bottom: -6px;
}

/* Улучшение для поддержки CSS-анимаций */
@supports (animation-name: test) {
  .menu-toggle .hamburger {
    transition: opacity 0.3s;
  }
  
  .menu-toggle .hamburger:before {
    transition: transform 0.3s, top 0.3s;
  }
  
  .menu-toggle .hamburger:after {
    transition: transform 0.3s, bottom 0.3s;
  }
  
  .menu-toggle[aria-expanded="true"] .hamburger {
    opacity: 0;
  }
  
  .menu-toggle[aria-expanded="true"] .hamburger:before {
    top: 0;
    transform: rotate(45deg);
  }
  
  .menu-toggle[aria-expanded="true"] .hamburger:after {
    bottom: 0;
    transform: rotate(-45deg);
  }
}
</style>

<script>
// Базовая функциональность
document.getElementById('menu-toggle').addEventListener('click', function() {
  const menu = document.getElementById('mobile-menu');
  const isExpanded = this.getAttribute('aria-expanded') === 'true';
  
  this.setAttribute('aria-expanded', !isExpanded);
  menu.hidden = isExpanded;
});

// Улучшение для современных возможностей
if ('animate' in Element.prototype) {
  // Добавляем анимацию для современных браузеров
  document.getElementById('menu-toggle').addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    
    if (!isExpanded) {
      menu.hidden = false;
      menu.animate([
        { opacity: 0, transform: 'translateY(-10px)' },
        { opacity: 1, transform: 'translateY(0)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      });
    } else {
      menu.animate([
        { opacity: 1, transform: 'translateY(0)' },
        { opacity: 0, transform: 'translateY(-10px)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      }).onfinish = () => {
        menu.hidden = true;
      };
    }
    
    this.setAttribute('aria-expanded', !isExpanded);
  });
}
</script>

<style>
/* Стили для доступности */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Улучшение для пользователей, предпочитающих уменьшенные анимации */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
```

## Прогрессивное улучшение и производительность

```javascript
// Улучшение производительности на основе возможностей устройства
function optimizeForDeviceCapabilities() {
  // Проверка возможностей устройства
  const deviceCapabilities = {
    hardwareConcurrency: navigator.hardwareConcurrency || 2,
    deviceMemory: navigator.deviceMemory || 4,
    connection: navigator.connection ? navigator.connection.effectiveType : '4g',
    battery: 'getBattery' in navigator
  };
  
  // Оптимизация для слабых устройств
  if (deviceCapabilities.hardwareConcurrency < 4 || deviceCapabilities.deviceMemory < 4) {
    // Отключение сложных анимаций
    document.documentElement.classList.add('low-performance-mode');
    
    // Использование упрощенных изображений
    useLowQualityImages();
    
    // Отложенная загрузка контента
    enableLazyLoading();
    
    // Упрощение визуальных эффектов
    disableComplexEffects();
  } else {
    // Для мощных устройств - полная функциональность
    document.documentElement.classList.add('high-performance-mode');
    enableComplexAnimations();
    useHighQualityImages();
  }
  
  // Оптимизация для медленного соединения
  if (deviceCapabilities.connection === 'slow-2g' || deviceCapabilities.connection === '2g') {
    disableAutoPlayVideos();
    loadLowQualityImages();
    deferNonCriticalResources();
  }
}

// Использование Intersection Observer для lazy loading
function initLazyLoading() {
  if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove('lazy');
          observer.unobserve(img);
        }
      });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
      imageObserver.observe(img);
    });
  } else {
    // Резервный вариант для старых браузеров
    initScrollBasedLoading();
  }
}

// Резервный вариант lazy loading
function initScrollBasedLoading() {
  const images = document.querySelectorAll('img[data-src]');
  
  function checkImages() {
    images.forEach(img => {
      if (isInViewport(img)) {
        img.src = img.dataset.src;
        img.classList.remove('lazy');
      }
    });
  }
  
  window.addEventListener('scroll', debounce(checkImages, 100));
  checkImages(); // Проверка при загрузке
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}
```

## Пример комплексного прогрессивного улучшения

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Комплексное прогрессивное улучшение</title>
  
  <style>
    /* Базовые стили */
    .gallery {
      display: block;
    }
    
    .gallery-item {
      display: block;
      margin-bottom: 10px;
    }
    
    .gallery-image {
      width: 100%;
      height: auto;
    }
    
    /* Улучшение для flexbox */
    @supports (display: flex) {
      .gallery {
        display: flex;
        flex-wrap: wrap;
      }
      
      .gallery-item {
        flex: 1 1 300px;
        margin: 5px;
      }
    }
    
    /* Дополнительное улучшение для grid */
    @supports (display: grid) {
      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 10px;
      }
      
      .gallery-item {
        margin: 0;
      }
    }
    
    /* Улучшение для поддержки современных возможностей */
    @supports (display: grid) and (object-fit: cover) {
      .gallery-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }
    }
  </style>
</head>
<body>
  <div class="gallery">
    <figure class="gallery-item">
      <img src="image1-low.jpg" alt="Изображение 1" data-src-high="image1-high.jpg" class="gallery-image lazy">
      <figcaption>Подпись к изображению 1</figcaption>
    </figure>
    <figure class="gallery-item">
      <img src="image2-low.jpg" alt="Изображение 2" data-src-high="image2-high.jpg" class="gallery-image lazy">
      <figcaption>Подпись к изображению 2</figcaption>
    </figure>
    <figure class="gallery-item">
      <img src="image3-low.jpg" alt="Изображение 3" data-src-high="image3-high.jpg" class="gallery-image lazy">
      <figcaption>Подпись к изображению 3</figcaption>
    </figure>
  </div>
  
  <script>
    // Комплексное прогрессивное улучшение
    document.addEventListener('DOMContentLoaded', function() {
      // Проверка возможностей
      const capabilities = {
        webP: checkWebPSupport(),
        intersectionObserver: 'IntersectionObserver' in window,
        serviceWorker: 'serviceWorker' in navigator,
        webAnimations: 'animate' in Element.prototype
      };
      
      // Применение улучшений на основе возможностей
      if (capabilities.intersectionObserver) {
        initModernLazyLoading();
      } else {
        initLegacyLazyLoading();
      }
      
      if (capabilities.webAnimations) {
        initGalleryAnimations();
      }
      
      if (capabilities.serviceWorker) {
        initServiceWorker();
      }
      
      // Добавление классов для CSS-улучшений
      Object.keys(capabilities).forEach(capability => {
        if (capabilities[capability]) {
          document.documentElement.classList.add(`supports-${capability}`);
        } else {
          document.documentElement.classList.add(`no-${capability}`);
        }
      });
    });
    
    function initModernLazyLoading() {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.srcHigh) {
              img.src = img.dataset.srcHigh;
            }
            img.classList.remove('lazy');
            observer.unobserve(img);
          }
        });
      });
      
      document.querySelectorAll('img[data-src-high]').forEach(img => {
        imageObserver.observe(img);
      });
    }
    
    function initLegacyLazyLoading() {
      // Резервный вариант для старых браузеров
      const images = document.querySelectorAll('img[data-src-high]');
      images.forEach(img => {
        img.src = img.dataset.srcHigh;
        img.classList.remove('lazy');
      });
    }
    
    function initGalleryAnimations() {
      // Анимации для галереи в современных браузерах
      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
          this.animate([
            { transform: 'scale(1)' },
            { transform: 'scale(1.05)' }
          ], {
            duration: 200,
            easing: 'ease-out'
          });
        });
        
        item.addEventListener('mouseleave', function() {
          this.animate([
            { transform: 'scale(1.05)' },
            { transform: 'scale(1)' }
          ], {
            duration: 200,
            easing: 'ease-out'
          });
        });
      });
    }
    
    function initServiceWorker() {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('Service Worker зарегистрирован');
        })
        .catch(error => {
          console.log('Service Worker ошибка:', error);
        });
    }
  </script>
</body>
</html>
```

## Заключение

Прогрессивное улучшение — это фундаментальный подход к веб-разработке, который обеспечивает доступность, совместимость и постепенное улучшение пользовательского опыта. Он позволяет создавать веб-приложения, которые работают для всех пользователей, независимо от их браузера или устройства, при этом предоставляя улучшенные возможности тем, кто может их использовать.

## См. также

- [[Кросс-браузерная-совместимость]]
- [[Адаптивность]]
- [[Поддержка-разных-устройств]]
- [[Градуальное-улучшение]]
- [[Progressive Web Apps]]
- [[Feature Detection]]
- [[Accessibility]]