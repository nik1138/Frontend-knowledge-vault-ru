---
tags: [programming, javascript, concepts, async]
aliases: [асинхронное программирование, асинхронность]
---

# Асинхронное программирование

## Введение

Асинхронное программирование — это парадигма программирования, при которой выполнение задач может происходить независимо от основного потока выполнения. Это позволяет приложениям оставаться отзывчивыми, выполняя длительные операции (например, сетевые запросы или операции ввода-вывода) без блокировки пользовательского интерфейса.

## Синхронное vs Асинхронное выполнение

### Синхронное выполнение

Синхронный код выполняется последовательно, строка за строкой. Каждая операция должна завершиться, прежде чем начнётся следующая.

```javascript
console.log('1');
console.log('2');
console.log('3');
// Вывод: 1, 2, 3
```

### Асинхронное выполнение

Асинхронный код позволяет начать выполнение операции, не дожидаясь её завершения, и продолжить выполнение других задач.

```javascript
console.log('1');
setTimeout(() => console.log('2'), 1000);
console.log('3');
// Вывод: 1, 3, 2 (через 1 секунду)
```

## Модели асинхронности

### Callbacks (коллбэки)

Коллбэки — это функции, передаваемые в другую функцию и вызываемые после завершения определённой операции.

```javascript
function fetchData(callback) {
  setTimeout(() => {
    callback(null, 'Данные получены');
  }, 1000);
}

fetchData((error, data) => {
  if (error) {
    console.error(error);
  } else {
    console.log(data);
  }
});
```

Проблема: "ад коллбэков" (callback hell) при вложенных вызовах.

### Promises (обещания)

Promise — это объект, представляющий результат асинхронной операции. Он может быть в одном из трёх состояний: pending, fulfilled, rejected.

```javascript
const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('Успешно!');
  }, 1000);
});

promise.then(result => console.log(result));
```

### Async/Await

Синтаксический сахар поверх Promises, позволяющий писать асинхронный код как синхронный.

```javascript
async function fetchDataAsync() {
  const response = await fetch('/api/data');
  const data = await response.json();
  return data;
}
```

## Event Loop (цикл событий)

Event Loop — это механизм, который позволяет JavaScript обрабатывать асинхронные операции, не блокируя основной поток выполнения. Он постоянно проверяет стек вызовов и очередь задач, выполняя задачи из очереди, когда стек пуст.

```javascript
console.log('Начало');

setTimeout(() => console.log('setTimeout'), 0);

Promise.resolve().then(() => console.log('Promise'));

console.log('Конец');

// Вывод: Начало, Конец, Promise, setTimeout
```

## Модели конкурентности

JavaScript использует однопоточную модель выполнения, но благодаря асинхронности и Event Loop может обрабатывать множество операций конкурентно. Это не многопоточность, а конкурентность на одном потоке.

## Race Conditions (состояние гонки)

Состояние гонки возникает, когда поведение программы зависит от того, в каком порядке выполняются асинхронные операции.

```javascript
let counter = 0;

function increment() {
  setTimeout(() => {
    counter++;
  }, Math.random() * 100);
}

increment();
increment();
// counter может быть 1 или 2, в зависимости от порядка выполнения
```

## Deadlocks (тупики)

Deadlock в асинхронном программировании JavaScript маловероятен из-за однопоточности, но может возникнуть при неправильном управлении синхронизацией между асинхронными задачами.

## Non-blocking I/O (неблокирующий ввод-вывод)

Неблокирующий ввод-вывод позволяет выполнять операции ввода-вывода (например, чтение файлов, сетевые запросы) без ожидания завершения, освобождая поток для других задач.

```javascript
// Неблокирующая операция
fs.readFile('file.txt', (err, data) => {
  if (err) throw err;
  console.log(data);
});

console.log('Файл читается...');
```

## Future/Promise паттерны

Future и Promise — это паттерны, представляющие значение, которое может быть доступно в будущем. Promise — это реализация этого паттерна в JavaScript.

## Связь с другими концепциями

- [[Event Loop]] — основа асинхронного выполнения
- [[Callbacks]] — первый подход к асинхронности
- [[Promises]] — улучшенная модель для работы с асинхронностью
- [[Async/Await]] — синтаксический сахар над Promises
- [[Concurrency]] — общая концепция параллельного выполнения
- [[Error Handling]] — особенности обработки ошибок в асинхронном коде

## Заключение

Асинхронное программирование — ключ к созданию отзывчивых и эффективных приложений. Понимание основных концепций, таких как Event Loop, Promise и async/await, критично для современной разработки.
