---
aliases: [Валидация данных, Проверка данных, Валидация ввода]
tags: [javascript, безопасность, валидация, безопасность-ввода]
---

# Валидация данных в JavaScript-приложениях

## Общее описание

Валидация данных - это процесс проверки, что входные данные соответствуют ожидаемому формату, типу и диапазону значений. В 2025 году правильная валидация данных является критическим элементом безопасности веб-приложений, предотвращающим множество типов атак, включая XSS, SQL-инъекции и CSRF.

## Зачем нужна валидация данных

1. **Безопасность** - предотвращение внедрения вредоносного кода
2. **Целостность данных** - обеспечение корректности информации в системе
3. **Стабильность приложения** - предотвращение ошибок из-за некорректных данных
4. **Соответствие требованиям** - соблюдение стандартов и нормативов

## Типы валидации

### 1. Клиентская валидация
Выполняется на стороне пользователя для улучшения UX:

```javascript
// Пример клиентской валидации
function validateEmail(email) {
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    return emailRegex.test(email);
}

function validatePassword(password) {
    // Пароль должен содержать не менее 8 символов, включая цифры и буквы
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;
    return passwordRegex.test(password);
}

// Комплексная валидация формы
function validateForm(formData) {
    const errors = {};
    
    if (!validateEmail(formData.email)) {
        errors.email = 'Некорректный email адрес';
    }
    
    if (!validatePassword(formData.password)) {
        errors.password = 'Пароль должен содержать не менее 8 символов, включая цифры и буквы';
    }
    
    if (formData.password !== formData.confirmPassword) {
        errors.confirmPassword = 'Пароли не совпадают';
    }
    
    return {
        isValid: Object.keys(errors).length === 0,
        errors
    };
}
```

### 2. Серверная валидация
Критически важна для безопасности:

```javascript
// Пример серверной валидации с использованием Node.js
const validator = require('validator');

function sanitizeAndValidateUserData(userData) {
    const sanitizedData = {};
    
    // Санитизация и валидация email
    if (userData.email) {
        const email = validator.normalizeEmail(userData.email);
        if (!validator.isEmail(email)) {
            throw new Error('Некорректный email адрес');
        }
        sanitizedData.email = email;
    }
    
    // Валидация и ограничение длины имени
    if (userData.name) {
        const name = validator.escape(userData.name.trim());
        if (name.length > 100) {
            throw new Error('Имя слишком длинное');
        }
        sanitizedData.name = name;
    }
    
    // Валидация возраста
    if (userData.age) {
        const age = parseInt(userData.age, 10);
        if (isNaN(age) || age < 0 || age > 150) {
            throw new Error('Некорректный возраст');
        }
        sanitizedData.age = age;
    }
    
    return sanitizedData;
}
```

## Современные библиотеки валидации

### 1. Joi (для Node.js)
```javascript
const Joi = require('joi');

const userSchema = Joi.object({
    email: Joi.string().email().required(),
    password: Joi.string().min(8).pattern(/^(?=.*[A-Za-z])(?=.*\d)/).required(),
    age: Joi.number().integer().min(0).max(150),
    profile: Joi.object({
        firstName: Joi.string().max(50).required(),
        lastName: Joi.string().max(50).required()
    }).required()
});

function validateUser(userData) {
    const { error, value } = userSchema.validate(userData);
    if (error) {
        throw new Error(`Валидация не пройдена: ${error.details[0].message}`);
    }
    return value;
}
```

### 2. Yup (для валидации на клиенте)
```javascript
import * as yup from 'yup';

const userSchema = yup.object({
    email: yup.string().email('Некорректный email').required('Email обязателен'),
    password: yup
        .string()
        .min(8, 'Пароль должен содержать не менее 8 символов')
        .matches(/^(?=.*[A-Za-z])(?=.*\d)/, 'Пароль должен содержать буквы и цифры')
        .required('Пароль обязателен'),
    confirmPassword: yup
        .string()
        .oneOf([yup.ref('password')], 'Пароли не совпадают')
        .required('Подтверждение пароля обязательно')
});

async function validateFormWithYup(formData) {
    try {
        await userSchema.validate(formData, { abortEarly: false });
        return { isValid: true };
    } catch (validationError) {
        const errors = {};
        validationError.inner.forEach(error => {
            errors[error.path] = error.message;
        });
        return { isValid: false, errors };
    }
}
```

## Валидация специфических типов данных

### 1. Валидация URL
```javascript
function validateURL(url) {
    try {
        const urlObject = new URL(url);
        // Проверяем протокол
        if (!['http:', 'https:'].includes(urlObject.protocol)) {
            return false;
        }
        return true;
    } catch {
        return false;
    }
}

// Использование с библиотекой validator
function validateAndSanitizeURL(url) {
    if (!validator.isURL(url, { 
        protocols: ['http', 'https'], 
        require_protocol: true 
    })) {
        throw new Error('Некорректный URL');
    }
    
    return validator.normalizeURL(url);
}
```

### 2. Валидация телефонных номеров
```javascript
function validateRussianPhone(phone) {
    // Проверка российского номера телефона
    const phoneRegex = /^(\+7|7|8)?[\s-]?\(?[0-9]{3}\)?[\s-]?[0-9]{3}[\s-]?[0-9]{2}[\s-]?[0-9]{2}$/;
    return phoneRegex.test(phone.replace(/\s/g, ''));
}

function validatePhone(phone) {
    if (!validateRussianPhone(phone)) {
        throw new Error('Некорректный российский номер телефона');
    }
    
    // Санитизация: оставляем только цифры
    return phone.replace(/\D/g, '');
}
```

### 3. Валидация дат
```javascript
function validateDate(dateString) {
    // Проверяем формат даты (YYYY-MM-DD)
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (!dateRegex.test(dateString)) {
        return false;
    }
    
    const date = new Date(dateString);
    // Проверяем, является ли дата действительной
    return date instanceof Date && !isNaN(date) && 
           date.toISOString().slice(0, 10) === dateString;
}

function validateDateRange(startDate, endDate) {
    if (!validateDate(startDate) || !validateDate(endDate)) {
        throw new Error('Некорректный формат даты');
    }
    
    const start = new Date(startDate);
    const end = new Date(endDate);
    
    if (start > end) {
        throw new Error('Дата начала не может быть позже даты окончания');
    }
    
    // Проверяем, что диапазон не превышает 1 год
    const diffTime = Math.abs(end - start);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays > 365) {
        throw new Error('Диапазон дат не может превышать 1 год');
    }
}
```

## Валидация файлов

```javascript
// Валидация файлов на клиенте
function validateFile(file, options = {}) {
    const {
        maxSize = 5 * 1024 * 1024, // 5MB по умолчанию
        allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'],
        allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf']
    } = options;
    
    // Проверка размера файла
    if (file.size > maxSize) {
        throw new Error(`Файл слишком большой. Максимальный размер: ${maxSize / (1024 * 1024)}MB`);
    }
    
    // Проверка MIME-типа
    if (!allowedTypes.includes(file.type)) {
        throw new Error(`Недопустимый тип файла: ${file.type}`);
    }
    
    // Проверка расширения
    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
    if (!allowedExtensions.includes(fileExtension)) {
        throw new Error(`Недопустимое расширение файла: ${fileExtension}`);
    }
    
    return true;
}

// Валидация файлов на сервере
function validateUploadedFile(filePath, fileBuffer) {
    // Проверка MIME-типа файла на основе содержимого
    const fileType = require('file-type');
    const detectedType = fileType(fileBuffer);
    
    if (!detectedType || !['jpg', 'png', 'pdf'].includes(detectedType.ext)) {
        throw new Error('Обнаружен недопустимый тип файла');
    }
    
    // Проверка размера
    const fs = require('fs');
    const stats = fs.statSync(filePath);
    if (stats.size > 5 * 1024 * 1024) {
        throw new Error('Файл слишком большой');
    }
    
    return detectedType;
}
```

## Валидация JSON-данных

```javascript
// Валидация JSON-схемы
function validateJSONSchema(data, schema) {
    // Простая проверка соответствия структуре
    for (const [key, requirements] of Object.entries(schema)) {
        if (requirements.required && !(key in data)) {
            throw new Error(`Обязательное поле ${key} отсутствует`);
        }
        
        if (key in data) {
            const value = data[key];
            
            // Проверка типа
            if (requirements.type && typeof value !== requirements.type) {
                throw new Error(`Поле ${key} должно быть типа ${requirements.type}`);
            }
            
            // Проверка диапазона для чисел
            if (typeof value === 'number') {
                if (requirements.min !== undefined && value < requirements.min) {
                    throw new Error(`Значение ${key} должно быть не меньше ${requirements.min}`);
                }
                if (requirements.max !== undefined && value > requirements.max) {
                    throw new Error(`Значение ${key} должно быть не больше ${requirements.max}`);
                }
            }
            
            // Проверка длины для строк
            if (typeof value === 'string') {
                if (requirements.minLength !== undefined && value.length < requirements.minLength) {
                    throw new Error(`Длина ${key} должна быть не меньше ${requirements.minLength}`);
                }
                if (requirements.maxLength !== undefined && value.length > requirements.maxLength) {
                    throw new Error(`Длина ${key} должна быть не больше ${requirements.maxLength}`);
                }
            }
        }
    }
    
    return true;
}

// Пример использования
const userSchema = {
    name: { type: 'string', required: true, minLength: 2, maxLength: 50 },
    age: { type: 'number', min: 0, max: 150 },
    email: { type: 'string', required: true }
};

try {
    validateJSONSchema({ name: 'Иван', age: 25, email: 'ivan@example.com' }, userSchema);
    console.log('Данные валидны');
} catch (error) {
    console.error('Ошибка валидации:', error.message);
}
```

## Валидация в российском контексте 2025

В 2025 году в России требования к защите персональных данных ужесточаются. Федеральный закон №152-ФЗ "О персональных данных" требует надежной валидации и защиты персональной информации.

Для приложений, обрабатывающих персональные данные российских граждан, обязательна:
- Валидация форматов персональных данных (ФИО, адреса, паспортные данные)
- Проверка корректности ввода банковской информации
- Контроль доступа к чувствительным данным
- Логирование попыток ввода некорректных данных

## Лучшие практики валидации

### 1. Валидация на всех уровнях
```javascript
// Клиентская валидация для UX
function clientSideValidation(data) {
    const errors = [];
    
    // Быстрая проверка на клиенте
    if (!data.email || !data.email.includes('@')) {
        errors.push('Некорректный email');
    }
    
    return errors;
}

// Серверная валидация для безопасности
function serverSideValidation(data) {
    // Тщательная проверка на сервере
    if (!validator.isEmail(data.email)) {
        throw new Error('Некорректный email');
    }
    
    // Санитизация данных
    return {
        email: validator.normalizeEmail(data.email)
    };
}
```

### 2. Централизованная система валидации
```javascript
// Централизованная система валидации
class Validator {
    constructor() {
        this.rules = new Map();
    }
    
    addRule(name, validatorFn) {
        this.rules.set(name, validatorFn);
        return this;
    }
    
    validate(data, ruleName) {
        const rule = this.rules.get(ruleName);
        if (!rule) {
            throw new Error(`Правило валидации ${ruleName} не найдено`);
        }
        return rule(data);
    }
}

// Регистрация правил
const validator = new Validator()
    .addRule('email', (value) => validator.isEmail(value))
    .addRule('password', (value) => value.length >= 8);
```

### 3. Валидация с учетом локали
```javascript
// Валидация с учетом российских стандартов
function validateRussianPersonalData(data) {
    const errors = {};
    
    // Проверка ФИО (допускаем кириллицу)
    if (data.fullName) {
        const nameRegex = /^[\u0400-\u04FF\s]{2,100}$/; // Кириллица и пробелы
        if (!nameRegex.test(data.fullName.trim())) {
            errors.fullName = 'ФИО должно содержать только кириллические буквы';
        }
    }
    
    // Проверка паспортных данных
    if (data.passport) {
        const passportRegex = /^\d{4}\s\d{6}$/; // Формат: 1234 567890
        if (!passportRegex.test(data.passport)) {
            errors.passport = 'Некорректный формат паспорта (XXXX XXXXXX)';
        }
    }
    
    return {
        isValid: Object.keys(errors).length === 0,
        errors
    };
}
```

## Заключение

Валидация данных является фундаментальным элементом безопасности веб-приложений. В 2025 году, особенно в российском контексте, правильная валидация помогает защитить персональные данные и предотвратить множество типов атак.

См. также: [[XSS-защита]], [[CSRF-защита]], [[CSP]], [[Защита-от-инъекций]]

> [!warning]
> Никогда не полагайтесь только на клиентскую валидацию - всегда проверяйте данные на сервере!