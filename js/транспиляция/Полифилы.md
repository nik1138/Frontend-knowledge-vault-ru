---
aliases: ["JavaScript полифилы", "ES6 полифилы", "Совместимость браузеров"]
tags: [javascript, polyfills, browser-compatibility, frontend-development, transpilation]
---

# Полифилы

**Полифилы** (polyfills) — это код, который реализует функциональность современных возможностей JavaScript в более старых браузерах, которые не поддерживают эти возможности нативно. В российской разработке 2025 года полифилы остаются важной частью обеспечения совместимости, особенно при необходимости поддержки устаревших браузеров в государственных и корпоративных системах.

## Основные концепции

Полифилы позволяют использовать современные возможности JavaScript, такие как:

- Методы массивов (Array.prototype.includes, Array.from)
- Методы строк (String.prototype.startsWith, String.prototype.endsWith)
- Promise и async/await
- fetch API
- WeakMap, Map, Set и другие коллекции
- Symbol и Proxy
- Модули (через транспиляцию)

## Популярные библиотеки полифилов

### core-js

Самая популярная и универсальная библиотека полифилов:

```bash
npm install core-js
```

Использование:
```javascript
// Полный импорт всех полифилов
import 'core-js';

// Импорт конкретных полифилов
import 'core-js/features/array/includes';
import 'core-js/features/promise';
import 'core-js/features/string/starts-with';
```

### regenerator-runtime

Необходим для поддержки async/await и генераторов:

```bash
npm install regenerator-runtime
```

Использование:
```javascript
import 'regenerator-runtime/runtime';
```

### babel-polyfill (устаревший)

Ранее использовался с Babel, но теперь заменен на core-js:

```javascript
// Ранее
import 'babel-polyfill';

// Теперь
import 'core-js/stable';
import 'regenerator-runtime/runtime';
```

## Настройка через Babel

Современный способ подключения полифилов через Babel:

```json
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "usage",
        "corejs": {
          "version": 3,
          "proposals": true
        }
      }
    ]
  ]
}
```

Параметр `useBuiltIns: "usage"` автоматически добавляет только те полифилы, которые действительно используются в коде.

## Ручное создание полифилов

Пример полифила для `Array.prototype.includes`:

```javascript
if (!Array.prototype.includes) {
  Array.prototype.includes = function(searchElement, fromIndex) {
    // Проверка на null или undefined
    if (this == null) {
      throw new TypeError('"this" is null or not defined');
    }

    // Приведение к объекту
    var o = Object(this);
    // Определение длины массива
    var len = parseInt(o.length) || 0;

    if (len === 0) {
      return false;
    }

    var n = fromIndex || 0;
    var k;

    // Обработка отрицательного индекса
    if (n >= 0) {
      k = n;
    } else {
      k = len + n;
      if (k < 0) { k = 0; }
    }

    var currentElement;
    while (k < len) {
      currentElement = o[k];
      if (searchElement === currentElement ||
         (searchElement !== searchElement && currentElement !== currentElement)) {
        return true;
      }
      k++;
    }

    return false;
  };
}
```

## Практические рекомендации

### Выбор полифилов

1. **Определите целевую аудиторию**: Узнайте, какие браузеры используют ваши пользователи
2. **Используйте caniuse.com**: Проверяйте поддержку возможностей в браузерах
3. **Минимизируйте размер**: Подключайте только необходимые полифилы
4. **Тестируйте на устаревших браузерах**: Особенно в российских условиях часто нужно тестировать в IE11

### Автоматическая загрузка полифилов

Использование сервиса polyfill.io:

```html
<script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2Ces2016%2Ces2017"></script>
```

Сервис определяет возможности браузера и подключает только необходимые полифилы.

### Настройка Webpack для полифилов

```javascript
module.exports = {
  entry: ['core-js/stable', 'regenerator-runtime/runtime', './src/index.js'],
  // остальная конфигурация
};
```

Или через plugin:

```javascript
module.exports = {
  plugins: [
    new webpack.ProvidePlugin({
      Promise: 'es6-promise-promise',
      fetch: 'imports-loader?this=>global!exports-loader?global.fetch!whatwg-fetch'
    })
  ]
};
```

## Особенности российской разработки

В 2025 году в российской разработке полифилы особенно важны по следующим причинам:

1. **Поддержка устаревших браузеров**: Многие государственные и корпоративные структуры продолжают использовать Internet Explorer 11, требуя подключения большого количества полифилов.

2. **Отечественные браузеры**: Необходимость тестирования и обеспечения совместимости с отечественными браузерами, такими как Яндекс.Браузер, Mail.Ru Агент, Спутник.

3. **Корпоративные ограничения**: Внутренние политики безопасности компаний могут ограничивать обновление браузеров, требуя поддержки устаревших версий.

4. **Региональные особенности**: В отдаленных регионах могут использоваться устаревшие системы, требующие дополнительных полифилов.

## Современные альтернативы

### Feature detection

Вместо подключения всех полифилов, можно использовать определение возможностей:

```javascript
if (!Array.prototype.includes) {
  // Подключить полифил только если необходим
  import('./array-includes-polyfill.js');
}
```

### Условная загрузка

Загрузка полифилов только при необходимости:

```javascript
// Проверка поддержки fetch
if (!window.fetch) {
  const script = document.createElement('script');
  script.src = '/path/to/fetch-polyfill.js';
  document.head.appendChild(script);
}
```

## Лучшие практики

### 1. Использование preset-env

Настройка Babel для автоматического подключения полифилов:

```json
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "targets": {
          "browsers": ["> 1%", "last 2 versions", "ie >= 11"]
        },
        "useBuiltIns": "usage",
        "corejs": 3
      }
    ]
  ]
}
```

### 2. Lazy loading полифилов

Подключение полифилов только при необходимости:

```javascript
async function loadPolyfills() {
  const needsPolyfills = !window.Promise || !Array.prototype.includes;
  
  if (needsPolyfills) {
    await import('core-js');
    await import('regenerator-runtime/runtime');
  }
}

loadPolyfills().then(() => {
  // Запуск основного приложения
  import('./app.js');
});
```

### 3. Мониторинг использования

Отслеживание использования полифилов в продакшн-среде:

```javascript
// Отправка статистики о необходимости полифилов
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log('SW registered'))
    .catch(e => console.error('SW failed', e));
} else {
  // Отправить метрику о необходимости полифила
  analytics.track('polyfill_needed', { feature: 'serviceWorker' });
}
```

## Связанные темы

- [[Babel]] - настройка полифилов через Babel
- [[Преобразование-кода]] - общие принципы транспиляции
- [[TypeScript]] - использование полифилов с TypeScript
- [[Webpack]] - интеграция полифилов с системами сборки
- [[Browser compatibility]] - обеспечение совместимости с браузерами
- [[Modern JavaScript]] - возможности, требующие полифилов

## Заключение

Полифилы остаются важной частью JavaScript-разработки в 2025 году, особенно в условиях необходимости поддержки разнообразных браузеров и сред выполнения. В российских условиях, где требуется поддержка устаревших систем, правильное использование полифилов позволяет использовать современные возможности языка, обеспечивая при этом совместимость с устаревшими окружениями. Ключ к успеху — баланс между функциональностью и производительностью, достигаемый через тщательный выбор и настройку полифилов.