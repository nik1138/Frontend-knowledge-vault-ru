---
aliases: ["Функциональная композиция", "Function Composition"]
tags: [programming, javascript, functional-programming, best-practices]
---

# Композиция функций

**Композиция функций** — это техника объединения двух или более функций для создания новой функции, где результат одной функции передается в качестве аргумента другой. Это одна из ключевых концепций функционального программирования, позволяющая создавать сложную логику из простых, переиспользуемых компонентов.

## Основная концепция

Композиция функций позволяет строить сложные вычисления, комбинируя простые функции. В математике это выражается как (f ∘ g)(x) = f(g(x)). В контексте российской разработки это особенно полезно при создании сложных бизнес-логик, где каждая функция отвечает за свою часть работы.

## Примеры композиции

### Простой пример

```javascript
// Определение простых функций
const add10 = x => x + 10;
const multiplyBy2 = x => x * 2;
const subtract5 = x => x - 5;

// Композиция функций вручную
const result = subtract5(multiplyBy2(add10(5))); // ((5 + 10) * 2) - 5 = 25

// Функция для композиции двух функций
const compose = (f, g) => x => f(g(x));

// Использование композиции
const composedFunction = compose(subtract5, multiplyBy2, add10);
// Важно: в традиционной композиции функции применяются справа налево
```

### Универсальная функция композиции

```javascript
// Композиция нескольких функций (справа налево)
const compose = (...fns) => x => fns.reduceRight((acc, fn) => fn(acc), x);

// Композиция нескольких функций (слева направо) - pipe
const pipe = (...fns) => x => fns.reduce((acc, fn) => fn(acc), x);

// Пример использования
const processNumber = pipe(
    add10,        // 5 + 10 = 15
    multiplyBy2,  // 15 * 2 = 30
    subtract5     // 30 - 5 = 25
);

console.log(processNumber(5)); // 25
```

## Практическое применение

### Обработка данных

```javascript
// Функции для обработки пользовательских данных
const trim = str => str.trim();
const toLowerCase = str => str.toLowerCase();
const addDomain = str => `${str}@example.com`;
const validateEmail = email => email.includes('@') && email.length > 5;

// Композиция для обработки и валидации email
const processEmail = pipe(
    trim,
    toLowerCase,
    addDomain,
    validateEmail
);

console.log(processEmail('  USER@EXAMPLE.COM  ')); // true
```

### Форматирование данных в российских условиях

```javascript
// Функции для работы с российскими телефонными номерами
const removeSpaces = str => str.replace(/\s/g, '');
const removeDashes = str => str.replace(/-/g, '');
const removeBrackets = str => str.replace(/[()]/g, '');
const formatToRussian = str => {
    const cleaned = str.replace(/\D/g, '');
    if (cleaned.length === 10 && cleaned[0] === '9') {
        return `+7${cleaned}`;
    }
    return cleaned;
};

// Композиция для форматирования телефонного номера
const formatPhone = pipe(
    removeSpaces,
    removeDashes,
    removeBrackets,
    formatToRussian
);

console.log(formatPhone('(495) 123-45-67')); // +74951234567
```

### Обработка финансовых данных

```javascript
// Функции для работы с финансовыми данными
const round = (value, decimals = 2) => Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);
const addTax = rate => value => value * (1 + rate);
const applyDiscount = discount => value => value * (1 - discount);
const formatCurrency = value => `₽${value.toFixed(2)}`;

// Композиция для обработки цены товара с налогами и скидками
const calculateFinalPrice = (basePrice, taxRate, discount) => pipe(
    applyDiscount(discount),
    addTax(taxRate),
    round,
    formatCurrency
)(basePrice);

console.log(calculateFinalPrice(1000, 0.2, 0.1)); // ₽1080.00
```

## Преимущества композиции

- **Читаемость**: Код становится более понятным и легче поддается чтению
- **Тестируемость**: Каждая функция может быть протестирована отдельно
- **Переиспользуемость**: Простые функции можно комбинировать различными способами
- **Модульность**: Легче поддерживать и изменять отдельные части логики
- **Чистота**: Функции остаются чистыми и не изменяют внешнее состояние

## Инструменты для композиции

### Использование Lodash

```javascript
const _ = require('lodash/fp');

// Lodash предоставляет встроенные функции для композиции
const processUser = _.flow([
    _.get('name'),
    _.trim,
    _.toLower,
    name => `${name}@company.ru`
]);

const user = { name: '  Иван Петров  ' };
console.log(processUser(user)); // 'иван петров@company.ru'
```

### Создание собственных утилит

```javascript
// Утилита для безопасного доступа к вложенным свойствам
const safeGet = (path, defaultValue = null) => obj => {
    const keys = path.split('.');
    let result = obj;
    
    for (const key of keys) {
        if (result == null) return defaultValue;
        result = result[key];
    }
    
    return result !== undefined ? result : defaultValue;
};

// Утилита для фильтрации массивов
const filterBy = predicate => arr => arr.filter(predicate);

// Утилита для маппинга массивов
const mapWith = fn => arr => arr.map(fn);

// Пример сложной композиции
const processUsers = pipe(
    safeGet('data.users', []),
    filterBy(user => user.active),
    mapWith(user => ({ name: user.name, email: user.email }))
);
```

## Практические советы

1. **Начинайте с простых функций**: Создавайте функции, которые делают только одну вещь
2. **Следите за порядком**: В традиционной композиции функции применяются справа налево
3. **Используйте pipe для левосторонней композиции**: Это делает код более понятным
4. **Давайте осмысленные имена**: Композиции также нужно давать понятные имена
5. **Тестируйте по отдельности**: Тестируйте каждую функцию отдельно, прежде чем тестировать композицию

## Заключение

Композиция функций — это мощный инструмент функционального программирования, который позволяет создавать сложную логику из простых, переиспользуемых компонентов. В российской практике разработки это особенно важно при создании масштабируемых приложений, где требуется высокая степень модульности и тестируемости.

## См. также

- [[Каррирование]]
- [[Неизменяемость]]
- [[Функции-высшего-порядка]]