---
aliases: ["E2E Tests", "End-to-End Testing", "Сквозное тестирование", "Пользовательские сценарии"]
tags: ["#javascript", "#testing", "#e2e-testing", "#user-journey", "#automation"]
---

# Сквозные тесты

## Определение сквозного тестирования

Сквозное тестирование (end-to-end testing, E2E) — это тип тестирования, при котором проверяется полный пользовательский сценарий от начала до конца. В контексте JavaScript-приложений сквозные тесты имитируют действия реальных пользователей, проходя через все уровни приложения (фронтенд, бэкенд, база данных и т.д.).

## Цель сквозных тестов

Цель сквозного тестирования — убедиться, что приложение работает корректно в целом, как его увидит реальный пользователь. Это позволяет:
- Проверить полные пользовательские сценарии
- Обнаружить проблемы интеграции между компонентами
- Убедиться в корректности рабочих процессов
- Проверить производительность в реальных условиях

## Отличие от других типов тестов

> [!note] Отличие сквозных тестов
> - [[Модульные-тесты]] тестируют отдельные компоненты в изоляции
> - [[Интеграционные-тесты]] тестируют взаимодействие между компонентами
> - Сквозные тесты тестируют полные пользовательские сценарии
> - Сквозные тесты самые медленные и ресурсоемкие
> - Сквозные тесты самые реалистичные

## Пирамида тестирования и E2E

Сквозные тесты составляют вершину пирамиды тестирования:
- Много [[Модульные-тесты|модульных тестов]]
- Меньше [[Интеграционные-тесты|интеграционных тестов]]
- Минимум сквозных тестов

Это связано с их сложностью, временем выполнения и хрупкостью.

## Примеры пользовательских сценариев

Сквозные тесты должны покрывать ключевые пользовательские сценарии:

1. **Регистрация пользователя**
   - Переход на страницу регистрации
   - Заполнение формы
   - Отправка формы
   - Проверка подтверждения регистрации

2. **Покупка товара**
   - Поиск товара
   - Добавление в корзину
   - Оформление заказа
   - Оплата

3. **Авторизация**
   - Переход на страницу входа
   - Ввод логина и пароля
   - Проверка доступа к защищенным страницам

## Инструменты для сквозного тестирования

### [[Инструменты-тестирования#Cypress]]

Cypress — один из самых популярных инструментов для E2E тестирования в российском IT-ландшафте 2025 года:

```javascript
// Пример теста с использованием Cypress
describe('Форма входа', () => {
  beforeEach(() => {
    cy.visit('/login');
  });

  it('должна позволять пользователю войти в систему', () => {
    cy.get('[data-cy=username]').type('testuser');
    cy.get('[data-cy=password]').type('password123');
    cy.get('[data-cy=submit]').click();

    cy.url().should('include', '/dashboard');
    cy.get('[data-cy=welcome-message]').should('contain', 'Добро пожаловать');
  });
});
```

### [[Инструменты-тестирования#Playwright]]

Playwright от Microsoft также широко используется:

```javascript
// Пример теста с использованием Playwright
import { test, expect } from '@playwright/test';

test('пользователь может зарегистрироваться', async ({ page }) => {
  await page.goto('/register');
  
  await page.locator('#name').fill('Иван Иванов');
  await page.locator('#email').fill('ivan@example.com');
  await page.locator('#password').fill('securepassword');
  
  await page.locator('button[type="submit"]').click();
  
  await expect(page).toHaveURL(/.*dashboard/);
  await expect(page.locator('.success-message')).toContainText('Регистрация успешна');
});
```

### [[Инструменты-тестирования#Selenium]]

Традиционный инструмент для автоматизации браузера:

```javascript
// Пример с использованием Selenium WebDriver
const { Builder, By, until } = require('selenium-webdriver');

describe('Тестирование формы входа', function() {
  let driver;

  beforeEach(async function() {
    driver = await new Builder().forBrowser('chrome').build();
    await driver.get('http://localhost:3000/login');
  });

  afterEach(async function() {
    await driver.quit();
  });

  it('должна успешно авторизовать пользователя', async function() {
    await driver.findElement(By.name('username')).sendKeys('testuser');
    await driver.findElement(By.name('password')).sendKeys('password123');
    await driver.findElement(By.css('button[type="submit"]')).click();

    await driver.wait(until.urlContains('/dashboard'), 5000);
    
    const welcomeText = await driver.findElement(By.css('.welcome')).getText();
    expect(welcomeText).to.include('Добро пожаловать');
  });
});
```

## Архитектура Page Object Model

Для организации сквозных тестов часто используется паттерн Page Object Model:

```javascript
// LoginPage.js
class LoginPage {
  constructor(page) {
    this.page = page;
    this.usernameInput = page.locator('#username');
    this.passwordInput = page.locator('#password');
    this.submitButton = page.locator('button[type="submit"]');
    this.errorMessage = page.locator('.error-message');
  }

  async login(username, password) {
    await this.usernameInput.fill(username);
    await this.passwordInput.fill(password);
    await this.submitButton.click();
  }

  async getErrorMessage() {
    return await this.errorMessage.textContent();
  }
}

// Тест, использующий Page Object
test('проверка ошибки при неверных данных', async ({ page }) => {
  const loginPage = new LoginPage(page);
  await page.goto('/login');
  
  await loginPage.login('invalid', 'invalid');
  
  expect(await loginPage.getErrorMessage()).toContain('Неверные учетные данные');
});
```

## Тестирование разных браузеров и устройств

Сквозные тесты должны проверять приложение в разных условиях:

```javascript
// Тестирование в разных браузерах с Playwright
import { test, expect } from '@playwright/test';

test.describe('Тестирование в разных браузерах', () => {
  test('должно работать в Chrome', async ({ page }) => {
    await page.goto('/products');
    await expect(page.locator('.product-list')).toBeVisible();
  });

  test('должно работать в Firefox', async ({ page, browserName }) => {
    test.skip(browserName !== 'firefox', 'Только для Firefox');
    
    await page.goto('/products');
    await expect(page.locator('.product-list')).toBeVisible();
  });

  test('должно работать на мобильных устройствах', async ({ page, isMobile }) => {
    test.skip(!isMobile, 'Только для мобильных устройств');
    
    await page.goto('/products');
    await expect(page.locator('.mobile-menu')).toBeVisible();
  });
});
```

## Обработка асинхронности и ожиданий

Важно правильно обрабатывать асинхронные операции в E2E тестах:

```javascript
// Пример обработки асинхронности в Cypress
it('должно отображать результаты поиска после ввода', () => {
  cy.get('[data-cy=search-input]').type('JavaScript');
  
  // Cypress автоматически ждет элементы
  cy.get('[data-cy=search-results]')
    .should('be.visible')
    .and('contain', 'JavaScript');
});

// Пример в Playwright
test('должно загружать список товаров', async ({ page }) => {
  await page.goto('/products');
  
  // Явное ожидание элемента
  await page.waitForSelector('.product-item', { state: 'visible' });
  
  const productCount = await page.locator('.product-item').count();
  expect(productCount).toBeGreaterThan(0);
});
```

## Тестирование API в сквозных тестах

Сквозные тесты могут включать проверки API:

```javascript
// Пример с Cypress для проверки API в E2E тесте
it('должно обновлять данные пользователя через API', () => {
  cy.intercept('PUT', '/api/users/*').as('updateUser');
  
  cy.get('[data-cy=profile-edit]').click();
  cy.get('[data-cy=name-input]').type('Новое имя');
  cy.get('[data-cy=save]').click();
  
  cy.wait('@updateUser').then((interception) => {
    expect(interception.response.statusCode).to.eq(200);
    expect(interception.request.body.name).to.eq('Новое имя');
  });
});
```

## Практические рекомендации

> [!tip] Лучшие практики для E2E тестов
> - Писать тесты как реальные пользовательские сценарии
> - Использовать стабильные селекторы (data-* атрибуты)
> - Избегать хардкодинга ожиданий времени
> - Тестировать только критически важные пути
> - Использовать фикстуры для тестовых данных
> - Регулярно обновлять тесты при изменении интерфейса

## Организация тестов

Для лучшей организации сквозные тесты можно группировать:

```
e2e/
├── specs/
│   ├── auth/
│   │   ├── login.spec.js
│   │   ├── registration.spec.js
│   │   └── password-reset.spec.js
│   ├── products/
│   │   ├── search.spec.js
│   │   ├── details.spec.js
│   │   └── cart.spec.js
│   └── checkout/
│       ├── billing.spec.js
│       ├── payment.spec.js
│       └── confirmation.spec.js
├── pages/
│   ├── LoginPage.js
│   ├── ProductPage.js
│   └── CheckoutPage.js
└── fixtures/
    ├── users.json
    └── products.json
```

## Современные подходы в российском IT (2025)

В 2025 году в российской практике сквозное тестирование включает:

- **Visual testing** — проверка визуального соответствия
- **Accessibility testing** — проверка доступности для пользователей с ограниченными возможностями
- **Performance testing** — проверка производительности в реальных условиях
- **Cross-browser testing** — проверка на различных браузерах и устройствах
- **AI-assisted testing** — использование ИИ для генерации тестов

## Заключение

Сквозные тесты являются важной частью обеспечения качества JavaScript-приложений, проверяя полные пользовательские сценарии. Хотя они требуют больше ресурсов и времени на выполнение, они обеспечивают уверенность в том, что приложение работает корректно в целом. Важно использовать их умеренно, фокусируясь на ключевых пользовательских сценариях и сочетая с другими типами тестов.

> [!note] См. также
> - [[Введение-в-тестирование]]
> - [[Модульные-тесты]]
> - [[Интеграционные-тесты]]
> - [[Инструменты-тестирования]]
> - [[Тестирование-доступности]]